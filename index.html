<!DOCTYPE html>
<html lang="en">
	<head>
        <script src = 'tools/jquery/jquery.3.3.1.min.js'></script>
        <script src = 'js/workaroundnetlify.js'></script>

        <script>

            function checklocationurl(){
                // console.log('load checklocationurl')
                var currentURL = window.location.href;
                // if the page is on local host, go to index2.html directly
                if (currentURL.startsWith("http://localhost:")){
                    window.location.href ='index2.html'
                } 
            }
            function checkpasscode() {
                //get the passcode
                var passcode = document.getElementById('passcode').value;
                console.log(passcode)


                //if the page is on netlify, do not use ajax post, as php is not suported
                var currentURL = window.location.href;
                console.log(currentURL)
                if (currentURL.endsWith("netlify.com/")){
                    console.log('hey, it is netlify!')

                    // load the conents in workaroundnetlify
                    var workaroundobj= workaroundnetlify();
                    console.log(workaroundobj)
                    if (passcode ===workaroundobj.code ) {
                        // stringify the json
                        var workaroundjsonstr=JSON.stringify(workaroundobj.json)
                        //save the json str into a sessionStorage item
                        sessionStorage.setItem('thejsonstr', workaroundjsonstr);
                        sessionStorage.setItem('thejsonstrname', workaroundobj.name);
                        // goto index2.html
                        window.location.href ='index2.html'                        
                    } else {
                        console.log ("The passcode is incorrect. Please try again")
                        $("p#prompt").text("The passcode is incorrect. Please try again.");
                    }

                } else {

                    var 
                        jsontosend = {
                            passcode:passcode
                        }

                    //post the password to 'php/checkpasscode.php', and get returned contents
                    var jqxhr = $.post( 
                        "php/checkpasscode.php", 
                        jsontosend, 
                        'json'
                        )
                        // the following is to return the contents printed on the target php, so that user can 
                        // moniter whether the target php runs normally or having errors.
                        .done(function(d) {
                        console.log( 'On php/checkpasscode.php:\n' + d );
                        if (d==="inCorRect") {
                            console.log ("The passcode is incorrect. Please try again")
                            $("p#prompt").text("The passcode is incorrect. Please try again.");
                        } else {
                            // if the returned d is a json (passcode is correct)
                            //save the json str into a sessionStorage item
                            sessionStorage.setItem('thejsonstr', d);
                            sessionStorage.setItem('thejsonstrname', 'ULtraSound_20191221');
                    
                            // goto index2.html
                            window.location.href ='index2.html'
                        }
                    }) // end post
                } // end if
            } // end function checkpasscode()
        </script>
 	</head>
  	<body onload="checklocationurl()">
        <h2>Please input passcode:</h2>
        <input type="text" name="passcode" id="passcode">
        <button onclick= "checkpasscode()">Submit</button>
        <p id="prompt"></p>        
	 </body>
	 <footer>
		 
	 </footer>
	 
</html>


