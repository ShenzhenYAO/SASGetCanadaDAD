{"idx":"ProjectCollection-cmSbt48MqRzD7t79","name":"DataCreation_Physician_Impact_Pro_20191126","children":[{"idx":"CodeTask-iqlReHV8qNfiqkLR","name":"_0A ProjectRootPath","NodeDescription":"///t<br/>///s<br/>/*Get path of the current EG project file*/<br/><br/>%global thisProjectRootPath ThisEGPPath&#59<br/><br/>/*the following is put in a macro so that all the vars can be set as local*/<br/>%macro defineProjectRootPath&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%local RevEGPPath SearchSeg RevSearchSegPosition StartPosOftheRevProjectRootPath<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspLengthRevEGPPath theRevProjectRootPathLength theRevProjectRootPath<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the path of this EGP project file<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNote that the value of system variable &_clientprojectpath is wrapped by apostrophes '', which should be stripped to avoid error.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ThisEGPPath =%sysfunc(dequote(&_clientprojectpath))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &ThisEGPPath&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*to reversely search and find the root folder<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFor example, the EGPPath is <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspS:\\Collaborative_researchers\\LinaAlSakran\\Project4(LAlsakaran)\\SAS code\\_Bio15_331\\SAS code\\DataCreation_Project4_20190514.egp&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspThe project root path is <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspS:\\Collaborative_researchers\\LinaAlSakran\\Project4(LAlsakaran)\\SAS code\\_Bio15_331\\<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspi.e., the sub string before '\\SAS code\\'.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNote that  '\\SAS code\\' appears twice in the EGPPath, the expected root path is before the last incidence of 'SAS code\\'. <br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspThe following is a clumpsy way of doing it, but it works.<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*1. Make a reverse string of the EGPPath<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppge.41509102_4tcejorP_noitaerCataD\\edoc SAS\\133_51oiB_\\edoc SAS\\)narakaslAL(4tcejorP\\narkaSlAaniL\\srehcraeser_evitaroballoC\\:S<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let RevEGPPath =%sysfunc(reverse(&ThisEGPPath))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &RevEGPPath&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*2. The string segment to search is '\\SAS code\\'<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphowever, in the revered EGPPath by step 1, the segment to search should also be reversed:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspso it is like '\\edoc SAS\\'<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/ <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let SearchSeg=\\SAS code\\&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let RevSearchSeg=%sysfunc(reverse(&SearchSeg))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &RevSearchSeg&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*3. In the reversed EGPPath, search the first position of the reversed search segment<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNote use %nrbquote() instead of %str() so as to escape specail characters in the string. Otherwise SAS is not smart enough to carry on.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspuse %nrbquote instead of %quote to handle each single bracket. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let RevSearchSegPosition = %index(%nrbquote(&RevEGPPath), %nrbquote(&RevSearchSeg))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &RevSearchSegPosition&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*4. Determine the start position of the target sub string<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspThe position of the reversed search segment ('\\edoc SAS\\') is obtained in &RevSearchSegPosition, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspThe reversed search segment ('\\edoc SAS\\') has a length of %length(&RevSearchSeg).<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTherefore the start position of the target sub string is:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&RevSearchSegPosition + %length(&RevSearchSeg) .<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let StartPosOftheRevProjectRootPath = %eval(&RevSearchSegPosition + %length(&RevSearchSeg))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &StartPosOftheRevProjectRootPath&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*5. Determine the length of the target sub string<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIt should be the length of (&RevEGPPath) -  &StartPosOftheRevProjectRootPath +1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let LengthRevEGPPath=%length(%nrbquote(&RevEGPPath))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &LengthRevEGPPath &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theRevProjectRootPathLength = %eval(&LengthRevEGPPath -  &StartPosOftheRevProjectRootPath+1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &theRevProjectRootPathLength&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*6. Get the substr from the reversed EGPPath, after the start position<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNote, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp1) such string is the reversed Project Root Path.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2) use %nrbquote() instead of %str() so as to escape specail characters in the string. Otherwise SAS is not smart enough to carry on. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspuse %nrbquote instead of %quote to handle each single bracket. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theRevProjectRootPath = %substr(%nrbquote(&RevEGPPath), &StartPosOftheRevProjectRootPath, &theRevProjectRootPathLength)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>>&theRevProjectRootPath&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*7. finally, Reverse the reversed project root path again. This time, the project root path is obtained!*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let thisProjectRootPath = %sysfunc(reverse(%nrbquote(&theRevProjectRootPath)))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &thisProjectRootPath&#59<br/><br/>%mend defineProjectRootPath&#59<br/>%defineProjectRootPath&#59<br/>s///<br/>t///","children":[{"idx":"CodeTask-lm45gKn6MFkGPZo4","name":"_0B Local Settings","NodeDescription":"///t<br/>///s<br/>/*include macro tools in drive S<br/>&nbsp&nbsp&nbsp&nbsp/LRECL to allow the length of a statement line to be 32767 bytes instead of the default 256<br/>*/<br/><br/>/*set global variables*/<br/>%global <br/>/*the new cohort creation sas tools*/<br/>&nbsp&nbsp&nbsp&nbspnccSASTools<br/>/*a local folder allowing data exchange between local and remote server*/<br/>&nbsp&nbsp&nbsp&nbspexchangeDir<br/>/*the xlsx file with project settings (i.e., InputForm.xlsm)*/<br/>&nbsp&nbsp&nbsp&nbspsettingsXls<br/>/*the xlsx file on R drive with hospital information*/<br/>&nbsp&nbsp&nbsp&nbsph_Infoxls <br/>/*the path including reports at local*/<br/>&nbsp&nbsp&nbsp&nbsplocalReportPath<br/>/*the xlsx file2 with data reports*/<br/>&nbsp&nbsp&nbsp&nbspAnalyticalReport <br/>&nbsp&nbsp&nbsp&nbspDataReport <br/>/*the xlsx file as the database dictionary*/<br/>&nbsp&nbsp&nbsp&nbspdicXls<br/>/* the folder on remote server containing common tool files for new cohort creation*/<br/>&nbsp&nbsp&nbsp&nbspremoteToolsPath<br/>&#59<br/><br/>/*including the sas macros for new cohort creation*/<br/>%let nccSASTools=P:\\02 New project data creation\\Tools\\SAS tools\\tools_ncc.sas&#59<br/>%include \"&nccSASTools\" /LRECL=32767&#59<br/>libname LCommon \"P:\\02 New project data creation\\CommonExchange\"&#59<br/><br/><br/>/*make a local folder for exchange between local and remote servers*/<br/>%let exchangeDir = &thisProjectRootPath.\\Data\\Exchange_Local_Remote&#59<br/>%put exchangeDir = &exchangeDir&#59<br/>/*check if such exchangeDir exists, if not, create it*/<br/>%macro mkExchangeDir&#59<br/>&nbsp&nbsp&nbsp&nbsp%put >>> &exchangeDir&#59<br/>&nbsp&nbsp&nbsp&nbsp%local dirExist&#59<br/>&nbsp&nbsp&nbsp&nbsp%let dirExist = %sysfunc(fileExist(&exchangeDir))&#59 <br/>&nbsp&nbsp&nbsp&nbsp%if %eval(&dirExist) = 0 %then %do&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sysexec mkdir \"&exchangeDir\"&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend mkExchangeDir&#59<br/>%mkExchangeDir&#59<br/><br/>libname transLib \"&exchangeDir\"&#59 <br/><br/>/*the xlsx file with import information, such file is named as:*/<br/>%let settingsXls =&thisProjectRootPath.\\Input\\Forms\\InputForm.xlsm&#59<br/>%let h_Infoxls = %str(R:\\Data Warehouse\\Data Manuals\\Hospital %(CIHI DAD%)\\cihi_hosps_master_file.xlsx)&#59<br/><br/>/*the report in local drive S*/<br/>%let localReportPath=S:\\Shenzhen\\Projects\\NewCohortCreating\\Reports&#59<br/>/*libname localR \"&localReportPath\"&#59*/<br/>%let AnalyticalReport=Analytical Report.xlsx&#59<br/>%let DataReport=DataSum_Report.xlsx&#59<br/><br/>/*The following steps are to import file and var description in the data dictionary *******/<br/>%let dicXls = S:\\Reference\\Data Warehouse\\Data Manuals\\General Information\\HQC_MOH_DW_data_dictionary.xlsx&#59<br/><br/>/* the folder on remote server containing common tool files for new cohort creation*/<br/>%let remoteToolsPath = /sasdata/hisc/shared_data/HQC_share/DoNotDelete New Cohort Common Tools&#59<br/><br/>/*In the log file, display the physical location of the work directory*/<br/>%put >>> the local work directory is at %sysfunc(pathname(work))&#59<br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"EGTask-oyLU9215za4Elsgd","name":"Copy Macro file to Remote Server","children":[{"idx":"CodeTask-kdXNatjk26MJ53wd","name":"A_import settings","NodeDescription":"///t<br/>///s<br/>/*Import settings from the setting xls file (&settingXls)*/<br/><br/>data _null_&#59run&#59<br/><br/>%global  theMasterInputFile<br/>localParentFolder localDataFolder localReportFolder localTargetPath localDataPath localReportPath<br/>RemoteParentFolder RemoteSourcePath DataStartDate DataEndDate&#59<br/><br/>Filename setXls \"&settingsXls\"&#59<br/>%put >>> &settingsXls&#59<br/><br/>/*create a folder dedicated for the project (by rem id?)*/<br/>/*copy a back up of the setting xls file in the log directory*/<br/>/*add a file for log (create date, etc)*/<br/><br/>/*1.Import dates*/<br/>/*always create an empty data set first<br/>&nbsp&nbsp&nbsp&nbspotherwise, when the source excel table contains 0 records, the import proc won't run,<br/>&nbsp&nbsp&nbsp&nbspthe setting file won't be created<br/>&nbsp&nbsp&nbsp&nbsplater, no files were copied to the remote site to overwrite the old files<br/>&nbsp&nbsp&nbsp&nbspAs such, the old setting files will be used in getting data, which is wrong <br/>*/<br/>/*data translib.a1_MasterInput&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspformat Items $100. Values $100.&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete&#59*/<br/>/*run&#59*/<br/>/*proc import does not work, when the file is xlsm, the SAS is 64 bit, while the excel is 32 bit, and the PC file server is not installed or not properly installed<br/>&nbsp&nbsp&nbsp&nbspIn that case, use libname instead of DBMS works!<br/>*/<br/>/*proc import datafile=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbspDBMS=excel*/<br/>/*&nbsp&nbsp&nbsp&nbspout=translib.a1_MasterInput*/<br/>/*&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*getnames=yes&#59*/<br/>/*sheet=\"MasterInput\"&#59*/<br/>/*run&#59*/<br/><br/>%myImportXls(<br/> srcFile= &settingsXls,<br/> sheet=MasterInput,<br/> target= translib.a1_MasterInput,<br/> where=,<br/> keep = ,<br/> format=%str( Items $100. Value $100.)<br/>)&#59<br/><br/><br/><br/>/*Save an additional copy of a1<br/>This file should be uploaded to remote server into a common area in the first place.<br/>From this file, we can create the project parent folder on remote site, and create sub folders for data exchange, source, <br/>and target.<br/>*/<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif Items = 'ProjectName'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('thisProjectName', Value)&#59<br/>run&#59<br/><br/><br/>/*Such file has to be named using a variable that is commonly recognized by both local and remote programs<br/>&nbsp&nbsp&nbsp&nbspAt this monment all project specific varaibles have not been defined yet on remote side.<br/>&nbsp&nbsp&nbsp&nbspThe clientprojectname is a nice one, as it can be recognized by both local and remote programs.<br/>*/<br/>%let thisProjectName=%lowcase(%sysfunc(dequote(&_clientprojectname)))&#59<br/>/*remove '.egp'*/<br/>%let thisProjectName=%sysfunc(tranwrd(&thisProjectName, .egp, ))&#59<br/>%let thisProjectName=%sysfunc(tranwrd(&thisProjectName, datacreation, ))&#59<br/>%let thisProjectName=%substr(&thisProjectName, 1, 29)&#59<br/>%put >>> &thisProjectName&#59<br/>/*This file has to be saved in the common folder (the Common exchange folder)<br/>&nbsp&nbsp&nbsp&nbspIt cannot be saved in a project specific folder, as at remote side, the project specific variables are not defined yet<br/>*/<br/>%let theMasterInputFile=a1_&thisProjectName &#59<br/>data LCommon.&theMasterInputFile&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.a1_MasterInput&#59<br/>run&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*Determine the local data/target/reports folder*/<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif Items = 'LocalFolder'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('localParentFolder', Value)&#59<br/>run&#59<br/><br/>%let localParentFolder=%sysfunc(strip(&localParentFolder))&#59<br/>%let localTargetPath=&localParentFolder.\\Output\\Result data&#59<br/>%put >>> &localTargetPath&#59<br/>%let localDataPath=&localParentFolder.\\Data&#59 /*the folder to save requested raw data files*/<br/>libname localT \"&localTargetPath\"&#59<br/>%put >>> &localDataPath&#59<br/>/*the report in local drive S*/<br/>%let localReportPath=&localParentFolder.\\Output\\Reports&#59<br/>%put >>> &localReportPath&#59<br/>libname localR \"&localReportPath\"&#59<br/><br/><br/>/*2.Import the sourcefiles and fields*/<br/>data translib.A2_CohortDataVars&#59<br/>&nbsp&nbsp&nbsp&nbspformat final_status 8. file_nick_name $100. VarName_in_Raw_File $100.&#59<br/>&nbsp&nbsp&nbsp&nbspdelete&#59<br/>run&#59<br/>/*proc import library=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbspdbms=excel*/<br/>/*&nbsp&nbsp&nbsp&nbspout=translib.A2_CohortDataVars (*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspwhere=(Final_status=1) */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep= final_status file_nick_name VarName_in_Raw_File*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)*/<br/>/*&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*getnames=yes&#59*/<br/>/*sheet=\"StudyFields\"&#59*/<br/>/*run&#59*/<br/><br/><br/>%myImportXls(<br/> srcFile= &settingsXls,<br/> sheet=StudyFields,<br/> target= translib.A2_CohortDataVars,<br/> where=%str(Final_status gt 0),<br/> keep = final_status file_nick_name VarName_in_Raw_File,<br/> format=%str( final_status 8. file_nick_name $100. VarName_in_Raw_File $100.)<br/>)&#59<br/><br/><br/><br/>/*3 import the case def ICD code list*/<br/>/*data translib.a3_ICDDx&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspformat Source_file $100. Code_Version $100. Code $100. Disease $100. Description $100.&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete&#59*/<br/>/*run&#59*/<br/>/*proc import datafile=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbspDBMS=excel*/<br/>/*&nbsp&nbsp&nbsp&nbspout=translib.a3_ICDDx (where=(code ne \"\") keep= Source_file Code_Version Code Disease Description)*/<br/>/*&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*getnames=yes&#59*/<br/>/*sheet=\"ICD_Codes\"&#59*/<br/>/*run&#59*/<br/><br/>%myImportXls(<br/> srcFile= &settingsXls,<br/> sheet=ICD_Codes,<br/> target= translib.a3_ICDDx,<br/> where=%str(code ne \"\"),<br/> keep = Source_file Code_Version Code Disease Description ,<br/> format=%str(Source_file $100. Code_Version $100. Code $100. Disease $100. Description $100.)<br/>)&#59<br/>%print(data=translib.a3_ICDDx)&#59<br/><br/>/*4 import the case def procedure code list*/<br/>/*data translib.a4_IntvnDx&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspformat Source_file $100. Code_Version $100. Code $100. Disease $100. Description $100.&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete&#59*/<br/>/*run&#59*/<br/>/*proc import datafile=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbspDBMS=excel*/<br/>/*&nbsp&nbsp&nbsp&nbspout=translib.a4_IntvnDx (where=(code ne \"\") keep=Source_file Code_Version Code Disease Description)*/<br/>/*&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*getnames=yes&#59*/<br/>/*sheet=\"Procedure_Codes\"&#59*/<br/>/*run&#59*/<br/><br/>%myImportXls(<br/> srcFile= &settingsXls,<br/> sheet=Procedure_Codes,<br/> target= translib.a4_IntvnDx,<br/> where=%str(code ne \"\"),<br/> keep = Source_file Code_Version Code Disease Description ,<br/> format=%str(Source_file $100. Code_Version $100. Code $100. Disease $100. Description $100.)<br/>)&#59<br/><br/>%print(data=translib.a4_IntvnDx)&#59<br/><br/>/*5 import the case def SK fee for service code list*/<br/>/*data translib.a5_FSC&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspformat Source_file $100. Code_Version $100. Code $100. Disease $100. Description $100.&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete&#59*/<br/>/*run&#59*/<br/>/*proc import datafile=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbspDBMS=excel*/<br/>/*&nbsp&nbsp&nbsp&nbspout=translib.a5_FSC (where=(code ne \"\") keep=Source_file Code_Version Code Disease Description)*/<br/>/*&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*getnames=yes&#59*/<br/>/*sheet=\"SK_fee_Codes\"&#59*/<br/>/*run&#59*/<br/><br/>%myImportXls(<br/> srcFile= &settingsXls,<br/> sheet=SK_fee_Codes,<br/> target=translib.a5_FSC,<br/> where=%str(code ne \"\"),<br/> keep = Source_file Code_Version Code Disease Description ,<br/> format=%str(Source_file $100. Code_Version $100. Code $100. Disease $100. Description $100.)<br/>)&#59<br/><br/>%print(data=translib.a5_FSC)&#59<br/><br/>/*6 import the case def DINPIN list*/<br/>/*data translib.a6_DINDx&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspformat Therapeutic_Class $100. Generic_Name $100. DIN $100. Disease $100. Description $100.&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete&#59*/<br/>/*run&#59*/<br/>/*proc import datafile=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbspDBMS=excel*/<br/>/*&nbsp&nbsp&nbsp&nbspout=translib.a6_DINDx (where=(DIN ne \"\") keep=Therapeutic_Class Generic_Name DIN Disease Description)*/<br/>/*&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*getnames=yes&#59*/<br/>/*sheet=\"DINs\"&#59*/<br/>/*run&#59*/<br/><br/>%myImportXls(<br/> srcFile= &settingsXls,<br/> sheet=DINs,<br/> target=translib.a6_DINDx,<br/> where=%str(DIN ne \"\"),<br/> keep = Therapeutic_Class Generic_Name DIN Disease Description ,<br/> format=%str(Therapeutic_Class $100. Generic_Name $100. DIN $100. Disease $100. Description $100.)<br/>)&#59<br/>%print(data=translib.a6_DINDx)&#59<br/><br/>/*7 import the list of source files for case definition*/<br/>/*data translib.a7_DxFile&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspformat DxFiles $100. Inclusion 8.&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete&#59*/<br/>/*run&#59*/<br/>/*proc import datafile=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbspDBMS=excel*/<br/>/*&nbsp&nbsp&nbsp&nbspout=translib.a7_DxFile (where=(Inclusion =1) )*/<br/>/*&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*getnames=yes&#59*/<br/>/*sheet=\"DxFiles\"&#59*/<br/>/*run&#59*/<br/><br/>%myImportXls(<br/> srcFile= &settingsXls,<br/> sheet=DxFile,<br/> target=translib.a7_DxFiles,<br/> where=%str(Inclusion =1),<br/> keep =  ,<br/> format=%str(DxFiles $100. Inclusion 8.)<br/>)&#59<br/><br/>%print(data=translib.a7_DxFiles)&#59<br/><br/><br/>/*8 import the list of additional request*/<br/>/*data translib.a8_AddRequest&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspformat Class $100. Description $100. SourceData $100. Syntax $100.&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete&#59*/<br/>/*run&#59*/<br/>/*proc import datafile=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbspDBMS=excel*/<br/>/*&nbsp&nbsp&nbsp&nbspout=translib.a8_AddRequest  (where=(syntax ne '') )*/<br/>/*&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*getnames=yes&#59*/<br/>/*sheet=\"Additional request\"&#59*/<br/>/*run&#59*/<br/><br/><br/>%myImportXls(<br/> srcFile= &settingsXls,<br/> sheet=Additional_request,<br/> target=translib.a8_AddRequest,<br/> where=%str(syntax ne ''),<br/> keep =  ,<br/> format=%str(Class $100. Description $100. SourceData $100. Syntax $100.),<br/> debug=<br/>)&#59<br/><br/>%print(data=translib.a8_AddRequest)&#59<br/><br/>/*9 import cohort exclusion criteria*/<br/>/*data translib.a9_CohortExclusion&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspformat Source $100. Criteria $100. Syntax $100. Description $100.&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete&#59*/<br/>/*run&#59*/<br/>/*proc import datafile=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbspDBMS=excel*/<br/>/*&nbsp&nbsp&nbsp&nbspout=translib.a9_CohortExclusion*/<br/>/*&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*getnames=yes&#59*/<br/>/*sheet=\"cohort_exclusion\"&#59*/<br/>/*run&#59*/<br/>%myImportXls(<br/> srcFile= &settingsXls,<br/> sheet=cohort_exclusion,<br/> target=translib.a9_CohortExclusion,<br/> where=,<br/> keep =  ,<br/> format=%str(Source $100. Criteria $100. Syntax $100. Description $100.),<br/> debug=<br/>)&#59<br/><br/>%print(data=translib.a9_CohortExclusion)&#59<br/><br/>%put >>> &h_Infoxls&#59<br/><br/>/*<br/>&nbsp&nbsp&nbsp&nbspif the source xls file is open by other users, the import program may report error<br/>&nbsp&nbsp&nbsp&nbspin that case, open the Excel application (do not have to open the source xls file, just the Excel App), <br/>&nbsp&nbsp&nbsp&nbspthen run the following import program<br/>*/<br/>/*10 import hospital info*/<br/><br/><br/>proc import datafile=\"&h_Infoxls\"<br/>&nbsp&nbsp&nbsp&nbspDBMS=xlsx<br/>&nbsp&nbsp&nbsp&nbspout=translib.a10_hospInfo<br/>&nbsp&nbsp&nbsp&nbspreplace<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>getnames=yes&#59<br/>sheet=\"facilities\"&#59<br/>run&#59<br/>%print(data=translib.a10_hospInfo)&#59<br/><br/>%put &dicXls&#59<br/>/*import ed data description*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc import datafile=\"&dicXls\"<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDBMS=xlsx<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspout=importDIc_tmp1  /*if required by HQC*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreplace<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetnames=no&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsheet=\"ed (NACRS)\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=importDIc_tmp1)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata importDIc_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat  filename $100. varname $100. description $10000. notes $10000.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilename = 'master_ed_a2012'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp1 (firstOBS=3)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*strip: removing both leading and tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptrim: removing tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcompress removing all spaces (including those in the string)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf6=strip(upcase(f6))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf7=strip(upcase(f7))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf10=strip(upcase(f10))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep filename varName description notes &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*don't use rename, as the length f6-f8 is limited*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvarName=f6&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdescription=f7&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnotes=f10&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif not (f6='' and f7 ='' and f10 ='')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/****************************************************************/<br/>&nbsp&nbsp&nbsp&nbsp<br/>/*import hospital data description*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc import datafile=\"&dicXls\"<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDBMS=xlsx<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspout=importDIc_tmp11<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreplace<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetnames=no&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsheet=\"Hosp (DAD)\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=importDIc_tmp11)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata importDIc_tmp12&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat  filename $100. varname $100. description $10000. notes $10000. metadoc $20.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilename = 'master_hosp'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp11 (firstOBS=3)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*strip: removing both leading and tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptrim: removing tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcompress removing all spaces (including those in the string)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf5=strip(upcase(f5))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf14=strip(upcase(f14))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf15=strip(upcase(f15))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf16=strip(upcase(f16))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep filename varName description notes metadoc&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*don't use rename, as the length f6-f8 is limited*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvarName=f5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdescription=f15&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnotes=f14&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmetadoc=f16&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif not (f5='' and f14 ='' and f15 ='' and f16='')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/****************************************************************/<br/>&nbsp&nbsp&nbsp&nbsp<br/>/*import phrs data description*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc import datafile=\"&dicXls\"<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDBMS=xlsx<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspout=importDIc_tmp21<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreplace<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetnames=no&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsheet=\"PHRS\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=importDIc_tmp21)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata importDIc_tmp22&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat  filename $100. varname $100. description $10000. notes $10000. metadoc $20.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilename = 'master_phrs_'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp21 (firstOBS=3)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*strip: removing both leading and tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptrim: removing tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcompress removing all spaces (including those in the string)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf4=strip(upcase(f4))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf9=strip(upcase(f9))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf8=strip(upcase(f8))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf10=strip(upcase(f10))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep filename varName description notes metadoc&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*don't use rename, as the length f6-f8 is limited*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvarName=f4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdescription=f9&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnotes=f8&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmetadoc=f10&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif not (f4='' and f9 ='' and f8 ='' and f10='')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/****************************************************************/<br/>&nbsp&nbsp&nbsp&nbsp<br/>/*import drug claim variable description*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc import datafile=\"&dicXls\"<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDBMS=xlsx<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspout=importDIc_tmp31<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreplace<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetnames=no&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsheet=\"Drug plan\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=importDIc_tmp31)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata importDIc_tmp32&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat  filename $100. varname $100. description $10000. notes $10000. metadoc $20.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilename = 'master_dp_'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp31 (firstOBS=3)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*strip: removing both leading and tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptrim: removing tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcompress removing all spaces (including those in the string)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf4=strip(upcase(f4))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf10=strip(upcase(f10))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf9=strip(upcase(f9))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf11=strip(upcase(f11))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep filename varName description notes metadoc&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*don't use rename, as the length f6-f8 is limited*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvarName=f4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdescription=f10&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnotes=f9&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmetadoc=f11&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif not (f4='' and f9 ='' and f11 ='' and f10='')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/****************************************************************/<br/><br/>/*import description of msb billing variables*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc import datafile=\"&dicXls\"<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDBMS=xlsx<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspout=importDIc_tmp41<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreplace<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetnames=no&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsheet=\"Phys Claims (MSB)\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=importDIc_tmp41)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata importDIc_tmp42&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat  filename $100. varname $100. description $10000. notes $10000. metadoc $20.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilename = 'master_msb'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp41 (firstOBS=4)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*strip: removing both leading and tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptrim: removing tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcompress removing all spaces (including those in the string)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf4=strip(upcase(f4))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf10=strip(upcase(f10))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf9=strip(upcase(f9))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf11=strip(upcase(f11))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep filename varName description notes metadoc&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*don't use rename, as the length f6-f8 is limited*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvarName=f4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdescription=f10&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnotes=f9&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmetadoc=f11&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif not (f4='' and f9 ='' and f11 ='' and f10='')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/****************************************************************/<br/><br/>/*import description of msb mobility doc info variables*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc import datafile=\"&dicXls\"<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDBMS=xlsx<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspout=importDIc_tmp51<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreplace<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetnames=no&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsheet=\"Phys Mobility (MSB docs)\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=importDIc_tmp51)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata importDIc_tmp52&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat  filename $100. varname $100. description $10000. notes $10000. metadoc $20.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilename = 'master_msb'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp51 (firstOBS=4)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*strip: removing both leading and tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptrim: removing tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcompress removing all spaces (including those in the string)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf4=strip(upcase(f4))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf10=strip(upcase(f10))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf9=strip(upcase(f9))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf11=strip(upcase(f11))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep filename varName description notes metadoc&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*don't use rename, as the length f6-f8 is limited*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvarName=f4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdescription=f10&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnotes=f9&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmetadoc=f11&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif not (f4='' and f9 ='' and f11 ='' and f10='')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/****************************************************************/<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*create an emtpy data set for var description*/<br/>&nbsp&nbsp&nbsp&nbspData importDIc_tmp91&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat  filename $100. varname $100. description $10000. notes $10000. metadoc $20.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp/*Append  descriptions from source data files*/<br/>&nbsp&nbsp&nbsp&nbspdata importDIc_tmp91&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp91 importDIc_tmp2 importDIc_tmp12 importDIc_tmp22 importDIc_tmp32 importDIc_tmp42 importDIc_tmp52&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*for those like 'dx_code_1 to dx_code_25', truncate the var names before the first space<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspalso, for those like 'D000360,V1' in metadoc, truncate the string and keep the sub string before the first comma <br/>&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbspdata translib.A11_DataVarDic&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp91&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppos1= index(varname, ' ')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif pos1 >0 then varname =substr(varname, 1, pos1-1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppos2= index(metadoc, ',')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif pos2 >0 then metadoc =substr(metadoc, 1, pos2-1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppos3=index(metadoc, 'V')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif pos3 >0 then metadoc =substr(metadoc, 1, pos3-1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop pos1 pos2 pos3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename varName = variable&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/><br/>/*Determine the remote data/target/reports folder*/<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif Items = 'RemoteFolder'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('RemoteParentFolder', Value)&#59<br/>run&#59<br/>%let RemoteParentFolder=%sysfunc(strip(&RemoteParentFolder))&#59<br/>%put >>> RemoteParentFolder = &RemoteParentFolder&#59<br/>%let RemoteSourcePath=&RemoteParentFolder./Source&#59<br/>%put >>>RemoteSourcePath= &RemoteSourcePath&#59<br/><br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif items='DataStartDate'&#59<br/>&nbsp&nbsp&nbsp&nbspdatevalue=input(value, anydtdte.)&#59<br/>&nbsp&nbsp&nbsp&nbspformat datevalue date9.&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('DataStartDate', put(datevalue, date9.))&#59<br/>run&#59<br/>%let DataStartDate=%bquote('&DataStartDate')d&#59<br/>%let DataStartDate=%substr(&DataStartDate, 1, %length(&DataStartDate))&#59<br/>%put >>> DataStartDate = &DataStartDate&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif items='DataEndDate'&#59<br/>&nbsp&nbsp&nbsp&nbspdatevalue=input(value, anydtdte.)&#59<br/>&nbsp&nbsp&nbsp&nbspformat datevalue date9.&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('DataEndDate', put(datevalue, date9.))&#59<br/>run&#59<br/>%let DataEndDate=%bquote('&DataEndDate')d&#59<br/>%let DataEndDate=%substr(&DataEndDate, 1, %length(&DataEndDate))&#59<br/>%put >>> DataEndDate = &DataEndDate&#59<br/><br/>/*import data from MDS LTC (MDS_ASSESSMENT_F_2015)  <br/>&nbsp&nbsp&nbsp&nbspfor diagnoses (if in DXFiles, long_term_care =1), <br/>&nbsp&nbsp&nbsp&nbspit is not to get any dxlist (not like the ICD list, etc), rather it is go run a specific macro so as to get the study patients.<br/>&nbsp&nbsp&nbsp&nbspe.g., to have dementia patients by running specific macros,<br/>&nbsp&nbsp&nbsp&nbspor<br/>&nbsp&nbsp&nbsp&nbspto have all who admitted into LTC within a certain period of time (like the Frailty-HRPIM study)<br/><br/>&nbsp&nbsp&nbsp&nbspfor MDS_LTC data requested for a cohort, the fields are from two sources:<br/>&nbsp&nbsp&nbsp&nbsp1) by default, get key_hsn, create_date,  MDS_AB1, AB1b, A3, and R4, these fields has been specified in A2_CohortDataVars<br/>&nbsp&nbsp&nbsp&nbsp2) fields specified in sheet 'vars_MDS_LTC'<br/><br/>&nbsp&nbsp&nbsp&nbspNote that the two sources may have overlapping vars&#59 therefore they are putting together to have a list of distinct vars.<br/>&nbsp&nbsp&nbsp&nbspThe distinct vars are then added to A2_CohortDataVars<br/>*/<br/>/*21 import data vars from sheet 'vars_mds_ltc' LTC file*/<br/>data translib.a2_vars&#59<br/>&nbsp&nbsp&nbsp&nbspformat final_status $100. file_nick_name $100. VarName_in_Raw_File $100.&#59<br/>&nbsp&nbsp&nbsp&nbspdelete&#59<br/>run&#59<br/>%print(data=translib.a2_cohortdatavars)&#59<br/>/*data importDIc_tmp201&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspformat variable $100.  &#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete&#59*/<br/>/*run&#59*/<br/>/*proc import datafile=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbspDBMS=excel*/<br/>/*&nbsp&nbsp&nbsp&nbspout=importDIc_tmp201 (keep=variable where=(variable ne ''))*/<br/>/*&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*getnames=yes&#59*/<br/>/*sheet=\"vars_MDS_LTC\"&#59*/<br/>/*run&#59*/<br/><br/>%myImportXls(<br/>&nbsp&nbsp&nbsp&nbsp srcFile= &settingsXls,<br/>&nbsp&nbsp&nbsp&nbsp sheet=vars_MDS_LTC,<br/>&nbsp&nbsp&nbsp&nbsp target=importDIc_tmp201,<br/>&nbsp&nbsp&nbsp&nbsp where=%str(variable ne ''),<br/>&nbsp&nbsp&nbsp&nbsp keep =variable  ,<br/>&nbsp&nbsp&nbsp&nbsp format=%str(variable $100. )<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>data importDIc_tmp202&#59<br/>&nbsp&nbsp&nbsp&nbspformat final_status 8. file_nick_name $100. &#59<br/>&nbsp&nbsp&nbsp&nbspset importDIc_tmp201&#59<br/>&nbsp&nbsp&nbsp&nbsprename variable = VarName_in_Raw_File&#59<br/>&nbsp&nbsp&nbsp&nbspfinal_status =1&#59<br/>&nbsp&nbsp&nbsp&nbspfile_nick_name='mds_ltc'&#59<br/>run&#59<br/>/*get ltc vars already input into a2 from sheet 'StudyFields'*/<br/>data importDIc_tmp203&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.a2_cohortdatavars&#59<br/>&nbsp&nbsp&nbsp&nbspif file_nick_name='mds_ltc' &#59<br/>run&#59<br/><br/>/*from _tmp202, remove those already appeared in _tmp203*/<br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=importDIc_tmp202,<br/>&nbsp&nbsp&nbsp&nbsptarget=importDIc_tmp204,<br/>&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbspfilters=%str(VarName_in_Raw_File not in (select  VarName_in_Raw_File from importDIc_tmp203))<br/>)&#59<br/><br/>/*attach vars in _tmp202 to a2*/<br/>data translib.a2_cohortdatavars&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.a2_cohortdatavars &nbsp&nbsp&nbsp&nbspimportDIc_tmp204&#59<br/>&nbsp&nbsp&nbsp&nbspVarName_in_Raw_File=upcase(strip(VarName_in_Raw_File))&#59<br/>run&#59<br/>%sort(data =  translib.a2_cohortdatavars, sorter=file_nick_name VarName_in_Raw_File)&#59<br/><br/><br/>/*get dictionary for mds_ltc vars*/<br/>/*import description of variables from mds_ltc */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc import datafile=\"&dicXls\"<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDBMS=xlsx<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspout=importDIc_tmp205<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreplace<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetnames=no&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsheet=\"MDS-LTC\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=importDIc_tmp51)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata importDIc_tmp206&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat  filename $100. varname $100. description $10000. notes $10000. metadoc $20.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilename = 'mds_ltc'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp205 (firstOBS=3)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*strip: removing both leading and trailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptrim: removing tailing spaces<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcompress removing all spaces (including those in the string)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf4=strip(upcase(f4))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf9=strip(upcase(f9))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf8=strip(upcase(f8))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspf10=strip(upcase(f10))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep filename varName description notes metadoc lagvar&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*don't use rename, as the length f6-f8 is limited*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvarName=f4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdescription=f9&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnotes=f8&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmetadoc=f10&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif not (f4='' and f9 ='' and f8 ='' and f10='') &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename varName = variable&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*For some of the vars, the description is in two rows. The var name appears in the first row, but not the second row<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata importDIc_tmp207&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp206&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs=_n_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat lagVar1 $100. lagDesc $1000. lagNote $1000. lagMeta $1000.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplagVar1 = lag(variable)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspLagdesc = lag(description)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplagNotes = lag(notes)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspLagMeta = lag(metadoc)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif variable='' then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvariable = lagVar1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdescription = strip(Lagdesc) || ' ' || description&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnotes = strip(lagNotes) || ' ' || notes&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmetadoc = strip(LagMeta) || ' ' || metadoc&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sort(data=importDIc_tmp207, sorter=variable obs)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata importDIc_tmp208&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset importDIc_tmp207&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby variable obs&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif last.variable&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop obs lagVar1 lagdesc lagNotes lagMeta&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*for those like 'dx_code_1 to dx_code_25', truncate the var names before the first space<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspalso, for those like 'D000360,V1' in metadoc, truncate the string and keep the sub string before the first comma <br/>&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbspdata translib.A11_DataVarDic&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset  translib.A11_DataVarDic importDIc_tmp206&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppos1= index(variable, ' ')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif pos1 >0 then variable =substr(variable, 1, pos1-1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppos2= index(metadoc, ',')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif pos2 >0 then metadoc =substr(metadoc, 1, pos2-1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppos3=index(metadoc, 'V')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif pos3 >0 then metadoc =substr(metadoc, 1, pos3-1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop pos1 pos2 pos3&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/>/****************************************************************/<br/><br/>/**getting macro file (full path) and command lines for getting dx from MDS_LTC files**/<br/><br/>%macro getLTCMacro&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*by default, always have a empty macro (for a later task, there has to be a file to be transferred)*/<br/>&nbsp&nbsp&nbsp&nbsp/*create an empty sas file. If A12 does not contain a real sas file, transfer the empty sas file*/<br/>&nbsp&nbsp&nbsp&nbspfilename EmpSAS \"&localDataPath.\\empty.sas\"&#59<br/>&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfile EmpSAS&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspput &#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>/*&nbsp&nbsp&nbsp&nbspproc import datafile=\"&settingsXls\"*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDBMS=excel*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspout=translib.a12_DxMDSLTC (where = (strip(theFile) ne ''))*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspreplace*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetnames=yes&#59*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsheet=\"Dx_MDS_LTC_Macro\"&#59*/<br/>/*&nbsp&nbsp&nbsp&nbsprun&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%myImportXls(<br/>&nbsp&nbsp&nbsp&nbsp srcFile= &settingsXls,<br/>&nbsp&nbsp&nbsp&nbsp sheet=Dx_MDS_LTC_Macro,<br/>&nbsp&nbsp&nbsp&nbsp target=translib.a12_DxMDSLTC,<br/>&nbsp&nbsp&nbsp&nbsp where=%str(strip(theFile) ne ''),<br/>&nbsp&nbsp&nbsp&nbsp keep =  ,<br/>&nbsp&nbsp&nbsp&nbsp format=<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp%nobs(data=translib.a12_DxMDSLTC)&#59<br/>&nbsp&nbsp&nbsp&nbsp%if %eval(&nobs=0) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata translib.a12_DxMDSLTC&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat thePath $1000. theFile $100. theLines $1000.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthePath = \"&localDataPath\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheFile =\"empty.sas\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend getLTCMacro&#59<br/>%getLTCMacro&#59<br/><br/>&nbsp&nbsp&nbsp&nbspproc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete importDIc_tmp:&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*************************************************************************************/<br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-kqczIKG22ZMBhJZ8","name":"_0C Define Master Input file on remote side","NodeDescription":"///t<br/>///s<br/>%global theMasterInputFile remoteToolsPath&#59<br/>%let remoteToolsPath = /sasdata/hisc/shared_data/HQC_share/DoNotDelete New Cohort Common Tools&#59<br/>%include \"&remoteToolsPath./tools_ncc.sas\" /LRECL=32767&#59<br/><br/>%let thisProjectName=%lowcase(%sysfunc(dequote(&_clientprojectname)))&#59<br/>/*remove '.egp'*/<br/>%let thisProjectName=%sysfunc(tranwrd(&thisProjectName, .egp, ))&#59<br/>%let thisProjectName=%sysfunc(tranwrd(&thisProjectName, datacreation, ))&#59<br/>%let thisProjectName=%substr(&thisProjectName, 1, 29)&#59<br/><br/><br/>%let theMasterInputFile = a1_&thisProjectName.&#59<br/>%put >>> &theMasterInputFile&#59<br/><br/>%let remoteCommonExchange= \"\"&#59<br/><br/>/*Also need to let the remote site know the local project rootpath*/<br/><br/>%global thisProjectRootPath ThisEGPPath&#59<br/><br/>/*the following is put in a macro so that all the vars can be set as local*/<br/>%macro defineProjectRootPath&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%local RevEGPPath SearchSeg RevSearchSegPosition StartPosOftheRevProjectRootPath<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspLengthRevEGPPath theRevProjectRootPathLength theRevProjectRootPath<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the path of this EGP project file<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNote that the value of system variable &_clientprojectpath is wrapped by apostrophes '', which should be stripped to avoid error.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ThisEGPPath =%sysfunc(dequote(&_clientprojectpath))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &ThisEGPPath&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*to reversely search and find the root folder<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFor example, the EGPPath is <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspS:\\Collaborative_researchers\\LinaAlSakran\\Project4(LAlsakaran)\\SAS code\\_Bio15_331\\SAS code\\DataCreation_Project4_20190514.egp&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspThe project root path is <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspS:\\Collaborative_researchers\\LinaAlSakran\\Project4(LAlsakaran)\\SAS code\\_Bio15_331\\<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspi.e., the sub string before '\\SAS code\\'.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNote that  '\\SAS code\\' appears twice in the EGPPath, the expected root path is before the last incidence of 'SAS code\\'. <br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspThe following is a clumpsy way of doing it, but it works.<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*1. Make a reverse string of the EGPPath<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppge.41509102_4tcejorP_noitaerCataD\\edoc SAS\\133_51oiB_\\edoc SAS\\)narakaslAL(4tcejorP\\narkaSlAaniL\\srehcraeser_evitaroballoC\\:S<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let RevEGPPath =%sysfunc(reverse(&ThisEGPPath))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &RevEGPPath&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*2. The string segment to search is '\\SAS code\\'<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphowever, in the revered EGPPath by step 1, the segment to search should also be reversed:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspso it is like '\\edoc SAS\\'<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/ <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let SearchSeg=\\SAS code\\&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let RevSearchSeg=%sysfunc(reverse(&SearchSeg))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &RevSearchSeg&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*3. In the reversed EGPPath, search the first position of the reversed search segment<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNote use %nrbquote() instead of %str() so as to escape specail characters in the string. Otherwise SAS is not smart enough to carry on.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspuse %nrbquote instead of %quote to handle each single bracket. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let RevSearchSegPosition = %index(%nrbquote(&RevEGPPath), %nrbquote(&RevSearchSeg))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &RevSearchSegPosition&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*4. Determine the start position of the target sub string<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspThe position of the reversed search segment ('\\edoc SAS\\') is obtained in &RevSearchSegPosition, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspThe reversed search segment ('\\edoc SAS\\') has a length of %length(&RevSearchSeg).<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTherefore the start position of the target sub string is:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&RevSearchSegPosition + %length(&RevSearchSeg) .<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let StartPosOftheRevProjectRootPath = %eval(&RevSearchSegPosition + %length(&RevSearchSeg))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &StartPosOftheRevProjectRootPath&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*5. Determine the length of the target sub string<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIt should be the length of (&RevEGPPath) -  &StartPosOftheRevProjectRootPath +1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let LengthRevEGPPath=%length(%nrbquote(&RevEGPPath))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &LengthRevEGPPath &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theRevProjectRootPathLength = %eval(&LengthRevEGPPath -  &StartPosOftheRevProjectRootPath+1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &theRevProjectRootPathLength&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*6. Get the substr from the reversed EGPPath, after the start position<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNote, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp1) such string is the reversed Project Root Path.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2) use %nrbquote() instead of %str() so as to escape specail characters in the string. Otherwise SAS is not smart enough to carry on. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspuse %nrbquote instead of %quote to handle each single bracket. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theRevProjectRootPath = %substr(%nrbquote(&RevEGPPath), &StartPosOftheRevProjectRootPath, &theRevProjectRootPathLength)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>>&theRevProjectRootPath&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*7. finally, Reverse the reversed project root path again. This time, the project root path is obtained!*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let thisProjectRootPath = %sysfunc(reverse(%nrbquote(&theRevProjectRootPath)))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &thisProjectRootPath&#59<br/><br/>%mend defineProjectRootPath&#59<br/>%defineProjectRootPath&#59<br/>s///<br/>t///","children":[{"idx":"EGTask-AA72ijpRTgdiZvGZ","name":"0D_Copy masterInputfile to remote common folder","children":[{"idx":"Note-Tqtl5IHjvbOD3jke","name":"Note","NodeDescription":"///t<br/>The&nbspfile&nbspA1&nbspcontains&nbspremote&nbspfolder&nbspname.&nbspThis&nbspfile&nbspshould&nbspbe&nbspuploaded&nbspto&nbspremote&nbspserver&nbspinto&nbspa&nbspcommon&nbsparea.&nbspFrom&nbspthis&nbspfile,&nbspwe&nbspcan&nbspcreate&nbspthe&nbspproject&nbspparent&nbspfolder&nbspon&nbspremote&nbspsite,&nbspand&nbspcreate&nbspsub&nbspfolders&nbspfor&nbspdata&nbspexchange,&nbspsource,&nbspand&nbsptarget<br/>t///","custparents":[{"idx":"EGTask-AA72ijpRTgdiZvGZ"}]},{"idx":"CodeTask-8XQczBciSUyozSiJ","name":"Remote settings","NodeDescription":"///t<br/>///s<br/>/*Settings on remote server*/<br/>data _null_&#59run&#59<br/>/*set raw file names*/<br/>%global<br/>&nbsp&nbsp&nbsp&nbspThisEGPPath <br/>&nbsp&nbsp&nbsp&nbspexchangeDir Rexchange  dp_benefitFile dp_nonbenefitFile dp_specFile ed_a2012File ed_b2012File<br/>&nbsp&nbsp&nbsp&nbsphospitalFile MSBFile MSB_DFile MSB_DocInfoFile PHRS_InfoFile PHRS_CovFile PHRS_RSDCFile PHRS_ArrvFile<br/>&nbsp&nbsp&nbsp&nbspPHRS_ResiFile PHRS_Resi_cleanFile PHRS_retrFile VerfMortFile MDS_LTC_File AnalyticalReport DataReport alldinfile<br/>&nbsp&nbsp&nbsp&nbspMortDateVar MortFile_vital MortFile_PHRS<br/>&nbsp&nbsp&nbsp&nbspThisProjectType<br/>&nbsp&nbsp&nbsp&nbspCleanHospFile CleanDINFile CleanMortVitalFile CleanMortPHRSFile<br/>&#59<br/><br/><br/>/*set initial values of the source files from the cleaned file folders*/<br/>%let hospitalFile =&#59<br/>%let MortFile_vital=&#59<br/>%let MortFile_PHRS=&#59<br/>%let alldinfile=&#59<br/><br/><br/>/*The first thing is to get the master input information from the data in the common folder.*/<br/>libname RCommon \"/sasdata/hisc/shared_data/HQC_share/DoNotDelete New Cohort Common Tools/CommonExchange\"&#59<br/>%print(data=RCOMMON.&theMasterInputFile)&#59<br/>/*get remote path*/<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset RCOMMON.&theMasterInputFile&#59<br/>&nbsp&nbsp&nbsp&nbspif Items = 'RemoteFolder'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('RemoteParentFolder', Value)&#59<br/>run&#59quit&#59<br/>%let RemoteParentFolder=%sysfunc(strip(&RemoteParentFolder))&#59<br/>%put >>> &RemoteParentFolder&#59<br/><br/>/*determine whether there are customized cleaned files<br/>&nbsp&nbsp&nbsp&nbspSometimes the project is not going to use the latest cleaned file, rather, a specific version will be used<br/>&nbsp&nbsp&nbsp&nbspthe following is to set to the specific cleaned file if it is customized<br/>*/<br/>%let CleanHospFile=&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset RCOMMON.&theMasterInputFile&#59<br/>&nbsp&nbsp&nbsp&nbspif Items = 'CleanHospFile'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('CleanHospFile', Value)&#59<br/>run&#59quit&#59<br/>%put >>> &CleanHospFile&#59<br/><br/>%let CleanDINFile=&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset RCOMMON.&theMasterInputFile&#59<br/>&nbsp&nbsp&nbsp&nbspif Items = 'CleanDINFile'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('CleanDINFile', Value)&#59<br/>run&#59quit&#59<br/>%put >>> &CleanDINFile&#59<br/><br/>%let CleanMortVitalFile=&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset RCOMMON.&theMasterInputFile&#59<br/>&nbsp&nbsp&nbsp&nbspif Items = 'CleanMortVitalFile'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('CleanMortVitalFile', Value)&#59<br/>run&#59quit&#59<br/><br/>%put >>> &CleanMortVitalFile&#59<br/><br/>%let CleanMortPHRSFile=&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset RCOMMON.&theMasterInputFile&#59<br/>&nbsp&nbsp&nbsp&nbspif Items = 'CleanMortPHRSFile'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('CleanMortPHRSFile', Value)&#59<br/>run&#59quit&#59<br/>%put >>> &CleanMortPHRSFile&#59<br/><br/><br/>/*Set the filename for the customzied cleaned files*/<br/>%macro setCustomCleanFile(theCustFileSrc=, theCustFileLib=, theSrcVar=)&#59<br/>&nbsp&nbsp&nbsp&nbsp%local theCustFileSrc theLength theCusSrcFileName theExtName theCustFileLib<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRevtheCusSrcFileName FileNameLength thePos thePath theFileName theLength2  theSrcVar<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp%let theCusSrcFileName =&&theCustFileSrc&#59<br/>&nbsp&nbsp&nbsp&nbsp%put >>> theCusSrcFileName= &theCusSrcFileName&#59<br/>&nbsp&nbsp&nbsp&nbsp%let theLength=%length(&theCusSrcFileName)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%if &theLength=0 %then %goto exit&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%let theCusSrcFileName=%sysfunc(strip(&theCusSrcFileName))&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%if %eval(&theLength<9)%then %let theLength=9&#59<br/>&nbsp&nbsp&nbsp&nbsp/*add the file extension name if it is missing*/<br/>&nbsp&nbsp&nbsp&nbsp%let theExtName=%substr(&theCusSrcFileName, %eval(&theLength-8), 9)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%if &theExtName ne %str(.sas7bdat) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theCusSrcFileName =&theCusSrcFileName..sas7bdat&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> theCusSrcFileName= &theCusSrcFileName&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*determine the folder, and the file name*/<br/>&nbsp&nbsp&nbsp&nbsp/*reverse the string, and find the first '/'. */<br/>&nbsp&nbsp&nbsp&nbsp%let RevtheCusSrcFileName =%sysfunc(reverse(&theCusSrcFileName))&#59<br/>&nbsp&nbsp&nbsp&nbsp%put >>> RevtheCusSrcFileName=&RevtheCusSrcFileName&#59<br/>&nbsp&nbsp&nbsp&nbsp%let FileNameLength= %index(&RevtheCusSrcFileName, /)&#59<br/>&nbsp&nbsp&nbsp&nbsp%put >>> FileNameLength=&FileNameLength&#59<br/>&nbsp&nbsp&nbsp&nbsp%let theLength2= %length(&theCusSrcFileName)&#59<br/>&nbsp&nbsp&nbsp&nbsp%let thePos=%eval( &theLength2- &FileNameLength)&#59<br/>&nbsp&nbsp&nbsp&nbsp%let thePath=%substr(&theCusSrcFileName, 1, &thePos)&#59<br/>&nbsp&nbsp&nbsp&nbsp%let theFileName = %substr(&theCusSrcFileName, &thePos+2 , &FileNameLength-1)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*remove the extension name (the data set name in SAS data steps does not include extension names)*/<br/>&nbsp&nbsp&nbsp&nbsp%let theFileName = %sysfunc(tranwrd(&theFileName, %str(.sas7bdat), ))&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%put >>> thePath = &thePath&#59<br/>&nbsp&nbsp&nbsp&nbsp%put >>> theFileName = &theFileName&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*make a libname for the Path*/<br/>&nbsp&nbsp&nbsp&nbsplibname &theCustFileLib \"&thePath\"&#59<br/>&nbsp&nbsp&nbsp&nbsp/*set the value of the source file (e.g., let the hospitalfile = the customized file)*/<br/>&nbsp&nbsp&nbsp&nbsp%let &theSrcVar =&theCustFileLib..&theFileName&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*if the file dose not exist, create an error*/<br/>&nbsp&nbsp&nbsp&nbsp%if %sysfunc(exist(&&&theSrcVar))=0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the file &theCusSrcFileName does not exist&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata setCustomCleanFile_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset &&&theSrcVar (obs= 1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>/*&nbsp&nbsp&nbsp&nbsp%print(data=&&&theSrcVar)&#59*/<br/><br/>%exit:<br/><br/>%mend setCustomCleanFile&#59<br/>%setCustomCleanFile(theCustFileSrc =&CleanHospFile, theCustFileLib=custHF, theSrcVar=hospitalFile)&#59<br/>%setCustomCleanFile(theCustFileSrc =&CleanDINFile, theCustFileLib=custDF, theSrcVar=alldinfile)&#59<br/>%setCustomCleanFile(theCustFileSrc =&CleanMortVitalFile, theCustFileLib=custMVF, theSrcVar=MortFile_vital)&#59<br/>%setCustomCleanFile(theCustFileSrc =&CleanMortPHRSFile, theCustFileLib=custMPF, theSrcVar=MortFile_PHRS)&#59<br/><br/><br/>/*determine the source of mortality file. For non research projects, do not use vital statistics*/<br/>%let ThisProjectType=&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset RCOMMON.&theMasterInputFile&#59<br/>&nbsp&nbsp&nbsp&nbspif lowcase(strip(items))='projecttype'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('ThisProjectType', value)&#59<br/>run&#59<br/>%put >>> ThisProjectType= &ThisProjectType&#59<br/><br/><br/><br/>/*check if such RemoteParentFolder exists, if not, create it*/<br/>%macro mkRemoteParentFolderDir&#59<br/>&nbsp&nbsp&nbsp&nbsp%put >>> &RemoteParentFolder&#59<br/>&nbsp&nbsp&nbsp&nbsp%local dirExist&#59<br/>&nbsp&nbsp&nbsp&nbsp%let dirExist = %sysfunc(fileExist(&RemoteParentFolder))&#59 <br/>&nbsp&nbsp&nbsp&nbsp%if %eval(&dirExist) = 0 %then %do&#59&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sysexec mkdir -p &RemoteParentFolder&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sysexec mkdir -p &RemoteParentFolder./Source&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sysexec mkdir -p &RemoteParentFolder./Target&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sysexec mkdir -p &RemoteParentFolder./FileExchangeBetweenLocalAndRemote&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend mkRemoteParentFolderDir&#59<br/>%mkRemoteParentFolderDir&#59<br/><br/>/*delete the master input file in the common exchange folder<br/>&nbsp&nbsp&nbsp&nbspthe lib name has to be specified separately in the proc datasets statement.<br/>&nbsp&nbsp&nbsp&nbspIt won't work by the following<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\"delete rcommon.&theMasterInputFile\"&#59<br/>*/<br/>proc datasets nolist lib=rcommon&#59<br/>&nbsp&nbsp&nbsp&nbspdelete &theMasterInputFile&#59<br/>run&#59quit&#59<br/><br/><br/>/*get the path of this EGP project file<br/>&nbsp&nbsp&nbsp&nbspNote that the value of system variable &_clientprojectpath is wrapped by apostrophes '', which should be stripped to avoid error.<br/>&nbsp&nbsp&nbsp&nbsp*/<br/>%let ThisEGPPath =%sysfunc(dequote(&_clientprojectpath))&#59<br/>%put >>> &ThisEGPPath&#59<br/><br/><br/>libname Clean \"/sasdata/hisc/shared_data/HQC_share/Clean\"&#59<br/>/*The following part is to set clean folders for each year*/<br/>%macro setCleanLibs&#59<br/>&nbsp&nbsp&nbsp&nbsp%local curSysYear theYear yearTag theCleanRoot theCleanFolder thelibname dirExist&#59<br/>&nbsp&nbsp&nbsp&nbsp%let theCleanRoot = /sasdata/hisc/shared_data/HQC_share/Clean/&#59<br/>&nbsp&nbsp&nbsp&nbsp/*determine the curent year*/<br/>&nbsp&nbsp&nbsp&nbsp%let curSysYear=%sysfunc(year(\"&sysdate\"d))&#59<br/>&nbsp&nbsp&nbsp&nbsp%put >>> &curSysYear&#59<br/>&nbsp&nbsp&nbsp&nbsp%do theYear = 2017 %to &curSysYear&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let yearTag = %substr(&theYear, 3,2)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &yearTag&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*determine the year specific clean folders*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theCleanFolder= &theCleanRoot.&theYear. Data/Clean files&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*check if the specified clean folder exists*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let dirExist = %sysfunc(fileExist(&RemoteParentFolder))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &dirExist&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &dirExist = 1 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the folder &theCleanFolder exists&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*determine the libname*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let thelibname = Clean&yearTag&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> creating &thelibname for the folder \"&theCleanFolder\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*define the libnames*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplibname &theLibname \"&theCleanFolder\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend setCleanLibs&#59<br/>%setCleanLibs&#59<br/><br/>/*do not use the folder 'exchange'. That one is quite confusing*/<br/><br/>/*assign the address for the exchange folder between local and remote<br/>&nbsp&nbsp&nbsp&nbsptheexChangeDir is the LOCAL exchange folder<br/>*/<br/>%let exchangeDir =&thisProjectRootPath.\\Data\\Exchange_Local_Remote&#59<br/>libname transLib \"&exchangeDir\"&#59 <br/><br/>/*This folder should be project specific!!!*/<br/>%let Rexchange =  &RemoteParentFolder./FileExchangeBetweenLocalAndRemote&#59<br/>libname RexLib \"&RExchange\"&#59<br/><br/>/*%let localDataPath=S:\\Shenzhen\\Projects\\NewCohortCreating\\Data&#59*/ /* the folder to save requested raw data files*/<br/><br/>/*the following file may have to be identified manually*/<br/><br/><br/>%let dp_benefitFile=hqc.dp_claim&#59<br/>%let dp_nonbenefitFile=hqc.dp_claim_non_ben&#59<br/>%let dp_specFile = hqc.dp_drug&#59<br/><br/>%let ed_a2012File=hqc.ED_F_2012&#59<br/>%let ed_b2012File=hqc.nacrs&#59<br/><br/>%let MSBFile=hqc.MSB_BILLING&#59<br/>%let MSB_DFile=hqc.MSB_Doctor&#59<br/>%let MSB_DocInfoFile=hqc.MSB_DOCTOR_MOBILITY&#59<br/><br/>%let PHRS_InfoFile = hqc.PHRS_PERS_INFO&#59<br/>%let PHRS_CovFile = hqc.PHRS_PERS_PROG&#59<br/>%let PHRS_RSDCFile=hqc.phrs_pers_rsdc&#59<br/>%let PHRS_ArrvFile = HQC.phrs_pers_arrv&#59<br/>%let PHRS_ResiFile = HQC.phrs_pers_resc&#59<br/>%let PHRS_retrFile = HQC.PHRS.PERS_RETR&#59<br/><br/>/*The following file cannot be changed, as it is the latest one with income quintile info*/<br/>%let PHRS_Resi_cleanFile=clean17.PHRS_PERS_RESC_3_AMJ17_02NOV2017&#59 /*this is the last file with income quintile, AMJ = Apr May Jun*/<br/><br/>/*For the following files, there are different versions. Either the latest, or a customized file will be select for this project*/<br/>%macro setCleanFiles(theRaw=, startChars=, debug=)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%local curYear YearTag startChars  nTrials theRaw theRawFileName debug&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*If theRaw file has been defined (i.e., by a customized source), exit the macro and do not overwrite the defined value*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&&&theRaw) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> The raw file &theRaw has been defined, and is not overwritten&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &theRaw = &&&theRaw&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%goto exit&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*Determine the source of the cleaned hospitalization file*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*The logic is to select the latest file (by modified date) among all versions.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe latest file is either in a clean folder of the current year, or the previous year <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(at the begining of the year, the clean folder is created, but the clean file was not available yet).<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*list out all files in the clean file folder of the current year*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*determine the current year*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let curYear=%sysfunc(year(\"&sysdate\"d))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &curYear&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let yearTag=%substr(&curYear, 3,2)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theLibname= Clean&yearTag&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let nTrials=0&#59<br/><br/>%repeat:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspods results off&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>>>>>>>>>>>>>>>>>>>>>>> &theRaw&#59*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspods output Members=setCleanFiles_tmp1&#59 /*Note: this line must precede the following proc statement lines. Otherwise the output goes nowhere*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc datasets library=&theLibname  &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59quit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspods results on&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let startChars=%lowcase(&startChars)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*In the output data set with all file names, select the target files (e.g., hospital files are characterized by the begining 'cihi'*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata setCleanFiles_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset setCleanFiles_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif strip(lowcase(name)) in: (\"&startChars\")&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*Check the number of variables in _tmp2*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%nobs(data=setCleanFiles_tmp2)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*If nobs =0, there is no such file in the clean folder of the current year. It must be that files of the first year is not available yet<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe latest file is in the clean folder of the last year*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &nobs =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*redefine the year tag to last year*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let curYear=%eval(&curYear - 1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let yearTag=%substr(&curYear, 3,2)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theLibname= Clean&yearTag&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let nTrials = %eval(&nTrials +1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> number of trials = &nTrials&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*repeat the process to get the files in the redefined clean folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %eval(&nTrials < 3) %then %do&#59  /*After trying for 3 times, yet there is no such files, quit*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%goto repeat&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> There is no such files in the recent 3 years. Nothing is defined for the source file &#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sort(data=setCleanFiles_tmp2, sorter=Lastmodified)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset setCleanFiles_tmp2 (obs=max)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('theRawFileName', name)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let &theRaw = %lowcase(Clean&yearTag..&theRawFileName)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &theRaw = &&&theRaw&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &debug ne 1 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete setCleanFiles_tmp:&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59quit&#59 /*it is critical to have the statement 'quit', as it releases proc dataset from suppressing ods tables (the suppressing was set by the option nolist)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>%exit:<br/><br/>%mend setCleanFiles&#59<br/>%setCleanFiles(theRaw=hospitalFile, startChars=cihi_EOC)&#59<br/>%setCleanFiles(theRaw=alldinfile, startChars=alldin_)&#59<br/>%setCleanFiles(theRaw=MortFile_vital, startChars=verf_dths_)&#59<br/>%setCleanFiles(theRaw=MortFile_PHRS, startChars=PHRS_DTHS_)&#59<br/><br/><br/><br/><br/>%macro setMortFileSource&#59<br/> &nbsp&nbsp&nbsp&nbsp%if %length(&ThisProjectType) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*note that the combination of %lowcase, %sysfunc, and strip cannot deal with null values, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspi.e., if &ThisProjectType has nothing in it, the following line will report error*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ThisProjectType=%lowcase(%sysfunc(strip(&ThisProjectType)))&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp%put >>> &ThisProjectType&#59<br/>&nbsp&nbsp&nbsp&nbsp%if %lowcase(&ThisProjectType) = %str(usevital) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*For nonresearch projects, use vital mortality data*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let VerfMortFile = &MortFile_vital&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let MortDateVar=ddt_Vit&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*For research projects, use phrs mortality data*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let VerfMortFile = &MortFile_PHRS&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let MortDateVar=ddt_NoVit&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend setMortFileSource&#59<br/>%setMortFileSource&#59<br/>%put >>> ThisProjectType= &ThisProjectType&#59<br/>%put >>> VerfMortFile= &VerfMortFile&#59<br/>%put >>> MortDateVar=&MortDateVar&#59<br/><br/>%let MDS_LTC_File = hqc.MDS_ASSESSMENT_F_2015&#59<br/><br/>%let AnalyticalReport=Analytical Report.xlsx&#59<br/>%let DataReport=DataSum_Report.xlsx&#59<br/><br/><br/>/*include the raw file extracing macros*/<br/><br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_CIHI.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_MSB.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_Drug.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/demog_assign.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_Drug_non_ben_test.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/Addquotes.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/reformat_datevars.sas' /LRECL=32767&#59<br/>%include '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_Drug_non_ben_test.sas' /LRECL=32767&#59<br/>%include '/SAS_data/dw0/HQC_share/Xinya/Macros/GEO_INCQTL_assign.sas' /LRECL=32767&#59<br/><br/>/*the following is for calculating the Charlson-elixer score*/<br/>%INCLUDE '/SAS_data/dw0/HQC_share/Clean/library_dw0.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_MSB.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD9_E_CH_dxtype.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD9_E_EX_dxtype.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD10_CH_dxtype.sas' /LRECL=32767&#59 <br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD10_EX_dxtype.sas' /LRECL=32767&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/ExpandLst.sas' /LRECL=32767&#59<br/>%include '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/VarExist.sas' /LRECL=32767&#59<br/>%include '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/IsEmptyDS.sas' /LRECL=32767&#59<br/><br/>%put >>> the remote work directory is at %sysfunc(pathname(work))&#59<br/><br/><br/>s///<br/>t///","children":[{"idx":"EGTask-cWNDcRk2GJkT9UJm","name":"A1_Copy data sets in transLib to Remote Server","children":[{"idx":"CodeTask-CinsaqqKpNiJAroE","name":"A2_at Local, del files in transDir","NodeDescription":"///t<br/>///s<br/>/**/<br/>/*%delData(data=translib.a1_MasterInput translib.a2_vars */<br/>/*translib.a3_icddx translib.a4_intvndx translib.a5_fsc translib.a6_dindx*/<br/>/*translib.a7_dxfiles)&#59*/<br/><br/>Proc delete data=translib._all_&#59<br/>run&#59<br/><br/>s///<br/>t///","custparents":[{"idx":"EGTask-cWNDcRk2GJkT9UJm"}]},{"idx":"CodeTask-B7GYeGViHcyJuijA","name":"B_Remote_get settings into macro variables","NodeDescription":"///t<br/>///s<br/>/*get the project start date. It is also the last Xtrc Date*/<br/><br/>data _null_&#59run&#59<br/><br/>%global <br/>&nbsp&nbsp&nbsp&nbspProjectName<br/>&nbsp&nbsp&nbsp&nbspProjectStartDate<br/>&nbsp&nbsp&nbsp&nbspContact<br/>&nbsp&nbsp&nbsp&nbspEmail<br/>&nbsp&nbsp&nbsp&nbspDataStartDate<br/>&nbsp&nbsp&nbsp&nbspDataEndDate<br/>&nbsp&nbsp&nbsp&nbspEntryStartDate<br/>&nbsp&nbsp&nbsp&nbspEntryEndDate<br/>&nbsp&nbsp&nbsp&nbspEntryStartYear<br/>&nbsp&nbsp&nbsp&nbspEntryEndYear<br/>&nbsp&nbsp&nbsp&nbspEntryYears&nbsp&nbsp&nbsp&nbsp<br/><br/>&nbsp&nbsp&nbsp&nbspLastXtrcDate<br/>&nbsp&nbsp&nbsp&nbspXtrc_Start_MSB<br/>&nbsp&nbsp&nbsp&nbspXtrc_End_MSB<br/>&nbsp&nbsp&nbsp&nbspXtrc_Start_DP_Ben<br/>&nbsp&nbsp&nbsp&nbspXtrc_End_DP_Ben<br/>&nbsp&nbsp&nbsp&nbspXtrc_Start_DP_NBen<br/>&nbsp&nbsp&nbsp&nbspXtrc_End_DP_NBen<br/>&nbsp&nbsp&nbsp&nbspXtrc_End_Cover<br/>&nbsp&nbsp&nbsp&nbspXtrc_Start_DP_SPEC<br/>&nbsp&nbsp&nbsp&nbspXtrc_End_DP_SPEC<br/>&nbsp&nbsp&nbsp&nbspXtrc_MDS_LTC<br/>&nbsp&nbsp&nbsp&nbspLPath_MDSLTC_DxMacro<br/>&nbsp&nbsp&nbsp&nbspFile_MDSLTC_DxMacro<br/>&nbsp&nbsp&nbsp&nbspCommand_MDSLTC_DxMacro<br/><br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspremoteSourcePath<br/>&nbsp&nbsp&nbsp&nbspremoteReportPath<br/>&nbsp&nbsp&nbsp&nbspremoteTargetPath<br/>&nbsp&nbsp&nbsp&nbsplocalParentFolder<br/>&nbsp&nbsp&nbsp&nbsplocalDataPath<br/>&nbsp&nbsp&nbsp&nbsplocalTargetPath<br/><br/>&#59<br/><br/>/*remote parent path has been defined in program _0C*/<br/><br/><br/>/*the source files on remote server*/<br/>%let remoteSourcePath=&RemoteParentFolder./Source&#59<br/>%put >>> &remoteSourcePath&#59<br/>libname remoteS \"&remoteSourcePath\"&#59<br/>/*the target files on remote server*/<br/>%let remoteTargetPath=&RemoteParentFolder./Target&#59<br/>libname remoteT \"&remoteTargetPath\"&#59<br/>/*the report on remote server*/<br/>%let remoteReportPath=&RemoteParentFolder./Reports&#59<br/>libname remoteR \"&remoteReportPath\"&#59<br/><br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset RexLib.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif Items = 'LocalFolder'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('localParentFolder', Value)&#59<br/>run&#59<br/>%let localParentFolder=%sysfunc(strip(&localParentFolder))&#59<br/>%put >>> &localParentFolder&#59<br/>%let localDataPath=&localParentFolder.\\Data&#59<br/>%put >>> localDataPath=&localDataPath&#59<br/>%let localTargetPath=&localParentFolder.\\Output\\Result data&#59<br/>%put >>> localTargetPath = &localTargetPath&#59<br/><br/><br/>/*copy all files from remote exchange to remoteS*/<br/>proc datasets lib=Rexlib&#59<br/>&nbsp&nbsp&nbsp&nbspcopy out=remoteS&#59<br/>run&#59<br/><br/>Proc delete data=Rexlib._all_&#59<br/>run&#59<br/><br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteS.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif Items='ProjectStartDate'&#59<br/>&nbsp&nbsp&nbsp&nbsp/*in the source data, the date values are characters<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspin the folloiwng steps, the character date values are changed to numberical datavalues, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthen put into macro variables<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspWhy not directly put characters into macro variable values?<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbecause the original character is like 'yyyymmdd', while the required data format is 'ddmmmyyyy'<br/>&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbspdatevalue=input(value, anydtdte.)&#59<br/>&nbsp&nbsp&nbsp&nbspformat datevalue date9.&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('ProjectStartDate', put(datevalue, date9.))&#59<br/>run&#59<br/>%let ProjectStartDate=%bquote('&ProjectStartDate')d&#59<br/>%let ProjectStartDate=%substr(&ProjectStartDate, 1, %length(&ProjectStartDate))&#59<br/>%put >>> ProjectStartDate = &ProjectStartDate&#59<br/>%put >>> ProjectStartDate = &ProjectStartDate&#59<br/><br/>/*changes made in 20190228<br/>The value of lastxtrcdate used to be determined by the ProjectStartDate. <br/>In Yuan's VH project, the start date was in Apr 15 2018. Later the team deceided to have updated report <br/>by including more recent data, including a cleaned resc file. For that file, it should include an xtrc_date of <br/>Jul 03 2018. Such date is after the project start date. <br/><br/>Update by including more recent data could happen frequently. In that case, setting the lastXtrcDate to the ProjectStartDate <br/>is not appropriate.<br/><br/>Starting from 2019-02-28, the setting of lastXtrcDate has changed by taking the 'EarliestProjectStartDatePlus180', <br/>which is 'EarlistProjectStartDate' +180 days (see the formula xls cell in sheet 'MasterInput' of the xls input form)  as the lastXtrcDate. <br/>This would be sufficient to include more recent data in cleaned files.  <br/><br/>Values on that sheet will be read into the SAS set 'remoteS.al_MasterInput' , and used to determine the lastxtrcdate, as the following. <br/>*/<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteS.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif Items='EarliestProjectStartDatePlus180'&#59<br/>&nbsp&nbsp&nbsp&nbsp/*in the source data, the date values are characters<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspin the folloiwng steps, the character date values are changed to numberical datavalues, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthen put into macro variables<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspWhy not directly put characters into macro variable values?<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspbecause the original character is like 'yyyymmdd', while the required data format is 'ddmmmyyyy'<br/>&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbspdatevalue=input(value, anydtdte.)&#59<br/>&nbsp&nbsp&nbsp&nbspformat datevalue date9.&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('LastXtrcDate', put(datevalue, date9.))&#59<br/>run&#59<br/>%let LastXtrcDate=%bquote('&LastXtrcDate')d&#59<br/>%let LastXtrcDate=%substr(&LastXtrcDate, 1, %length(&LastXtrcDate))&#59<br/>%put >>> LastXtrcDate = &LastXtrcDate&#59<br/><br/>/*get the data start and end dates*/<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteS.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif items='DataStartDate'&#59<br/>&nbsp&nbsp&nbsp&nbspdatevalue=input(value, anydtdte.)&#59<br/>&nbsp&nbsp&nbsp&nbspformat datevalue date9.&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('DataStartDate', put(datevalue, date9.))&#59<br/>run&#59<br/>%let DataStartDate=%bquote('&DataStartDate')d&#59<br/>%let DataStartDate=%substr(&DataStartDate, 1, %length(&DataStartDate))&#59<br/>%put >>> DataStartDate = &DataStartDate&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteS.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif items='DataEndDate'&#59<br/>&nbsp&nbsp&nbsp&nbspdatevalue=input(value, anydtdte.)&#59<br/>&nbsp&nbsp&nbsp&nbspformat datevalue date9.&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('DataEndDate', put(datevalue, date9.))&#59<br/>run&#59<br/>%let DataEndDate=%bquote('&DataEndDate')d&#59<br/>%let DataEndDate=%substr(&DataEndDate, 1, %length(&DataEndDate))&#59<br/>%put >>> DataEndDate = &DataEndDate&#59<br/><br/>/*get the cohort entrydates*/<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteS.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif items='EntryStartDate'&#59<br/>&nbsp&nbsp&nbsp&nbspdatevalue=input(value, anydtdte.)&#59<br/>&nbsp&nbsp&nbsp&nbspformat datevalue date9.&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('EntryStartDate', put(datevalue, date9.))&#59<br/>run&#59<br/>%let EntryStartDate=%bquote('&EntryStartDate')d&#59<br/>%let EntryStartDate=%substr(&EntryStartDate, 1, %length(&EntryStartDate))&#59<br/>%put >>> EntryStartDate = &EntryStartDate&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteS.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif items='EntryEndDate'&#59<br/>&nbsp&nbsp&nbsp&nbspdatevalue=input(value, anydtdte.)&#59<br/>&nbsp&nbsp&nbsp&nbspformat datevalue date9.&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('EntryEndDate', put(datevalue, date9.))&#59<br/>run&#59<br/>%let EntryEndDate=%bquote('&EntryEndDate')d&#59<br/>%let EntryEndDate=%substr(&EntryEndDate, 1, %length(&EntryEndDate))&#59<br/>%put >>> EntryEndDate = &EntryEndDate&#59<br/><br/>%let EntryStartYear = %sysfunc(year(&EntryStartDate))&#59<br/>%put >>> EntryStartYear=&EntryStartYear&#59<br/>%let EntryEndYear = %sysfunc(year(&EntryEndDate))&#59<br/>%put >>> EntryEndYear=&EntryEndYear&#59<br/>%let EntryYears = %eval(&EntryEndYear - &EntryStartYear +1)&#59<br/>%put >>> EntryYears=&EntryYears&#59<br/><br/><br/>/*The  project name, contact, and email*/<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteS.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif items='ProjectName'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('ProjectName', value)&#59<br/>run&#59<br/>%put >>> ProjectName = &ProjectName&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteS.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif items='Contact'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Contact', value)&#59<br/>run&#59<br/>%put >>> Contact = &Contact&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteS.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbspif items='Email'&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Email', value)&#59<br/>run&#59<br/>%put >>> Email = &Email&#59<br/><br/><br/>/*the following part is to determine the xtrc_date for each sources<br/>&nbsp&nbsp&nbsp&nbspMSB, Drug claims, coverage period (same for demo, resitype)<br/>&nbsp&nbsp&nbsp&nbspThe cleaned hospital file does not require xtrc date<br/>&nbsp&nbsp&nbsp&nbsp?? How about the mortality record file (verfdt), the emergancy file (f_2012)<br/><br/>*/<br/>%put >>> &dataStartDate&#59<br/>/*the xtrc_dates*/<br/>/*determine the msb xtrc_date***********/<br/>%freq(data=clean.xtrc_dates, table=ds)&#59<br/>%sort(data=clean.xtrc_dates, target=b11, <br/>&nbsp&nbsp&nbsp&nbspsorter=%str(report_start report_end xtrc_date))&#59<br/><br/>data b12&#59<br/>&nbsp&nbsp&nbsp&nbspset b11&#59<br/>&nbsp&nbsp&nbsp&nbspif ds = 'msb_billing'&#59<br/>&nbsp&nbsp&nbsp&nbspdataStartDate=&dataStartDate&#59<br/>&nbsp&nbsp&nbsp&nbspLastXtrcDate = &LastXtrcDate&#59/* &LastXtrcDate&#59*/<br/>&nbsp&nbsp&nbsp&nbspformat dataStartDate date9. LastXtrcDate date9.&#59<br/>&nbsp&nbsp&nbsp&nbspif (report_start <= dataStartDate <= report_end <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor report_start > dataStartDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand (report_start <= LastXtrcDate <= report_end <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor report_end < LastXtrcDate)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/><br/>%sort(data=b12, sorter=xtrc_date)&#59<br/>/*the earliest xtrc_date should be the last one in the rows with a negative<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartgGap*/<br/>data b13&#59<br/>&nbsp&nbsp&nbsp&nbspset b12 (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_Start_MSB', put(xtrc_date, date9.))&#59<br/>run&#59<br/>%let Xtrc_Start_MSB=%str(%')&Xtrc_Start_MSB.%str(%')d&#59<br/>%let Xtrc_Start_MSB= %substr(&Xtrc_Start_MSB, 1, %length(&Xtrc_Start_MSB))&#59<br/>%put >>> &Xtrc_Start_MSB&#59<br/><br/>%sort(data=b12, sorter=descending xtrc_date)&#59<br/>/*the earliest xtrc_date should be the last one in the rows with a negative<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartgGap*/<br/>data b14&#59<br/>&nbsp&nbsp&nbsp&nbspset b12 (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_End_MSB', put(xtrc_date, date9.))&#59<br/>run&#59<br/>%let Xtrc_End_MSB=%str(%')&Xtrc_End_MSB.%str(%')d&#59<br/>%let Xtrc_End_MSB= %substr(&Xtrc_End_MSB, 1, %length(&Xtrc_End_MSB))&#59<br/>%put >>> &Xtrc_End_MSB&#59<br/>/******************************************/<br/><br/>/*determine the benefit drug claim xtrc_date***********/<br/>%sort(data=clean.xtrc_dates, target=b21, <br/>&nbsp&nbsp&nbsp&nbspsorter=%str(report_start report_end xtrc_date))&#59<br/>data b22&#59<br/>&nbsp&nbsp&nbsp&nbspset b21&#59<br/>&nbsp&nbsp&nbsp&nbspif ds = 'dp_claim'&#59<br/>&nbsp&nbsp&nbsp&nbspdataStartDate=&dataStartDate&#59<br/>&nbsp&nbsp&nbsp&nbspLastXtrcDate = &LastXtrcDate&#59/* &LastXtrcDate&#59*/<br/>&nbsp&nbsp&nbsp&nbspformat dataStartDate date9. LastXtrcDate date9.&#59<br/>&nbsp&nbsp&nbsp&nbspif (report_start <= dataStartDate <= report_end <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor report_start > dataStartDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand (report_start <= LastXtrcDate <= report_end <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor report_end < LastXtrcDate)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/><br/>%sort(data=b22, sorter=xtrc_date)&#59<br/>/*the earliest xtrc_date should be the last one in the rows with a negative<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartgGap*/<br/>data b23&#59<br/>&nbsp&nbsp&nbsp&nbspset b22 (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_Start_DP_Ben', put(xtrc_date, date9.))&#59<br/>run&#59<br/>%let Xtrc_Start_DP_Ben=%str(%')&Xtrc_Start_DP_Ben.%str(%')d&#59<br/>%let Xtrc_Start_DP_Ben= %substr(&Xtrc_Start_DP_Ben, 1, %length(&Xtrc_Start_DP_Ben))&#59<br/>%put >>> &Xtrc_Start_DP_Ben&#59<br/><br/>%sort(data=b22, sorter=descending xtrc_date)&#59<br/>/*the earliest xtrc_date should be the last one in the rows with a negative<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartgGap*/<br/>data b24&#59<br/>&nbsp&nbsp&nbsp&nbspset b22 (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_End_DP_Ben', put(xtrc_date, date9.))&#59<br/>run&#59<br/>%let Xtrc_End_DP_Ben=%str(%')&Xtrc_End_DP_Ben.%str(%')d&#59<br/>%let Xtrc_End_DP_Ben= %substr(&Xtrc_End_DP_Ben, 1, %length(&Xtrc_End_DP_Ben))&#59<br/>%put >>> &Xtrc_End_DP_Ben&#59<br/>/******************************************/<br/><br/>/*determine the non-benefit drug claim xtrc_date***********/<br/>%sort(data=clean.xtrc_dates, target=b31, <br/>&nbsp&nbsp&nbsp&nbspsorter=%str(report_start report_end xtrc_date))&#59<br/>data b32&#59<br/>&nbsp&nbsp&nbsp&nbspset b31&#59<br/>&nbsp&nbsp&nbsp&nbspif ds = 'dp_claim_non_ben'&#59<br/>&nbsp&nbsp&nbsp&nbspdataStartDate=&dataStartDate&#59<br/>&nbsp&nbsp&nbsp&nbspLastXtrcDate = &LastXtrcDate&#59/* &LastXtrcDate&#59*/<br/>&nbsp&nbsp&nbsp&nbspformat dataStartDate date9. LastXtrcDate date9.&#59<br/>&nbsp&nbsp&nbsp&nbspif (report_start <= dataStartDate <= report_end <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor report_start > dataStartDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand (report_start <= LastXtrcDate <= report_end <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor report_end < LastXtrcDate)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/><br/>%sort(data=b32, sorter=xtrc_date)&#59<br/>/*the earliest xtrc_date should be the last one in the rows with a negative<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartgGap*/<br/>data b33&#59<br/>&nbsp&nbsp&nbsp&nbspset b32 (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_Start_DP_NBen', put(xtrc_date, date9.))&#59<br/>run&#59<br/>%let Xtrc_Start_DP_NBen=%str(%')&Xtrc_Start_DP_NBen.%str(%')d&#59<br/>%let Xtrc_Start_DP_NBen= %substr(&Xtrc_Start_DP_NBen, 1, %length(&Xtrc_Start_DP_NBen))&#59<br/>%put >>> &Xtrc_Start_DP_NBen&#59<br/><br/>%sort(data=b32, sorter=descending xtrc_date)&#59<br/>/*the earliest xtrc_date should be the last one in the rows with a negative<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartgGap*/<br/>data b34&#59<br/>&nbsp&nbsp&nbsp&nbspset b32 (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_End_DP_NBen', put(xtrc_date, date9.))&#59<br/>run&#59<br/>%let Xtrc_End_DP_NBen=%str(%')&Xtrc_End_DP_NBen.%str(%')d&#59<br/>%let Xtrc_End_DP_NBen= %substr(&Xtrc_End_DP_NBen, 1, %length(&Xtrc_End_DP_NBen))&#59<br/>%put >>> &Xtrc_End_DP_NBen&#59<br/>/******************************************/<br/><br/>*&xtrc_cover&#59<br/>/*determine the coverage xtrc_date***********/<br/>%sort(data=clean.xtrc_dates, target=b41, <br/>&nbsp&nbsp&nbsp&nbspsorter=%str(report_start report_end xtrc_date))&#59<br/>/*%freq(data=b41, table=ds)&#59*/<br/>data b42&#59<br/>&nbsp&nbsp&nbsp&nbspset b41&#59<br/>&nbsp&nbsp&nbsp&nbspif ds = 'phrs_pers_prog'&#59<br/>&nbsp&nbsp&nbsp&nbspdataStartDate=&dataStartDate&#59<br/>&nbsp&nbsp&nbsp&nbspLastXtrcDate = &LastXtrcDate&#59/* &LastXtrcDate&#59*/<br/>&nbsp&nbsp&nbsp&nbspformat dataStartDate date9. LastXtrcDate date9.&#59<br/>&nbsp&nbsp&nbsp&nbspif (report_start <= dataStartDate <= report_end <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor report_start > dataStartDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand (report_start <= LastXtrcDate <= report_end <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor report_end < LastXtrcDate)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>%sort(data=b42, sorter=xtrc_date)&#59<br/>/*the earliest xtrc_date should be the last one in the rows with a negative<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartgGap*/<br/>data b43&#59<br/>&nbsp&nbsp&nbsp&nbspset b42 (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_Start_Cover', put(xtrc_date, date9.))&#59<br/>run&#59<br/>%let Xtrc_Start_Cover=%str(%')&Xtrc_Start_Cover.%str(%')d&#59<br/>%let Xtrc_Start_Cover= %substr(&Xtrc_Start_Cover, 1, %length(&Xtrc_Start_Cover))&#59<br/>%put >>> &Xtrc_Start_Cover&#59<br/><br/>/*the earliest xtrc_date should be the last one in the rows with a negative<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartgGap*/<br/>data b44&#59<br/>&nbsp&nbsp&nbsp&nbspset b42 end=last&#59<br/>&nbsp&nbsp&nbsp&nbspif last&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_End_Cover', put(xtrc_date, date9.))&#59<br/>run&#59<br/>%let Xtrc_End_Cover=%str(%')&Xtrc_End_Cover.%str(%')d&#59<br/>%let Xtrc_End_Cover= %substr(&Xtrc_End_Cover, 1, %length(&Xtrc_End_Cover))&#59<br/>%put >>> &Xtrc_End_Cover&#59<br/>/******************************************/<br/><br/><br/>/*2019-09-23<br/>&nbsp&nbsp&nbsp&nbspconsider that the study's lastxtrcdate is '01Jan2011'd, <br/>&nbsp&nbsp&nbsp&nbspwhile the earliest Xtrc_Start_Info (which is, as of 2019-09-23, always the same as the Xtrc_Start_Cover) is '01Jan2013'd. <br/>&nbsp&nbsp&nbsp&nbspIn that case, there will be no records earlier than the &LastXtrcDate.<br/>&nbsp&nbsp&nbsp&nbspTo correct it, when getting phrs info data, the following is added<br/>*/ <br/><br/>%put >>> Xtrc_Start_Cover=&Xtrc_Start_Cover&#59<br/>%put >>> Xtrc_End_Cover=&Xtrc_End_Cover&#59<br/>%put >>> LastXtrcDate=&LastXtrcDate&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspXtrc_Start_Cover=&Xtrc_Start_Cover&#59<br/>&nbsp&nbsp&nbsp&nbspXtrc_End_Cover=&Xtrc_End_Cover&#59<br/>&nbsp&nbsp&nbsp&nbspLastXtrcDate = &LastXtrcDate&#59<br/>&nbsp&nbsp&nbsp&nbspnew_LastXtrcDate=max(Xtrc_End_Cover, LastXtrcDate)&#59<br/>&nbsp&nbsp&nbsp&nbspformat new_LastXtrcDate date9. Xtrc_Start_Cover date9. LastXtrcDate date9.&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('new_LastXtrcDate', put(new_LastXtrcDate, date9.))&#59 <br/>run&#59<br/>%let new_LastXtrcDate=%str(%')&new_LastXtrcDate.%str(%')d&#59<br/>%let new_LastXtrcDate= %substr(&new_LastXtrcDate, 1, %length(&new_LastXtrcDate))&#59<br/>%let LastXtrcDate=&new_LastXtrcDate&#59<br/>%put >>> new_LastXtrcDate = &new_LastXtrcDate, i.e. LastXtrcDate is now &new_LastXtrcDate&#59<br/>/******/<br/><br/><br/>/*determine the drug spec xtrc_date***********/<br/>%sort(data=clean.xtrc_dates, target=b51, <br/>&nbsp&nbsp&nbsp&nbspsorter=%str(report_start report_end xtrc_date))&#59<br/>data b52&#59<br/>&nbsp&nbsp&nbsp&nbspset b51&#59<br/>&nbsp&nbsp&nbsp&nbspif ds = 'dp_claim' or ds = 'dp_claim_non_ben'&#59<br/>&nbsp&nbsp&nbsp&nbspdataStartDate=&dataStartDate&#59<br/>&nbsp&nbsp&nbsp&nbspLastXtrcDate = &LastXtrcDate&#59/* &LastXtrcDate&#59*/<br/>&nbsp&nbsp&nbsp&nbspformat dataStartDate date9. LastXtrcDate date9.&#59<br/>&nbsp&nbsp&nbsp&nbspif (report_start <= dataStartDate <= report_end <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor report_start > dataStartDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand (report_start <= LastXtrcDate <= report_end <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor report_end < LastXtrcDate)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>%sort(data=b52, sorter=xtrc_date)&#59<br/>/*the earliest xtrc_date should be the last one in the rows with a negative<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartgGap*/<br/>data b53&#59<br/>&nbsp&nbsp&nbsp&nbspset b52 (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_Start_DP_SPEC', put(xtrc_date, date9.))&#59<br/>run&#59<br/>%let Xtrc_Start_DP_SPEC=%str(%')&Xtrc_Start_DP_SPEC.%str(%')d&#59<br/>%let Xtrc_Start_DP_SPEC= %substr(&Xtrc_Start_DP_SPEC, 1, %length(&Xtrc_Start_DP_SPEC))&#59<br/>%put >>> &Xtrc_Start_DP_SPEC&#59<br/><br/>%sort(data=b52, sorter=descending xtrc_date)&#59<br/>/*the earliest xtrc_date should be the last one in the rows with a negative<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartgGap*/<br/>data b54&#59<br/>&nbsp&nbsp&nbsp&nbspset b52 (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_End_DP_SPEC', put(xtrc_date, date9.))&#59<br/>run&#59<br/>%let Xtrc_End_DP_SPEC=%str(%')&Xtrc_End_DP_SPEC.%str(%')d&#59<br/>%let Xtrc_End_DP_SPEC= %substr(&Xtrc_End_DP_SPEC, 1, %length(&Xtrc_End_DP_SPEC))&#59<br/>%put >>> &Xtrc_End_DP_SPEC&#59<br/>/******************************************/<br/><br/>/***get xtrc_date for mds_ltc data****************************/<br/>data b61&#59<br/>&nbsp&nbsp&nbsp&nbspset clean.xtrc_dates&#59<br/>&nbsp&nbsp&nbsp&nbspif xtrc_date < = &LastXtrcDate  and ds='mds_assessment_f_2015'&#59<br/>run&#59<br/>%sort(data=b61, sorter=descending xtrc_date)&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset b61 (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('Xtrc_MDS_LTC',  put(xtrc_date, date9.))&#59 <br/>run&#59<br/>%let XTRC_MDS_LTC=%str(%')&XTRC_MDS_LTC.%str(%')d&#59<br/>%let XTRC_MDS_LTC= %substr(&XTRC_MDS_LTC, 1, %length(&XTRC_MDS_LTC))&#59<br/>%put >>> &XTRC_MDS_LTC&#59<br/><br/>/****************************************************/<br/><br/>/*get the file (full path) and macro command for getting dx info from MDS_LTC*/<br/>%macro getMDSMacro&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*initially, let the following variables = nothing*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let LPath_MDSLTC_DxMacro=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let File_MDSLTC_DxMacro=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let Command_MDSLTC_DxMacro =&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data =remoteS.A12_DXMDSLTC )&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the path, file name and command lines*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remoteS.A12_DXMDSLTC (obs=1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('LPath_MDSLTC_DxMacro',  thePath)&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('File_MDSLTC_DxMacro',  theFile)&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('Command_MDSLTC_DxMacro',  theLines)&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*remove the slash at the end of the path*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let LPath_MDSLTC_DxMacro=%sysfunc(strip(&LPath_MDSLTC_DxMacro))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %substr(&LPath_MDSLTC_DxMacro, %length(&LPath_MDSLTC_DxMacro), 1) = \\ %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let LPath_MDSLTC_DxMacro=%substr(&LPath_MDSLTC_DxMacro, 1, %eval(%length(&LPath_MDSLTC_DxMacro)-1))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let LPath_MDSLTC_DxMacro= %sysfunc(strip(&LPath_MDSLTC_DxMacro))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the local macro file to get dx data from MDS_LTC = %str(&LPath_MDSLTC_DxMacro.\\&File_MDSLTC_DxMacro)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the remote macro file to get dx data from MDS_LTC = %str(&remoteSourcePath.\\&File_MDSLTC_DxMacro)&#59<br/>%mend getMDSMacro&#59<br/>%getMDSMacro&#59<br/><br/>%freq(source=clean.xtrc_dates, table=ds)&#59<br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"EGTask-yUjgFuvpaSgEzUDM","name":"Copy LTCMacro to Remote","custparents":[{"idx":"CodeTask-B7GYeGViHcyJuijA"}],"children":[{"idx":"CodeTask-iBm3TnsewjoXmFMA","name":"C_dx from all sources","NodeDescription":"///t<br/>///s<br/>/*C. Getting data from each sources*/<br/>data _null_&#59run&#59<br/>/*Note!!!<br/>&nbsp&nbsp&nbsp&nbspIf a new source file is added (e.g., the home care or long term care file), the <br/>&nbsp&nbsp&nbsp&nbspAddRequest_&theSourceFile must be added into the %global statement<br/>&nbsp&nbsp&nbsp&nbspIn addition, in the macro makingAddRequest, a line must be added to initialize null value for the variable&nbsp&nbsp&nbsp&nbspAddRequest_&theSourceFile:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspi.e., %let AddRequest_&theSourceFile =&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>*/<br/><br/>%global <br/>&nbsp&nbsp&nbsp&nbspCCP_ CCI_ ICD9_ ICD10_ ICDDxList IntVNDxList ICD9Left3_ ICD9DxListLeft3 FSCDxList<br/>&nbsp&nbsp&nbsp&nbspFSC_ EDF2012DxList DINDxStr DINDxList DxMethod<br/>&nbsp&nbsp&nbsp&nbspAddRequest_hospital AddRequest_msb AddRequest_ed_a2012 AddRequest_dp_benefit <br/>&nbsp&nbsp&nbsp&nbspAddRequest_dp_NonBenefit AddRequest_PHRS<br/>&#59<br/><br/>/*make syntax for additional request when preparing c_dx_&sourceFile*/<br/>%macro makingAddRequest&#59<br/>&nbsp&nbsp&nbsp&nbsp%local theSource nRec i theSyntaxSeg&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*clean up the values in the syntax variables*/<br/>&nbsp&nbsp&nbsp&nbsp%let AddRequest_hospital=&#59<br/>&nbsp&nbsp&nbsp&nbsp%let AddRequest_msb=&#59 <br/>&nbsp&nbsp&nbsp&nbsp%let AddRequest_ed_a2012=&#59 <br/>&nbsp&nbsp&nbsp&nbsp%let  AddRequest_dp_benefit=&#59 <br/>&nbsp&nbsp&nbsp&nbsp%let AddRequest_dp_NonBenefit=&#59<br/>&nbsp&nbsp&nbsp&nbsp%let AddRequest_PHRS=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*get the number of obs in a8_AddRequest*/<br/>&nbsp&nbsp&nbsp&nbsp%nobs(data=remotes.a8_addRequest)&#59<br/>&nbsp&nbsp&nbsp&nbsp%let nRec = &nobs&#59<br/>&nbsp&nbsp&nbsp&nbsp%let nobs=&#59<br/>&nbsp&nbsp&nbsp&nbsp/*loop and get the soureData name and syntax for each row in a8_addRequest*/<br/>&nbsp&nbsp&nbsp&nbsp%do i = 1 %to &nRec&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.a8_addRequest (firstobs=&i obs=&i)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('theSource', SourceData)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('theSyntaxSeg', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &theSource, &theSyntaxSeg&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> AddRequest_&theSource = &&AddRequest_&theSource&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*assemble the syntaxsegments into the condition segment*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&&AddRequest_&theSource) = 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the AddRequest syntax is blank, make it like: if <syntaxseg>*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let AddRequest_&theSource = if &theSyntaxSeg&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the addRequest syntax is not blank, attach the syntax seg with 'AND'*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let AddRequest_&theSource = &&AddRequest_&theSource AND &theSyntaxSeg&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> AddRequest_&theSource = &&AddRequest_&theSource&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>%mend makingAddRequest&#59<br/>%makingAddRequest&#59<br/><br/>/*prepare strings for ICD codes*/<br/>/*get icd-9 list*/<br/>%macro makingDxLists&#59&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata makingDxLists_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A3_ICDDX&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif code_version='ICD_9'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToStr(data=makingDxLists_tmp1, var=code)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ICD9_=&valuesToStr_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &ICD9_ = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ICD9_=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> ICD9 list = &ICD9_&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get icd-10-ca list*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata makingDxLists_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A3_ICDDX&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif code_version='ICD_10_CA'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToStr(data=makingDxLists_tmp2, var=code)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ICD10_=&valuesToStr_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &ICD10_ = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ICD10_=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> ICD10 list = &ICD10_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get CCP list*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata makingDxLists_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A4_INTVNDX&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif code_version='CCP'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToStr(data=makingDxLists_tmp3, var=code)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CCP_=&valuesToStr_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &CCP_ = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CCP_=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> CCP list = &CCP_&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get CCI list*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata makingDxLists_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A4_INTVNDX&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif code_version='CCI'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToStr(data=makingDxLists_tmp4, var=code)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CCI_=&valuesToStr_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &CCI_ = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CCI_=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> CCI list = &CCI_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*the ICD 9 codes may have 4 digitis or more<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor MSB file, only check the first digits, therefore a truncated 3-digit code list should be prepared separately<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata makingDxLists_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A3_ICDDX&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif code_version='ICD_9'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode_Left3=substr(code, 1,3)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToStr(data=makingDxLists_tmp5, var=code_Left3)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ICD9Left3_=&valuesToStr_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &ICD9Left3_ = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ICD9Left3_=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> For MSB, ICD9 (left 3 digits) list = &ICD9Left3_&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*from MSB file get list of Fee Schedule Code (SK proc codes)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata makingDxLists_tmp6&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A5_FSC&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToStr(data=makingDxLists_tmp6, var=code)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let FSC_=&valuesToStr_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &FSC_ = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let FSC_=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> For MSB, Fee schedule code (FSC) list = &FSC_&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a list of diag codes, delimited by ,*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToList(data=remotes.A3_ICDDX, var=code)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ICDDxList=&valuesToList_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToList_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &ICDDxList = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ICDDxList=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> All ICD codes, delimited by comma = &ICDDxList&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a list of diag codes from the ICD_9 codes, for MSB files only*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToList(data=makingDxLists_tmp5, var=code_Left3)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ICD9DxListLeft3=&valuesToList_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToList_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &ICD9DxListLeft3 = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let ICD9DxListLeft3=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> ICD_9 codes of first 3 charater, delimited by comma = &ICD9DxListLeft3&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToList(data=remotes.A4_IntVNDx, var=code)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let IntVNDxList=&valuesToList_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToList_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &IntVNDxList = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let IntVNDxList=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> Interveniton codes, delimted by comman = &IntVNDxList&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*from MSB file get list of Fee Schedule Code (SK proc codes)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToList(data=remotes.A5_FSC, var=code)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let FSCDxList=&valuesToList_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToList_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &FSCDxList = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let FSCDxList=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> Fee Schedule Codes, delimted by comman = &FSCDxList&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a list of codes for ED_after 2012 file*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata makingDxLists_tmp7&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A3_ICDDX&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif code_version='ICD_9' then EDCode =substr(code, 1,3)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse EDCode=Code&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToList(data=makingDxLists_tmp7, var=EDCode)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let EDF2012DxList=&valuesToList_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToList_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &EDF2012DxList = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let EDF2012DxList=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> diagnostic list for ED file (after 2012) = &EDF2012DxList&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a DIN list like xxx yyy (for drug extraction macro)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToStr(data=remotes.A6_DINDx, var=DIN)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let DINDxStr=&valuesToStr_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &DINDxStr = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let DINDxStr=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> All DIN codes, delimited by space = &DINDxStr&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a DIN list like 'xxx', 'yyy', for determination of dx source*/&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToList(data=remotes.A6_DINDx, var=DIN)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let DINDxList=&valuesToList_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &DINDxList&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToList_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &DINDxList = '[ThereIsNoValue]' %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let DINDxList=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> All DIN codes, delimited by comma = &DINDxList&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%deldata(data=makingDxLists_tmp1 makingDxLists_tmp2 makingDxLists_tmp3 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmakingDxLists_tmp4 makingDxLists_tmp5 makingDxLists_tmp6 makingDxLists_tmp7)&#59<br/><br/>%mend makingDxLists&#59<br/>%makingDxLists&#59<br/><br/>/*macro to get data from hopsital*/<br/>/*<br/>Get hospital record, with record N, adm/dschg date,<br/>&nbsp&nbsp&nbsp&nbsptype of dx (dx, cdx, intvn, cintvn), position of dx (main, others)<br/>*/<br/><br/>%macro getDxData_hospital&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%local LogicCondition&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*By default, the code_Logic = AND (in macro Extract_CIHI)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif only ICD codes  OR CCP/CCI codes were specified, let code_logic = AND<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIf both were specified, use the logic OR<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsuch that ANY records with 1+ diag codes from ICD/CCP/CCI will be included<br/>&nbsp&nbsp&nbsp&nbsp*/<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp%if (%length(&ICD9_) ne 0 or %length(&ICD10_) ne 0 ) <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand (%length(&CCP_) ne 0 or %length(&CCI_) ne 0 ) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let LogicCondition = OR&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let LogicCondition = AND&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%put >>> LogicCondition = &LogicCondition&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%Extract_CIHI( <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_in =&hospitalFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out=c_hospital, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadms_start_date=&DataStartDate,      <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadms_end_date=&EntryEndDate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspICD9_list=&ICD9_,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspICD10_list=&ICD10_,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCP_List=&CCP_,<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCP_Exact_list=,*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCI_list=&CCI_,<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCI_Exact_list=,*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode_logic=&LogicCondition,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file= <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp )&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp /*apply the additional request conditions*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&AddRequest_hospital) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> applying additional request: &AddRequest_hospital&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata c_hospital&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset c_hospital&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&AddRequest_hospital&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp /*if none of the ICDDxlist and IntVnDxList contains any code, keep all distinct records*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %if %length(&ICDDxList )=0 and %length(&IntVNDxList) = 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp &nbsp&nbsp&nbsp&nbsp%put >>> no ICD or IntVn codes specified&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=c_hospital,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=c_dx_hospital,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCIHI_REC,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspKEY_HSN,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADM_DATE,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDSCHG_DATE,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'hp' as src,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'NA' as type,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'NA' as code,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmonotonic() as obs,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp1 as dxN<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(datepart(xtrc_date) <= &LastXtrcDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>>  ICD or IntVn codes specified&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata c_dx_hospital&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset c_hospital&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrc='hp'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif datepart(xtrc_date) <= &LastXtrcDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsparray dxs $ dx_code_1 - dx_code_25&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsparray cdxs $ conv_dx_code_1 - conv_dx_code_25&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsparray intvns $ intvn_code_1 - intvn_code_20&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsparray cintvns $ conv_proc_code_1 - conv_proc_code_20&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat type $5.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat code $10.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdo i = 1 to 25&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&ICDDxList )  ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> ICDDxList = &ICDDxList&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif dxs(i) in: (&ICDDxList) then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs=_n_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype='dx'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxN=i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode=dxs(i)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif cdxs(i) in: (&ICDDxList)  then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs=_n_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype='cdx'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxN=i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode=cdxs(i)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif i <21 then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&IntVNDxList ) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> IntVNDxList = &IntVNDxList&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif intvns(i) in: (&IntVNDxList)  then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs=_n_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype='intvn'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxN=i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode=intvns(i)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif Cintvns(i) in: (&IntVNDxList)  then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs=_n_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype='cintvn'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxN=i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode=cintvns(i)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep CIHI_REC key_hsn obs type dxN code adm_date dschg_date src&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>%mend getDxData_hospital&#59<br/>/*%getDxData_hospital&#59*/<br/>/*************************************/<br/><br/><br/>/*macro to get data from MSB*/<br/>/**/<br/>/*%let ICD9Left3_=361 714&#59*/<br/>/*%let ICD9DxListLeft3=%str('361', '714')&#59*/<br/>/*%let FSC_= B00 A79&#59*/<br/>/*%let FSCDxList=%str('B00', 'A79')&#59*/<br/>%macro getDxData_MSB&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*the problem is that when both diagcode and FSC code are specified<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe following macro returns only records of diagcode AND FSC<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIt seems that, unlike the Extract_CIHI macro, there is no option to <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspchange the logic to OR<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTherefore in the following step, FSCcode is never specified, such that <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall records regardless will be extracted, regardless of FSC code. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspScreening of FSC code will be done in later steps<br/>&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%Extract_MSB(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt=&Xtrc_Start_MSB,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt=&Xtrc_End_MSB, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out= c_MSB, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file= , <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdiagcode=&ICD9Left3_, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdostart=&DataStartDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdosend=&EntryEndDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfscode=<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*apply the additional request conditions*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&AddRequest_MSB) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> applying additional request: &AddRequest_MSB&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata c_MSB&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset c_MSB&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&AddRequest_MSB&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*if the ICD9DxListLeft3 code contains no codes, keep all distinct records*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %if %length(&ICD9DxListLeft3 )=0  %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=c_MSB,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=c_dx_MSB,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspKEY_HSN,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_doc_num,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdos_1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'mb' as src,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'NA' as type,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'NA' as code,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmonotonic() as OBS,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp1 as dxN<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata c_dx_MSB&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset c_MSB&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat type $5. code $10. &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrc='mb'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&ICD9DxListLeft3 ) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif diag in: (&ICD9DxListLeft3) then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs=_n_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype='dx'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode=diag&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxN=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&FSCDxList ) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif &nbsp&nbsp&nbsp&nbspfsc in: (&FSCDxList) then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs=_n_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype='fsc'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode=fsc&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxN=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep key_hsn key_doc_num dos_1 obs type code dxN src&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>%mend getDxData_MSB&#59<br/>/*%getDxData_MSB&#59*/<br/>/*************************************/<br/><br/>/*macro to get data from ED_F_2012*/<br/>%macro getDxData_ED_A2012&#59<br/>&nbsp&nbsp&nbsp&nbsp%getED_A2012(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=&ed_a2012file,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=c_ED_A2012,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdistinctRecord=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatientList=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcondition = %str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(DatePart(reg_date) >= &DataStartDate and DatePart(reg_date) <= &EntryEndDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor (DatePart(disp_date) >= &DataStartDate and DatePart(disp_date) <= &EntryEndDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor (DatePart(reg_date) < &DataStartDate and DatePart(disp_date) > &EntryEndDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*apply the additional request conditions*/<br/>&nbsp&nbsp&nbsp&nbsp%if %length(&AddRequest_ED_A2012) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> applying additional request: &AddRequest_ED_A2012&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata c_ED_A2012&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset c_ED_A2012&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&AddRequest_ED_A2012&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspdata c_dx_ED_A2012&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset c_ED_A2012 &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat code $10.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadm_date = datepart(reg_date)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdschg_date = datepart(disp_date)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the EDDxlist is not specified, have all records*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&EDF2012DxList) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif mp_dx in: (&EDF2012DxList) &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs=_n_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype='dx'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode=mp_dx&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxN=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrc='ea'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat adm_date date9. dschg_date date9.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn adm_date dschg_date obs type code dxN src &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif datepart(xtrc_date) <= &LastXtrcDate&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/><br/>%mend getDxData_ED_A2012&#59<br/>/*%getDxData_EDA2012&#59*/<br/><br/>/*************************************/<br/><br/>/*macro to get data from Drug_ben*/<br/>/*get drug claims*/<br/>%macro getDxData_DP_Benefit&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%Extract_Drug(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt=&Xtrc_Start_DP_Ben, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt=&Xtrc_End_DP_Ben, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspexcl_xtrc_dt=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out=c_DP_Benefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspalldin_file=&alldinfile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_list=&DINDxStr,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_file= ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_list=,                    <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstrt_dt=&DataStartDate ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend_dt=&EntryEndDate  <br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=_drgtmp _fileout _allDIn)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*apply the additional request conditions*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&AddRequest_DP_Benefit) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> applying additional request: &AddRequest_DP_Benefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata c_DP_Benefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset c_DP_Benefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&AddRequest_ED_DP_Benefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59&nbsp&nbsp&nbsp&nbsp<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*if the DINDxList code contains nothing, keep all distinct records*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %if %length(&DINDxList )=0  %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=c_DP_Benefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=c_dx_DP_Benefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspKEY_HSN,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprx_ddddd as rxd,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'db' as src,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'din' as type,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'NA' as code,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmonotonic() as OBS,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp1 as dxN<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(datepart(xtrc_date) <= &LastXtrcDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata c_dx_DP_Benefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset c_DP_Benefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs=_n_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif din in (&DINDxList)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype='din'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode=din&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxN=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrc='db'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprxd=rx_ddddd&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat rxd date9.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep key_hsn rxd obs type code dxN src&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>%mend getDxData_DP_Benefit&#59<br/>/*%getDxData_DP_Benefit&#59*/<br/>/*************************************/&nbsp&nbsp&nbsp&nbsp<br/><br/>/*macro to get data from Drug_nonBen*/<br/>%macro getDxData_DP_NonBenefit&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%Extract_Drug_non_ben_test(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt=&Xtrc_Start_DP_NBen, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt=&Xtrc_End_DP_NBen, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspexcl_xtrc_dt=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out=getDxData_DP_NonBenefit_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspalldin_file=&alldinfile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_list=&DINDxStr,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_list=,                    <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstrt_dt=&DataStartDate ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend_dt=&EntryEndDate <br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*to be alined with the columns in dp_benefit*/<br/>&nbsp&nbsp&nbsp&nbspdata C_DP_NonBenefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getDxData_DP_NonBenefit_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop birth_year birth_month hc_mjr_clss hc_MNR_clss hc_sub_clss&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspAMNT_PAY_DRUG_PLAN=0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename total_cost=TOTAL_APPRV&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename UNT_PR_cost =UNT_PR_PAY&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFormat XMPT_IND $1.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspXMPT_IND ='N'&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=_drgtmp _fileout _allDIn getDxData_DP_NonBenefit_tmp1)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*apply the additional request conditions*/<br/>&nbsp&nbsp&nbsp&nbsp%if %length(&AddRequest_DP_NonBenefit) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> applying additional request: &AddRequest_DP_NonBenefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata C_DP_NonBenefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset C_DP_NonBenefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&AddRequest_ED_DP_NonBenefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*if the DINDxList code contains nothing, keep all distinct records*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %if %length(&DINDxList )=0  %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=C_DP_NonBenefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=c_dx_DP_NonBenefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspKEY_HSN,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprx_ddddd as rxd,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'dn' as src,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'din' as type,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'NA' as code,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmonotonic() as OBS,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp1 as dxN<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(datepart(xtrc_date) <= &LastXtrcDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp %else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata c_dx_DP_NonBenefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset C_DP_NonBenefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs=_n_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif din in: (&DINDxList)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype='din'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode=din&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxN=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrc='dn'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename rx_ddddd=rxd&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep key_hsn rx_ddddd obs type code dxN src&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>%mend getDxData_DP_NonBenefit&#59<br/>/*%getDxData_DP_NonBenefit&#59*/<br/><br/>/*<br/>&nbsp&nbsp&nbsp&nbspget MDSLTC data*/<br/>%put >>> &remoteSourcePath./&File_MDSLTC_DxMacro&#59<br/><br/>%macro getDxData_MDS_LTC&#59<br/>&nbsp&nbsp&nbsp&nbsp%include \"&remoteSourcePath./&File_MDSLTC_DxMacro\"&#59<br/>&nbsp&nbsp&nbsp&nbsp%if &File_MDSLTC_DxMacro ne empty.sas %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&Command_MDSLTC_DxMacro&#59 <br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend getDxData_MDS_LTC&#59<br/><br/><br/>/*get cohort population from PHRS files (e.g., from a particular area, of a study period, etc)*/<br/>%macro getDxData_phrs&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the population between the cohort entry period*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%SKPopulation(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprawfilePath=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinfoPath=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinfoFile=&PHRS_InfoFile, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProgPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProgFile=&PHRS_CovFile, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinfoXtrc=&lastXtrcDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcoverXtrc=&Xtrc_End_Cover, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartDate=&EntryStartDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspendDate=&EntryEndDate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeepTMP=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getDxData_phrs_tmp1)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*From above, the data set SKPopulation_Poplist contains all key_hsns ever appeared in the interested period<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor the following, add two columns to indicate the start and end dates)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=SKPopulation_Poplist,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getDxData_phrs_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, &EntryStartDate format date9. as startD, &EntryEndDate format date9. as endD)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get geologic information (in the result set, RHA=RHA_A_Number)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%demog_assign(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspprs_xtrc_dt=&Xtrc_End_Cover,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp         ds_in =getDxData_phrs_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp         ds_out=getDxData_phrs_tmp3, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp         strt_dt_var=startD,   <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp         end_dt_var=endD,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp         geo_file=&PHRS_Resi_cleanFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp         incl_full_info=N,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp         incl_incqtl_var=N,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp         debug=N<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp         )&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*apply additional conditions<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe conditions can be set for the following variables&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp RHA (0-9), URB_RUR, BORN_MONTH, BORN_YEAR, SEX_DESC, MARI_STAT_CODE*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp /*apply the additional request conditions*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&AddRequest_phrs) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> applying additional request: &AddRequest_phrs&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getDxData_phrs_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getDxData_phrs_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&AddRequest_PHRS&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=getDxData_phrs_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=c_dx_phrs,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, 'ph' as src, 'ph' as code, monotonic() as dxN, 'ph' as type, &EntryStartDate as DxDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=getDxData_phrs_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=c_dx_phrs,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, 'ph' as src, 'ph' as code, monotonic() as dxN, 'ph' as type, &EntryStartDate as DxDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete getDxData_phrs_tmp:&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>%mend getDxData_phrs&#59<br/><br/><br/><br/>/*****End of macros for getting data from individual sources********************************************/<br/><br/>%macro NewPop_GetDxData&#59<br/>&nbsp&nbsp&nbsp&nbsp%local theSources theFileSource i dlmt&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*let dlmt=space*/<br/>&nbsp&nbsp&nbsp&nbsp%let dlmt=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*the files for defining the study cohort*/<br/>&nbsp&nbsp&nbsp&nbsp%ValueToString(Data=remoteS.A7_DXFILES, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheVar=dxFiles, theStrVarName=, DLMT=&dlmt)&#59<br/>&nbsp&nbsp&nbsp&nbsp%let theSources=&theStrVar_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%put >>> theSources are &theSources&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*create an empty data set, later dx data from each src will be appendied to the dataset<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspit'll report in the log that the variable key_hsn is uninitialized<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspit is fine. SAS pops warnings if the variable has no value yet is formated (as in this case). <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspThis is to warn users<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthat the variable is never used (e.g., the var name is misspelled)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspHere it is fine, as the purpose IS to create an empty data set without any values. <br/>&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbspdata NewPop_GetDxData_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat Key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%let i=1&#59<br/>&nbsp&nbsp&nbsp&nbsp/*loop to get the sources*/<br/>&nbsp&nbsp&nbsp&nbsp/*loop unitl %scan has a null value, i.e., a null value after the last element*/<br/>&nbsp&nbsp&nbsp&nbsp%do %until (<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%length(%scan(%quote(&theSources), &i &dlmt)) =0<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the current file source*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> i = &i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theFileSource=%scan(%quote(&theSources), &i &dlmt)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the source is PHRS_INFO or PHRS_PROG, change the source name to PHRS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(because such set is to use the same macro gexDxData_PHRS)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theFileSource=%scan(%quote(&theSources), &i &dlmt)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %index(%upcase(&theFileSource), PHRS_INFO) ne 0<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor  %index(%upcase(&theFileSource), PHRS_PROG) ne 0<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%then %let theFileSource=PHRS&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> theFileSource= &theFileSource&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*run the specific data-getting macro for each file source*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> run macro getDxData_&theFileSource&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getDxData_&theFileSource&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*append the records to _tmp1*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata NewPop_GetDxData_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset NewPop_GetDxData_tmp1 c_dx_&theFileSource&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let i = %eval(&i+1)&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*determine the diagnosis date (e.g., by adm date or by ds_chg date*/<br/>&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.a1_MasterInput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif items= 'DiagnosisDate'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('DxMethod', value)&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*note the following settings does not account for<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata from ED before 2012 (ea), or phrs */<br/>&nbsp&nbsp&nbsp&nbspdata c_dxAll&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset NewPop_GetDxData_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat dxDate date9.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif src in ('hp', 'ea', 'eb') then  dxDate=&DxMethod&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif src = 'mb'  then dxDate = dos_1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif src in ('db', 'dn')  then dxDate = rxd&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif src in ('ml', 'ph') then dxDate=dxDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDxYear=year(dxDate)&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59 <br/>&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=c_dxAll, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=c_dxAll.zip, <br/>&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>&nbsp&nbsp&nbsp&nbsp%sort(data=c_dxAll, sorter=key_hsn dxDate src)&#59<br/>&nbsp&nbsp&nbsp&nbsp%freq(data=c_dxAll, table =dxyear* src)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=NewPop_GetDxData_tmp1)&#59<br/><br/>%mend NewPop_GetDxData&#59<br/>%NewPop_GetDxData&#59<br/>/*************************************/<br/><br/><br/>/*cohort*/<br/>data c6a&#59<br/>&nbsp&nbsp&nbsp&nbspset c_dxAll&#59<br/>&nbsp&nbsp&nbsp&nbspif dxDate >= &entryStartDate and dxDate <= &entryEndDate&#59<br/>run&#59<br/>data remoteT.c_cohort&#59<br/>&nbsp&nbsp&nbsp&nbspset c6a&#59<br/>&nbsp&nbsp&nbsp&nbspby key_hsn dxDate src&#59<br/>&nbsp&nbsp&nbsp&nbspif first.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbspif key_hsn ne . and dxdate ne . &#59<br/>&nbsp&nbsp&nbsp&nbsprename dxDate = dQDate&#59<br/>run&#59<br/><br/><br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-B1XbbPwYZKjWPVJM","name":"D_Patient Flow","NodeDescription":"///t<br/>///s<br/>/*D. Apply exclusion criteria and prepare patient flow report*/<br/>/*%print(data=&PHRS_CovFile)&#59*/<br/>data _null_&#59run&#59<br/><br/>%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=&remoteTargetPath,<br/>&nbsp&nbsp&nbsp&nbspzip=c_dxall,<br/>&nbsp&nbsp&nbsp&nbspzipped=c_dxall,<br/>&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsptarget=c_dxall<br/>)&#59<br/><br/><br/>/*D1. Pop between the entry period*/<br/>%SKPopulation(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprawfilePath=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinfoPath=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinfoFile=&PHRS_InfoFile, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProgPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProgFile=&PHRS_CovFile, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinfoXtrc=&lastXtrcDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcoverXtrc=&Xtrc_End_Cover, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartDate=&EntryStartDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspendDate=&EntryEndDate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeepTMP=1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=D1a)&#59<br/><br/>%minmax(data=d1a, <br/>&nbsp&nbsp&nbsp&nbspvar=count, format=, target=d1b, m=sum)&#59<br/>&nbsp&nbsp&nbsp&nbspdata remoteT.d1_pop&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVar='pop'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d1b&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename var_sum = N&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>/*D2. Number of cases in c_cohort*/<br/>%minmax(data=remoteT.c_cohort, <br/>&nbsp&nbsp&nbsp&nbspvar=key_hsn, format=, target=d2a, m=count)&#59<br/>&nbsp&nbsp&nbsp&nbspdata d2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVar='study_pop'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d2a&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename var_count = N&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>/*D3. get age sex natv_flag info of all patients in c_cohort*/<br/>%getPHRSInfo(<br/>&nbsp&nbsp&nbsp&nbsprawFile=&phrs_infoFile, <br/>&nbsp&nbsp&nbsp&nbspsourceFile=remoteT.c_cohort, <br/>&nbsp&nbsp&nbsp&nbsptargetFile=d3a, <br/>&nbsp&nbsp&nbsp&nbspindexCol=dQDate, <br/>&nbsp&nbsp&nbsp&nbspBornDay=15, <br/>&nbsp&nbsp&nbsp&nbspageCut=,<br/>&nbsp&nbsp&nbsp&nbspincldNative=1, /*the source file &PHRSINFOZIP have a column of native_flag&#59 we will include the first nations, but<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnot analyze as a specific group*/<br/>&nbsp&nbsp&nbsp&nbspstartDt=&EntryStartDate,<br/>&nbsp&nbsp&nbsp&nbspendDt=&EntryEndDate,<br/>&nbsp&nbsp&nbsp&nbspcohortGroup=,<br/>&nbsp&nbsp&nbsp&nbspxtrc=&lastXtrcDate,<br/>&nbsp&nbsp&nbsp&nbspkeepTMP=,<br/>&nbsp&nbsp&nbsp&nbspnoprint=noprint<br/>)&#59<br/><br/>/*# patients excluding those missing info*/<br/>%minmax(data=d3a, <br/>&nbsp&nbsp&nbsp&nbspvar=key_hsn, format=, target=d3b, m=count)&#59<br/>&nbsp&nbsp&nbsp&nbspdata d3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVar='excld_miss'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d3b&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename var_count = N&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>/*get the exclusion critera*/<br/><br/>/*D4 excluding registered Indians if specified*/<br/>%macro applyNatvCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%local NatvCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let NatvCondition=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Registered Indian'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('NatvCondition', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&NatvCondition) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let NatvCondition = if &NatvCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> NatvCondition is: &NatvCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d4a&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d3a&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&NatvCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%minmax(data=d4a, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvar=key_hsn, format=, target=d4b, m=count)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVar='excld_RegIndian'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d4b&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename var_count = N&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>%mend applyNatvCondition&#59<br/>%applyNatvCondition&#59<br/><br/>/*D5 apply age exclusion criteria*/<br/>%macro ApplyAgeCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%local AgeCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let AgeCondition=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Age'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('AgeCondition', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&AgeCondition) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let AgeCondition = If &AgeCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> AgeCondition is: &AgeCondition&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d5a&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d4a&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&AgeCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%minmax(data=d5a, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvar=key_hsn, format=, target=d5b, m=count)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&AgeCondition) ne 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVar=symget('AgeCondition')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVar = 'If Age >=0'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d5b&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename var_count = N&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>%mend ApplyAgeCondition&#59<br/>%ApplyAgeCondition&#59<br/><br/><br/>/*6. excluding those with coverage gaps within the look-back window*/<br/>%Macro ApplyPriorCoverCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%local PriorCovCondition CoverDef CoverDefValue&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let PriorCovCondition=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspincase in the following steps, nothing to be created for table d6c, let it be an empty set<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif the empty data set was not created, the old d6c from last run will be kept and causing wrong results*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d6c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11. DQDate date9.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Coverage prior to the first diagnosis'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('PriorCovCondition', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> PriorCovCondition is: &PriorCovCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if there is no Conditions, have all patients in d6a*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 1*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&PriorCovCondition) = 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let PriorCovCondition = PriorCovCondition not set, all patients retained&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = by nothing&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue = nothing&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d6c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 1*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*else have only those continuously covered*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 2*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*Have the cover days, gaps, and PCT<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNote, if there are multiple disease cohorts, specify 'cohortGroup'*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getCoverGAPs(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprawfile=&PHRS_Covfile, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspptFile=d5a, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheCovXtrc=%str(&Xtrc_End_Cover), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstart=%str(dQdate - &PriorCovCondition), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend= %str(dQdate - 1), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d6a, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcohortgroup=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*determine the type of continuous coverage definition*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the type of coverage definition*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Definition of loss of cover'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('CoverDef', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> The continuous coverage is defined: &CoverDef&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the value of coverage definition (e.g., min gap = 7 days, etc)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Threshold value for loss of cover'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('CoverDefValue', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> The continuous coverage threshold value is: &CoverDefValue&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the coverage status is defined by min gap<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(if the coverage status is not defined, use the default: min gap =1 day)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 3*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDef) =0 or &CoverDef=by minimum gap in days %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDefValue is not specified, set the default min gap as 1 day*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 4*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&coverDef) = 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef= CoverDef not defined, use default setting min gap =1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDefValue) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = &CoverDef CoverDefValue not set, use default (min gap = 1 days )&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> Coverage threshold value not defined. change CoverDefValue to &CoverDefValue&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 4*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*&nbsp&nbsp&nbsp&nbspget patients ever had a gap > &CoverDefValue days*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(data=d6a, target=d6c, vars=%str(key_hsn, dQdate), filters=%str(gaps > &CoverDefValue))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 3*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 5*/<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the coverage status is defined by coverage days*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 6*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &CoverDef = by cover days %then %do&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDefValue is not specified, set the default min cover days as &PriorCovCondition<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspe.g., if PriorCovCondition=365, let the min cover days =365*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 7*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDefValue) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=&PriorCovCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = &CoverDef CoverDefValue not set, use default (same length as the priorCovCondition)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 7*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*sum the cover days*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=d6a,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d6b,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, dqDate, sum(days) as cumuCover, sum(coverPCT) as coverPCT),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroupby=%str(key_hsn, dqDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, dqDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the patients whose cumulative covering days < &CoverDefValue*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d6c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d6b&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif cumuCover < &CoverDefValue &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 6*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 8*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the coverage status is defined by cover-percentage*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 9*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &CoverDef = by cover percentage %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDefValue is not specified, set the default min PCT = 100<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspe.g., if PriorCovCondition=365, let the min cover days =365*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 10*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDefValue) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = &CoverDef CoverDefValue not set, use default (100%)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 10*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*sum the cover PCT*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=d6a,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d6b,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, dqDate, sum(days) as cumuCover, sum(coverPCT) as coverPCT),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroupby=%str(key_hsn, dqDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, dqDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the patients whose cumulative covering days < &CoverDefValue*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d6c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d6b&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif coverPCT < (&CoverDefValue *100) &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 9*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 11*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDef is not by gap, coverdays, or cover PCT, it must be a wrong setting<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdo not exclude any patient*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let coverDef = None of the patient will be excluded. No such coverage setting - &coverDef&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d6c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 11*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 8*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 5*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 2*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*d6c contains key_hsn and Dqdate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif there are multiple disease cohorts, the same patient may have different DQdates<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppatient may lost coverage only for a particular disease dqdate, but not for another<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d5a1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d5a&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn_DQDate = key_hsn || DQDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if d6c does not have records, d6c1 won't have any records as well*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d6c1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d6c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn_DQDate = key_hsn || DQDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*patients in d5a, but not in d6c*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=d5a1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d6d,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(t1.key_hsn_DQDate not in (select key_hsn_DQDate from d6c1))<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59&nbsp&nbsp&nbsp&nbsp<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%minmax(data=d6d, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvar=key_hsn, format=, target=d6e, m=count)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d6&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVar='excld_PriorCovGap'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d6e&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename var_count = N&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=d6)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> priorCovCondition = &PriorCovCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the coverage status is defined &CoverDef&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the threshold value is &CoverDefValue&#59<br/><br/>%mend ApplyPriorCoverCondition&#59<br/>%ApplyPriorCoverCondition&#59<br/><br/>/*7. excluding those with coverage gaps since the diagnosis date*/<br/>%Macro ApplyFollowCoverCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%local FollowCovCondition CoverDef CoverDefValue&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let FollowCovCondition=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspincase in the following steps, nothing to be created for table d7c, let it be an empty set<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif the empty data set was not created, the old d7c from last run will be kept and causing wrong results*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d7c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Coverage since the first diagnosis'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('FollowCovCondition', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> FollowCovCondition is: &FollowCovCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if there is no Conditions, have all patients in d6d*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 1*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&FollowCovCondition) = 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let FollowCovCondition = FollowCovCondition not set, all patients retained&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = by nothing&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue = nothing&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d7c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 1*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*else have only those continuously covered*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 2*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*Have the cover days, gaps, and PCT*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getCoverGAPs(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprawfile=&PHRS_Covfile, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspptFile=d6d, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheCovXtrc=%str(&Xtrc_End_Cover), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstart=%str(dQdate ), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend= %str(dQdate + &FollowCovCondition -1), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d7a, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcohortgroup=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*determine the type of continuous coverage definition*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the type of coverage definition*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Definition of loss of cover'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('CoverDef', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> The continuous coverage is defined: &CoverDef&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the value of coverage definition (e.g., min gap = 7 days, etc)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Threshold value for loss of cover'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('CoverDefValue', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> The continuous coverage threshold value is: &CoverDefValue&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the coverage status is defined by min gap<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(if the coverage status is not defined, use the default: min gap =1 day)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 3*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDef) =0 or &CoverDef=by minimum gap in days %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDefValue is not specified, set the default min gap as 1 day*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 4*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&coverDef) = 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef= CoverDef not defined, use default setting min gap =1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDefValue) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = &CoverDef CoverDefValue not set, use default (min gap = 1 days )&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> Coverage threshold value not defined. change CoverDefValue to &CoverDefValue&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 4*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*&nbsp&nbsp&nbsp&nbspget patients ever had a gap > &CoverDefValue days*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(data=d7a, target=d7c, vars=%str(key_hsn, dqdate), filters=%str(gaps > &CoverDefValue))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 3*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 5*/<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the coverage status is defined by coverage days*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 6*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &CoverDef = by cover days %then %do&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDefValue is not specified, set the default min cover days as &FollowCovCondition<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspe.g., if FollowCovCondition=365, let the min cover days =365*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 7*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDefValue) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=&FollowCovCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = &CoverDef CoverDefValue not set, use default (same length as the FollowCovCondition)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 7*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*sum the cover days*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=d7a,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d7b,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, dqDate, sum(days) as cumuCover, sum(coverPCT) as coverPCT),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroupby=%str(key_hsn, dqDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, dqDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the patients whose cumulative covering days < &CoverDefValue*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d7c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d7b&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif cumuCover < &CoverDefValue &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 6*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 8*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the coverage status is defined by cover-percentage*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 9*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &CoverDef = by cover percentage %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDefValue is not specified, set the default min PCT = 100<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspe.g., if FollowCovCondition=365, let the min cover days =365*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 10*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDefValue) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = &CoverDef CoverDefValue not set, use default (100%)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 10*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*sum the cover PCT*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=d7a,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d7b,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, dqDate, sum(days) as cumuCover, sum(coverPCT) as coverPCT),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroupby=%str(key_hsn, dqDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, dqDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the patients whose cumulative covering days < &CoverDefValue*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d7c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d7b&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif coverPCT < (&CoverDefValue *100) &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 9*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 11*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDef is not by gap, coverdays, or cover PCT, it must be a wrong setting<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdo not exclude any patient*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let coverDef = None of the patient will be excluded. No such coverage setting - &coverDef&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d7c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 11*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 8*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 5*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 2*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*d7c contains key_hsn and Dqdate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif there are multiple disease cohorts, the same patient may have different DQdates<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppatient may lost coverage only for a particular disease dqdate, but not for another<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d6d1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d6d&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn_DQDate = key_hsn || DQDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if d7c does not have records, d6c1 won't have any records as well*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d7c1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d7c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn_DQDate = key_hsn || DQDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*patients in d6d, but not in d7c*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=d6d1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d7d,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(t1.key_hsn_DQDate not in (select key_hsn_DQDate from d7c1))<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59&nbsp&nbsp&nbsp&nbsp<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%minmax(data=d7d, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvar=key_hsn, format=, target=d7e, m=count)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d7&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVar='excld_FollowCovGap'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d7e&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename var_count = N&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=d7)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> FollowCovCondition = &FollowCovCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the coverage status is defined &CoverDef&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the threshold value is &CoverDefValue&#59<br/><br/>%mend ApplyFollowCoverCondition&#59<br/>%ApplyFollowCoverCondition&#59<br/><br/>/*8. excluding with diagnosis or procedure code in the defined window*/<br/>%macro ApplyPriorDxDaysExclusion&#59<br/>&nbsp&nbsp&nbsp&nbsp%local PriorDxDays&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspincase in the following steps, nothing to be created for table d8c, let it be an empty set<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif the empty data set was not created, the old d8c from last run will be kept and causing wrong results*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d8c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Prior diagnosis'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('PriorDxDays', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> PriorDxDays is: &PriorDxDays&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if there is no Conditions, have all patients in d7d*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 1*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&PriorDxDays) = 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let PriorDxDays = PriorDxDays not set, all patients retained&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d8c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 1*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*else have only those not having dx codes in the defined period prior to the dQdate*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 2*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=C_dxAll,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=d7d,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d8c,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdistinct=1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.key_hsn),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*source is not benifit/nonbenifit drug claims */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(t1.dxdate between t2.dqDate - &PriorDxDays and t2.dqDate-1 and t1.src ne 'db' and t1.src ne 'dn' )<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 2*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*patients not in d8c*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=d7d,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d8d,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(t1.key_hsn not in (select key_hsn from d8c))<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%minmax(data=d8d, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvar=key_hsn, format=, target=d8e, m=count)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d8&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVar='excld_PriorDx'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d8e&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename var_count = N&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=d8)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> PriorDxDays = &PriorDxDays&#59<br/><br/>%mend ApplyPriorDxDaysExclusion&#59<br/>%ApplyPriorDxDaysExclusion&#59<br/><br/>/*9. excluding patients receiving study medications within the defined window*/<br/>%macro ApplyPriorRxDaysExclusion&#59<br/>&nbsp&nbsp&nbsp&nbsp%local PriorRxDays&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspincase in the following steps, nothing to be created for table d9c, let it be an empty set<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif the empty data set was not created, the old d9c from last run will be kept and causing wrong results*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d9c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Prior study medication'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('PriorRxDays', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> PriorRxDays is: &PriorRxDays&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if there is no Conditions, have all patients in d8d*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 1*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&PriorRxDays) = 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let PriorRxDays = PriorRxDays not set, all patients retained&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d9c&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 1*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*else have only those not having dx codes in the defined period prior to the dQdate*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 2*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=C_dxAll,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=d8d,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d9c,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdistinct=1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.key_hsn),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*source is benifit/nonbenifit drug claims */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(t1.dxdate between t2.dqDate - &PriorRxDays <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand t2.dqDate-1 and (t1.src = 'db' or t1.src = 'dn' ))<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 2*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*patients not in d9c*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=d8d,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=d9d,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(t1.key_hsn not in (select key_hsn from d9c))<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%minmax(data=d9d, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvar=key_hsn, format=, target=d9e, m=count)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata d9&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVar='excld_PriorRx'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d9e&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename var_count = N&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%print(data=d9)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> PriorRxDays = &PriorRxDays&#59<br/><br/>%mend ApplyPriorRxDaysExclusion&#59<br/>%ApplyPriorRxDaysExclusion&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdata remoteT.R1_Flow&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat Var $20.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset  remoteT.d1_pop d2 - d9&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdata remoteT.D&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset d9d&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/>s///<br/>t///","children":[{"idx":"CodeTask-OZhXRTIAuUI8so1K","name":"EA_get resi income","NodeDescription":"///t<br/>///s<br/>/*EA&nbsp&nbsp&nbsp&nbspexclusion criteria<br/>*/<br/>data _null_&#59run&#59<br/>&nbsp&nbsp&nbsp&nbsp/*adding resi info*/<br/>&nbsp&nbsp&nbsp&nbsp%getResiType(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspResiFile=&PHRS_Resi_cleanFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc=&xtrc_end_cover,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPtList=remoteT.D,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspindexCol=dqdate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=EA1<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp/*adding income quintile info*/<br/><br/>%GEO_INCQTL_assign(ds_in =EA1,<br/>&nbsp&nbsp&nbsp&nbspds_out=EA2, <br/>&nbsp&nbsp&nbsp&nbspstrt_dt_var=dQdate,   <br/>&nbsp&nbsp&nbsp&nbspend_dt_var=dQdate,<br/>&nbsp&nbsp&nbsp&nbspgeo_file=&PHRS_Resi_cleanFile,<br/>&nbsp&nbsp&nbsp&nbspincl_incqtl_var=Y<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>data remoteT.EA_Cohort_Final&#59<br/>&nbsp&nbsp&nbsp&nbspset EA2&#59<br/>run&#59<br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-W7usgQIznMNjU4BC","name":"E_dxSrc","NodeDescription":"///t<br/>///s<br/>/*Patients identified by different sources*/<br/>data _null_&#59run&#59<br/><br/>%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=&remoteTargetPath,<br/>&nbsp&nbsp&nbsp&nbspzip=c_dxall,<br/>&nbsp&nbsp&nbsp&nbspzipped=c_dxall,<br/>&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsptarget=c_dxall<br/>)&#59<br/><br/>data E0&#59<br/>&nbsp&nbsp&nbsp&nbspset c_dxall&#59<br/>&nbsp&nbsp&nbsp&nbspwhere dxDate between &EntryStartDate and &EntryEndDate&#59<br/>&nbsp&nbsp&nbsp&nbspyear=year(dxdate)&#59<br/>run&#59<br/><br/><br/>%macro calcohortPT(data=, target=, debug=)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%local data target debug&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*sort and have the first dx*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sort(data=&data, sorter=key_hsn dxDate)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata calcohortPT_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset &data&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby key_hsn dxDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif first.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*counting # patients*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getMeanStats(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=calcohortPT_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroupVars=year,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheVar=dxDate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=calcohortPT_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheStats=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*keep group and N*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata calcohortPT_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset calcohortPT_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspyearc='year' || compress(year, ' ')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep yearc n_patients_group&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename n_patients_group = n&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*make a list of cyears from &entryStartYear to &EntryEndYear*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata calcohortPT_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdo year= &entryStartYear to &EntryEndYear&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspyearc='year' || compress(year, ' ')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop year&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*attache the values in tmp2 to tmp3<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthis way, even there is a year missing value, the year<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstill exists*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=calcohortPT_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=calcohortPT_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=calcohortPT_tmp5,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.yearc, t2.n),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=yearc<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transpose*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%transpose(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=calcohortPT_tmp5, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=calcohortPT_tmp6, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRowHead=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspColHead=yearc, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspContents=n, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeepAllCol=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=&debug<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata &target&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset calcohortPT_tmp6&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsparray years(&EntryYears) year&EntryStartYear. - year&EntryEndYear.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptotal=0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdo year = 1 to &EntryYears&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptotal = sum(total,years(year))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop year years1-years&&EntryYears.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &debug ne 1 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%delData(data=calcohortPT_tmp1 calcohortPT_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcalcohortPT_tmp2_SPR <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcalcohortPT_tmp3 calcohortPT_tmp4 calcohortPT_tmp5 calcohortPT_tmp6)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend calcohortPT&#59<br/><br/>%macro GetCohortPtbySrc(TheDxSources=)&#59<br/>&nbsp&nbsp&nbsp&nbsp%local theDxSources theDxSource SrcCondition dlmt &#59<br/><br/>&nbsp&nbsp&nbsp&nbspdata GetCohortPtbySrc_target&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat src $10.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*if the DxSources is not specified (specified Dx sources are with customized orders), get all sources from the dx file*/<br/>&nbsp&nbsp&nbsp&nbsp%if %length(&theDxSources) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get all the sources*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(source=E0, target=E0a, vars=src)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the sources into a string*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToStr(data=E0a, var=src)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theDxSources = &valuesToStr_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*loop to calculate # pt by adding dx sources<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspe.g., src1, then src1-2, then src1-3, etc<br/>&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%let i=1&#59<br/>&nbsp&nbsp&nbsp&nbsp%let theDxSource=&#59<br/>&nbsp&nbsp&nbsp&nbsp%let dlmt=&#59<br/>&nbsp&nbsp&nbsp&nbsp%let SrcCondition=&#59<br/>&nbsp&nbsp&nbsp&nbsp/*loop to get the sources*/<br/>&nbsp&nbsp&nbsp&nbsp/*loop unitl %scan has a null value, i.e., a null value after the last element*/<br/>&nbsp&nbsp&nbsp&nbsp%do %until (<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%length(%scan(%quote(&theDxSources), &i &dlmt)) =0<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the current file source*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> i = &i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theDxSource= %scan(%quote(&theDxSources), &i &dlmt)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &i=1 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*for the first source, let the SrcCondition like if src = 'src1' */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let SrcCondition = %bquote(if src = '&theDxSource')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor the following sources, let the SrcCondition like if src = 'src1' or src = 'src2' */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let SrcCondition = &SrcCondition or  %bquote(src = '&theDxSource')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let SrcCondition=%substr(&SrcCondition, 1, %length(&SrcCondition))&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the source condition = &SrcCondition&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*select patients by adding the current dx source*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata GetCohortPtbySrc_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset E0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&SrcCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*calculae the nubmer of patients*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%calcohortPT(data=GetCohortPtbySrc_tmp1, target=GetCohortPtbySrc_tmp2)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*add a col src to indicate the added source*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata GetCohortPtbySrc_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset GetCohortPtbySrc_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrc = symget('theDxSource')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*append to GetCohortPtbySrc_target*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata GetCohortPtbySrc_target&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset GetCohortPtbySrc_target GetCohortPtbySrc_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%delData(data=GetCohortPtbySrc_tmp1 GetCohortPtbySrc_tmp2 GetCohortPtbySrc_tmp3)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let i = %eval(&i+1)&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>%mend GetCohortPtbySrc&#59<br/>%GetCohortPtbySrc (theDxSources=)&#59/*customize the order and sources, e.g., mb hp db dn ml*/<br/><br/>data remoteT.R2_dxSrc&#59<br/>&nbsp&nbsp&nbsp&nbspset GetCohortPtbySrc_target&#59<br/>run&#59<br/><br/>%delData(data=GetCohortPtbySrc_target E0 E0A)&#59<br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-73IOnefOiNpAZfDi","name":"F_R3_DxPos","NodeDescription":"///t<br/>///s<br/>/*In hopsital, # patients identified by different dx position*/<br/>data _null_&#59run&#59<br/><br/>%macro getPtByDxPos&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%local nRow&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata F0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remoteT.c_cohort&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif src='hp'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%nobs(data=f0)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let nRow = &nobs&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &nRow =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata remoteT.R3_DxPosition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat code $10.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%goto exit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*N by type (dx, cdx, intvnCode, cintvn code, etc)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getMeanStats(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=f0,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroupVars=type dxN,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheVar=dxN,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=f1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheStats=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*keep group and N*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata f2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset f1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxPos='DxPos' || put(dxN, z2.)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep dxPos n_patients_group type&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename n_patients_group = n&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sort(data=f2, sorter=type dxPos)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transpose*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%transpose(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=f2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=remoteT.R3_DxPosition, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRowHead=type, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspColHead=dxPos, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspContents=n, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeepAllCol=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%exit:<br/><br/>%mend getPtByDxPos&#59<br/>%getPtByDxPos&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-gcU6kB6LE6RW7sX4","name":"G_R4_NptByDxCode","NodeDescription":"///t<br/>///s<br/>/*Patients identified by different sources*/<br/><br/>data _null_&#59run&#59<br/><br/>%put >>> &EntryStartDate&#59<br/>%put >>> &EntryEndDate&#59<br/>%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=&remoteTargetPath,<br/>&nbsp&nbsp&nbsp&nbspzip=c_dxall,<br/>&nbsp&nbsp&nbsp&nbspzipped=c_dxall,<br/>&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsptarget=c_dxall<br/>)&#59<br/><br/>data G0&#59<br/>&nbsp&nbsp&nbsp&nbspset C_Dxall&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspwhere dxDate between &EntryStartDate and &EntryEndDate&#59<br/>&nbsp&nbsp&nbsp&nbspyearc='year' || compress(year(dxdate), ' ')&#59<br/>run&#59<br/>%freq(data=g0, table=src)&#59<br/><br/>%macro calcohortPT_Code(data=, target=, debug=)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%local data target debug&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*sort and have the first dx*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sort(data=&data, sorter=key_hsn dxDate)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata calcohortPT_Code_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset &data&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby key_hsn dxDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif first.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*counting # patients*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=calcohortPT_Code_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=calcohortPT_Code_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp yearc, count(key_hsn) as n<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroupby=%str( yearc),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(yearc)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*make a list of cyears from entryStartYear to entryEndYear*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata calcohortPT_Code_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdo year= &entryStartYear to &entryEndYear&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspyearc='year' || compress(year, ' ')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop year&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*attache the values in tmp2 to tmp3<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthis way, even there is a year missing value, the year<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstill exists*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=calcohortPT_Code_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=calcohortPT_Code_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=calcohortPT_Code_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.yearc, t2.n),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=yearc<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transpose*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%transpose(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=calcohortPT_Code_tmp4, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=&target, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRowHead=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspColHead=yearc, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspContents=n, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeepAllCol=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=&debug<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &debug ne 1 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%delData(data=calcohortPT_Code_tmp1 calcohortPT_Code_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcalcohortPT_Code_tmp3 calcohortPT_Code_tmp4 )&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend calcohortPT_Code&#59<br/>/*%print(data=C_DXALL)&#59*/<br/>/*%freq(data=C_DXALL, table=src)&#59*/<br/><br/>/*get all codes*/<br/>%distinct(source=g0,target=g0a, vars=code)&#59<br/><br/>/*for each code, get n patients*/<br/>%macro NPatbyCode(debug=)&#59<br/>&nbsp&nbsp&nbsp&nbsp%local nRows theOBS debug&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*get the nobs in G0a*/<br/>&nbsp&nbsp&nbsp&nbsp%nobs(data=g0a)&#59<br/>&nbsp&nbsp&nbsp&nbsp%let nRows=&nobs&#59<br/>&nbsp&nbsp&nbsp&nbsp%let nobs=&#59<br/>&nbsp&nbsp&nbsp&nbsp%do theOBS = 1 %to &nRows&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> checking code &theOBS  of &nRows&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata NPatbyCode_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset G0a (obs=&theOBS)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%valuesToList(data=NPatbyCode_tmp1, var=code)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata NPatbyCode_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset g0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif code in (&valuesTolist_0824)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesTolist_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%calcohortPT_Code(data=NPatbyCode_tmp2, target=NPatbyCode_tmp3, debug=&debug)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset NPatbyCode_tmp1 (firstOBS=&theOBS obs=&theOBS)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('lastCode', code)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let lastCode=&lastCode&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &lastCode&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*the nubmer of codes in g0a1*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata NPatbyCode_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat type $20. code $30.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype='Code'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode=symget('lastCode')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset NPatbyCode_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsparray years(&EntryYears) year&entryStartYear. - year&entryEndYear.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptotal=0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdo year = 1 to &EntryYears&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptotal = sum(total,years(year))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop year years1-years&EntryYears.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let lastCode =&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &theOBS=1 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata G&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset NPatbyCode_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata G&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset G NPatbyCode_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend NPatbyCode&#59<br/>%NPatbyCode(debug=)&#59<br/><br/>data remoteT.R4_DxCode&#59<br/>&nbsp&nbsp&nbsp&nbspset G&#59<br/>run&#59<br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-JU2jGM49586GmWH7","name":"H_R5_Desc","NodeDescription":"///t<br/>///s<br/>/*H<br/>&nbsp&nbsp&nbsp&nbspage sex group descriptives<br/>*/<br/>data _null_&#59run&#59<br/><br/>data h0&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.EA_cohort_final&#59<br/>&nbsp&nbsp&nbsp&nbspif age < 18 then ageG=' 0-18'&#59<br/>&nbsp&nbsp&nbsp&nbspif 18 < age < 25 then ageG='18-24'&#59 <br/>&nbsp&nbsp&nbsp&nbspif 24 < age < 35 then ageG='25-34'&#59 <br/>&nbsp&nbsp&nbsp&nbspif 34 < age < 45 then ageG='35-44'&#59 <br/>&nbsp&nbsp&nbsp&nbspif 44 < age < 55 then ageG='45-54'&#59 <br/>&nbsp&nbsp&nbsp&nbspif 54 < age < 65 then ageG='55-64'&#59<br/>&nbsp&nbsp&nbsp&nbspif 64 < age < 75 then ageG='65-74'&#59<br/>&nbsp&nbsp&nbsp&nbspif 74 < age < 85 then ageG='75-84'&#59<br/>&nbsp&nbsp&nbsp&nbspif age >84 then ageG='85+'&#59<br/>run&#59<br/>%GetMeanStats(<br/>&nbsp&nbsp&nbsp&nbspdata=h0,<br/>&nbsp&nbsp&nbsp&nbspgroupVars=,<br/>&nbsp&nbsp&nbsp&nbsptheVar=age,<br/>&nbsp&nbsp&nbsp&nbsptheStats=,<br/>&nbsp&nbsp&nbsp&nbsptarget=remoteT.R5a_means,<br/>&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/>%GetMeanStats(<br/>&nbsp&nbsp&nbsp&nbspdata=h0,<br/>&nbsp&nbsp&nbsp&nbspgroupVars=ageG,<br/>&nbsp&nbsp&nbsp&nbsptheVar=age,<br/>&nbsp&nbsp&nbsp&nbsptheStats=,<br/>&nbsp&nbsp&nbsp&nbsptarget=h2a,<br/>&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/>data remoteT.R5b_ageG&#59<br/>&nbsp&nbsp&nbsp&nbspset h2a&#59<br/>&nbsp&nbsp&nbsp&nbspkeep ageG N_Patients_Group&#59<br/>&nbsp&nbsp&nbsp&nbsprename N_Patients_Group=N&#59<br/>run&#59<br/><br/>%GetMeanStats(<br/>&nbsp&nbsp&nbsp&nbspdata=h0,<br/>&nbsp&nbsp&nbsp&nbspgroupVars=sex_desc,<br/>&nbsp&nbsp&nbsp&nbsptheVar=age,<br/>&nbsp&nbsp&nbsp&nbsptheStats=,<br/>&nbsp&nbsp&nbsp&nbsptarget=h3a,<br/>&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/>data remoteT.R5c_Sex&#59<br/>&nbsp&nbsp&nbsp&nbspset h3a&#59<br/>&nbsp&nbsp&nbsp&nbspkeep sex_desc N_Patients_Group&#59<br/>&nbsp&nbsp&nbsp&nbsprename N_Patients_Group=N&#59<br/>run&#59<br/><br/>/*rural/income*/<br/><br/>%print(data=h0)&#59<br/>%GetMeanStats(<br/>&nbsp&nbsp&nbsp&nbspdata=h0,<br/>&nbsp&nbsp&nbsp&nbspgroupVars=urb_rur,<br/>&nbsp&nbsp&nbsp&nbsptheVar=age,<br/>&nbsp&nbsp&nbsp&nbsptheStats=,<br/>&nbsp&nbsp&nbsp&nbsptarget=h3b,<br/>&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/>data remoteT.R5d_urb&#59<br/>&nbsp&nbsp&nbsp&nbspset h3b&#59<br/>&nbsp&nbsp&nbsp&nbspkeep urb_rur N_Patients_Group&#59<br/>&nbsp&nbsp&nbsp&nbsprename N_Patients_Group=N&#59<br/>run&#59<br/><br/>%GetMeanStats(<br/>&nbsp&nbsp&nbsp&nbspdata=h0,<br/>&nbsp&nbsp&nbsp&nbspgroupVars=incqtl,<br/>&nbsp&nbsp&nbsp&nbsptheVar=age,<br/>&nbsp&nbsp&nbsp&nbsptheStats=,<br/>&nbsp&nbsp&nbsp&nbsptarget=h3c,<br/>&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/>data remoteT.R5e_inc&#59<br/>&nbsp&nbsp&nbsp&nbspset h3c&#59<br/>&nbsp&nbsp&nbsp&nbspkeep incqtl N_Patients_Group&#59<br/>&nbsp&nbsp&nbsp&nbsprename N_Patients_Group=N&#59<br/>run&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-zWY4MoZZbeEPxh68","name":"I_CoverageTest","NodeDescription":"///t<br/>///s<br/>/*I<br/>&nbsp&nbsp&nbsp&nbspcoverage<br/>*/<br/>/*get all coverage info (of all years) of the study patients in c_cohort<br/>&nbsp&nbsp&nbsp&nbspbefore any exclusion<br/>*/<br/><br/>data _null_&#59run&#59<br/><br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=&phrs_covFile,<br/>&nbsp&nbsp&nbsp&nbspt2=remoteT.c_cohort,<br/>&nbsp&nbsp&nbsp&nbsptarget=I1,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.key_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.eff_date,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.exp_date,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.report_start,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.report_end,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.xtrc_date<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp),<br/>&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbspjvars=key_hsn<br/>)&#59<br/><br/>%minmax(data=I1, <br/>&nbsp&nbsp&nbsp&nbspvar=xtrc_date, format=datetime20., target=I2, m=max)&#59<br/><br/>/*keep the records with the max xtrc_date*/<br/>data remoteT.I_covAllYears&#59<br/>&nbsp&nbsp&nbsp&nbspset I1&#59<br/>&nbsp&nbsp&nbsp&nbspif datepart(xtrc_date) = &xtrc_end_cover&#59<br/>run&#59<br/><br/><br/>/*testing coverage*/<br/>data remoteT.R6_covtest&#59<br/>&nbsp&nbsp&nbsp&nbspformat type $100. N 8.&#59<br/>&nbsp&nbsp&nbsp&nbspdelete&#59<br/>run&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>%macro testCov( target=)&#59<br/>&nbsp&nbsp&nbsp&nbsp%local lookback target type i&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp%do lookback = 1 %to 10&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let i = %eval(&lookback * 365)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let type = %str(covered in &lookback. years since index)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getCoverGAPs(rawfile=remoteT.I_covAllYears, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspptFile=remoteT.c_cohort, theCovXtrc=%str(&xtrc_end_cover), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstart=DQDate, end= %str(dQDate + &i - 1), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=testCov_tmp1, cohortgroup=, debug=)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(data=testCov_tmp1, target=testCov_tmp2, vars=%str(key_hsn), filters=%str(gaps >=7))&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*patients in d5a, but not in d6c*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=remoteT.c_cohort,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=testCov_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(t1.key_hsn not in (select key_hsn from testCov_tmp2))<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59&nbsp&nbsp&nbsp&nbsp<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%minmax(data=testCov_tmp3, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvar=key_hsn, format=, target=testCov_tmp4, m=count)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata testCov_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype=symget('type')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset testCov_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename Var_count=N&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata &target&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset &target testCov_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%delData(data=testCov_tmp1 testCov_tmp2 testCov_tmp3<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptestCov_tmp4 testCov_tmp5)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%do lookback = 1 %to 10&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let i = %eval(&lookback * 365)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let type = %str(covered in &lookback. years before index)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getCoverGAPs(rawfile=remoteT.I_covAllYears, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspptFile=remoteT.c_cohort, theCovXtrc=%str(&xtrc_end_cover), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstart=DQDate - &i, end= %str(dQDate - 1), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=testCov_tmp1, cohortgroup=, debug=)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(data=testCov_tmp1, target=testCov_tmp2, vars=%str(key_hsn), filters=%str(gaps >=7))&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*patients in d5a, but not in d6c*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=remoteT.c_cohort,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=testCov_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(t1.key_hsn not in (select key_hsn from testCov_tmp2))<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59&nbsp&nbsp&nbsp&nbsp<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%minmax(data=testCov_tmp3, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvar=key_hsn, format=, target=testCov_tmp4, m=count)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata testCov_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptype=symget('type')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset testCov_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename Var_count=N&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata &target&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset &target testCov_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%delData(data=testCov_tmp1 testCov_tmp2 testCov_tmp3<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptestCov_tmp4 testCov_tmp5)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend testCov&#59<br/>%testCov( target=remoteT.R6_covtest)&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-7akhfpgFObKpWa2P","name":"IB_Mortality","NodeDescription":"///t<br/>///s<br/>/*IB, get mortality record from rsdc file<br/>the verfMortFile, and MortDateVar are determined in Program 'remote settings', according to the value of <br/>&nbsp&nbsp&nbsp&nbspthisProjectType from the xls input form<br/>*/<br/><br/>data _null_&#59run&#59<br/><br/>%put >>> &VerfMortFIle&#59<br/>%put >>>  &LastXtrcDate&#59<br/>%print(data=&VerfMortFIle)&#59<br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=&VerfMortFIle,<br/>&nbsp&nbsp&nbsp&nbspt2=remoteT.EA_cohort_final,<br/>&nbsp&nbsp&nbsp&nbsptarget=IB1,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.Key_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&MortDateVar),<br/>&nbsp&nbsp&nbsp&nbspjtype =inner,<br/>&nbsp&nbsp&nbsp&nbspjvars=key_hsn,<br/>&nbsp&nbsp&nbsp&nbspfilters=%str(t1.&MortDateVar ne .)<br/>)&#59<br/><br/>data remoteT.IB&#59<br/>&nbsp&nbsp&nbsp&nbspset IB1&#59<br/>&nbsp&nbsp&nbsp&nbsp rename &MortDateVar=MortDate&#59<br/>run&#59<br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-1F53xJJrBEJqHkyM","name":"IC_LostCov","NodeDescription":"///t<br/>///s<br/>/*IC, lost coverage after DQ<br/>*/<br/>data _null_&#59run&#59<br/><br/>%macro notrun&#59<br/>&nbsp&nbsp&nbsp&nbsp%getCoverGAPs(rawfile=remoteT.I_covAllYears, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspptFile=remoteT.EA_cohort_final, theCovXtrc=%str(&xtrc_end_cover), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstart=DQDate, end= %str(&DataEndDate), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=IC1, cohortgroup=, debug=)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%print(data=IC1)&#59<br/>&nbsp&nbsp&nbsp&nbspdata IC2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset IC1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep key_hsn dQdate start end coverStart coverEnd gaps&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp%sort(data = IC2, sorter=%str(key_hsn coverStart coverEnd))&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdata IC3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset IC2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif gaps > 7 &#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbspdata remoteT.IC&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset IC3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby key_hsn dQdate start end coverStart&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif first.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep key_hsn coverStart&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename coverStart = LostCoverDate&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/>%mend notrun&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp%Macro CoverageInFollowup&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%local FollowCovCondition CoverDef CoverDefValue&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let FollowCovCondition=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspincase in the following steps, nothing to be created for table remoteT.IC, let it be an empty set<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif the empty data set was not created, the old remoteT.IC from last run will be kept and causing wrong results*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata IC3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11. coverStart date9.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*determine the type of coverage definition*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Coverage since the first diagnosis'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('FollowCovCondition', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> FollowCovCondition is: &FollowCovCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if there is no Conditions, have all patients in remoteT.EA_cohort_final*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 1*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&FollowCovCondition) = 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let FollowCovCondition = FollowCovCondition not set, all patients retained&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> &FollowCovCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = by nothing&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue = nothing&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata IC3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11. LostCoverDate date9.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 1*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*else have only those continuously covered*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 2*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*Have the cover days, gaps, and PCT<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspHere, the coverage period is not &FollowCovCondition days since the DQDate. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspInstead, it is from dqDate to dataEndDate<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getCoverGAPs(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprawfile=remoteT.I_covAllYears, /*&PHRS_Covfile,*/ <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspptFile=remoteT.EA_cohort_final, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheCovXtrc=%str(&Xtrc_End_Cover), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstart=%str(dQdate ), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend= %str(&DataEndDate), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=IC1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcohortgroup=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*determine the type of continuous coverage definition*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the type of coverage definition*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Definition of loss of cover'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('CoverDef', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> The continuous coverage is defined: &CoverDef&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the value of coverage definition (e.g., min gap = 7 days, etc)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotes.A9_COHORTEXCLUSION&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif criteria = 'Threshold value for loss of cover'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall symput('CoverDefValue', Syntax)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> The continuous coverage threshold value is: &CoverDefValue&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the coverage status is defined by min gap*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 3*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDef) =0 or &CoverDef=by minimum gap in days %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDefValue is not specified, set the default min gap as 1 day*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 4*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&coverDef) = 0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef= CoverDef not defined, use default setting min gap =1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDefValue) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = &CoverDef CoverDefValue not set, use default (min gap = 1 days )&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> Coverage threshold value not defined. change CoverDefValue to &CoverDefValue&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 4*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*&nbsp&nbsp&nbsp&nbspget patients ever had a gap > &CoverDefValue days*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the records with Gap >  &CoverDefValue days*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(data=IC1, target=IC2a, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.key_hsn, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.dqdate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.start, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.end,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.coverStart, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.coverEnd<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(gaps > &CoverDefValue),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby = %str(dQdate, key_hsn, coverStart, coverEnd)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*From above, for each patient, keep the first record with Gap >  &CoverDefValue days */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata IC3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset IC2a&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby dQdate key_hsn start end coverStart&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif first.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep key_hsn coverStart&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename coverStart = LostCoverDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 3*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 5*/<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the coverage status is defined by coverage days*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 6*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &CoverDef = by cover days %then %do&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDefValue is not specified, set the default min cover days as &FollowCovCondition<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspe.g., if FollowCovCondition=365, let the min cover days =365*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 7*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDefValue) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=&FollowCovCondition&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = &CoverDef CoverDefValue not set, use default (same length as the FollowCovCondition)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 7*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*sum the cover days*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=IC1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=IC2b1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, dqDate, sum(days) as cumuCover, sum(coverPCT) as coverPCT),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroupby=%str(key_hsn, dqDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, dqDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the patients whose cumulative covering days < &CoverDefValue*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata IC2b2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset IC2b1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif cumuCover < &CoverDefValue &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if lost of coverage is defined by coverage days, which date should be treated as lost of coverage?<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphere, the first gap >1 day is considered the date lost coverage<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspit is the simpliest, but may have problem, need to further analyze*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*IC2b2 contains patients lost coverage, now get their coverage records in IC1*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%Sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=IC1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=IC2b2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=IC2b3, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.key_hsn, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.dqdate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.start, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.end,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.coverStart, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.coverEnd<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn dqdate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(gaps >0),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby = %str(dQdate, key_hsn, coverStart, coverEnd)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*From above, for each patient, keep the first record with Gap >  &CoverDefValue days */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata IC3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset IC2b3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby dQdate key_hsn start end coverStart&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif first.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep key_hsn coverStart&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename coverStart = LostCoverDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 6*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 8*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the coverage status is defined by cover-percentage*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 9*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &CoverDef = by cover percentage %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDefValue is not specified, set the default min PCT = 100<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspe.g., if FollowCovCondition=365, let the min cover days =365*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 10*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&CoverDefValue) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDefValue=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let CoverDef = &CoverDef CoverDefValue not set, use default (100%)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 10*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*sum the cover PCT*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=IC1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=IC2C1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, dqDate, sum(days) as cumuCover, sum(coverPCT) as coverPCT),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroupby=%str(key_hsn, dqDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, dqDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the patients whose cumulative covering days < &CoverDefValue*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata IC2C2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset IC2C1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif coverPCT < (&CoverDefValue*100) &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if lost of coverage is defined by coverage days, which date should be treated as lost of coverage?<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphere, the first gap >1 day is considered the date lost coverage<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspit is the simpliest, but may have problem, need to further analyze*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*IC2b2 contains patients lost coverage, now get their coverage records in IC1*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%Sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=IC1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=IC2C2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=IC2C3, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.key_hsn, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.dqdate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.start, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.end,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.coverStart, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.coverEnd<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn dqdate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(gaps >0),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby = %str(dQdate, key_hsn, coverStart, coverEnd)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*From above, for each patient, keep the first record with Gap >  &CoverDefValue days */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata IC3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset IC2C3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby dQdate key_hsn start end coverStart&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif first.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep key_hsn coverStart&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename coverStart = LostCoverDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 9*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*do-end 11*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the CoverDef is not by gap, coverdays, or cover PCT, it must be a wrong setting<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdo not exclude any patient*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let coverDef = None of the patient will be excluded. No such coverage setting - &coverDef&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty data set (no patients to exclude)*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata IC3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_hsn $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 11*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 8*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 5*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59/*do-end 2*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata remoteT.IC&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset IC3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>%mend CoverageInFollowup&#59<br/>%CoverageInFollowup&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-kyenvWsNUN9pBHaB","name":"ID_FollowUpStatus","NodeDescription":"///t<br/>///s<br/>/*ID, patient deceased or loss of coverage*/<br/>/*Get lost cover date*/<br/>data _null_&#59run&#59<br/><br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=remotet.EA_cohort_final,<br/>&nbsp&nbsp&nbsp&nbspt2=remotet.IC,<br/>&nbsp&nbsp&nbsp&nbsptarget=ID1,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, t2.LostCoverDate),<br/>&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbspjvars=key_hsn<br/>)&#59<br/>/*get decease date*/<br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=ID1,<br/>&nbsp&nbsp&nbsp&nbspt2=remotet.IB,<br/>&nbsp&nbsp&nbsp&nbsptarget=ID2,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, t2.MortDate),<br/>&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbspjvars=key_hsn<br/>)&#59<br/><br/>data remoteT.ID_cohort&#59<br/>&nbsp&nbsp&nbsp&nbspset ID2&#59<br/>&nbsp&nbsp&nbsp&nbsp/*if both lostcover/Mort date is missing, 'FollowEnd', FollowEndDate = DataEnd<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif only has lostcover, 'LostCover', FollowEndDate = LostCoverDate<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif only has Mort date, 'Deceased',FollowEndDate = MortDate<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIf has both:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif MortDate < = LostCover, 'Deceased', FollowEndDate=MortDate<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif LostCover < MortDate, 'LostCover', FollowEndDate = LostCoverDate&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbspif LostCoverDate =. and MortDate =. then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFollowStatus = 'FollowEnd'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFollowEndDate=&DataEndDate&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspElse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif LostCoverDate =. or MortDate =. then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif LostCoverDate =. then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFollowStatus = 'Deceased'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFollowEndDate=MortDate&#59&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFollowStatus = 'LostCover'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFollowEndDate=LostCoverDate&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif MortDate <= LostCoverDate then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFollowStatus = 'Deceased'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFollowEndDate=MortDate&#59&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFollowStatus = 'LostCover'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFollowEndDate=LostCoverDate&#59&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspformat FollowEndDate date9.&#59<br/>&nbsp&nbsp&nbsp&nbspFollowYears = Int((FollowEndDate-DQdate) / 365)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*as in this case, if the record is wrong (patient is reported deceased in verif mort file yet having claims in MSB ),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheFollowYears would be negative.<br/>&nbsp&nbsp&nbsp&nbspIn that case, let's make the follow years super large<br/>&nbsp&nbsp&nbsp&nbsp*/<br/>&nbsp&nbsp&nbsp&nbspif FollowYears <0 then FollowYears=FollowYears+1000&#59<br/>run&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-sn8jH8iiFqgnr9tW","name":"IE_FollowStatusReport","NodeDescription":"///t<br/>///s<br/>/*IE report the follow up status by type (FollowEnd, Lost, Death) and by length (years)*/<br/>data _null_&#59run&#59<br/><br/>%print(data=remoteT.ID_cohort)&#59<br/><br/>%freq(data=remoteT.ID_cohort, table = FollowYears * FollowStatus,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoption=%str(out = IE1))&#59<br/><br/>data IE2&#59<br/>&nbsp&nbsp&nbsp&nbspset IE1&#59<br/>&nbsp&nbsp&nbsp&nbspdrop percent&#59<br/>&nbsp&nbsp&nbsp&nbspfollowYearsC=  'years_' || compress(followYears, ' ')&#59<br/>run&#59<br/><br/>%transpose(data=IE2, target=RemoteT.R7_Follow, <br/>&nbsp&nbsp&nbsp&nbspRowHead=FollowStatus, <br/>&nbsp&nbsp&nbsp&nbspColHead=FollowYearsC, <br/>&nbsp&nbsp&nbsp&nbspContents=count, <br/>&nbsp&nbsp&nbsp&nbspkeepAllCol=)&#59<br/><br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-IQsHUlGFWl8uZktJ","name":"L_ToRExchange","NodeDescription":"///t<br/>///s<br/>/*L<br/>&nbsp&nbsp&nbsp&nbspcopy files to Remote exchange folder<br/>*/<br/><br/>data _null_&#59run&#59<br/><br/>data RExLib.r1_flow&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.r1_flow&#59<br/>run&#59<br/>data RExLib.r2_dxsrc&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.r2_dxsrc&#59<br/>run&#59<br/>data RExLib.r3_dxposition&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.r3_dxposition&#59<br/>run&#59<br/>data RExLib.r4_dxcode&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.r4_dxcode&#59<br/>run&#59<br/>data RExLib.r5a_means&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.r5a_means&#59<br/>run&#59<br/>data RExLib.r5b_ageg&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.r5b_ageg&#59<br/>run&#59<br/>data RExLib.r5c_sex&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.r5c_sex&#59<br/>run&#59<br/>data RExLib.r5d_urb&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.r5d_urb&#59<br/>run&#59<br/>data RExLib.r5e_inc&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.r5e_inc&#59<br/>run&#59<br/>data RExLib.R6_COVTEST&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.R6_COVTEST&#59<br/>run&#59<br/><br/>data RExLib.R7_FOLLOW&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.R7_FOLLOW&#59<br/>run&#59<br/><br/>/*the following is only for dementia cohort*/<br/>/*data RExLib.R8_298&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspset remoteT.R8_298&#59*/<br/>/*run&#59*/<br/>/**/<br/>/*data RExLib.R9_FOLLOW_NO298&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspset remoteT.R9_FOLLOW_NO298&#59*/<br/>/*run&#59*/<br/><br/><br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"EGTask-15Q6EA1yHVxaKM94","name":"M1 Copy files from SAS server","children":[{"idx":"CodeTask-uu7FNkVc8L58LSwR","name":"M _delete REx Files","NodeDescription":"///t<br/>///s<br/>/*M delete all files in the remote folder<br/>*/<br/><br/>proc delete data=rexlib._all_&#59<br/>run&#59 <br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-zvvbqcEgpuE6QgWN","name":"N_Local_copy files to target folder","NodeDescription":"///t<br/>///s<br/>/*N<br/>&nbsp&nbsp&nbsp&nbspcopy files to local target folder<br/>*/<br/>data _null_&#59run&#59<br/><br/>data localT.r1_flow&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.r1_flow&#59<br/>run&#59<br/>data localT.r2_dxsrc&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.r2_dxsrc&#59<br/>run&#59<br/>data localT.r3_dxposition&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.r3_dxposition&#59<br/>run&#59<br/>data localT.r4_dxcode&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.r4_dxcode&#59<br/>run&#59<br/>data localT.r5a_means&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.r5a_means&#59<br/>run&#59<br/>data localT.r5b_ageg&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.r5b_ageg&#59<br/>run&#59<br/>data localT.r5c_sex&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.r5c_sex&#59<br/>run&#59<br/>data localT.r5d_urb&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.r5d_urb&#59<br/>run&#59<br/><br/>data localT.r5e_inc&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.r5e_inc&#59<br/>run&#59<br/><br/>data localT.r6_covtest&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.r6_covtest&#59<br/>run&#59<br/><br/><br/>data localT.R7_FOLLOW&#59<br/>&nbsp&nbsp&nbsp&nbspset translib.R7_FOLLOW&#59<br/>run&#59<br/><br/>/*For dementia project only*/<br/>/*data localT.R8_298&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspset translib.R8_298&#59*/<br/>/*run&#59*/<br/>/**/<br/>/**/<br/>/*data localT.R9_FOLLOW_NO298&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspset translib.R9_FOLLOW_NO298&#59*/<br/>/*run&#59*/<br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-relxLYgo8OlVVhJS","name":"NB_delLocalExchange","NodeDescription":"///t<br/>///s<br/>/*NB<br/>&nbsp&nbsp&nbsp&nbspdelete all files in the local exchange folder<br/>*/<br/><br/>Proc delete data=translib._all_&#59<br/>run&#59<br/>s///<br/>t///","children":[{"idx":"CodeTask-ZCfAl5dlvcIorNC2","name":"P_export to xls","NodeDescription":"///t<br/>///s<br/>/*p_Report to xls*/<br/>data _null_&#59run&#59<br/><br/><br/>%put >>> &AnalyticalReport&#59<br/><br/><br/>data P1&#59<br/>&nbsp&nbsp&nbsp&nbspformat reportTime datetime20.&#59<br/>&nbsp&nbsp&nbsp&nbspReportTime=DateTime()&#59<br/>run&#59<br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=p1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>data p2&#59<br/>&nbsp&nbsp&nbsp&nbspformat name $100.&#59<br/>&nbsp&nbsp&nbsp&nbspname =&_clientProjectname&#59<br/>&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbspname=&_clientTaskLabel&#59<br/>&nbsp&nbsp&nbsp&nbspoutput&#59<br/>run&#59<br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=p2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=3, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.R1_Flow,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=6, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r2_dxsrc,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=17, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r3_DxPosition,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=25, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r4_DxCode,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=32, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r5a_means,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=1239, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r5b_ageg,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=1243, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r5c_sex,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=1259, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r5d_urb,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=1264, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r5e_inc,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=1268, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r6_covtest,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=1276, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r7_follow,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=1298, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>/*For dementia project only*/<br/>/*%SASToXlsRange(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&AnalyticalReport, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localT.r8_298,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=Import Data, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=300, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=2,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59*/<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-tyupk9qkvIjdVjPX","name":"Q Get Data","NodeDescription":"///t<br/>///s<br/>/*get cohort data, it is similar to program C, getCohortData*/<br/>data _null_&#59run&#59<br/><br/>/*%print(data=remoteS.A2_CohortDataVars)&#59*/<br/>/**/<br/><br/>/*Note!!!<br/>&nbsp&nbsp&nbsp&nbspIf a new source file is added (e.g., the home care or long term care file), <br/>&nbsp&nbsp&nbsp&nbspa new macro like getCohortData_&theSourceFile must be created. <br/>&nbsp&nbsp&nbsp&nbspsuch macro is to get data from the specific source. <br/>*/<br/><br/>%global theDataVars&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*delete all existing Q_file zips (cohort data from each sources) in the remoteT folder<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsuch to delete old files<br/>&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbspdata _null_&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcommand2 =trim(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp\"rm -f \" ||trim(symget('remotetargetpath')) || \"/master_*.zip\"<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcommand1 = 'rm -f /sasdata/hisc/shared_data/HQC_share/Shenzhen/Projects/NewCohortCreating/Target/master_*.zip'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif command1 = command2 then check =1&#59 else check =0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcall system(command2)&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>/*select unique patient ids from the final cohort*/<br/>%distinct(source=remoteT.EA_Cohort_Final, target=Q1, vars=%str(key_hsn))&#59<br/><br/><br/>/*make a master_cohort file*/<br/>data master_cohort&#59<br/>&nbsp&nbsp&nbsp&nbspset remoteT.EA_Cohort_Final&#59<br/>run&#59<br/><br/>%UnixZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbspdata=Master_cohort, <br/>&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsptarget=Master_cohort.zip, <br/>&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbspdata=Master_cohort,*/<br/>/*&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/><br/>/*get drug claims not covered by drug plan benefits*/<br/>%macro getCohortData_DP_Benefit&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%Extract_Drug(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt=&Xtrc_Start_DP_Ben, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt=&Xtrc_End_DP_Ben, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspexcl_xtrc_dt=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out=getCohortData_DP_Benefit_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspalldin_file=&alldinfile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file=Q1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_file= ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_list=,                    <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstrt_dt=&DataStartDate ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend_dt=&DataEndDate  <br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*apply the additional request conditions*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_DP_Benefit_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_DP_Benefit_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop sgt_id&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data contains the var key_prscr_num, indicate key_prscr_num values that are sluch codes*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %index(%sysfunc(lowcase(&theDataVars)), key_prscr_num) >0 and %length(&theDataVars)>0 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a list of doc slush codes according to the txt files in the Clean folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getDocSlushCodes(target=getCohortData_DP_Benefit_tmp3, debug=)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_DP_Benefit_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_DP_Benefit_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_dp_benefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, ifc(t2.DocSlushCode ='', 'N', t2.DocSlushCode) as DocSlushCode),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjterm=%str(t1.key_prscr_num=t2.key_doc_num)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data does not contain the varkey_doc_num, let all DocSlushCode values be 'N'*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata Master_dp_benefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_DP_Benefit_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDocSlushCode=\"N\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_dp_benefit, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_dp_benefit.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_dp_benefit,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%deldata(data=_drgtmp _fileout _allDIn getCohortData_DP_Benefit_tmp1)&#59<br/><br/>%mend getCohortData_DP_Benefit&#59<br/>/*%getCohortData_DP_Benefit&#59*/<br/>/*************************************/&nbsp&nbsp&nbsp&nbsp<br/><br/>/*get drug claims not covered by drug plan benefits*/<br/>%macro getCohortData_DP_NonBenefit&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%Extract_Drug_non_ben_test(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt=&Xtrc_Start_DP_NBen, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt=&Xtrc_End_DP_NBen, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspexcl_xtrc_dt=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out=getCohortData_DP_NB_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspalldin_file=&alldinfile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file=Q1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_file= ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_list=,                    <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstrt_dt=&DataStartDate ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend_dt=&DataEndDate  <br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*apply the additional request conditions*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_DP_NB_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_DP_NB_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop sgt_id&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data contains the var key_prscr_num, indicate key_prscr_num values that are sluch codes*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %index(%sysfunc(lowcase(&theDataVars)), key_prscr_num) >0 and %length(&theDataVars)>0 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a list of doc slush codes according to the txt files in the Clean folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getDocSlushCodes(target=getCohortData_DP_NB_tmp3, debug=)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_DP_NB_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_DP_NB_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_dp_nonbenefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, ifc(t2.DocSlushCode ='', 'N', t2.DocSlushCode) as DocSlushCode),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjterm=%str(t1.key_prscr_num=t2.key_doc_num)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data does not contain the varkey_doc_num, let all DocSlushCode values be 'N'*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata Master_dp_nonbenefit&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_DP_NB_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDocSlushCode=\"N\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_dp_nonbenefit, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_dp_nonbenefit.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_dp_nonbenefit,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%deldata(data=_drgtmp _fileout _allDIn getCohortData_DP_NB_tmp1)&#59<br/><br/>%mend getCohortData_DP_NonBenefit&#59<br/>/*%getCohortData_DP_NonBenefit&#59*/<br/>/*************************************/&nbsp&nbsp&nbsp&nbsp<br/>/*get drug specifications*/<br/>%macro getCohortData_DP_Spec&#59<br/><br/>/*&nbsp&nbsp&nbsp&nbspget DINs from both benefit and nonbenefit drug claim files*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%if %sysfunc(fileexist(&remoteTargetPath./master_dp_benefit.zip)) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=&remoteTargetPath,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzip=master_dp_benefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipped=master_dp_benefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=master_dp_benefit<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(source=master_dp_benefit, target=getCohortData_DP_Spec_tmp1, vars=din)<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty, dummy DIN file*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_DP_Spec_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat DIN $8.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%if %sysfunc(fileexist(&remoteTargetPath./master_dp_nonbenefit.zip)) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=&remoteTargetPath,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzip=master_dp_nonbenefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipped=master_dp_nonbenefit,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=master_dp_nonbenefit<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(source=master_dp_nonbenefit, target=getCohortData_DP_Spec_tmp2, vars=din)<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty, dummy DIN file*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_DP_Spec_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat DIN $8.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*prepare a unique din list*/<br/>&nbsp&nbsp&nbsp&nbspproc sql&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcreate table getCohortData_DP_Spec_tmp3 as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect distinct <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin from<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(select distinct DIN from getCohortData_DP_Spec_tmp1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspunion  <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect distinct DIN from getCohortData_DP_Spec_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspwhere din ne ''&#59<br/>&nbsp&nbsp&nbsp&nbspquit&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=&dp_specFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_DP_Spec_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_DP_Spec_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=din, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(datepart(xtrc_date) <=&lastXtrcDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby = %str(din, xtrc_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdata Master_dp_spec&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_DP_Spec_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby DIN xtrc_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop sgt_id&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif last.DIN&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>/*&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_dp_spec,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/>&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_dp_spec, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_dp_spec.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_DP_Spec_tmp1 getCohortData_DP_Spec_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetCohortData_DP_Spec_tmp3 getCohortData_DP_Spec_tmp4 )&#59<br/><br/>%mend getCohortData_DP_Spec&#59<br/>/*%getCohortData_DP_Spec&#59*/<br/>/*************************************/&nbsp&nbsp&nbsp&nbsp<br/><br/><br/>/*get ED data (after 2012)*/<br/>%macro getCohortData_ED_A2012&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%getED_A2012(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=&ed_a2012file,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_ED_A2012_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdistinctRecord=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatientList=Q1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcondition = %str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(DatePart(reg_date) >= &DataStartDate and DatePart(reg_date) <= &DataEndDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor (DatePart(disp_date) >= &DataStartDate and DatePart(disp_date) <= &DataEndDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor (DatePart(reg_date) < &DataStartDate and DatePart(disp_date) > &DataEndDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_ED_A2012_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_ED_A2012_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif datepart(xtrc_date) <= &lastXtrcDate&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_ED_A2012_tmp2, target = Master_ED_A2012, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>/*&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_ED_A2012,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/>&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_ED_A2012, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_ED_A2012.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_ED_A2012_tmp1 getCohortData_ED_A2012_tmp2)&#59<br/><br/>%mend getCohortData_ED_A2012&#59<br/>/*%getCohortData_ED_A2012&#59*/<br/>/*************************************/&nbsp&nbsp&nbsp&nbsp<br/><br/><br/>/*Get hospital record, with record N, adm/dschg date,<br/>&nbsp&nbsp&nbsp&nbsptype of dx (dx, cdx, intvn, cintvn), position of dx (main, others)*/<br/>%macro getCohortData_hosp&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%local LogicCondition&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%Extract_CIHI( <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_in =&hospitalFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out=getCohortData_hosp_tmp1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadms_start_date=&DataStartDate,      <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadms_end_date=&DataEndDate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspICD9_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspICD10_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCP_List=,<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCP_Exact_list=,*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCI_list=,<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCI_Exact_list=,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode_logic=,*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file= Q1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp )&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp /*apply the additional request conditions, force to have the facility num*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata Master_hosp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_hosp_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_hosp, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_hosp.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_hosp,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%delData(data=getCohortData_hosp_tmp1)&#59<br/><br/>%mend getCohortData_hosp&#59<br/>/*%getCohortData_hosp&#59*/<br/>/**********************************************************/<br/><br/>/*macro to get data from MSB*/<br/>%macro getCohortData_MSB&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*the problem is that when both diag code and FSC code are specified<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe following macro returns only records of diagcode AND FSC<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIt seems that, unlike the Extract_CIHI macro, there is no option to <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspchange the logic to OR<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTherefore in the following step, FSCcode is never specified, such that <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall records will be extracted, regardless of FSC code. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp &nbsp&nbsp&nbsp&nbspScreening of FSC code will be done in later steps<br/>&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%Extract_MSB(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt=&Xtrc_Start_MSB,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt=&Xtrc_End_MSB, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out= getCohortData_MSB_tmp1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file= Q1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdiagcode=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdostart=&DataStartDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdosend=&DataEndDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfscode=<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*apply the additional request conditions*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_MSB_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_MSB_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdos = dos_1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat dos date9.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_MSB_tmp2, target = getCohortData_MSB_tmp3, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data contains the var key_doc_num, indicate key_doc_num values which are sluch codes*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %index(%sysfunc(lowcase(&theDataVars)), key_doc_num) >0 and %length(&theDataVars)>0 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a list of doc slush codes according to the txt files in the Clean folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getDocSlushCodes(target=getCohortData_MSB_tmp4, debug=1)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_MSB_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_MSB_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_MSB,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, ifc(t2.DocSlushCode ='', 'N', t2.DocSlushCode) as DocSlushCode),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_doc_num<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data does not contain the varkey_doc_num, change the temp file's name to Master_MSB*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata Master_MSB&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_MSB_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDocSlushCode=\"N\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_MSB,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_MSB, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_MSB.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete getCohortData_MSB_tmp:&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>%mend getCohortData_MSB&#59<br/>/*%getCohortData_MSB&#59*/<br/>/*************************************/<br/><br/>/*macro to get data from MDS_LTC*/<br/>%macro getCohortData_MDS_LTC&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*the problem is that when both diagcode and FSC code are specified<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe following macro returns only records of diagcode AND FSC<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIt seems that, unlike the Extract_CIHI macro, there is no option to <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspchange the logic to OR<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTherefore in the following step, FSCcode is never specified, such that <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall records will be extracted, regardless of FSC code. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp &nbsp&nbsp&nbsp&nbspScreening of FSC code will be done in later steps<br/>&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%get_MDS_LTC(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=&MDS_LTC_File,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_MDS_LTC_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=&theDataVars,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc=&xtrc_MDS_LTC,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstartDate =&dataStartDate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspendDate = &dataEndDate<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_MDS_LTC_tmp1, target = Master_MDS_LTC, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_MDS_LTC, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_MDS_LTC.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_MDS_LTC,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_MDS_LTC_tmp1)&#59<br/><br/>%mend getCohortData_MDS_LTC&#59<br/>/*%getCohortData_MDS_LTC&#59*/<br/>/*************************************/<br/><br/><br/>%macro getCohortData_PHRS_COV&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=&PHRS_CovFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=Q1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_PHRS_COV_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(datepart(xtrc_date) = &xtrc_End_Cover),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, xtrc_date, eff_date, exp_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_PHRS_COV_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_PHRS_COV_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif eff_date =. then eff_date = report_start&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif exp_date =. then exp_date = report_end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_PHRS_COV_tmp2, target = Master_PHRS_Cov, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_Cov, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_PHRS_Cov.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_Cov,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_PHRS_COV_tmp1 getCohortData_PHRS_COV_tmp2)&#59<br/>%mend getCohortData_PHRS_COV&#59<br/>/*%getCohortData_PHRS_COV&#59*/<br/>/*************************************/<br/><br/><br/>/*get personal info of the cohort patients*/<br/>%macro getCohortData_PHRS_INFO&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=&PHRS_InfoFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=Q1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_PHRS_INFO_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(datepart(xtrc_date) <= &xtrc_End_Cover),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, xtrc_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*for each person, get distinct combination of id-xtrcDate*/<br/>&nbsp&nbsp&nbsp&nbsp%distinct(data = getCohortData_PHRS_INFO_tmp1, target=getCohortData_PHRS_INFO_tmp2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, xtrc_date), orderby=%str(key_hsn, xtrc_date))&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/* For each patient, get the latest xtrc_date*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_PHRS_INFO_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_PHRS_INFO_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby key_hsn xtrc_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif last.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*from tmp1, select records of the last xtrc_date*/<br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_PHRS_INFO_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_PHRS_INFO_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_PHRS_INFO_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn xtrc_date<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*deal with missing eff/exp_date, keep requested vars*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_PHRS_INFO_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_PHRS_INFO_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_PHRS_INFO_tmp5, target = Master_PHRS_Info, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_Info, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_PHRS_Info.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_Info,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_PHRS_INFO_tmp1 getCohortData_PHRS_INFO_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetCohortData_PHRS_INFO_tmp3 getCohortData_PHRS_INFO_tmp4 getCohortData_PHRS_INFO_tmp5)&#59<br/>%mend getCohortData_PHRS_INFO&#59<br/>/*%getCohortData_PHRS_INFO&#59*/<br/>/*************************************/<br/><br/>/*get resi info of the cohort patients from the raw file under the path HQC*/<br/>%macro getCohortData_PHRS_RESI&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=&PHRS_ResiFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=Q1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_PHRS_RESI_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(datepart(xtrc_date) <= &lastXtrcDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, xtrc_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*for each person, get distinct combination of id-xtrcDate*/<br/>&nbsp&nbsp&nbsp&nbsp%distinct(data = getCohortData_PHRS_RESI_tmp1, target=getCohortData_PHRS_RESI_tmp2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, xtrc_date), orderby=%str(key_hsn, xtrc_date))&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/* For each patient, get the latest xtrc_date*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_PHRS_RESI_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_PHRS_RESI_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby key_hsn xtrc_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif last.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*from tmp1, select records of the last xtrc_date*/<br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_PHRS_RESI_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_PHRS_RESI_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_PHRS_RESI_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn xtrc_date,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby = %str(key_hsn, xtrc_date, eff_date, exp_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*deal with missing eff/exp_date, keep requested vars*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_PHRS_RESI_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_PHRS_RESI_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif eff_date =. then eff_date = report_start&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif exp_date =. then exp_date = report_end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_PHRS_RESI_tmp5, target = Master_PHRS_Resi, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_Resi, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_PHRS_Resi.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_Resi,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_PHRS_RESI_tmp1 getCohortData_PHRS_RESI_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetCohortData_PHRS_RESI_tmp3 getCohortData_PHRS_RESI_tmp4 getCohortData_PHRS_RESI_tmp5)&#59<br/>%mend getCohortData_PHRS_RESI&#59<br/>/*%getCohortData_PHRS_RESI&#59*/<br/>/*************************************/<br/><br/>/*get resi info of the cohort patients from the clean file under the path cleanYY*/<br/>%macro getCohortData_PHRS_RESI_CLEAN&#59<br/>/*in clean file, all dates are in date9 format*/<br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=&PHRS_Resi_cleanFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=Q1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_PHRS_RESI_Ctmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(xtrc_date <= &lastXtrcDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, xtrc_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*for each person, get distinct combination of id-xtrcDate*/<br/>&nbsp&nbsp&nbsp&nbsp%distinct(data = getCohortData_PHRS_RESI_Ctmp1, target=getCohortData_PHRS_RESI_Ctmp2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, xtrc_date), orderby=%str(key_hsn, xtrc_date))&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/* For each patient, get the latest xtrc_date*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_PHRS_RESI_Ctmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_PHRS_RESI_Ctmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby key_hsn xtrc_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif last.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*from tmp1, select records of the last xtrc_date*/<br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_PHRS_RESI_Ctmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_PHRS_RESI_Ctmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_PHRS_RESI_Ctmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn xtrc_date,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby = %str(key_hsn, xtrc_date, eff_date, exp_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*deal with missing eff/exp_date, keep requested vars*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_PHRS_RESI_Ctmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_PHRS_RESI_Ctmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif eff_date =. then eff_date = report_start&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif exp_date =. then exp_date = report_end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_PHRS_RESI_Ctmp5, target = Master_PHRS_Resi_Clean, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_Resi_Clean, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_PHRS_Resi_Clean.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_Resi_Clean,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_PHRS_RESI_Ctmp1 getCohortData_PHRS_RESI_Ctmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetCohortData_PHRS_RESI_Ctmp3 getCohortData_PHRS_RESI_Ctmp4 getCohortData_PHRS_RESI_Ctmp5)&#59<br/>%mend getCohortData_PHRS_RESI_CLEAN&#59<br/>/*%getCohortData_PHRS_RESI_CLEAN&#59*/<br/>/*************************************/<br/><br/><br/>/*get RSDC info of the cohort patients*/<br/>%macro getCohortData_PHRS_RSDC&#59<br/>/*in clean file, all dates are in date9 format*/<br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=&PHRS_RSDCFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=Q1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_PHRS_RSDC_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(xtrc_date <= &lastXtrcDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(key_hsn, xtrc_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*for each person, get distinct combination of id-xtrcDate*/<br/>&nbsp&nbsp&nbsp&nbsp%distinct(data = getCohortData_PHRS_RSDC_tmp1, target=getCohortData_PHRS_RSDC_tmp2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_hsn, xtrc_date), orderby=%str(key_hsn, xtrc_date))&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/* For each patient, get the latest xtrc_date*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_PHRS_RSDC_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_PHRS_RSDC_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby key_hsn xtrc_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif last.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*from tmp1, select records of the last xtrc_date*/<br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_PHRS_RSDC_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_PHRS_RSDC_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_PHRS_RSDC_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn xtrc_date,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby = %str(key_hsn, xtrc_date, eff_date, exp_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*deal with missing eff/exp_date, keep requested vars*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_PHRS_RSDC_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_PHRS_RSDC_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif eff_date =. then eff_date = report_start&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif exp_date =. then exp_date = report_end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_PHRS_RSDC_tmp5, target = Master_PHRS_RSDC, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_RSDC, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_PHRS_RSDC.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_RSDC,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_PHRS_RSDC_tmp1 getCohortData_PHRS_RSDC_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetCohortData_PHRS_RSDC_tmp3 getCohortData_PHRS_RSDC_tmp4 getCohortData_PHRS_RSDC_tmp5)&#59<br/>%mend getCohortData_PHRS_RSDC&#59<br/>/*%getCohortData_PHRS_RSDC&#59*/<br/>/*************************************/<br/><br/><br/>/*get verified mortality info of the cohort patients*/<br/>%macro getCohortData_verif_mort&#59<br/>/*in clean file, all dates are in date9 format*/<br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=&VerfMortFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=Q1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_mort_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=key_hsn<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*keep requested vars*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_mort_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_mort_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif ddt_novit ne .&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_mort_tmp2, target = Master_verif_mort, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_verif_mort, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_verif_mort.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_verif_mort,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_mort_tmp1 getCohortData_mort_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetCohortData_mort_tmp3 getCohortData_mort_tmp4 getCohortData_mort_tmp5)&#59<br/>%mend getCohortData_verif_mort&#59<br/>/*%getCohortData_verif_mort&#59*/<br/>/*************************************/<br/>/*get MSB Doc info*/<br/>%macro getCohortData_MSB_DOCINFO&#59<br/><br/>/*&nbsp&nbsp&nbsp&nbspget doc ID from MSB billing file*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%if %sysfunc(fileexist(&remoteTargetPath./master_msb.zip)) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=&remoteTargetPath,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzip=master_MSB,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipped=master_MSB,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=master_MSB<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(source=master_MSB, target=getCohortData_MSB_DOCINFO_tmp1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=key_doc_num, filters=%str(key_doc_num ne ''))<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty, dummy DIN file*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_MSB_DOCINFO_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat key_doc_num $11.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp/*get Doc Info*/<br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=&MSB_DocInfoFile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_MSB_DOCINFO_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_MSB_DOCINFO_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_doc_num, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(datepart(xtrc_date) <=&lastXtrcDate),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby = %str(key_doc_num, xtrc_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp/*have a unique list of doc- xtrcDate*/<br/>&nbsp&nbsp&nbsp&nbsp%distinct(data=getCohortData_MSB_DOCINFO_tmp2, target =getCohortData_MSB_DOCINFO_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(key_doc_num, xtrc_date),orderby = %str(key_doc_num, xtrc_date) )<br/><br/>&nbsp&nbsp&nbsp&nbsp/*for each doc, keep the latest xtrc_date*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_MSB_DOCINFO_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_MSB_DOCINFO_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby key_doc_num xtrc_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif last.key_doc_num&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp/*from tmp2, keep records of doc and xtrc_date in tmp4 (records of the most recent data cut)*/<br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_MSB_DOCINFO_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_MSB_DOCINFO_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_MSB_DOCINFO_tmp5,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_doc_num xtrc_date, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby = %str(key_doc_num, xtrc_date)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*keep requested fields*/<br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_MSB_DOCINFO_tmp6&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_MSB_DOCINFO_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby key_doc_num xtrc_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars report_start report_end&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_MSB_DOCINFO_tmp6, target = Master_MSB_DocInfo, debug=)&#59 <br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_MSB_DocInfo, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_MSB_DocInfo.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_MSB_DocInfo,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_MSB_DOCINFO_tmp1 getCohortData_MSB_DOCINFO_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetCohortData_MSB_DOCINFO_tmp3 getCohortData_MSB_DOCINFO_tmp4 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetCohortData_MSB_DOCINFO_tmp5 getCohortData_MSB_DOCINFO_tmp6)&#59<br/><br/>%mend getCohortData_MSB_DOCINFO&#59<br/>/*%getCohortData_MSB_DOCINFO&#59*/<br/>/*************************************/&nbsp&nbsp&nbsp&nbsp<br/><br/>/*get hospital info*/<br/>%macro getCohortData_hosp_info&#59<br/><br/>/*&nbsp&nbsp&nbsp&nbspget facility number from both hospital and emergency files*/<br/>&nbsp&nbsp&nbsp&nbsp%if %sysfunc(fileexist(&remoteTargetPath./master_hosp.zip)) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=&remoteTargetPath,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzip=master_hosp,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipped=master_hosp,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=master_hosp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*in hospital file, the inst_num is character type, length of 4 (lik 8???) select from the second position, for a length of 3*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(source=master_hosp, target=getCohortData_hosp_info_tmp1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(substr(inst_num, 2, 3)) as hosp_num, filters=%str(inst_num ne ''))&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty, dummy DIN file*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_hosp_info_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat hosp_num $8.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%if %sysfunc(fileexist(&remoteTargetPath./master_ed_a2012.zip)) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=&remoteTargetPath,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzip=master_ed_a2012,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipped=master_ed_a2012,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=master_ed_a2012<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*in ED file, the inst_num is character type, length of 5 (lik 71???) select from the 3rd position, for a length of 3*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(source=master_ed_a2012, target=getCohortData_hosp_info_tmp2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(substr(inst_num, 3, 3)) as hosp_num, filters=%str(inst_num ne ''))&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*create an empty, dummy DIN file*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_hosp_info_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat hosp_num $8.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*prepare a unique din list*/<br/>&nbsp&nbsp&nbsp&nbspproc sql&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcreate table getCohortData_hosp_info_tmp3 as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect distinct <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphosp_num from<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(select distinct hosp_num from getCohortData_hosp_info_tmp1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspunion  <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect distinct hosp_num from getCohortData_hosp_info_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspwhere hosp_num ne ''&#59<br/>&nbsp&nbsp&nbsp&nbspquit&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=remoteS.A10_HOSPINFO,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_hosp_info_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_hosp_info_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=hosp_num, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby = %str(hosp_num)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_hosp_info_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_hosp_info_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars &#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_hosp_info_tmp5, target = Master_HOSP_INFO, debug=)&#59 <br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_HOSP_INFO, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_HOSP_INFO.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_HOSP_INFO,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=getCohortData_hosp_info_tmp1 getCohortData_hosp_info_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgetCohortData_hosp_info_tmp3 getCohortData_hosp_info_tmp4 getCohortData_hosp_info_tmp5)&#59<br/><br/>%mend getCohortData_hosp_info&#59<br/>/*%getCohortData_hosp_info&#59*/<br/>/*************************************/&nbsp&nbsp&nbsp&nbsp<br/><br/>/*********************************************************************************************/<br/>/*the master macro to call each sub macro and get data from each source*/<br/>%macro NewPop_getCohortData (DataVarList=)&#59<br/>&nbsp&nbsp&nbsp&nbsp%local DataVarList theSources theFileSource i dlmt&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*let dlmt=space*/<br/>&nbsp&nbsp&nbsp&nbsp%let dlmt=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*get a list of source names*/<br/>&nbsp&nbsp&nbsp&nbsp%distinct(data=&DataVarList, target=NewPop_getCohortData_tmp1, vars=file_nick_name)&#59<br/>&nbsp&nbsp&nbsp&nbsp%ValueToString(Data=NewPop_getCohortData_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheVar=file_nick_name, theStrVarName=, DLMT=&dlmt)&#59<br/>&nbsp&nbsp&nbsp&nbsp%let theSources=&theStrVar_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%put >>> the sources are &theSources&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*loop by each source to get data*/<br/>&nbsp&nbsp&nbsp&nbsp%let i=1&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*loop unitl %scan has a null value, i.e., a null value after the last element*/<br/>&nbsp&nbsp&nbsp&nbsp%do %until (<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%length(%scan(%quote(&theSources), &i &dlmt)) =0<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the current file source*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> i = &i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theFileSource=%scan(%quote(&theSources), &i &dlmt)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> theFileSource= &theFileSource&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the variables to be extracted from the source data*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(data = &DataVarList, target=NewPop_getCohortData_tmp2, vars=%str(varname_in_raw_file),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(file_nick_name = symget('theFileSource')))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%ValueToString(Data=NewPop_getCohortData_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheVar=varname_in_raw_file, theStrVarName=, DLMT=&dlmt)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theDataVars=&theStrVar_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> theDataVars=&theDataVars&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the current source is &theSources, theDataVars are &theDataVars&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*run the specific data-getting macro for each file source*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> run macro getCohortData_&theFileSource&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getCohortData_&theFileSource&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let i = %eval(&i+1)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%delData(data=NewPop_getCohortData_tmp1 NewPop_getCohortData_tmp2)&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>%mend NewPop_getCohortData&#59<br/>%NewPop_getCohortData(DataVarList =  remoteS.A2_CohortDataVARS)&#59<br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-zUCuLGc5Xv9jVBhJ","name":"R_Data SUm","NodeDescription":"///t<br/>///s<br/>/*Data Report<br/>&nbsp&nbsp&nbsp&nbsp1. List of data files<br/>&nbsp&nbsp&nbsp&nbsp2. List of variables per file<br/>*/<br/>/*the dic is prepared, however, the filenames cannot be entirely matched<br/>&nbsp&nbsp&nbsp&nbspe.g., <br/>&nbsp&nbsp&nbsp&nbspin remoteS.A11_DataVarDic:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspphrs_,  BORN_YEAR<br/>&nbsp&nbsp&nbsp&nbspin datasum_2:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspphrs_info, BORN_YEAR<br/>*/<br/><br/>/*Make a Decartes join, and keep those:<br/>&nbsp&nbsp&nbsp&nbspof same var names<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspof same filename or same start of filename<br/>&nbsp&nbsp&nbsp&nbspthe following is to link the descriptions to the requested variables<br/>*/<br/>data _null_&#59run&#59<br/><br/>%macro NewCohort_GetVarDesc&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=remoteT.datasum_2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=remoteS.A11_DataVarDic,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=NewCohort_GetVarDesc_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdistinction=1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.filename, t1.variable, t2.description, t2.notes, t2.metadoc),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype = cross,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(t1.variable = t2.variable<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand (<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.filename = t2.filename<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsubstr(t1.filename, 1, length(t2.filename))=t2.filename<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(filename, variable)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*Link the desc info to the variables in datasum_2*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=remoteT.datasum_2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=NewCohort_GetVarDesc_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=remoteT.datasum_3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.filename, t1.variable, t2.description, t2.notes, t2.metadoc, ifc(t2.filename='', 'N', 'Y') as Matched),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=left, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars= filename variable<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata remoteT.datasum_3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remoteT.datasum_3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdescription=tranwrd(description, byte(10), '')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnotes=tranwrd(notes, byte(10), '')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmetadoc=tranwrd(metadoc, byte(10), '')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%delData(data=NewCohort_GetVarDesc_tmp1)&#59<br/><br/>%mend NewCohort_GetVarDesc&#59<br/><br/><br/><br/>%macro NewCohort_DataSum (DataVarList=)&#59<br/>&nbsp&nbsp&nbsp&nbsp%local DataVarList theSources theFileSource i dlmt nrows personCol theDataVars&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*let dlmt=space*/<br/>&nbsp&nbsp&nbsp&nbsp%let dlmt=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*get a list of source names*/<br/>&nbsp&nbsp&nbsp&nbsp%distinct(data=&DataVarList, target=NewCohort_DataSum_tmp1, vars=file_nick_name)&#59<br/>&nbsp&nbsp&nbsp&nbsp%ValueToString(Data=NewCohort_DataSum_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheVar=file_nick_name, theStrVarName=, DLMT=&dlmt)&#59<br/>&nbsp&nbsp&nbsp&nbsp%let theSources=&theStrVar_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%put >>> the sources are &theSources&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*create an empty file-summary table*/<br/>&nbsp&nbsp&nbsp&nbspdata remotet.dataSum_1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat location $200. filename $100. nobs 8. createTime datetime20. projectName $100. programName $100.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*create an emtpy missing value report table*/<br/>&nbsp&nbsp&nbsp&nbspdata NewCohort_DataSum_tmp0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilename $50. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvariable $50.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs_total 8.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspn_persons_total 8.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs_Missing 8.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspn_persons_Missing 8.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPCT_OBS_Missing&nbsp&nbsp&nbsp&nbspPERCENT10.1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspspecialValue $30.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspobs_SpecV 8.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspn_persons_SpecV 8.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPCT_OBS_SpecV PERCENT10.1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCreateTime&nbsp&nbsp&nbsp&nbspDATETIME20.&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProjectName&nbsp&nbsp&nbsp&nbsp$50.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProgramName $50.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*prepare a list of requested vars of all requested files*/<br/>&nbsp&nbsp&nbsp&nbsp%distinct(source= &dataVarList, target =NewCohort_DataSum_tmp2, vars= %str(file_nick_name, VarName_in_Raw_file))&#59<br/>&nbsp&nbsp&nbsp&nbspdata remotet.DataSum_2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat filename $100.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset NewCohort_DataSum_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename VarName_in_Raw_file = variable&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilename='master_' || file_nick_name&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcreateTime = datetime()&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat createTime datetime20.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspprojectName = &_clientprojectname&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspprogramName = &_clientTaskLabel&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop file_nick_name&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*link descriptions to the selected vars*/<br/>&nbsp&nbsp&nbsp&nbsp%NewCohort_GetVarDesc&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*loop by each source to get data*/<br/>&nbsp&nbsp&nbsp&nbsp%let i=1&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*loop unitl %scan has a null value, i.e., a null value after the last element*/<br/>&nbsp&nbsp&nbsp&nbsp%do %until (<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%length(%scan(%quote(&theSources), &i &dlmt)) =0<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the current file source*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> i = &i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theFileSource=%scan(%quote(&theSources), &i &dlmt)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> theFileSource= &theFileSource&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the file ready*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if not %sysfunc(exist(master_&theFileSource)) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> master_&theFileSource does not exist in work directory, try to unzip &remoteTargetPath./master_&theFileSource..zip&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*check if the zip file exist*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %sysfunc(fileexist(&remoteTargetPath./master_&theFileSource..zip)) %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> unzipping &remoteTargetPath./master_&theFileSource..zip ...&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=&remoteTargetPath,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzip=master_&theFileSource,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipped=master_&theFileSource,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=master_&theFileSource<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*the file does not exist, skip this file source*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put the file master_&theFileSource does not exist in the work directory, nor in the zip file in &remoteTargetPath. Information of the file cannot be reported.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theFileSource=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%goto skipTheFile&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the number of obs in the file*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%nobs(data=master_&theFileSource)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let nrows=&nobs&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let nobs=&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*attache to the file sum table,  the current file's location, name, nobs<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe location is where the data files are to be saved in local drive<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspit is set in the program 'Remote Settings'*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata NewCohort_DataSum_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplocation = symget('localDataPath')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilename = 'master_' || compress(symget('theFileSource'), ' ')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspnobs= &nrows&#59 /*to input nrows as a numeric value, in such cases, do not use symget()*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcreateTime = datetime()&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspprojectName = &_clientprojectname&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspprogramName = &_clientTaskLabel&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata remotet.DataSum_1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset remotet.DataSum_1 NewCohort_DataSum_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*for each file, run getDataSum to have missing value reports*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &theFileSource ne dp_spec and &theFileSource ne hosp_info  %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &theFileSource=msb_docinfo %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let personCol = key_doc_num&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %let personCol = key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getMissingSum(data=MASTER_&theFileSource, ptCol = &personCol, target=NewCohort_DataSum_tmp4, debug=)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*attach report to the all_var summary table*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata  NewCohort_DataSum_tmp0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset  NewCohort_DataSum_tmp0 NewCohort_DataSum_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get the variables extracted from the source data*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%distinct(data = &DataVarList, target=NewCohort_DataSum_tmp5, vars=%str(varname_in_raw_file),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfilters=%str(file_nick_name = symget('theFileSource')))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%ValueToString(Data=NewCohort_DataSum_tmp5,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptheVar=varname_in_raw_file, theStrVarName=, DLMT=&dlmt)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theDataVars=&theStrVar_0824&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let valuesToStr_0824=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> theDataVars=&theDataVars&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> the current source is &theSources, theDataVars are &theDataVars&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*run the specific data-getting macro for each file source*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> run macro getCohortData_&theFileSource&#59*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*%getCohortData_&theFileSource&#59<br/>%skipTheFile:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let i = %eval(&i+1)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%delData(data=NewCohort_DataSum_tmp1 NewCohort_DataSum_tmp2)&#59<br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*rename the names*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata remoteT.DataSum_4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset NewCohort_DataSum_tmp0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcreateTime = datetime()&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspprojectName = &_clientprojectname&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspprogramName = &_clientTaskLabel&#59&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%delData(data=NewCohort_DataSum_tmp0)&#59<br/>%mend NewCohort_DataSum&#59<br/>%NewCohort_DataSum(DataVarList=remoteS.A2_CohortDataVARS)&#59<br/><br/>/*get slushcode sum for master data sets with doc numbers (MSB, DP_benefit, DP_nonbenefit*/<br/>%getDocSlushCodeSum(data = MASTER_MSB, target=r1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdocid=key_doc_num, debug=)&#59<br/>%getDocSlushCodeSum(data = MASTER_DP_BENEFIT, target=r2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdocid=key_prscr_num, debug=)&#59<br/>%getDocSlushCodeSum(data = MASTER_DP_NonBENEFIT, target=r3, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdocid=key_prscr_num, debug=)&#59<br/><br/>data remotet.dataSum_DocSlushCodes&#59<br/>&nbsp&nbsp&nbsp&nbspset r1 r2 r3&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/>proc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbspdelete r1 r2 r3&#59<br/>run&#59<br/><br/><br/>/*Make the cover table*/<br/>data remotet.dataSum_Cover&#59<br/>&nbsp&nbsp&nbsp&nbspset&nbsp&nbsp&nbsp&nbspremotes.a1_masterinput end=eof &#59<br/>&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbspif eof then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspItems='DataCreateTime'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspValue =strip(put( datetime(), datetime20.))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspitems='DataCreateProject'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvalue=&_clientProjectName&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>run&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-4fD8SJ7EZPvVQDtC","name":"AdditionalDataForDocCovariates","NodeDescription":"///t<br/>///s<br/>/*additional: get msb and drug claims  of all individuals between 2010 and 2018*/<br/>%let DataStartDate='31Dec2009'd&#59<br/>%let DataEndDate='01Jan2019'd&#59<br/><br/><br/>/*get drug claims not covered by drug plan benefits*/<br/>%macro getCohortData_DP_NonBenefit&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%Extract_Drug_non_ben_test(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt=&Xtrc_Start_DP_NBen, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt=&Xtrc_End_DP_NBen, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspexcl_xtrc_dt=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out=getCohortData_DP_NB_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspalldin_file=&alldinfile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_file= ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_list=,                    <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstrt_dt=&DataStartDate ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend_dt=&DataEndDate  <br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*apply the additional request conditions*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_DP_NB_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_DP_NB_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop sgt_id&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data contains the var key_prscr_num, indicate key_prscr_num values that are sluch codes*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %index(%sysfunc(lowcase(&theDataVars)), key_prscr_num) >0 and %length(&theDataVars)>0 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a list of doc slush codes according to the txt files in the Clean folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getDocSlushCodes(target=getCohortData_DP_NB_tmp3, debug=)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_DP_NB_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_DP_NB_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_dp_nonbenefit_pop,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, ifc(t2.DocSlushCode ='', 'N', t2.DocSlushCode) as DocSlushCode),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjterm=%str(t1.key_prscr_num=t2.key_doc_num)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data does not contain the varkey_doc_num, let all DocSlushCode values be 'N'*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata Master_dp_nonbenefit_pop&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_DP_NB_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDocSlushCode=\"N\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_dp_nonbenefit_pop, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_dp_nonbenefit_pop.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_dp_nonbenefit,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%deldata(data=_drgtmp _fileout _allDIn getCohortData_DP_NB_tmp1)&#59<br/><br/>%mend getCohortData_DP_NonBenefit&#59<br/>%let theDataVars=DIN DRG_TYPE KEY_HSN KEY_PRSCR_NUM RX_DDDDD RX_QTY_AMT TOTAL_COST UNIT_PR_COST&#59<br/>%getCohortData_DP_NonBenefit&#59<br/>/*************************************/&nbsp&nbsp&nbsp&nbsp<br/><br/><br/><br/>/*get drug claims not covered by drug plan benefits*/<br/>%macro getCohortData_DP_Benefit&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%Extract_Drug(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt=&Xtrc_Start_DP_Ben, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt=&Xtrc_End_DP_Ben, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspexcl_xtrc_dt=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out=getCohortData_DP_Benefit_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspalldin_file=&alldinfile,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdin_file= ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_list=,                    <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgenname_file=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspstrt_dt=&DataStartDate ,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend_dt=&DataEndDate  <br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*apply the additional request conditions*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_DP_Benefit_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_DP_Benefit_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop sgt_id&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data contains the var key_prscr_num, indicate key_prscr_num values that are sluch codes*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %index(%sysfunc(lowcase(&theDataVars)), key_prscr_num) >0 and %length(&theDataVars)>0 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a list of doc slush codes according to the txt files in the Clean folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getDocSlushCodes(target=getCohortData_DP_Benefit_tmp3, debug=)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_DP_Benefit_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_DP_Benefit_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_dp_benefit_pop,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, ifc(t2.DocSlushCode ='', 'N', t2.DocSlushCode) as DocSlushCode),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjterm=%str(t1.key_prscr_num=t2.key_doc_num)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data does not contain the varkey_doc_num, let all DocSlushCode values be 'N'*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata Master_dp_benefit_pop&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_DP_Benefit_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDocSlushCode=\"N\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_dp_benefit_pop, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_dp_benefit_pop.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_dp_benefit,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%deldata(data=_drgtmp _fileout _allDIn getCohortData_DP_Benefit_tmp1)&#59<br/><br/>%mend getCohortData_DP_Benefit&#59<br/>%let theDataVars=DIN DRG_TYPE KEY_HSN KEY_PRSCR_NUM RX_DDDDD RX_QTY_AMT TOTAL_APPRV  AMNT_PAY_DRUG_PLAN UNIT_PR_PAY&#59<br/>%getCohortData_DP_Benefit&#59<br/>/*************************************/&nbsp&nbsp&nbsp&nbsp<br/><br/><br/>/*macro to get data from MSB*/<br/>%macro getCohortData_MSB&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*the problem is that when both diag code and FSC code are specified<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe following macro returns only records of diagcode AND FSC<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIt seems that, unlike the Extract_CIHI macro, there is no option to <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspchange the logic to OR<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTherefore in the following step, FSCcode is never specified, such that <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall records will be extracted, regardless of FSC code. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp &nbsp&nbsp&nbsp&nbspScreening of FSC code will be done in later steps<br/>&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%Extract_MSB(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt=&Xtrc_Start_MSB,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt=&Xtrc_End_MSB, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out= getCohortData_MSB_tmp1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file= , <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdiagcode=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdostart=&DataStartDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdosend=&DataEndDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfscode=<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*apply the additional request conditions*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata getCohortData_MSB_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_MSB_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdos = dos_1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat dos date9.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &theDataVars&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_MSB_tmp2, target = getCohortData_MSB_tmp3, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data contains the var key_doc_num, indicate key_doc_num values which are sluch codes*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %index(%sysfunc(lowcase(&theDataVars)), key_doc_num) >0 and %length(&theDataVars)>0 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*prepare a list of doc slush codes according to the txt files in the Clean folder*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%getDocSlushCodes(target=getCohortData_MSB_tmp4, debug=1)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=getCohortData_MSB_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=getCohortData_MSB_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_MSB_pop,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, ifc(t2.DocSlushCode ='', 'N', t2.DocSlushCode) as DocSlushCode),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=key_doc_num<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*if the data does not contain the varkey_doc_num, change the temp file's name to Master_MSB*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata Master_MSB_pop&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_MSB_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDocSlushCode=\"N\"&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_MSB,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_MSB_pop, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_MSB_pop.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete getCohortData_MSB_tmp:&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>%mend getCohortData_MSB&#59<br/>%let theDataVars=_ALL_&#59<br/>%getCohortData_MSB&#59<br/>/*************************************/<br/><br/><br/>/*a list of KEY_HSNs ever appeared in PHRS*/<br/>data additionalzz_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbspset &PHRS_InfoFile (keep=key_hsn)&#59<br/>run&#59<br/>/*make a distinct list of key_hsn*/<br/>%distinct(data=additionalzz_tmp1, target=Master_keyhsn_pop, vars=key_hsn)&#59<br/>%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_keyhsn_pop, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_keyhsn_pop.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/>/*a list of key_doc_num ever appeared in msb_billing, and dp_claims*/<br/>data additionalzz_tmp2a&#59<br/>&nbsp&nbsp&nbsp&nbspset hqc.msb_billing (keep=key_doc_num)&#59<br/>run&#59<br/>data additionalzz_tmp2b&#59<br/>&nbsp&nbsp&nbsp&nbspset hqc.DP_CLAIM (keep=key_prscr_num)&#59<br/>&nbsp&nbsp&nbsp&nbsprename key_prscr_num=key_doc_num&#59<br/>run&#59<br/>data additionalzz_tmp2c&#59<br/>&nbsp&nbsp&nbsp&nbspset hqc.DP_CLAIM_NON_BEN (keep=key_prscr_num)&#59<br/>&nbsp&nbsp&nbsp&nbsprename key_prscr_num=key_doc_num&#59<br/>run&#59<br/>/*make a distinct list of key_doc_num&#59*/<br/>data additionalzz_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbspset additionalzz_tmp2a additionalzz_tmp2b additionalzz_tmp2c&#59<br/>run&#59<br/>%distinct(data=additionalzz_tmp2, target=Master_docnum_pop, vars=key_doc_num)&#59<br/>%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_docnum_pop, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_docnum_pop.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/><br/>/*a list of DINs ever appeared in dp files (ben and nonben)*/<br/>data additionalzz_tmp3a&#59<br/>&nbsp&nbsp&nbsp&nbspset hqc.dp_claim (keep=din)&#59<br/>run&#59<br/>data additionalzz_tmp3b&#59<br/>&nbsp&nbsp&nbsp&nbspset hqc.dp_claim_non_ben (keep=din)&#59<br/>run&#59<br/>data additionalzz_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbspset additionalzz_tmp3a additionalzz_tmp3b&#59<br/>run&#59<br/><br/>/*make a distinct list of key_hsn*/<br/>%distinct(data=additionalzz_tmp3, target=additionalzz_tmp4, vars=din)&#59<br/>/*the dins in _tmp4 (from dp and non dp files) is not the same as the dins in alldin files<br/>&nbsp&nbsp&nbsp&nbspNone of the files is complete. <br/>&nbsp&nbsp&nbsp&nbspTherefore the following is to have dins in alldin files<br/>&nbsp&nbsp&nbsp&nbspput the two together and have a complete din file<br/>*/<br/>/*the following test shows that the alldin file does not have all dins obtained from dp claims*/<br/>libname  ald \"/sasdata/hisc/shared_data/HQC_share/Clean/2019 Data/Clean files/\"&#59<br/>%let theald = ald.alldin_1_jas19_18oct2019&#59<br/>%distinct(data=&theald, target=additionalzz_tmp5, vars=din)&#59<br/>%compAB(a=additionalzz_tmp4, b=additionalzz_tmp5, vars=din, target=test5)&#59<br/>Data additionalzz_tmp6&#59<br/>&nbsp&nbsp&nbsp&nbspset additionalzz_tmp4 additionalzz_tmp5&#59<br/>run&#59<br/>%distinct(data=additionalzz_tmp6, target=Master_din_pop, vars=din)&#59<br/><br/>%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_din_pop, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_din_pop.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp<br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"EGTask-TmIx3Xy8T1UxrKr6","name":"S1 Copy zip files from SAS server","children":[{"idx":"EGTask-jmwuujYzzFA6crDn","name":"S2 Copy data sum files from SAS server","children":[{"idx":"CodeTask-vCOpZE73OY9t79ol","name":"T_Report DataSum into Xls","NodeDescription":"///t<br/>///s<br/>/*S export*/<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&DataReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localt.datasum_cover,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=cover, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&DataReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localt.datasum_1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=files, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&DataReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localt.datasum_3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=vars, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&DataReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localt.datasum_4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=missing, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>%SASToXlsRange(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspExcelAppLoc=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFilePath=&localReportPath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxlsFileName=&DataReport, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=localt.datasum_docslushcodes,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSheetName=docslushcodes, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellRow=2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcellCol=1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselectsheet=1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/>s///<br/>t///","custparents":[{"idx":"EGTask-jmwuujYzzFA6crDn"}]}],"custparents":[{"idx":"EGTask-TmIx3Xy8T1UxrKr6"}]}],"custparents":[{"idx":"CodeTask-4fD8SJ7EZPvVQDtC"},{"idx":"CodeTask-9TFqBPI3CpP2l286"}]}],"custparents":[{"idx":"CodeTask-zUCuLGc5Xv9jVBhJ"}]},{"idx":"CodeTask-9TFqBPI3CpP2l286","name":"AdditionalCovHospPop","NodeDescription":"///t<br/>///s<br/>/*additional to have all enrolled individuals of their coverage status<br/>&nbsp&nbsp&nbsp&nbspThese patient will be anayzed for panel size, and physician workload<br/>&nbsp&nbsp&nbsp&nbspFor that purpose, we'll need to exclude patients<br/>&nbsp&nbsp&nbsp&nbsp1) not fully covered by insurance within a follow up<br/>&nbsp&nbsp&nbsp&nbsp2) hospitalized (so that the physicina msb may not be correct)<br/>&nbsp&nbsp&nbsp&nbsp3) preg<br/><br/>&nbsp&nbsp&nbsp&nbspTherefore we'll need to have coverage info between 2011 and 2018<br/>&nbsp&nbsp&nbsp&nbspand hospitization info between 2011 and 2018<br/>*/<br/><br/>/*coverage info between 2011 and 2018*/<br/>data PHRS_COV_Pop_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbspset &PHRS_CovFile&#59<br/>&nbsp&nbsp&nbsp&nbspwhere datepart(xtrc_date) = &xtrc_End_Cover&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn eff_date exp_date report_start report_end&#59<br/>run&#59<br/>data Master_PHRS_COV_Pop&#59<br/>&nbsp&nbsp&nbsp&nbspset PHRS_COV_Pop_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbspif eff_date =. then eff_date = report_start&#59<br/>&nbsp&nbsp&nbsp&nbspif exp_date =. then exp_date = report_end&#59<br/>&nbsp&nbsp&nbsp&nbspformat reff_date date9. rexp_date date9.&#59<br/>&nbsp&nbsp&nbsp&nbspreff_date = datepart(eff_date)&#59<br/>&nbsp&nbsp&nbsp&nbsprexp_date = datepart(exp_date)&#59<br/>&nbsp&nbsp&nbsp&nbspdrop eff_date exp_date report_start report_end&#59<br/>&nbsp&nbsp&nbsp&nbsprename reff_date= eff_date rexp_date = exp_date&#59<br/>run&#59<br/><br/><br/>/*zip it into the RemoteT folder*/<br/>%UnixZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbspdata=Master_PHRS_COV_Pop, <br/>&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsptarget=Master_PHRS_COV_Pop.zip, <br/>&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/><br/>/*get hosp pop data*/<br/>%Extract_CIHI( <br/>&nbsp&nbsp&nbsp&nbspds_in =&hospitalFile,<br/>&nbsp&nbsp&nbsp&nbspds_out=getCohortData_hosp_pop_tmp1, <br/>&nbsp&nbsp&nbsp&nbspadms_start_date='01Jan2011'd,      <br/>&nbsp&nbsp&nbsp&nbspadms_end_date='31dec2018'd,<br/>&nbsp&nbsp&nbsp&nbspICD9_list=,<br/>&nbsp&nbsp&nbsp&nbspICD10_list=,<br/>&nbsp&nbsp&nbsp&nbspCCP_List=,<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCP_Exact_list=,*/<br/>&nbsp&nbsp&nbsp&nbspCCI_list=,<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCI_Exact_list=,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode_logic=,*/<br/>&nbsp&nbsp&nbsp&nbsphsn_list=,<br/>&nbsp&nbsp&nbsp&nbsphsn_file= <br/> )&#59<br/><br/><br/>data Master_HOSP_POP&#59<br/> &nbsp&nbsp&nbsp&nbspset getCohortData_hosp_pop_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn cihi_rec  adm_date dschg_date ds_ip t_los a_los alc_los dx_code_1-dx_code_25 <br/>&nbsp&nbsp&nbsp&nbspconv_dx_code_1-conv_dx_code_25&#59<br/>run&#59<br/><br/>%UnixZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbspdata=Master_HOSP_POP, <br/>&nbsp&nbsp&nbsp&nbsptPath=&remoteTargetPath, <br/>&nbsp&nbsp&nbsp&nbsptarget=Master_HOSP_POP.zip, <br/>&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/><br/><br/>s///<br/>t///","custparents":[{"idx":"CodeTask-zUCuLGc5Xv9jVBhJ"}]}],"custparents":[{"idx":"CodeTask-tyupk9qkvIjdVjPX"}]}],"custparents":[{"idx":"CodeTask-ZCfAl5dlvcIorNC2"}]}],"custparents":[{"idx":"CodeTask-relxLYgo8OlVVhJS"}]}],"custparents":[{"idx":"CodeTask-zvvbqcEgpuE6QgWN"}]}],"custparents":[{"idx":"CodeTask-uu7FNkVc8L58LSwR"}]}],"custparents":[{"idx":"EGTask-15Q6EA1yHVxaKM94"}]}],"custparents":[{"idx":"CodeTask-IQsHUlGFWl8uZktJ"}]}],"custparents":[{"idx":"CodeTask-sn8jH8iiFqgnr9tW"}]}],"custparents":[{"idx":"CodeTask-kyenvWsNUN9pBHaB"}]}],"custparents":[{"idx":"CodeTask-1F53xJJrBEJqHkyM"}]}],"custparents":[{"idx":"CodeTask-7akhfpgFObKpWa2P"}]}],"custparents":[{"idx":"CodeTask-zWY4MoZZbeEPxh68"}]}],"custparents":[{"idx":"CodeTask-JU2jGM49586GmWH7"}]}],"custparents":[{"idx":"CodeTask-gcU6kB6LE6RW7sX4"}]}],"custparents":[{"idx":"CodeTask-73IOnefOiNpAZfDi"}]}],"custparents":[{"idx":"CodeTask-W7usgQIznMNjU4BC"}]}],"custparents":[{"idx":"CodeTask-OZhXRTIAuUI8so1K"}]}],"custparents":[{"idx":"CodeTask-B1XbbPwYZKjWPVJM"}]}],"custparents":[{"idx":"CodeTask-iBm3TnsewjoXmFMA"}]}],"custparents":[{"idx":"EGTask-yUjgFuvpaSgEzUDM"}]}]}],"custparents":[{"idx":"EGTask-cWNDcRk2GJkT9UJm"}]}],"custparents":[{"idx":"CodeTask-8XQczBciSUyozSiJ"}]}],"custparents":[{"idx":"EGTask-AA72ijpRTgdiZvGZ"}]},{"idx":"CodeTask-ValelAlfFSjl8z6j","name":"_0D del Master Input at local","NodeDescription":"///t<br/>///s<br/>/*Delete the master input file in the local common exchange folder*/<br/>proc datasets nolist lib=lcommon&#59<br/>&nbsp&nbsp&nbsp&nbspdelete &theMasterInputFile&#59<br/>run&#59<br/><br/>s///<br/>t///","custparents":[{"idx":"EGTask-AA72ijpRTgdiZvGZ"}]}],"custparents":[{"idx":"CodeTask-kqczIKG22ZMBhJZ8"}]}],"custparents":[{"idx":"CodeTask-kdXNatjk26MJ53wd"}]}],"custparents":[{"idx":"EGTask-oyLU9215za4Elsgd"}]}],"custparents":[{"idx":"CodeTask-lm45gKn6MFkGPZo4"}]}],"custparents":[{"idx":"CodeTask-iqlReHV8qNfiqkLR"}]}]},{"idx":"MYe41584e8-a4ea-4a1f-8077-c08ac73f627a","name":"Tools and others","custparents":[{"idx":"ProjectCollection-cmSbt48MqRzD7t79"}],"children":[{"idx":"CodeTask-q65h3IrNGuXafJ8T","name":"Test_local","NodeDescription":"///t<br/>///s<br/>data _null_&#59run&#59<br/><br/><br/>s///<br/>t///","custparents":[{"idx":"MYe41584e8-a4ea-4a1f-8077-c08ac73f627a"}]},{"idx":"CodeTask-zlO9ztVQoMSivIaE","name":"Test_remote","NodeDescription":"///t<br/>///s<br/>data _null_&#59run&#59<br/><br/><br/>s///<br/>t///","custparents":[{"idx":"MYe41584e8-a4ea-4a1f-8077-c08ac73f627a"}]},{"idx":"CodeTask-b3OezYBUd9h9Xqga","name":"escape","NodeDescription":"///t<br/>///s<br/>/*data x&#59a=1&#59run&#59*/<br/>)&#59<br/>data _null_&#59run&#59<br/>s///<br/>t///","custparents":[{"idx":"MYe41584e8-a4ea-4a1f-8077-c08ac73f627a"}]},{"idx":"CodeTask-nFFfnUzpOAcAde3z","name":"Beep","NodeDescription":"///t<br/>///s<br/>%beep&#59<br/>s///<br/>t///","custparents":[{"idx":"MYe41584e8-a4ea-4a1f-8077-c08ac73f627a"}]},{"idx":"CodeTask-46MoQuNJCxeUz4lE","name":"Tools_change zip and file names","NodeDescription":"///t<br/>///s<br/>/*unzip the file*/<br/><br/>%macro changeZip(theCohort=)&#59<br/>&nbsp&nbsp&nbsp&nbsp%local theCohort theData&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%let theData= master_ed_a2012&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrcFile=%str(&theData..sas7bdat)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*rename it*/<br/>&nbsp&nbsp&nbsp&nbsp%renameData(source=&theData, target=&theData._&theCohort, lib=work)&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=&theData._&thecohort..zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=&theData._&thecohort..sas7bdat, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete it*/<br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=&theData._&thecohort)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete the old zip file*/<br/>&nbsp&nbsp&nbsp&nbspx \"del \"\"P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip\"\" \"&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%let theData= master_hosp&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrcFile=%str(&theData..sas7bdat)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*rename it*/<br/>&nbsp&nbsp&nbsp&nbsp%renameData(source=&theData, target=&theData._&theCohort, lib=work)&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=&theData._&thecohort..zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=&theData._&thecohort..sas7bdat, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete it*/<br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=&theData._&thecohort)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete the old zip file*/<br/>&nbsp&nbsp&nbsp&nbspx \"del \"\"P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip\"\" \"&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%let theData= master_mds_ltc&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrcFile=%str(&theData..sas7bdat)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*rename it*/<br/>&nbsp&nbsp&nbsp&nbsp%renameData(source=&theData, target=&theData._&theCohort, lib=work)&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=&theData._&thecohort..zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=&theData._&thecohort..sas7bdat, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete it*/<br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=&theData._&thecohort)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete the old zip file*/<br/>&nbsp&nbsp&nbsp&nbspx \"del \"\"P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip\"\" \"&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%let theData= master_msb&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrcFile=%str(&theData..sas7bdat)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*rename it*/<br/>&nbsp&nbsp&nbsp&nbsp%renameData(source=&theData, target=&theData._&theCohort, lib=work)&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=&theData._&thecohort..zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=&theData._&thecohort..sas7bdat, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete it*/<br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=&theData._&thecohort)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete the old zip file*/<br/>&nbsp&nbsp&nbsp&nbspx \"del \"\"P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip\"\" \"&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%let theData= master_msb_docinfo&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrcFile=%str(&theData..sas7bdat)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*rename it*/<br/>&nbsp&nbsp&nbsp&nbsp%renameData(source=&theData, target=&theData._&theCohort, lib=work)&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=&theData._&thecohort..zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=&theData._&thecohort..sas7bdat, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete it*/<br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=&theData._&thecohort)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete the old zip file*/<br/>&nbsp&nbsp&nbsp&nbspx \"del \"\"P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip\"\" \"&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%let theData= master_phrs_cov&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrcFile=%str(&theData..sas7bdat)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*rename it*/<br/>&nbsp&nbsp&nbsp&nbsp%renameData(source=&theData, target=&theData._&theCohort, lib=work)&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=&theData._&thecohort..zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=&theData._&thecohort..sas7bdat, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete it*/<br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=&theData._&thecohort)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete the old zip file*/<br/>&nbsp&nbsp&nbsp&nbspx \"del \"\"P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip\"\" \"&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp%let theData= master_phrs_info&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrcFile=%str(&theData..sas7bdat)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*rename it*/<br/>&nbsp&nbsp&nbsp&nbsp%renameData(source=&theData, target=&theData._&theCohort, lib=work)&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=&theData._&thecohort..zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=&theData._&thecohort..sas7bdat, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete it*/<br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=&theData._&thecohort)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete the old zip file*/<br/>&nbsp&nbsp&nbsp&nbspx \"del \"\"P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip\"\" \"&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%let theData= master_phrs_resi_clean&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsrcFile=%str(&theData..sas7bdat)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*rename it*/<br/>&nbsp&nbsp&nbsp&nbsp%renameData(source=&theData, target=&theData._&theCohort, lib=work)&#59<br/>&nbsp&nbsp&nbsp&nbsp%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=%str(P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspzipFile=&theData._&thecohort..zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=&theData._&thecohort..sas7bdat, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete it*/<br/>&nbsp&nbsp&nbsp&nbsp%deldata(data=&theData._&thecohort)&#59<br/>&nbsp&nbsp&nbsp&nbsp/*delete the old zip file*/<br/>&nbsp&nbsp&nbsp&nbspx \"del \"\"P:\\VictoriaH_Redesign(TianY)\\tmp\\&theCohort.\\Data\\&theData..zip\"\" \"&#59<br/><br/>%mend changeZip&#59<br/><br/><br/><br/>s///<br/>t///","custparents":[{"idx":"MYe41584e8-a4ea-4a1f-8077-c08ac73f627a"}]}]}]}