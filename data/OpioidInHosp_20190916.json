[{"idx":"ProjectCollection-oSbbJmNbuyopFfxD","name":"Opioid Use In Hosp 20190916","children":[{"idx":"CodeTask-d4P1yji32TLBQlxg","name":"Settings","NodeDescription":"///t<br/>///s<br/>/*define locations of files*/<br/>%include \"F:\\Personal\\Dropbox\\Project\\D3 learning\\Convert SAS EGP to JSON for D3 diagrams\\SAS EGP\\mymacros.sas\"&#59<br/>libname s \"F:\\ForSASUEdition\\SASUniversityEdition\\myfolders\\_Project1_bk\\Source\"&#59<br/><br/>/*switch between code and log window*/<br/><br/>/*special file address in SAS studio*/<br/><br/>/*check library, refresh*/<br/><br/><br/>/*Assigment:<br/>&nbsp&nbsp&nbsp&nbspadd your own library s<br/>*/<br/><br/><br/>/*more.....*/<br/>/*define global variables*/<br/><br/>%let DataStartDate = '01jan2007'd&#59<br/>%let DataEndDate = '31dec2007'd&#59<br/><br/>%let MEQxlsx =F:\\ForSASUEdition\\SASUniversityEdition\\myfolders\\_Project1_bk\\Documents\\opioidmeq.xlsx &#59<br/>%let reportxls=F:\\ForSASUEdition\\SASUniversityEdition\\myfolders\\_Project1_bk\\Results\\Reports\\Descriptive.xlsx&#59<br/><br/>/*add t*/<br/>libname t \"F:\\ForSASUEdition\\SASUniversityEdition\\myfolders\\_Project1_bk\\Results\\byEG\"&#59<br/><br/>/*refresh library*/<br/><br/><br/>/*macros*/<br/>%macro print (data=)&#59<br/>/*&nbsp&nbsp&nbsp&nbsp%let srcdata=t._a_cohort&#59*/<br/>&nbsp&nbsp&nbsp&nbsp%local data&#59<br/>&nbsp&nbsp&nbsp&nbspproc print data=&data (obs=10)&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/>%mend print&#59<br/><br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-93byM4sZgUaR8fqE","name":"MyMacros","custparents":[{"idx":"CodeTask-d4P1yji32TLBQlxg"}]},{"idx":"CodeTask-JyS9oMI8rwPFbetm","name":"Test","NodeDescription":"///t<br/>///s<br/>Test<br/>s///<br/>t///","custparents":[{"idx":"CodeTask-d4P1yji32TLBQlxg"}]},{"idx":"CodeTask-FDC7A5O3ZDcN9ozV","name":"Make dummy","NodeDescription":"///t<br/>///s<br/>%include \"S:\\Collaborative_researchers\\Shenzhen\\My Project\\Projects\\DoNotDelete Common Macros\\MyMacros.sas\"&#59<br/><br/><br/>data _null_&#59run&#59<br/><br/>%let docPath = F:\\ForSASUEdition\\SASUniversityEdition\\myfolders\\_Project1\\Documents&#59<br/>%let dataPPath = F:\\ForSASUEdition\\SASUniversityEdition\\myfolders\\_Project1\\Source\\DataPrepare&#59<br/>%let dataPath = F:\\ForSASUEdition\\SASUniversityEdition\\myfolders\\_Project1\\Source&#59<br/><br/><br/>libname e \"&docPath\"&#59<br/>libname d \"&dataPath\"&#59<br/>libname dp \"&dataPPath\"&#59<br/><br/><br/>/*create a dummy patient list<br/>&nbsp&nbsp&nbsp&nbsprandomize age between 16 and 80<br/>&nbsp&nbsp&nbsp&nbsprandomize sex<br/>*/<br/>data dp.cohort&#59<br/>&nbsp&nbsp&nbsp&nbsplength KEY_HSN $11. SEX_DESC $1. BORN_MONTH $2.&#59<br/>&nbsp&nbsp&nbsp&nbspdo pt_obs = 1 to 1000&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn = put(pt_obs+10000000000, z11.)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspBORN_YEAR = 1927 + floor((1+1991-1927)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspBORN_MONTH2= 1 + floor((1+12-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspBORN_MONTH= put(BORN_MONTH2, z2.)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSEXN=0 + floor((1+1-0)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif SEXN =0 then SEX_DESC='M'&#59else SEX_DESC='F'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspdrop sexn BORN_MONTH2&#59<br/>run&#59<br/><br/>/*create a dummy hopistalization list<br/>&nbsp&nbsp&nbsp&nbsp1. randomize the hosp records between 3 hospitals<br/>&nbsp&nbsp&nbsp&nbsp2. randomize the adm_date between 2007.3 and 2007.4<br/>&nbsp&nbsp&nbsp&nbsp3. randomize the length of stay between 1 and 30 days<br/>&nbsp&nbsp&nbsp&nbsp4. randomized to patients<br/>&nbsp&nbsp&nbsp&nbsp5. randomize the ICD codes for cancer (can be null, or any), in any position<br/>*/<br/><br/>data dp.hosp&#59<br/>&nbsp&nbsp&nbsp&nbspFORMat INST_NUM $4. ADM_DATE datetime20. DSCHG_DATE datetime20.&#59<br/>&nbsp&nbsp&nbsp&nbsparray dxs {25} $10. DX_CODE_1 - DX_CODE_25&#59<br/>&nbsp&nbsp&nbsp&nbspdo CIHI_REC = 1 to 2000&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*random inst number*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinstn =1 + floor((1+3-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspINST_NUM = 'H' || put (instn, z3.)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*random adm date and length of stay*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadmd = 17226 + floor((1+17286-17226)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdschgd = admd + 1 + floor((1+30-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADM_DATE = dhms(admd, 0,0,0)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDSCHG_DATE=dhms(dschgd, 0,0,0)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*random patient number*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsppt_obs = 1 + floor((1+1000-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*random ICD number*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*the number of DX in a row by random*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspndx = 1 + floor((1+5-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdo i = 1 to ndx&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*pt_obs < 901 do not have cancer*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif pt_obs < 901 then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspHeadN = 65 + floor((1+66-65)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTailN = 1 + floor((1+50-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxs(i) = byte(HeadN) || put(TailN, z3.)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspHeadN = 66 + floor((1+72-66)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTailN = 1 + floor((1+50-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxs(i) = byte(HeadN) || put(TailN, z3.)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspdrop instn admd dschgd HeadN TailN i ndx&#59<br/>run&#59<br/><br/>/*link cohort and patient together, and have the raw_hospital data*/<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table t20 as<br/>&nbsp&nbsp&nbsp&nbspselect<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdp.cohort t1<br/>&nbsp&nbsp&nbsp&nbspinner join <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdp.hosp t2<br/>&nbsp&nbsp&nbsp&nbspon (t1.pt_obs =t2.pt_obs)<br/>&nbsp&nbsp&nbsp&nbsporder by key_hsn, adm_date<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>/*adding several incomplete data*/<br/>data t21&#59<br/>&nbsp&nbsp&nbsp&nbspinput key_hsn $11. @13 dt1 anydtdte9.@23 dt2 anydtdte9.&#59<br/>&nbsp&nbsp&nbsp&nbspadm_date = dhms(dt1, 0,0,0)&#59<br/>&nbsp&nbsp&nbsp&nbspdschg_date = dhms(dt2, 0,0,0)&#59<br/>&nbsp&nbsp&nbsp&nbspformat adm_date datetime20. dschg_date datetime20.&#59<br/>&nbsp&nbsp&nbsp&nbspdrop dt1 dt2&#59<br/>&nbsp&nbsp&nbsp&nbspcards&#59<br/>20000000001 01Apr2001<br/>20000000002           01Apr2002<br/>20000000003 01Apr2003<br/>20000000004           03Apr2004<br/>20000000005 03Apr2012<br/>20000000006           03Apr2012<br/>20000000007 03Mar2012<br/>20000000008           03Jun2012<br/>&#59<br/><br/><br/>/*change one patient's sex*/<br/>data t22&#59<br/>&nbsp&nbsp&nbsp&nbspretain KEY_HSN SEX_DESC BORN_YEAR BORN_MONTH CIHI_REC &#59<br/>&nbsp&nbsp&nbsp&nbspset t20 t21&#59<br/>&nbsp&nbsp&nbsp&nbspif cihi_rec=407 then born_year =1953&#59<br/>&nbsp&nbsp&nbsp&nbspif cihi_rec=764 then SEX_desc = 'M'&#59<br/>&nbsp&nbsp&nbsp&nbspinformat adm_date datetime20.&#59<br/>run&#59<br/><br/><br/><br/>/*create a case that the first 2 hosp does not contain cancer dx*/<br/>data d.raw_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspset t22&#59<br/>&nbsp&nbsp&nbsp&nbspif key_hsn='10000000082' and datepart(adm_date) ='04mar2007'd then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdx_code_2='A021'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdschg_date = dhms('08mar2007'd,0,0,0)&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspif key_hsn='10000000082' and datepart(adm_date) ='23mar2007'd then dx_code_2='C043'&#59<br/>run&#59<br/><br/><br/><br/><br/>/*make the fake dp claims*/<br/>/*list of opiods*/<br/>data t1&#59<br/>&nbsp&nbsp&nbsp&nbspset e.sz_studydin&#59<br/>run&#59<br/>proc sort data=t1&#59<br/>&nbsp&nbsp&nbsp&nbspby medname gen_name /*form_code route_desc*/ Acting_Type specType  din&#59<br/>run&#59<br/><br/>data t2&#59<br/>&nbsp&nbsp&nbsp&nbspset t1&#59<br/>&nbsp&nbsp&nbsp&nbspby medname gen_name /*form_code route_desc*/ Acting_Type specType  din&#59<br/>&nbsp&nbsp&nbsp&nbspif first.gen_name&#59<br/>run&#59<br/><br/>data t3&#59<br/>&nbsp&nbsp&nbsp&nbspset t2&#59<br/>&nbsp&nbsp&nbsp&nbspkeep din drugN UNIT_PR_COST PCT_APRV_DP potent&#59<br/>&nbsp&nbsp&nbsp&nbspdrugN= _n_&#59<br/>&nbsp&nbsp&nbsp&nbspUNIT_PR_COST= (200 + floor((1+500-200)*rand(\"Uniform\"))) /100  &#59<br/>&nbsp&nbsp&nbsp&nbspPCT_APRV_DP = (0 + floor((1+8-0)*rand(\"Uniform\"))) /10&#59<br/>run&#59<br/><br/>/*create a random drug list*/<br/>data t4&#59<br/>&nbsp&nbsp&nbsp&nbspdo i = 1 to 5000&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*random Opioid DINs*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrugN = 1 + floor((1+64-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*random quantity of dispensation*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRX_QTY_AMT = 1 + floor((1+5-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspdrop i&#59<br/>run&#59 <br/>/*linking the drug info*/<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table t5 as<br/>&nbsp&nbsp&nbsp&nbspselect<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt4 t1<br/>&nbsp&nbsp&nbsp&nbspinner join <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt3 t2<br/>&nbsp&nbsp&nbsp&nbspon (t1.drugN =t2.drugN)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>/*caculate cost and gov pay*/<br/>data t6&#59<br/>&nbsp&nbsp&nbsp&nbspset t5&#59<br/>&nbsp&nbsp&nbsp&nbspTOTAL_COST = UNIT_PR_COST * RX_QTY_AMT&#59<br/>&nbsp&nbsp&nbsp&nbspAMT_PAY_DRUG_PLAN=round(TOTAL_COST * PCT_APRV_DP, '0.01')&#59<br/>&nbsp&nbsp&nbsp&nbspdrop drugN PCT_APRV_DP&#59<br/>run&#59<br/><br/>/*Assign 80% of the weak and 20% of the strong opioids to 50% of the non-cancer patients<br/>&nbsp&nbsp&nbsp&nbspAssign 20% of the week and 80% of the strong opioids to 80% of the cancer patients<br/>*/<br/><br/>data t7a t7b&#59<br/>&nbsp&nbsp&nbsp&nbspset t6&#59<br/>&nbsp&nbsp&nbsp&nbspif potent='weak' then output t7a&#59else output t7b&#59<br/>run&#59<br/><br/><br/><br/><br/>/*50% of non-cancer patients*/<br/>data t9a&#59<br/>&nbsp&nbsp&nbsp&nbspset d.raw_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspif pt_obs < 351&#59<br/>&nbsp&nbsp&nbsp&nbspdrop dx:&#59<br/>&nbsp&nbsp&nbsp&nbsprandN= rand(\"Uniform\")&#59<br/>run&#59<br/>proc sort data=t9a&#59<br/>&nbsp&nbsp&nbsp&nbspby randN&#59<br/>run&#59<br/>data t9b&#59<br/>&nbsp&nbsp&nbsp&nbspset t9a&#59<br/>&nbsp&nbsp&nbsp&nbsprN = _n_&#59<br/>run&#59<br/>/*689*/<br/>/*most weak*/<br/>data t8a&#59<br/>&nbsp&nbsp&nbsp&nbspset t7a (obs= 2800) t7b (firstobs=1181)&#59<br/>&nbsp&nbsp&nbsp&nbsprandN= rand(\"Uniform\")&#59<br/>&nbsp&nbsp&nbsp&nbsprN = 1 + floor((1+689-1)*rand(\"Uniform\"))&#59/*689 as there are 689 hospital records*/<br/>run&#59<br/><br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table t9c as<br/>&nbsp&nbsp&nbsp&nbspselect<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt8a t1<br/>&nbsp&nbsp&nbsp&nbspleft join <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt9b t2<br/>&nbsp&nbsp&nbsp&nbspon (t1.rN =t2.rN)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>data t9d&#59<br/>&nbsp&nbsp&nbsp&nbspretain KEY_HSN<br/>&nbsp&nbsp&nbsp&nbspSERVE_DATE<br/>&nbsp&nbsp&nbsp&nbspDIN<br/>&nbsp&nbsp&nbsp&nbspRX_QTY_AMT<br/>&nbsp&nbsp&nbsp&nbspUNIT_PR_COST<br/>&nbsp&nbsp&nbsp&nbspTOTAL_COST<br/>&nbsp&nbsp&nbsp&nbspAMT_PAY_DRUG_PLAN<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspset t9c&#59<br/>&nbsp&nbsp&nbsp&nbspdrop randN rN&#59<br/>&nbsp&nbsp&nbsp&nbsp/*random number to determine whether the claim is within hosp or after*/<br/>&nbsp&nbsp&nbsp&nbsprN2 = 1 + floor((1+10-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbspif rN2 >9 then SERVE_DATE = datepart(dschg_date)&#59<br/>&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*randomly determine a day between adm and discharge*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSERVE_DATE = Datepart(adm_date) + floor((1+Datepart(dschg_date)-Datepart(adm_date))*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspformat SERVE_DATE date9.&#59<br/>&nbsp&nbsp&nbsp&nbspdrop born_month born_year cihi_rec adm_date dschg_date inst_num sex_desc rn2 potent pt_obs&#59<br/>run&#59<br/><br/><br/>/*80% of cancer patients*/<br/>data t10a&#59<br/>&nbsp&nbsp&nbsp&nbspset d.raw_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspif pt_obs >760&#59<br/>&nbsp&nbsp&nbsp&nbspdrop dx:&#59<br/>&nbsp&nbsp&nbsp&nbsprandN= rand(\"Uniform\")&#59<br/>run&#59<br/>proc sort data=t10a&#59<br/>&nbsp&nbsp&nbsp&nbspby randN&#59<br/>run&#59<br/>data t10b&#59<br/>&nbsp&nbsp&nbsp&nbspset t10a&#59<br/>&nbsp&nbsp&nbsp&nbsprN = _n_&#59<br/>run&#59<br/>/*459*/<br/>/*most strong*/<br/>data t8b&#59<br/>&nbsp&nbsp&nbsp&nbspset t7a (firstobs= 2801) t7b (obs=1180)&#59<br/>&nbsp&nbsp&nbsp&nbsprN = 1 + floor((1+459-1)*rand(\"Uniform\"))&#59/*459 as there are 459 hospital records*/<br/>run&#59<br/><br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table t10c as<br/>&nbsp&nbsp&nbsp&nbspselect<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt8B t1<br/>&nbsp&nbsp&nbsp&nbspleft join <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt10b t2<br/>&nbsp&nbsp&nbsp&nbspon (t1.rN =t2.rN)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>data t10d&#59<br/>&nbsp&nbsp&nbsp&nbspretain KEY_HSN<br/>&nbsp&nbsp&nbsp&nbspSERVE_DATE<br/>&nbsp&nbsp&nbsp&nbspDIN<br/>&nbsp&nbsp&nbsp&nbspRX_QTY_AMT<br/>&nbsp&nbsp&nbsp&nbspUNIT_PR_COST<br/>&nbsp&nbsp&nbsp&nbspTOTAL_COST<br/>&nbsp&nbsp&nbsp&nbspAMT_PAY_DRUG_PLAN<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspset t10c&#59<br/>&nbsp&nbsp&nbsp&nbspdrop randN rN&#59<br/>&nbsp&nbsp&nbsp&nbsp/*random number to determine whether the claim is within hosp or after*/<br/>&nbsp&nbsp&nbsp&nbsprN2 = 1 + floor((1+10-1)*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbspif rN2 >9 then SERVE_DATE = datepart(dschg_date)&#59<br/>&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*randomly determine a day between adm and discharge*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSERVE_DATE = Datepart(adm_date) + floor((1+Datepart(dschg_date)-Datepart(adm_date))*rand(\"Uniform\"))&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspformat SERVE_DATE date9.&#59<br/>&nbsp&nbsp&nbsp&nbspdrop born_month born_year cihi_rec adm_date dschg_date inst_num sex_desc rn2 potent pt_obs&#59<br/>run&#59<br/><br/>data t31&#59<br/>&nbsp&nbsp&nbsp&nbsplength key_hsn $11. DIN $8.&#59<br/>&nbsp&nbsp&nbsp&nbspinput key_hsn $11. @13 DIN $8. @22 SERVE_date anydtdte9.  &#59<br/>&nbsp&nbsp&nbsp&nbspformat serve_date date9.&#59<br/>&nbsp&nbsp&nbsp&nbspcards&#59<br/>20000000001 00293490 01Feb2001<br/>20000000002 01941895 01Feb2002<br/>20000000003 00593168 01Feb2011<br/>&#59<br/>run&#59<br/><br/><br/>DATA d.raw_pharm&#59<br/> set t9d t10d t31&#59<br/>run&#59<br/><br/><br/><br/><br/><br/><br/> <br/><br/><br/>s///<br/>t///","custparents":[{"idx":"CodeTask-d4P1yji32TLBQlxg"}]}]},{"idx":"CodeTask-4z55DclN4F1tX8Wi","name":"Check data","NodeDescription":"///t<br/>///s<br/>/*checking data*/<br/><br/><br/>data _null_&#59run&#59<br/><br/><br/>proc dataSets&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=s.Raw_hosp&#59<br/>run&#59<br/><br/>/*indentations, case*/<br/><br/>/*the code, log, and result windows*/<br/>/*local, size, number of obs, type of variables*/<br/><br/><br/>proc print data=s.raw_hosp (obs=10)&#59<br/>run&#59<br/><br/><br/>/*assignment*/<br/>/*check s.raw_pharm<br/>? location<br/>? size<br/>? number of rows, obs<br/>? list of variables, and types<br/>*/<br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-NpTms4UYZ7t4qnsp","name":"studyData","NodeDescription":"///t<br/>///s<br/>/*define the study period*/<br/><br/>/*open the cpf*/<br/>/*save it as another version 20101016*/<br/><br/>/*check libraries*/<br/><br/>/*select two nodes, and run*/<br/><br/>/*check libraries*/<br/><br/><br/>data _null_&#59run&#59<br/><br/>/*show references*/<br/>/*google sas 9.3 proc means*/<br/><br/><br/>proc means data=s.raw_hosp n nmiss min max&#59<br/>&nbsp&nbsp&nbsp&nbspvar adm_date  dschg_date &#59<br/>run&#59<br/><br/><br/><br/><br/>/*explain the datetime/date from PPT*/<br/><br/>/*SAS datetime values*/<br/><br/>/*display min max in datetime format*/<br/>proc tabulate data=s.raw_hosp&#59<br/>&nbsp&nbsp&nbsp&nbsp/*the variables to summarize*/<br/>&nbsp&nbsp&nbsp&nbspvar adm_date  dschg_date&#59<br/>&nbsp&nbsp&nbsp&nbsp/*the table*/<br/>&nbsp&nbsp&nbsp&nbsptable <br/>&nbsp&nbsp&nbsp&nbsp/*what to display in rows*/<br/>&nbsp&nbsp&nbsp&nbspadm_date dschg_date<br/>&nbsp&nbsp&nbsp&nbsp,<br/>&nbsp&nbsp&nbsp&nbsp/*what to display in columns*/ <br/>&nbsp&nbsp&nbsp&nbspn nmiss (min max )*f=datetime20. &#59<br/>run&#59<br/><br/><br/>/*the first data set<br/>if or<br/>*/<br/>/*the missings*/<br/>data test1&#59<br/>&nbsp&nbsp&nbsp&nbspset s.raw_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspif adm_date = . or dschg_date =.&#59<br/>run&#59<br/><br/>/*those without missings*/<br/>data test2&#59<br/>&nbsp&nbsp&nbsp&nbspset s.raw_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspif adm_date ne . and dschg_date ne .&#59<br/>run&#59<br/><br/>proc tabulate data=test2&#59<br/>&nbsp&nbsp&nbsp&nbspvar adm_date  dschg_date&#59<br/>&nbsp&nbsp&nbsp&nbsptable adm_date dschg_date, n nmiss (min max )*f=datetime20. &#59<br/>run&#59<br/><br/>/*location of the the temporary folder*/<br/>proc datasets&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=test2&#59<br/>run&#59<br/><br/>/*data start and data end<br/>where*/<br/>data test3&#59<br/>&nbsp&nbsp&nbsp&nbspset s.raw_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspwhere <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdatepart(adm_date) between '01jan2007'd and '31dec2007'd<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdatepart(dschg_date) between '01jan2007'd and '31dec2007'd<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/>/*check the log file on # of obs, or # of rows*/<br/><br/>/*%let DataStartDate = '01jan2007'd&#59*/<br/>/*%let DataEndDate = '31dec2007'd&#59*/<br/><br/>data test3&#59<br/>&nbsp&nbsp&nbsp&nbspset s.raw_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspwhere <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdatepart(adm_date) between &DataStartDate and &DataEndDate<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdatepart(dschg_date) between &DataStartDate and &DataEndDate<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>/*explain the diff between if and where*/<br/><br/><br/>libname t \"F:\\ForSASUEdition\\SASUniversityEdition\\myfolders\\_Project1_bk\\Results\"&#59<br/>data t.data_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspset test3&#59<br/>run&#59<br/><br/><br/>/*delete files*/<br/>proc datasets&#59<br/>&nbsp&nbsp&nbsp&nbspdelete test:&#59<br/>run&#59<br/><br/>/*Exercise, check the missings in raw_pharm, of the RX_QTY_AMT<br/>min and max serve dates<br/>How many records after excluding missing data<br/>min and max serve dates again?<br/>save the target data set into the results folder<br/>*/<br/>proc means data=s.raw_pharm n nmiss min max&#59<br/>&nbsp&nbsp&nbsp&nbspvar RX_QTY_AMT  &#59<br/>run&#59<br/><br/><br/>data t.data_pharm&#59<br/>&nbsp&nbsp&nbsp&nbspset s.raw_pharm&#59<br/>&nbsp&nbsp&nbsp&nbspwhere serve_date between &DataStartDate and &DataEndDate&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsppharm_rec = _n_&#59<br/>run&#59<br/><br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-wHaoQvjsf2a7IddP","name":"A_Cohort","NodeDescription":"///t<br/>///s<br/>/*Patient cohort*/<br/><br/>data _null_&#59run&#59<br/><br/>proc print data=t.data_hosp (obs=10)&#59<br/>run&#59<br/><br/>/*&nbsp&nbsp&nbsp&nbspcreate a data set from an existing data set<br/>&nbsp&nbsp&nbsp&nbspkeep<br/>*/<br/>data _A1&#59<br/>&nbsp&nbsp&nbsp&nbspset t.data_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn born_month born_year sex_desc&#59<br/>run&#59<br/><br/>/*Birth date*/<br/>data _A2&#59<br/>&nbsp&nbsp&nbsp&nbspset _A1&#59<br/>&nbsp&nbsp&nbsp&nbspDOB = mdy(born_month, 15, born_year)&#59<br/>&nbsp&nbsp&nbsp&nbspformat dob date9.&#59<br/>run&#59 <br/><br/><br/>/*unique*/<br/>proc sort data=_A2&#59<br/>&nbsp&nbsp&nbsp&nbspby key_hsn sex_desc dob&#59<br/>run&#59<br/><br/>proc sort data=_A2 out=_A3 nodupkey&#59<br/>&nbsp&nbsp&nbsp&nbspby key_hsn sex_desc dob&#59<br/>run&#59<br/>/*880*/<br/><br/>proc sort data=_A2 out=_A4 nodupkey&#59<br/>&nbsp&nbsp&nbsp&nbspby key_hsn&#59<br/>run&#59<br/>/*878*/<br/><br/><br/>/*show tasks -> data -> Combine Tables*/<br/><br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _A5 as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcount(key_hsn) as counts<br/>&nbsp&nbsp&nbsp&nbspfrom _A3<br/>&nbsp&nbsp&nbsp&nbspgroup by key_hsn<br/>&nbsp&nbsp&nbsp&nbsporder by counts desc<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>data _a6&#59<br/>&nbsp&nbsp&nbsp&nbspset _a3&#59<br/>&nbsp&nbsp&nbsp&nbspwhere key_hsn in ('10000000016', '10000000019')&#59<br/>run&#59<br/><br/>data t._A_cohort&#59<br/>&nbsp&nbsp&nbsp&nbspset _a3&#59<br/>&nbsp&nbsp&nbsp&nbspif key_hsn not in ('10000000016', '10000000019')&#59<br/>&nbsp&nbsp&nbsp&nbspdrop born_month born_year&#59<br/>run&#59<br/>/*876*/<br/><br/>proc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbspdelete _a1 - _a6&#59<br/>run&#59<br/><br/><br/><br/><br/>s///<br/>t///","children":[{"idx":"MY86d0853b-ebae-4079-9a9f-70ef308d9cdb","name":"B Hosp events","children":[{"idx":"MYe40c4847-22e2-46c7-94a3-a8731659c357","name":"C Opioid Use","children":[{"idx":"CodeTask-75vyb4lmfkqegnDQ","name":"D_making Data4GenMod","NodeDescription":"///t<br/>///s<br/>/*making  data4genmod*/<br/><br/><br/><br/>data _null_&#59run&#59<br/><br/><br/>%print(data = t._A_COHORT)&#59<br/>PROC SQL&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _D1 as <br/>&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.sex_desc,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.DOB,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspyrdif(dob, adm_dt, 'age') as age,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspint(yrdif(dob, adm_dt, 'age')) as age_int<br/>&nbsp&nbsp&nbsp&nbspfrom<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp t._CB t1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp inner join <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp t._A_Cohort t2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp (t1.key_hsn = t2.key_hsn)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>proc means data=_D1 n nmiss mean std median qrange min max&#59<br/>&nbsp&nbsp&nbsp&nbspvar MEQ_daily_HospEpiSum&#59<br/>run&#59<br/>proc univariate data=_d1&#59<br/>&nbsp&nbsp&nbsp&nbspvar MEQ_daily_HospEpiSum&#59<br/>&nbsp&nbsp&nbsp&nbsphistogram MEQ_daily_HospEpiSum /normal&#59<br/>run&#59<br/><br/>data t._D_data4genmod&#59<br/>&nbsp&nbsp&nbsp&nbspset _D1&#59<br/>&nbsp&nbsp&nbsp&nbspHOU=0&#59<br/>&nbsp&nbsp&nbsp&nbspif MEQ_daily_HospEpiSum ge 5.6 then HOU=1&#59<br/>run&#59<br/><br/>%freq(data= t._D_data4genmod, table = HOU)&#59<br/>s///<br/>t///","children":[{"idx":"MY091747a8-b475-4065-a3e3-814167197adb","name":"E Statistic Analysis","children":[{"idx":"MY83dcee04-e8f5-4ecd-ae06-635b2e7e3aff","name":"details","children":[{"idx":"CodeTask-sf6aY8EQzc6AoI9h","name":"EA_Descriptives","NodeDescription":"///t<br/>///s<br/>/*EA descriptives*/<br/><br/>data _null_&#59run&#59<br/><br/>/*proc format*/<br/><br/>/*means of age, grouped by cancer yes/no*/<br/>proc means data=t._d_data4genmod n nmiss mean std median q1 q3 nway&#59<br/>&nbsp&nbsp&nbsp&nbspclass cancer&#59<br/>&nbsp&nbsp&nbsp&nbspvar age&#59<br/>&nbsp&nbsp&nbsp&nbspoutput out=_EA1a n=n mean=mean std=std median=median q1=q1 q3=q3 &#59<br/>run&#59<br/><br/>data _EA1&#59<br/>&nbsp&nbsp&nbsp&nbspset _EA1a&#59<br/>&nbsp&nbsp&nbsp&nbspVar='AGE'&#59<br/>&nbsp&nbsp&nbsp&nbspdrop _type_ _freq_&#59<br/>&nbsp&nbsp&nbsp&nbsp/*stamps*/<br/>&nbsp&nbsp&nbsp&nbspProjectPath=&_CLIENTPROJECTPATH&#59<br/>&nbsp&nbsp&nbsp&nbspProjectName= &_clientprojectname&#59<br/>&nbsp&nbsp&nbsp&nbspProgramName=&_clienttasklabel&#59<br/>&nbsp&nbsp&nbsp&nbspCreateDate =date()&#59<br/>&nbsp&nbsp&nbsp&nbspformat CreateDate date9.&#59<br/>run&#59<br/><br/>/*%let reportxls=F:\\ForSASUEdition\\SASUniversityEdition\\myfolders\\_Project1\\Results\\Reports\\Descriptive.xlsx&#59*/<br/>/*Export to excel*/<br/>proc export <br/>&nbsp&nbsp&nbsp&nbspdata=_EA1<br/>&nbsp&nbsp&nbsp&nbspoutfile=\"&reportxls\"<br/>&nbsp&nbsp&nbsp&nbspdbms= xlsx replace&#59<br/>&nbsp&nbsp&nbsp&nbspsheet=\"means\"&#59<br/>run&#59<br/><br/><br/>/*age group*/<br/>data _EA2a&#59<br/>&nbsp&nbsp&nbsp&nbspset t._d_data4genmod&#59<br/>&nbsp&nbsp&nbsp&nbspselect  &#59<br/>&nbsp&nbsp&nbsp&nbspwhen (0 <= age < 45 ) age_group = 1&#59<br/>&nbsp&nbsp&nbsp&nbspwhen (45 <= age < 65 ) age_group = 2&#59<br/>&nbsp&nbsp&nbsp&nbspwhen (65 <= age <= 70) age_group = 3&#59<br/>&nbsp&nbsp&nbsp&nbspwhen (age >= 70 ) age_group = 4&#59<br/>&nbsp&nbsp&nbsp&nbspotherwise age_group=9&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>run&#59<br/><br/><br/>/*<br/>https://www.lexjansen.com/nesug/nesug10/hw/hw04.pdf<br/>https://support.sas.com/resources/papers/proceedings/pdfs/sgf2008/264-2008.pdf<br/>*/<br/><br/>/*simplist*/<br/>proc tabulate data=_EA2a&#59<br/>&nbsp&nbsp&nbsp&nbspclass age_group cancer&#59<br/>&nbsp&nbsp&nbsp&nbsptables <br/>&nbsp&nbsp&nbsp&nbsp/*rows*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspage_group<br/>&nbsp&nbsp&nbsp&nbsp, <br/>&nbsp&nbsp&nbsp&nbsp/*cols*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>/*n and pct in two sections vertically*/<br/>proc tabulate data=_EA2a&#59<br/>&nbsp&nbsp&nbsp&nbspclass age_group&#59<br/>&nbsp&nbsp&nbsp&nbspclass cancer /descending &#59 /*columns in descending order*/<br/>&nbsp&nbsp&nbsp&nbsptables <br/>&nbsp&nbsp&nbsp&nbsp/*rows*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspage_group <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspage_group * pctn<age_group> /*'pctN to subtotal of the row in the current col',*/<br/>&nbsp&nbsp&nbsp&nbsp,<br/>&nbsp&nbsp&nbsp&nbsp/*cols*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>/*n and pct in two sections horizontally*/<br/>proc tabulate data=_EA2a&#59<br/>&nbsp&nbsp&nbsp&nbspclass age_group&#59<br/>&nbsp&nbsp&nbsp&nbspclass cancer /descending &#59 /*columns in descending order*/<br/>&nbsp&nbsp&nbsp&nbsptables <br/>&nbsp&nbsp&nbsp&nbsp/*rows*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspage_group<br/>&nbsp&nbsp&nbsp&nbsp,<br/>&nbsp&nbsp&nbsp&nbsp/*cols*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer * colpctn<cancer> /*'pctN to subtotal of the row in the current col',*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>/*add row and col total*/<br/>proc tabulate data=_EA2a&#59<br/>&nbsp&nbsp&nbsp&nbspclass age_group&#59<br/>&nbsp&nbsp&nbsp&nbspclass cancer /descending &#59 /*columns in descending order*/<br/>&nbsp&nbsp&nbsp&nbsptables <br/>&nbsp&nbsp&nbsp&nbsp/*rows*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspage_group<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall = 'row total'<br/>&nbsp&nbsp&nbsp&nbsp,<br/>&nbsp&nbsp&nbsp&nbsp/*cols*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall = 'col total'<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer * colpctn<cancer> /*'pctN to subtotal of the row in the current col',*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall * colpctn<all> /*pctN to subtotal of the row total in the current col*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>/*suppressing labels*/<br/>proc tabulate data=_EA2a&#59<br/>&nbsp&nbsp&nbsp&nbspclass age_group&#59<br/>&nbsp&nbsp&nbsp&nbspclass cancer /descending &#59 /*columns in descending order*/<br/>&nbsp&nbsp&nbsp&nbsptables <br/>&nbsp&nbsp&nbsp&nbsp/*rows*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspage_group<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall = 'row total'<br/>&nbsp&nbsp&nbsp&nbsp,<br/>&nbsp&nbsp&nbsp&nbsp/*cols*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer = ''<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall = 'col total'<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer * colpctn<cancer> /*'pctN to subtotal of the row in the current col',*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall * colpctn<all> /*pctN to subtotal of the row total in the current col*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>/*add a second grouping*/<br/>proc tabulate data=_EA2a&#59<br/>&nbsp&nbsp&nbsp&nbspclass age_group sex_desc&#59<br/>&nbsp&nbsp&nbsp&nbspclass cancer /descending &#59 /*columns in descending order*/<br/>&nbsp&nbsp&nbsp&nbsptables <br/>&nbsp&nbsp&nbsp&nbsp/*rows*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspage_group<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsex_desc<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall = 'row total'<br/>&nbsp&nbsp&nbsp&nbsp,<br/>&nbsp&nbsp&nbsp&nbsp/*cols*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer = ''<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall = 'col total'<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer * colpctn<cancer> /*'pctN to subtotal of the row in the current col',*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall * colpctn<all> /*pctN to subtotal of the row total in the current col*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>/*https://communities.sas.com/t5/ODS-and-Base-Reporting/ODS-excel-multiple-sheet/td-p/225377*/<br/><br/>ods excel file=\"&reportxls\"  options (sheet_name='table')&#59<br/>proc tabulate data=_EA2a&#59<br/>&nbsp&nbsp&nbsp&nbspclass age_group sex_desc&#59<br/>&nbsp&nbsp&nbsp&nbspclass cancer /descending &#59 /*columns in descending order*/<br/>&nbsp&nbsp&nbsp&nbsptables <br/>&nbsp&nbsp&nbsp&nbsp/*rows*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspage_group<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsex_desc<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall = 'row total'<br/>&nbsp&nbsp&nbsp&nbsp,<br/>&nbsp&nbsp&nbsp&nbsp/*cols*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer = ''<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall = 'col total'<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcancer * colpctn<cancer> /*'pctN to subtotal of the row in the current col',*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspall * colpctn<all> /*pctN to subtotal of the row total in the current col*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/>ods excel close&#59<br/><br/><br/>/*it is a bad solution, SAS!*/<br/><br/>proc freq data=_EA2a nlevels&#59<br/>&nbsp&nbsp&nbsp&nbsptables age_group * cancer /out=EA2b&#59<br/>run&#59<br/><br/>/*have to export again after the ods excel is done, as the previous export contents has been overwritten*/<br/>proc export <br/>&nbsp&nbsp&nbsp&nbspdata=_EA1<br/>&nbsp&nbsp&nbsp&nbspoutfile=\"&reportxls\"<br/>&nbsp&nbsp&nbsp&nbspdbms= xlsx replace&#59<br/>&nbsp&nbsp&nbsp&nbspsheet=\"means\"&#59<br/>run&#59<br/><br/>data _EA2&#59<br/>&nbsp&nbsp&nbsp&nbspset EA2b&#59<br/>&nbsp&nbsp&nbsp&nbsp/*stamps*/<br/>&nbsp&nbsp&nbsp&nbspProjectPath=&_CLIENTPROJECTPATH&#59<br/>&nbsp&nbsp&nbsp&nbspProjectName= &_clientprojectname&#59<br/>&nbsp&nbsp&nbsp&nbspProgramName=&_clienttasklabel&#59<br/>&nbsp&nbsp&nbsp&nbspCreateDate =date()&#59<br/>&nbsp&nbsp&nbsp&nbspformat CreateDate date9.&#59<br/>run&#59<br/><br/>proc export <br/>&nbsp&nbsp&nbsp&nbspdata=_EA2<br/>&nbsp&nbsp&nbsp&nbspoutfile=\"&reportxls\"<br/>&nbsp&nbsp&nbsp&nbspdbms= xlsx replace&#59<br/>&nbsp&nbsp&nbsp&nbspsheet=\"freq2\"&#59<br/>run&#59<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>s///<br/>t///","custparents":[{"idx":"CodeTask-75vyb4lmfkqegnDQ"}]},{"idx":"CodeTask-uzMlSD9Zdb87f5bi","name":"EB_Statistic Analysis","NodeDescription":"///t<br/>///s<br/>/*EB*/<br/>data _null_&#59run&#59<br/>%print(data=t._d_data4genmod)&#59<br/><br/>proc genmod data=t._d_data4genmod desc&#59<br/>/*&nbsp&nbsp&nbsp&nbspclass key_hsn&#59*/<br/>&nbsp&nbsp&nbsp&nbspclass CANCER(ref = '0') / param=ref&#59<br/>&nbsp&nbsp&nbsp&nbspmodel hou  = age CANCER /dist=binomial link=logit&#59<br/>&nbsp&nbsp&nbsp&nbspestimate \"Cancer yes vs no\" CANCER 1 /exp &#59<br/>/*&nbsp&nbsp&nbsp&nbsprepeated subject=key_hsn&#59*/<br/>run&#59<br/><br/>proc genmod data=t._d_data4genmod desc&#59<br/>/*&nbsp&nbsp&nbsp&nbspclass key_hsn&#59*/<br/>&nbsp&nbsp&nbsp&nbspclass CANCER(ref = '0')  key_hsn / param=ref &#59<br/>&nbsp&nbsp&nbsp&nbspmodel hou  = age CANCER /dist=binomial link=logit covb corrb &#59<br/>&nbsp&nbsp&nbsp&nbspestimate \"Cancer yes vs no\" CANCER 1 /exp &#59<br/>&nbsp&nbsp&nbsp&nbsprepeated subject=key_hsn /type=exch modelse printmle mcovb ecovb&#59<br/>run&#59<br/><br/>/*multicolinearity*/<br/>proc reg data=t._d_data4genmod&#59<br/>&nbsp&nbsp&nbsp&nbspmodel hou = age cancer /vif tol&#59<br/>run&#59<br/><br/>proc glm data=t._d_data4genmod&#59<br/>&nbsp&nbsp&nbsp&nbspclass cancer&#59<br/>&nbsp&nbsp&nbsp&nbspmodel hou = age cancer / tolerance&#59<br/>run&#59<br/><br/>/*outliers, etc*/<br/><br/>/*fitness of model*/<br/><br/>/*best working covariance structure*/<br/><br/>/*export results*/<br/><br/><br/>s///<br/>t///","custparents":[{"idx":"CodeTask-75vyb4lmfkqegnDQ"}]},{"idx":"CodeTask-jLjBuxBfnAFFNci6","name":"EC_Logistic Regression Time","NodeDescription":"///t<br/>///s<br/>/*EC linear regression MEQ vs time*/<br/>%print(data=t._d_data4genmod)&#59<br/><br/>/*normality*/<br/>proc univariate data=t._d_data4genmod&#59<br/>&nbsp&nbsp&nbsp&nbspvar MEQ_daily_HospEpiSum&#59<br/>&nbsp&nbsp&nbsp&nbsphistogram MEQ_daily_HospEpiSum /normal&#59<br/>run&#59<br/><br/>proc reg data=t._d_data4genmod&#59<br/>&nbsp&nbsp&nbsp&nbspmodel MEQ_daily_HospEpiSum = adm_dt&#59<br/>run&#59<br/>s///<br/>t///","custparents":[{"idx":"CodeTask-75vyb4lmfkqegnDQ"}]},{"idx":"CodeTask-EEEMuBtE1fRr9Jl3","name":"E_TimeSeries","NodeDescription":"///t<br/>///s<br/>/*Time series analysis*/<br/><br/>%print(data=t._cc)&#59<br/>/*http://support.sas.com/documentation/cdl/en/etsug/63939/HTML/default/etsug_autoreg_sect003.htm*/<br/>proc augoreg data=t._cc&#59<br/>run&#59<br/><br/><br/>s///<br/>t///","custparents":[{"idx":"CodeTask-HhvUncQKYDZwj4iN"}]}]}]},{"idx":"b0e29f8b-66c6-4695-a210-532a9cc7458d","name":"substeps","children":[{"idx":"c88aca0c-e65f-4139-b00b-51bbc137ecf3","name":"D1 Age","NodeDescription":"///t<br/>///s<br/><br/>%print(data&nbsp=&nbspt._A_COHORT)&#59<br/>PROC&nbspSQL&#59<br/>&nbsp&nbsp&nbsp&nbspcreate&nbsptable&nbsp_D1&nbspas&nbsp<br/>&nbsp&nbsp&nbsp&nbspselect&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*,&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.sex_desc,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.DOB,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspyrdif(dob,&nbspadm_dt,&nbsp'age')&nbspas&nbspage,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspint(yrdif(dob,&nbspadm_dt,&nbsp'age'))&nbspas&nbspage_int<br/>&nbsp&nbsp&nbsp&nbspfrom<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt._CB&nbspt1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinner&nbspjoin&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt._A_Cohort&nbspt2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(t1.key_hsn&nbsp=&nbspt2.key_hsn)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>proc&nbspmeans&nbspdata=_D1&nbspn&nbspnmiss&nbspmean&nbspstd&nbspmedian&nbspqrange&nbspmin&nbspmax&#59<br/>&nbsp&nbsp&nbsp&nbspvar&nbspMEQ_daily_HospEpiSum&#59<br/>run&#59&#59<br/>proc&nbspunivariate&nbspdata=_d1&#59<br/>&nbsp&nbsp&nbsp&nbspvar&nbspMEQ_daily_HospEpiSum&#59<br/>&nbsp&nbsp&nbsp&nbsphistogram&nbspMEQ_daily_HospEpiSum&nbsp/normal&#59<br/>run&#59<br/>s///<br/>t///","children":[{"idx":"05fea255-2023-49b5-8272-a74d2a6fb4e1","name":"D2 High Opioid Use","NodeDescription":"///t<br/>///s<br/>data&nbspt._D_data4genmod&#59<br/>&nbsp&nbsp&nbsp&nbspset&nbsp_D1&#59<br/>&nbsp&nbsp&nbsp&nbspHOU=0&#59<br/>&nbsp&nbsp&nbsp&nbspif&nbspMEQ_daily_HospEpiSum&nbspge&nbsp5.6&nbspthen&nbspHOU=1&#59<br/>run&#59<br/>s///<br/>t///"}],"custparents":[{"idx":"b0e29f8b-66c6-4695-a210-532a9cc7458d"}]}]}],"custparents":[{"idx":"CodeTask-VgcUCgSQDLNtmyvw"}]},{"idx":"MY158e073c-2fbb-46cf-aebc-f8344fddb929","name":"details","children":[{"idx":"CodeTask-gPrAtVdEa5sjlsAr","name":"CA_Opioid_Use in Hosp","NodeDescription":"///t<br/>///s<br/>/*Opioid use in hosp (regardless of length of stay)*/<br/><br/><br/>data _null_&#59run&#59<br/><br/>proc print data=t.data_pharm (obs=10)&#59<br/>run&#59<br/><br/>/*import from an xlsx file with drug MEQs*/<br/>/*%let MEQxlsx =F:\\ForSASUEdition\\SASUniversityEdition\\myfolders\\_Project1\\Documents\\opioidmeq.xlsx &#59*/<br/>proc import datafile=\"&MEQxlsx\"<br/>&nbsp&nbsp&nbsp&nbspDBMS = xlsx<br/>&nbsp&nbsp&nbsp&nbspout = s.opioidmeq<br/>&nbsp&nbsp&nbsp&nbspreplace&#59<br/>&nbsp&nbsp&nbsp&nbspgetnames=yes&#59<br/>&nbsp&nbsp&nbsp&nbspsheet=\"Sheet1\"&#59<br/>run&#59<br/><br/>/*alternatively*/<br/>libname _tmpxl clear&#59<br/>libname _tmpxl xlsx \"&meqxlsx\"&#59<br/><br/>data _CA1&#59<br/>&nbsp&nbsp&nbsp&nbspset _tmpxl.sheet1&#59<br/>run&#59<br/><br/>/*add MEQ_Strength, and MEQ into the claims*/<br/>proc print data=s.opioidmeq (obs=10)&#59run&#59<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _CA2 as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.meq_strength,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.RX_QTY_AMT * t2.meq_strength as MEQ<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt.data_pharm t1 left join s.opioidmeq t2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.din = t2.din&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>/*need a slide here*/<br/>/*link pharm to hospital<br/>&nbsp&nbsp&nbsp&nbsplots of thinking about this distinct<br/>&nbsp&nbsp&nbsp&nbspthe data_hosp may have multiple records with the same radm and rdschg dates<br/>&nbsp&nbsp&nbsp&nbspfor which the pharm claim falling into the hosp range should only be accounted for once<br/>*/<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _CA3 as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.adm_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.dschg_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.CANCER,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.hospepi_rec<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_CA2 t1 inner join t._BC t2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.key_hsn = t2.key_hsn&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.serve_date ge t2.adm_dt <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.serve_date lt t2.dschg_dt<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>/*sum of MEQ by hosp episode*/<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table t._CA as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadm_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdschg_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCANCER,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphospepi_rec, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsum(MEQ) as MEQ_HospEpiSum<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_CA3&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspgroup by key_hsn, adm_dt, dschg_dt, CANCER, hospepi_rec<br/>&nbsp&nbsp&nbsp&nbsporder by adm_dt, dschg_dt, CANCER, hospepi_rec<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>/*but the length of hosp is not accounted for*/<br/><br/>/*https://communities.sas.com/t5/SAS-Programming/Age-standardized-prevalence-SAS-code/td-p/509598*/<br/><br/><br/>s///<br/>t///","children":[],"custparents":[{"idx":"CodeTask-o378WS71yD9qk8Kx"}]},{"idx":"CodeTask-VgcUCgSQDLNtmyvw","name":"CB_Opioid_daily use in Hosp","NodeDescription":"///t<br/>///s<br/>/*CB_ DAILY Use*/<br/><br/>data _null_&#59run&#59<br/><br/>/*add MEQ_Strength, and MEQ into the claims*/<br/>proc print data=s.opioidmeq (obs=10)&#59run&#59<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _CB2 as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.meq_strength,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.RX_QTY_AMT * t2.meq_strength as MEQ<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt.data_pharm t1 left join s.opioidmeq t2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.din = t2.din&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>/*need a slide here*/<br/>/*link pharm to hospital<br/>&nbsp&nbsp&nbsp&nbsplots of thinking about this distinct<br/>&nbsp&nbsp&nbsp&nbspthe data_hosp may have multiple records with the same radm and rdschg dates<br/>&nbsp&nbsp&nbsp&nbspfor which the pharm claim falling into the hosp range should only be accounted for once<br/>*/<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _CB3 as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.adm_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.dschg_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.CANCER,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.hospepi_rec<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_CB2 t1 inner join t._BC t2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.key_hsn = t2.key_hsn&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.serve_date ge t2.adm_dt <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.serve_date lt t2.dschg_dt<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/>/*taking into accound the length of stay*/<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _CB4 (drop=MEQ) as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadm_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdschg_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCANCER,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphospepi_rec, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspMEQ/(dschg_dt - adm_dt +1) as MEQ_Daily<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_CB3&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspgroup by key_hsn, adm_dt, dschg_dt, CANCER, hospepi_rec<br/>&nbsp&nbsp&nbsp&nbsporder by adm_dt, dschg_dt, CANCER, hospepi_rec<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/>/*sum of daily MEQ by hosp episode*/<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table t._CB as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadm_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdschg_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCANCER,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphospepi_rec, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsum(MEQ_Daily) as MEQ_daily_HospEpiSum<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_CB4&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspgroup by key_hsn, adm_dt, dschg_dt, CANCER, hospepi_rec<br/>&nbsp&nbsp&nbsp&nbsporder by adm_dt, dschg_dt, CANCER, hospepi_rec<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/><br/>/*https://communities.sas.com/t5/SAS-Programming/Age-standardized-prevalence-SAS-code/td-p/509598*/<br/><br/><br/>s///<br/>t///","children":[],"custparents":[{"idx":"CodeTask-gPrAtVdEa5sjlsAr"}]},{"idx":"CodeTask-HhvUncQKYDZwj4iN","name":"CC_Std Rates","NodeDescription":"///t<br/>///s<br/>%print(data=t._ca)&#59<br/>%print(data=t._A_Cohort)&#59<br/><br/>/*attach age/sex*/<br/>Proc SQL&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _CC1 as<br/>&nbsp&nbsp&nbsp&nbspselect<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.sex_desc, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspint(yrdif(t2.dob, t1.adm_dt, 'age')) as age_adm<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt._ca t1 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinner join <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt._A_cohort t2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(t1.Key_hsn = t2.key_hsn)<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>Quit&#59<br/><br/>/*change to age categories*/<br/>data _CC2&#59<br/>&nbsp&nbsp&nbsp&nbspset _CC1&#59<br/>&nbsp&nbsp&nbsp&nbsplength age_grp $8.&#59<br/>&nbsp&nbsp&nbsp&nbspselect &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspwhen (age_adm < 40)  age_grp = ' 0-39'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspwhen (40 < =age_adm < 65)  age_grp = '40-64'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspwhen (age_adm >= 65)  age_grp = '65+'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspotherwise age_grp='Wrong'&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspPersonDay=(dschg_dt - adm_dt +1)&#59<br/>run&#59<br/><br/>/*make a standard population*/<br/>Proc SQL&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _CC3 as<br/>&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsex_desc,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspage_grp,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsum(PersonDay) as PersonDay,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsum(MEQ_HospEpiSum) as MEQ_HospEpiSum,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'std' as PopGroup<br/>&nbsp&nbsp&nbsp&nbspfrom _cc2<br/>&nbsp&nbsp&nbsp&nbspgroup by age_grp, sex_desc<br/>&nbsp&nbsp&nbsp&nbsporder by age_grp, sex_desc&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>Quit&#59<br/><br/>/*the source data*/<br/>Proc SQL&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _CC4 as<br/>&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsex_desc,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspage_grp,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadm_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsum(PersonDay) as PersonDay,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsum(MEQ_HospEpiSum) as MEQ_HospEpiSum,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'day' as PopGroup<br/>&nbsp&nbsp&nbsp&nbspfrom _cc2<br/>&nbsp&nbsp&nbsp&nbspgroup by adm_dt, age_grp, sex_desc<br/>&nbsp&nbsp&nbsp&nbsporder by adm_dt, age_grp, sex_desc&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>Quit&#59<br/><br/><br/><br/>/*select a day from the source data*/<br/>data _cc5&#59<br/>&nbsp&nbsp&nbsp&nbspset _cc4&#59<br/>&nbsp&nbsp&nbsp&nbspby adm_dt&#59<br/>&nbsp&nbsp&nbsp&nbspif first.adm_dt then dayN+1&#59<br/>run&#59<br/><br/>/*get the last record*/<br/>data _cc6&#59<br/>&nbsp&nbsp&nbsp&nbspset _cc5 end=last&#59<br/>&nbsp&nbsp&nbsp&nbspif last&#59<br/>run&#59<br/>data _null_&#59<br/>&nbsp&nbsp&nbsp&nbspset _cc6&#59<br/>&nbsp&nbsp&nbsp&nbspcall symput('lastN', dayN)&#59<br/>run&#59<br/>%let lastN=&lastN&#59<br/>%put >>> &lastN&#59<br/><br/>/*make a unique list of dayN and adm_dt*/<br/>proc sort data=_cc5 out=_cc7 nodupkey&#59<br/>&nbsp&nbsp&nbsp&nbspby adm_dt dayN&#59<br/>run&#59<br/><br/>%macro getStdRates(debug=)&#59<br/>&nbsp&nbsp&nbsp&nbsp%local debug&#59<br/>&nbsp&nbsp&nbsp&nbsp/*create an empty set (latter to append std rates from each day )*/<br/>&nbsp&nbsp&nbsp&nbspdata _tmp0&#59 delete&#59run&#59<br/>/*&lastN&#59*/<br/>&nbsp&nbsp&nbsp&nbsp%do i = 11 %to &lastN&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset _cc5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif dayN = &i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp/*attach the data in _tmp1 into the stand pop (_cc3)*/<br/>&nbsp&nbsp&nbsp&nbspProc SQL&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcreate table _tmp2 as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.SEX_DESC,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.age_grp,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.adm_dt,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.PersonDay,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.MEQ_HospEpiSum,<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspifn(t2.PersonDay=., 0, t2.PersonDay) as PersonDay,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspifn(t2.MEQ_HospEpiSum =., 0, t2.MEQ_HospEpiSum) as MEQ_HospEpiSum,*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspifc(t2.PopGroup='', 'day', t2.PopGroup) as PopGroup,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.dayN,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.PersonDay as PopPersonDay<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_CC3 t1 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinner join <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_tmp1 t2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(t1.age_grp = t2.age_grp and t1.sex_desc = t2.sex_desc)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporder by adm_dt desc<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspQuit&#59<br/>&nbsp&nbsp&nbsp&nbsp/* in the ref (std pop), exclude the stratum if it is not in _tmp2*/<br/>&nbsp&nbsp&nbsp&nbspProc SQL&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcreate table _tmp3 as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_CC3 t1 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinner join <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_tmp2 t2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(t1.age_grp = t2.age_grp and t1.sex_desc = t2.sex_desc)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporder by adm_dt desc<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspQuit&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp/*make standardized population<br/>&nbsp&nbsp&nbsp&nbsphttp://support.sas.com/documentation/cdl/en/statug/68162/HTML/default/viewer.htm#statug_stdrate_examples01.htm<br/>&nbsp&nbsp&nbsp&nbsp*/<br/><br/>&nbsp&nbsp&nbsp&nbsp/*ods graphics on&#59*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspods results off&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspods select none&#59*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc stdrate data=_tmp2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp             refdata=_tmp3<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp             method=direct<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp             stat=rate(mult=1)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp             effect<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp             plots(only)=(dist effect)&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp             &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   population group=popgroup event=MEQ_HospEpiSum total=PersonDay&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   reference  total=PersonDay&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   strata Sex_desc age_grp /  effect missing  &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   ods output StdRate = _tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspods select all&#59*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspods results on&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*ods graphics off&#59*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset _tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep StdRate lowerCL UpperCL dayN&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdayN=&i&#59&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata _tmp0&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset _tmp0 _tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspproc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete _tmp1 - _tmp5&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*add back the adm_date*/<br/>&nbsp&nbsp&nbsp&nbspPROC SQL&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcreate table t._CC (drop=dayN) as<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.adm_dt<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfrom<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_tmp0 t1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinner join<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_cc7 t2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(t1.dayN = t2.dayN)&#59<br/>&nbsp&nbsp&nbsp&nbspQUIT&#59<br/><br/>&nbsp&nbsp&nbsp&nbspproc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdelete _tmp0&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/><br/>%mend&#59<br/>%getStdRates&#59<br/><br/><br/><br/><br/>s///<br/>t///","children":[],"custparents":[{"idx":"CodeTask-gPrAtVdEa5sjlsAr"}]}]}]},{"idx":"MYc4b846f0-ac13-45eb-8cd4-bd1ca182e7ad","name":"details","children":[{"idx":"CodeTask-7x3AyQ4KseDLl6p1","name":"BA_Hosp_age","NodeDescription":"///t<br/>///s<br/>/*age at adm*/<br/><br/>data _null_&#59run&#59<br/><br/>/*using wizard*/<br/>proc print data=t._a_cohort (obs=10)&#59<br/>run&#59<br/><br/>/*%macro print (data=)&#59*/<br/>/*&nbsp&nbsp&nbsp&nbsp%let srcdata=t._a_cohort&#59*/<br/>/*&nbsp&nbsp&nbsp&nbsp%local data&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspproc print data=&data (obs=10)&#59*/<br/>/*&nbsp&nbsp&nbsp&nbsprun&#59*/<br/>/*%mend print&#59*/<br/>%print(data=t._a_cohort)&#59<br/><br/><br/>/*select records from data_hosp for indivduals in cohort*/<br/>PROC SQL&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _ba1 as<br/>&nbsp&nbsp&nbsp&nbspselect<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*, t2.dob<br/>&nbsp&nbsp&nbsp&nbspfrom<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt.data_hosp t1 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspinner join <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt._a_cohort t2<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspon <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(t1.key_hsn = t2.key_hsn)<br/><br/>&#59<br/>quit&#59 run&#59<br/><br/>proc sort data=t._a_cohort&#59by key_hsn&#59 run&#59<br/>proc sort data=t.data_hosp&#59by key_hsn&#59  run&#59<br/>data _ba1a&#59<br/>&nbsp&nbsp&nbsp&nbspmerge <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt._a_cohort (in= inA)  <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt.data_hosp (in=inB)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59 <br/>&nbsp&nbsp&nbsp&nbspby key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbspif inA=1 and inB=1&#59<br/>run&#59<br/> <br/>%compAB(a=_ba1, b=_ba1a, target=test, vars=cihi_rec)&#59<br/><br/>/*exclusion age < 18*/<br/>data _ba2&#59<br/>&nbsp&nbsp&nbsp&nbspset _ba1&#59<br/>/*&nbsp&nbsp&nbsp&nbspAge_at_adm = yrdif(dob, adm_date, 'age')&#59*/<br/>&nbsp&nbsp&nbsp&nbspAge_at_adm = yrdif(dob, datepart(adm_date), 'age')&#59<br/>&nbsp&nbsp&nbsp&nbspAge_at_adm_int = int(Age_at_adm)&#59<br/>run&#59<br/><br/>data t._bA&#59<br/>&nbsp&nbsp&nbsp&nbspset _ba2&#59<br/>&nbsp&nbsp&nbsp&nbspwhere Age_at_adm_int ge 18&#59<br/>run&#59<br/><br/>proc univariate data=t._ba&#59<br/>&nbsp&nbsp&nbsp&nbspvar Age_at_adm_int&#59<br/>&nbsp&nbsp&nbsp&nbsphistogram Age_at_adm_int &#59<br/>run&#59<br/><br/>s///<br/>t///","children":[],"custparents":[{"idx":"CodeTask-wHaoQvjsf2a7IddP"}]},{"idx":"CodeTask-5UXMbfXdHF3dQbSh","name":"BB_Hosp_CleanOverlap","NodeDescription":"///t<br/>///s<br/>/*BB_Hosp_Clean*/<br/>data _null_&#59run&#59<br/><br/>/*line up hospitalizations*/<br/>/*1. sort by personid adm_date dischg_date*/<br/>proc sort data=t._bA&#59<br/>&nbsp&nbsp&nbsp&nbspby /*inst_num*/ key_hsn adm_date dschg_date&#59<br/>run&#59<br/><br/><br/>/*2. extend the &startD if it overlaps with the previous one<br/>for details, see remarks in macro backup0301<br/>&nbsp&nbsp&nbsp&nbspafter this step, both the eff/dschg_dates are redefined*/<br/>data _bb1&#59<br/>&nbsp&nbsp&nbsp&nbspset _bA&#59<br/>&nbsp&nbsp&nbsp&nbspby /*inst_num*/ key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbspif first.key_hsn then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspradm_date = adm_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprdschg_date =dschg_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspretain radm_date rdschg_date&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif adm_date - rdschg_date <= 1 then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif dschg_date > rdschg_date then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprdschg_date = dschg_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspradm_date = adm_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprdschg_date = dschg_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspend &#59<br/>&nbsp&nbsp&nbsp&nbspformat radm_date rdschg_date datetime20.&#59<br/>run&#59<br/><br/>/*3. keep the last record which contains the longest period between reff and rdschg_dates*/<br/>data _bb2&#59<br/>&nbsp&nbsp&nbsp&nbspset _bb1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby /*inst_num*/ key_hsn radm_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif last.radm_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep /*inst_num*/ key_hsn adm_date dschg_date radm_date rdschg_date&#59 <br/>run&#59<br/><br/>/*4.  for each record in bb1, use the rdschg_date in bb2 as the final dschg_date (fdschg_date)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspin bb1 (all records, with some redefined for the dschg_date), match the &studyID, &HN, radm_date in bb2, and get rdschg_date in bb2 as Fdschg_date*/<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _bb3 as <br/>&nbsp&nbsp&nbsp&nbspselect<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*, t2.rdschg_date as Fdschg_date<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_bb1 t1<br/>&nbsp&nbsp&nbsp&nbspleft join<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_bb2 t2<br/>&nbsp&nbsp&nbsp&nbspon <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.key_hsn = t2.key_hsn<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.radm_date = t2.radm_date<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsporder by <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn, radm_date, fdschg_date, adm_date, dschg_date<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59<br/><br/><br/>/*5. drop the original eff/exp/rdschg_date, replace with the radm_date, and fdschg_date*/<br/>data t._bb&#59<br/>&nbsp&nbsp&nbsp&nbspset _bb3&#59<br/>&nbsp&nbsp&nbsp&nbspdrop rdschg_date&#59<br/>&nbsp&nbsp&nbsp&nbsprename fdschg_date = rdschg_date&#59<br/>run&#59<br/><br/><br/>/*<br/>the new cleanH macro realign each record and for those overlapping records, redefine the event start and end date.<br/>None of the records is deleted, though. This is because the records may have different dx info. <br/>If there are two records overlap, both event start/end dates are extended to include the whole period. The two records<br/>will have same start/end date&#59 but there will still be 2 records with different diagnosis info. <br/><br/>example:%cleanHNew(data=tc2, target=test, MaxGap=1, incldHN=1, keep=, inst_num=, keepTMP=1, startD=, endD=)&#59<br/>*/<br/><br/>%macro cleanHNew(data=, target=, MaxGap=, incldHN=, keep=,inst_num=, keepTMP=, startD=, endD=, studyID=, debug=)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%local data target   MaxGap    incldHN HN keepinst_num keepTMP startD endD StudyID debug&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*by default, set startD = adm_date, endD=dschg_date,inst_num=&inst_num<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthis is because ed data has different name for adm/dschg_date, and for inst_num*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&startD)=0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let startD=adm_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&EndD)=0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let EndD=dschg_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&inst_num)=0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%letinst_num=hosp_num&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&StudyID)=0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let StudyID=Key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> startD=&startD, endD=&endD,inst_num=&inst_num&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if %length(&MaxGap)=0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let MaxGap=1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*by default, incldHN is set to 1, force to separate hospitalizations from different hosptials into different records&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &incldHN=0 or %length(&incldHN) =0 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let HN=&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%else %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let HN=&inst_num&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> HNterm = &HN&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%put >>> MaxGap= &MaxGap days&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*1. sort by &studyID adm_date dischg_date*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sort(source=&data, target=cleanHNew_tmp1, sorter=%str(&HN &studyID &startD &EndD))&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*2. extend the &startD if it overlaps with the previous one<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor details, see remarks in macro backup0301<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspafter this step, both the eff/dschg_dates are redefined*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%selectdata<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=cleanHNew_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=cleanHNew_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselection = %str&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby &HN &studyID&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif first.&studyID then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspradm_date = &startD&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprdschg_date = &EndD&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspretain radm_date rdschg_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif &startD - rdschg_date <= &MaxGap then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif &EndD > rdschg_date then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprdschg_date = &EndD&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspradm_date = &startD&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprdschg_date = &EndD&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspformat radm_date rdschg_date date9.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*3. keep the last record which contains the longest period between reff and rdschg_dates*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%selectdata<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource = cleanHNew_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=cleanHNew_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselection = %str<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspby &hn &studyID radm_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif last.radm_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep &studyID &hn &startD &endD radm_date rdschg_date&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*4.  for each record in tmp2, use the rdschg_date in tmp3 as the final dschg_date (fdschg_date)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspin tmp2 (all records, with some redefined for the dschg_date), match the &studyID, &HN, radm_date in tmp3, and get rdschg_date in tmp3 as Fdschg_date*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1=cleanHNew_tmp2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2=cleanHNew_tmp3,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=cleanHNew_tmp4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, t2.rdschg_date as Fdschg_date),<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspjvars=&studyID radm_date &hn,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsporderby=%str(&studyID, radm_date, fdschg_date, &startD, &endD)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*5. drop the original eff/exp/rdschg_date, replace with the radm_date, and fdschg_date*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata &target&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset cleanHNew_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdrop rdschg_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprename fdschg_date = rdschg_date&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%if &keepTMP ne 1 and &debug ne 1 %then %do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%deldata(source=cleanHNew_tmp1 cleanHNew_tmp2 cleanHNew_tmp3 cleanHNew_tmp4)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%end&#59<br/>%mend cleanHNew&#59<br/>s///<br/>t///","children":[],"custparents":[{"idx":"CodeTask-7x3AyQ4KseDLl6p1"}]},{"idx":"CodeTask-o378WS71yD9qk8Kx","name":"BC_Cancer dx","NodeDescription":"///t<br/>///s<br/>/*BC cancer dx*/<br/><br/>data _null_&#59run&#59<br/><br/>/*a list of cancer diagnosis*/<br/><br/>/* %print(data=t._bb)&#59 */<br/>proc print data=t._bb (obs=10)&#59<br/>run&#59<br/>/*1. indicate if the hosp record has cancer diagnosis*/<br/>data _BC1&#59<br/>&nbsp&nbsp&nbsp&nbspset t._BB&#59<br/>&nbsp&nbsp&nbsp&nbsparray dxs {25} dx_code_1 - dx_code_25&#59<br/>&nbsp&nbsp&nbsp&nbspdo i = 1 to 25&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif substr(dxs(i), 1, 3) ge 'C00' and substr(dxs[i], 1, 3) le 'C49'<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand substr(dxs{i}, 1, 3) ne 'C44' then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdx=dxs[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspp=i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspleave&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn radm_date&#59<br/>run&#59<br/>/*alternatively....*/<br/>data _BC1a&#59<br/>&nbsp&nbsp&nbsp&nbspset t._BB&#59<br/>&nbsp&nbsp&nbsp&nbsparray dxs {25} dx_code_1 - dx_code_25&#59<br/>&nbsp&nbsp&nbsp&nbspdo i = 1 to 25&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif dxs(i) ge: 'C00' and dxs(i) le: 'C49'<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspand dxs(i) not in  ('C44')  then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdx=dxs[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspp=i&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspleave&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn radm_date&#59<br/>run&#59<br/><br/>%compab(a=_bc1, b=_bc1a, target=test, vars=key_hsn radm_date)&#59<br/><br/>/*sort and have the earliest radm_date, which is the earliest cancer dx date*/<br/>proc sort data=_BC1&#59<br/>&nbsp&nbsp&nbsp&nbspby key_hsn radm_date&#59<br/>run&#59<br/>data _BC2&#59<br/>&nbsp&nbsp&nbsp&nbspset _BC1&#59<br/>&nbsp&nbsp&nbsp&nbspby key_hsn radm_date&#59<br/>&nbsp&nbsp&nbsp&nbspif first.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbsprename radm_date = CA_DxDate&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn CA_DxDate&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn radm_date&#59<br/>run&#59<br/><br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _BC3 as <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspselect <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspifn(&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.CA_DxDate ne . and <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdatepart(t2.CA_DxDate) between datepart(t1.radm_date) and datepart(t1.rdschg_date)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdatepart(t2.CA_DxDate) < datepart(radm_date)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp1, 0<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp) as CANCER, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspifn(&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.CA_DxDate ne . and <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdatepart(t2.CA_DxDate) between datepart(t1.radm_date) and datepart(t1.rdschg_date)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdatepart(t2.CA_DxDate) < datepart(radm_date)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.CA_DxDate, .<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)  format datetime20. as CA_DxDate<br/>&nbsp&nbsp&nbsp&nbspfrom t._BB t1 left join _BC2 t2 on<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(t1.key_hsn = t2.key_hsn)<br/>&nbsp&nbsp&nbsp&nbsporder by key_hsn, radm_date, rdschg_date<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>quit&#59run&#59<br/><br/>/*from above select the unique records*/<br/>proc sql&#59<br/>&nbsp&nbsp&nbsp&nbspcreate table _BC4 as <br/>&nbsp&nbsp&nbsp&nbspselect distinct<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn, datepart(radm_date) format date9. as adm_dt, datepart(rdschg_date)  format date9. as dschg_dt, CANCER, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDatepart(CA_DxDate) format date9. as CA_Dxdt<br/>&nbsp&nbsp&nbsp&nbspfrom <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp_BC3<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>/*add an episode number*/<br/>data t._BC&#59<br/>&nbsp&nbsp&nbsp&nbspset _BC4&#59<br/>&nbsp&nbsp&nbsp&nbspHospEpi_Rec = _n_&#59<br/>run&#59<br/><br/><br/><br/><br/>s///<br/>t///","children":[],"custparents":[{"idx":"CodeTask-5UXMbfXdHF3dQbSh"}]}]}]}],"custparents":[{"idx":"CodeTask-NpTms4UYZ7t4qnsp"}]}],"custparents":[{"idx":"CodeTask-4z55DclN4F1tX8Wi"}]}],"custparents":[{"idx":"CodeTask-d4P1yji32TLBQlxg"},{"idx":"ProjectCollection-oSbbJmNbuyopFfxD"}]}]}]