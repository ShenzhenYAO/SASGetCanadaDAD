{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8","name":"PilotV910_20191218","type":"PROJECT","children":[{"idx":"CodeTask-klBgI7NRLnI7fn3L","name":"Download package","type":"TASK","NodeDescription":"<iframe class=\"ql-video\" frameborder=\"0\" allowfullscreen=\"true\" src=\"https://www.youtube.com/embed/EXL1lgmy7tQ?showinfo=0\" data-blot-formatter-unclickable-bound=\"true\"></iframe><p><br></p><p><br></p><p>///t</p><p>///s</p><p>/*Download pacakge*/</p><p><br></p><p>/*</p><p>1. The SQRP (Sentinel query routine package) were downloaded from</p><p>https://dev.sentinelsystem.org/projects/AD/repos/qrp/browse</p><p>It is constantly updating. As of today 2019-12-18, the most recent version is package 9.1.0.</p><p><br></p><p>2. The sample databases were downloaded from</p><p>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_datasets/browse</p><p>*/</p><p><br></p><p>/*Download these packages, and save into the project folder</p><p>P:\\cdmpilot9_v1\\projectfolder</p><p>in which the subfolders are:</p><p>-docs</p><p>-dplocal</p><p>-inputfiles</p><p>-msoc</p><p>-sasprograms</p><p><br></p><p>Addtionally, the sample databases will be put in</p><p>-indata</p><p>*/</p><p>s///</p><p>t///</p>","children":[{"idx":"CodeTask-1nO5AOhrm37TWv37","name":"TheSRQ Analysis list","type":"TASK","NodeDescription":"<iframe class=\"ql-video\" frameborder=\"0\" allowfullscreen=\"true\" src=\"https://www.youtube.com/embed/dIr2qS1ytxE?showinfo=0\" data-blot-formatter-unclickable-bound=\"true\"></iframe><p><br></p><p><br></p><p>///t</p><p>///s</p><p>/*</p><p>A list of Sentinel Routine Querying Moduels and COHORT IDENTIFICATION AND DESCRIPTIVE ANALYSIS (CIDA) MODULEs </p><p>can be found at </p><p>https://dev.sentinelsystem.org/projects/SENTINEL/repos/sentinel-routine-querying-tool-documentation/browse</p><p><br></p><p>*/</p><p>s///</p><p>t///</p>","children":[{"idx":"CodeTask-2EWZUgWyk7dvfLe9","name":"Local Settings","type":"TASK","NodeDescription":"<p>///t</p><p>///s</p><p>/*local settings*/</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let mymacros=S:\\Collaborative_researchers\\Shenzhen\\My Project\\Projects\\DoNotDelete Common Macros\\MyMacros.sas;</div><div class=\"ql-code-block\">%include \"&amp;mymacros\" /LRECL=32767;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let localDatapath =P:/cdmpilot9_v1/projectfolder/indata;</div><div class=\"ql-code-block\">libname locald \"&amp;localDatapath\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let inputfiles =P:/cdmpilot9_v1/projectfolder/inputfiles;</div><div class=\"ql-code-block\">libname infiles \"&amp;inputfiles\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*the path to hold real data of SK*/</div><div class=\"ql-code-block\">%let localSKDatapath =P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\NewVersion_Shenzhen_Since20191219\\data;</div><div class=\"ql-code-block\">libname localSKd \"&amp;localSKDatapath\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let datastartdate='01Jan1996'd;</div><div class=\"ql-code-block\">%let dataenddate='31dec2018'd;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*for local*/</div><div class=\"ql-code-block\">%let theNGSfile = localskd.NGS_FSC_SK;</div><div class=\"ql-code-block\">/*for local*/</div><div class=\"ql-code-block\">%let theEncTypeFile = localskd.Enctype;</div><div class=\"ql-code-block\">/*for local*/</div><div class=\"ql-code-block\">%let theFacLocFile = localskd.fac_loc;</div><div class=\"ql-code-block\">/*for local*/</div><div class=\"ql-code-block\">%let theDiagMapFile=localskd.SK_ZDIAG_TO_ICD9;</div></div><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"CodeTask-O5XVQeecDfZh8Tsa","name":"Remote Settings","type":"TASK","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%include \"/sasdata/hisc/shared_data/HQC_share/DoNotDelete New Cohort Common Tools/tools_ncc.sas\" /LRECL=32767;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let remotedatapath =/sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/data_9618;</div><div class=\"ql-code-block\">libname remoted \"&amp;remotedatapath\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let remoteoldData = /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/data;</div><div class=\"ql-code-block\">libname rOldD \"&amp;remoteoldData\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let remoteoldDoc = /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document;</div><div class=\"ql-code-block\">libname rOldDoc \"&amp;remoteoldDoc\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*define raw files</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;These can be found in NCC</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;prog 'remote settings' and prog 'b_remote...'</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">%global</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ThisEGPPath </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;exchangeDir Rexchange dp_benefitFile dp_nonbenefitFile dp_specFile ed_a2012File ed_b2012File</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;hospitalFile MSBFile MSB_DFile MSB_DocInfoFile PHRS_InfoFile PHRS_CovFile PHRS_RSDCFile PHRS_ArrvFile</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PHRS_ResiFile PHRS_Resi_cleanFile PHRS_retrFile VerfMortFile MDS_LTC_File AnalyticalReport DataReport alldinfile</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;MortDateVar MortFile_vital MortFile_PHRS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ThisProjectType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;CleanHospFile CleanDINFile CleanMortVitalFile CleanMortPHRSFile</div><div class=\"ql-code-block\">;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let datastartdate='01Jan1996'd;</div><div class=\"ql-code-block\">%let dataenddate='31dec2018'd;</div><div class=\"ql-code-block\">%let clean19 =/sasdata/hisc/shared_data/HQC_share/Clean/2019 Data/Clean files ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let Xtrc_Start_MSB ='31MAR1997'd;</div><div class=\"ql-code-block\">%let Xtrc_End_MSB = '08Oct2019'd;</div><div class=\"ql-code-block\">%let Xtrc_End_ED_A2012 = '30SEP2019'd;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;Xtrc_Start_DP_Ben*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;Xtrc_End_DP_Ben*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;Xtrc_Start_DP_NBen*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;Xtrc_End_DP_NBen*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">libname clean19 \"&amp;clean19\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let Xtrc_End_Cover = '01Oct2019'd;</div><div class=\"ql-code-block\">%let PHRS_CovFile = hqc.phrs_pers_prog;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let PHRS_InfoFile = hqc.phrs_pers_info;</div><div class=\"ql-code-block\">%let PHRS_Resi_cleanFile=clean19.phrs_pers_resc_1_ond18_06feb2019;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let VerfMortFile = clean19.PHRS_DTHS_1_JFM19_16DEC2019;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let dp_benefitFile = hqc.dp_claim;</div><div class=\"ql-code-block\">%let dp_nonbenefitFile = hqc.DP_CLAIM_NON_BEN;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let MSBFile = hqc.msb_billing;</div><div class=\"ql-code-block\">%let hospitalFile = clean19.cihi_eoc_1_jfm19_21nov2019;</div><div class=\"ql-code-block\">%let ed_a2012File = hqc.ED_F_2012;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*for remote*/</div><div class=\"ql-code-block\">%let theNGSfile = rOldDoc.NGS_FSC_SK;</div><div class=\"ql-code-block\">/*for remote*/</div><div class=\"ql-code-block\">%let theEncTypeFile = rOldDoc.Enctype;</div><div class=\"ql-code-block\">/*for remote*/</div><div class=\"ql-code-block\">%let theFacLocFile = rOldDoc.fac_loc;</div><div class=\"ql-code-block\">/*for remote*/</div><div class=\"ql-code-block\">%let theDiagMapFile=rOldDoc.SK_ZDIAG_TO_ICD9;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*include the raw file extracing macros*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_CIHI.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_MSB.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_Drug.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/demog_assign.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_Drug_non_ben_test.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/Addquotes.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/reformat_datevars.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%include '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_Drug_non_ben_test.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%include '/SAS_data/dw0/HQC_share/Xinya/Macros/GEO_INCQTL_assign.sas' /LRECL=32767;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*the following is for calculating the Charlson-elixer score*/</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_share/Clean/library_dw0.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_MSB.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD9_E_CH_dxtype.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD9_E_EX_dxtype.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD10_CH_dxtype.sas' /LRECL=32767; </div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD10_EX_dxtype.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/ExpandLst.sas' /LRECL=32767;</div><div class=\"ql-code-block\">/*%include '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/VarExist.sas' /LRECL=32767;*/</div><div class=\"ql-code-block\">%include '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/IsEmptyDS.sas' /LRECL=32767;</div></div><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"CodeTask-2EWZUgWyk7dvfLe9"}]},{"idx":"CodeTask-SbMLkku5hRGuVfGb","name":"Prepare  the input setting files","type":"TASK","NodeDescription":"<iframe class=\"ql-video\" frameborder=\"0\" allowfullscreen=\"true\" src=\"https://www.youtube.com/embed/5zxBupqcFuA?showinfo=0\" data-blot-formatter-unclickable-bound=\"true\"></iframe><p><br></p><p><br></p><p>///t</p><p>///s</p><p>/*Preparing files required for type1 analysis</p><p><br></p><p>*/</p><p>data _null_;run;</p><p><br></p><p>/*1. in the inputfile folder, prepare a dataset called montioringfile</p><p>&nbsp;&nbsp;&nbsp;&nbsp;the data set contains 3 cols:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;periodid, startdate, enddate </p><p>&nbsp;&nbsp;&nbsp;&nbsp;it seems that the enrol date of the sample files is from 2008 to 2010. Therefore here</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the pilot will take the segment from the middle</p><p>*/</p><p><br></p><p>/*The start date col should be named startdate, NOT startfollowup, This is different from wenbin's file*/</p><p><br></p><p>data infiles.monitoringfile;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;format periodid 8. startdate date9. enddate date9.;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;periodid=1;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;startdate='01jan2008'd;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enddate='30jun2010'd;</p><p>run;</p><p><br></p><p>/*create a file (cohortfile) to define cohorts</p><p>&nbsp;&nbsp;&nbsp;&nbsp;the description of the fields can be found at:</p><p>&nbsp;&nbsp;&nbsp;&nbsp;https://dev.sentinelsystem.org/projects/SENTINEL/repos/sentinel-routine-querying-tool-documentation/browse/files/file526-typeall-cohortfile.md</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;in wenbin's file, the col was named 'group'. This is wrong. It should be named cohortgrp. </p><p>*/</p><p><br></p><p>data infiles.cohortfile;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;format </p><p>&nbsp;&nbsp;&nbsp;&nbsp;cohortgrp&nbsp;&nbsp;&nbsp;&nbsp;$40.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;coverage&nbsp;&nbsp;&nbsp;&nbsp;$2.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrolgap&nbsp;&nbsp;&nbsp;&nbsp;8.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrdays&nbsp;&nbsp;&nbsp;&nbsp;8.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;type1&nbsp;&nbsp;&nbsp;&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;type2&nbsp;&nbsp;&nbsp;&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;type3&nbsp;&nbsp;&nbsp;&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;type4&nbsp;&nbsp;&nbsp;&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;type5&nbsp;&nbsp;&nbsp;&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrdaysaft&nbsp;&nbsp;&nbsp;&nbsp;8.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;chartres&nbsp;&nbsp;&nbsp;&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;sex&nbsp;&nbsp;&nbsp;&nbsp;$3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;race&nbsp;&nbsp;&nbsp;&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;hispanic&nbsp;&nbsp;&nbsp;&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;race_out&nbsp;&nbsp;&nbsp;&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;hispanic_out&nbsp;&nbsp;&nbsp;&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;agestrat&nbsp;&nbsp;&nbsp;&nbsp;$100.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;geog&nbsp;&nbsp;&nbsp;&nbsp;$50.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;/*in this pilot, several groups will be established to test the different settings</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Briefly, the criteria include: </p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1) coverage for medical insurance/drug plans (M/D/MD),&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2) allowed gap days between insurance covreage periods</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3) minimal days of continuous insurance coverage </p><p>&nbsp;&nbsp;&nbsp;&nbsp;*/</p><p>&nbsp;&nbsp;&nbsp;&nbsp;type1='Y';&nbsp;&nbsp;&nbsp;&nbsp;type2='N'; type3='N';&nbsp;&nbsp;&nbsp;&nbsp;type4='N'; type5='N';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;chartres='N';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;race_out='N';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;hispanic_out='N';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;agestrat='00-09 10-19 20-44 45-64 65-74 75+';</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;cohortgrp='G1_MD7360';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;coverage='M';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrolgap=7;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrdays = 360;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;output;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;cohortgrp='G2_M7360';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;coverage='M';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrolgap=7;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrdays = 360;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;output;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;cohortgrp='G3_MD30360';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;coverage='MD';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrolgap=30;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrdays = 360;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;output;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;cohortgrp='G4_MD7180';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;coverage='MD';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrolgap=7;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;enrdays = 180;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;output;</p><p>run;</p><p><br></p><p>/*prepare a cohortcodesfile, which contains diagnostic codes to make cases</p><p>The required vars in the file can be found at :</p><p>https://dev.sentinelsystem.org/projects/SENTINEL/repos/sentinel-routine-querying-tool-documentation/browse/files/file590-typeall-cohortcodes.md</p><p>*/</p><p>/*list out the drug codes (NDC) in the dispensing file*/</p><p>%freq(data=locald.dispensing_1 noprint , table=ndc, option=%str(out = _tmp1));</p><p>%sort(data=_tmp1, sorter=%str(descending count));</p><p>/*keep the top ten ndc (drug code) from the dispensing file*/</p><p>data _tmp2;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set _tmp1 (obs=10);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;keep ndc;</p><p>run;</p><p><br></p><p>/*make a cross join between the drug code list, and the cohort file*/</p><p>%print(data=infiles.cohortfile);</p><p>%sqljoinv2(</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t1=infiles.cohortfile,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t2=_tmp2,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;target=_tmp3,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.cohortgrp as group, t2.ndc as code),</p><p>&nbsp;&nbsp;&nbsp;&nbsp;jtype=cross</p><p>);</p><p>/*make a pseudo code (Guess it is for all codes)*/</p><p>data _tmp4;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set infiles.cohortfile;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;keep cohortgrp code;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;rename cohortgrp = group;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;code='99999999999';</p><p>run;</p><p>/*merge the above 2*/</p><p>data _tmp5;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set _tmp3 _tmp4;</p><p>run;</p><p><br></p><p><br></p><p><br></p><p>data infiles.cohortcodesfile;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;format</p><p>&nbsp;&nbsp;&nbsp;&nbsp;group $40.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;code $11.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;stockgroup $30.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;codetype $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;codecat $2.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;caresettingprincipal $41.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t1_index $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t2_index $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t2_fup $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t3_index $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t3_fup $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t4_index $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t4_fup $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t5_index $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t6_index $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;conc_fup $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;rawlabdatetype $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;rawlabresult $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;codesupply 8.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;excludesupply $1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;productapprovaldate Date9. productmarketingdate Date9. otherproductdate Date9.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;rawlabdatetype $3. rawlabresult $3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set _tmp5;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;if code = '99999999999' then do;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stockgroup='';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;codetype=11;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;end;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;else do;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stockgroup='Med';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;codetype=11;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;end;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;codecat = 'RX';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t1_index = 'DEF';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t2_index = 'NOT';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t3_index = 'NOT';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t4_index = 'NOT';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t5_index = 'NOT';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t6_index = 'NOT';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t2_fup = 'NOT';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t3_fup = 'NOT';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t4_fup = 'NOT';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;conc_fup = 'NOT';</p><p>run;</p><p><br></p><p><br></p><p>/*Make the type1file*/</p><p><br></p><p>data _tmp1;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set infiles.cohortfile;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;keep cohortgrp;rename cohortgrp = group;</p><p>run;</p><p><br></p><p>data infiles.Type1File;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;format </p><p>&nbsp;&nbsp;&nbsp;&nbsp;group $30.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t1cohortdef $2.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t1washper 8.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;censor_dth $1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;censor_output $1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;censor_dpend $1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;censor_qryend $1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set _tmp1;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t1cohortdef=1;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;t1washper =360;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;if _n_=4 then t1washper=180;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;censor_dth='Y';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;censor_output = 'Y';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;censor_dpend = 'Y';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;censor_qryend = 'N';</p><p>run;</p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"CodeTask-pypwaJWDu1aXADlD","name":"Define project , using SK Data same as Prepare the input setting files","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*The following is a copy of <br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\01_create_inputfiles_PS1.sas<br/>*/<br/><br/>%INCLUDE '/SAS_data/dw0/HQC_share/Clean/library_dw0.sas'&#59<br/><br/>%let MSProjID = soc&#59<br/>%let MSWPType = qar&#59<br/>%let MSWPID   = wp001&#59<br/>%let MSDPID   = pilot1&#59<br/>%let MSVerID  = v01&#59<br/>%let dlm = _ &#59<br/><br/>%let MSReqID = &MSProjID.&dlm.&MSWPType.&dlm.&MSWPID.&dlm.&MSDPID.&dlm.&MSVerID &#59<br/>/* Request-Id parameter value must be lower case */<br/>%let MSReqID = %lowcase(&MSReqID) &#59<br/>%put &MSReqID &#59<br/><br/>%LET _root= /SAS_data/dw0/HQC_share/Project_CNODES_CDM/&#59 <br/><br/>/* Define Request Specific Subdirectories */<br/>%let MSOC = &_root./&MSReqID./msoc/ &#59<br/>%let INFOLDER = &_root./&MSReqID./inputfiles/ &#59<br/><br/>/* Assign libnames */<br/>libname ps1 \"&INFOLDER.\" &#59<br/>libname data \"&MSOC.\" &#59<br/><br/>*----------------------------*<br/>&nbsp&nbsp&nbsp&nbspCreate Monitoring File<br/>*----------------------------*&#59<br/><br/>DATA PS1.P1MonitoringFile&#59<br/>&nbsp&nbsp&nbsp&nbsplength periodid 8&#59<br/>&nbsp&nbsp&nbsp&nbsplength startfollowup 8&#59<br/>&nbsp&nbsp&nbsp&nbsplength enddate 8&#59<br/><br/>&nbsp&nbsp&nbsp&nbspperiodid = 1&#59<br/><br/>&nbsp&nbsp&nbsp&nbspstartfollowup = '01jan2015'd&#59<br/>&nbsp&nbsp&nbsp&nbspenddate = '31dec2017'd&#59<br/><br/>&nbsp&nbsp&nbsp&nbspformat startfollowup enddate date9.&#59<br/>RUN&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   *----------------------------------------------------*<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspStudy Groups<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   *----------------------------------------------------*&#59<br/><br/>**********************************************************************************************<br/>*   Each combination of drug of interest and washout period must be its own group&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   &nbsp&nbsp&nbsp&nbsp *<br/>*&nbsp&nbsp&nbsp&nbsp(ex. Alprolix_90 is Alprolix with a washout period of 90 days&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp *<br/>*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp *<br/>*&nbsp&nbsp&nbsp&nbspAll of the groups are incident with respect to the drug of interest AND all other drugs  *<br/>*&nbsp&nbsp&nbsp&nbspconsidered in the study&nbsp&nbsp&nbsp&nbsp(i.e. new users cannot be current users of any other statin &nbsp&nbsp&nbsp&nbsp *<br/>*&nbsp&nbsp&nbsp&nbspconsidered.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp *<br/>*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp *<br/>*&nbsp&nbsp&nbsp&nbsp34 drugs x 2 washout periods = 66 groups&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp *<br/>*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp *<br/>*&nbsp&nbsp&nbsp&nbspNames of groups are put into macro variables to be made into arrays and then looped      *<br/>*&nbsp&nbsp&nbsp&nbspthrough to create group records&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp     *<br/>**********************************************************************************************&#59<br/><br/><br/>%let groups = ('Alprolix_90' 'Alprolix_180' 'Carbaglu_90' 'Carbaglu_180' 'Cosentyx_90' 'Cosentyx_180' 'Cyramza_90' 'Cyramza_180' 'Daklinza_90' <br/>'Daklinza_180' 'Dapagliflozin_Metformin_90' 'Dapagliflozin_Metformin_180' 'Dymista_90' 'Dymista_180' 'Egrifta_90' 'Egrifta_180' <br/>'Entresto_90' 'Entresto_180' 'Entyvio_90' 'Entyvio_180' 'Ferriprox_90' 'Ferriprox_180' 'Fetzima_90' 'Fetzima_180' 'Forxiga_90' <br/>'Forxiga_180' 'Gardasil_90' 'Gardasil_180' 'Holkira_Pak_90' 'Holkira_Pak_180' 'Iclusig_90' 'Iclusig_180' 'Jardiance_90' <br/>'Jardiance_180' 'Keytruda_90' 'Keytruda_180' 'Movantik_90' 'Movantik_180' 'Opdivo_90' 'Opdivo_180' 'Peginterferon_Alfa_2b_90' <br/>'Peginterferon_Alfa_2b_180' 'Pheburane_90' 'Pheburane_180' 'Plegridy_90' 'Plegridy_180' 'Prolensa_90' 'Prolensa_180' 'Repatha_90' <br/>'Repatha_180' 'Revestive_90' 'Revestive_180' 'Rosiver_90' 'Rosiver_180' 'Secukinumab_Recombinant_90' 'Secukinumab_Recombinant_180'<br/>'Sodium_Phenyl_90' 'Sodium_Phenyl_180'<br/>'Strensiq_90' 'Strensiq_180' 'Sylvant_90' 'Sylvant_180' 'Zydelig_90' 'Zydelig_180' 'Zykadia_90' 'Zykadia_180')&#59<br/><br/><br/>DATA PS1.P1CohortFile&#59<br/>&nbsp&nbsp&nbsp&nbsplength group $ 30&#59 <br/>&nbsp&nbsp&nbsp&nbsplength coverage $ 2&#59<br/>&nbsp&nbsp&nbsp&nbsplength enrolgap 8&#59<br/>&nbsp&nbsp&nbsp&nbsplength enrdays 8&#59<br/>&nbsp&nbsp&nbsp&nbsplength type1 $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength type2 $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength type3 $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength type4 $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength type5 $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength enrdaysaft 8&#59<br/>&nbsp&nbsp&nbsp&nbsplength chartres $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength sex $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength race $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength hispanic $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength race_out $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength hispanic_out $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength agestrat $100&#59<br/>&nbsp&nbsp&nbsp&nbsplength geog $50&#59&nbsp&nbsp&nbsp&nbsp<br/><br/>&nbsp&nbsp&nbsp&nbspcoverage = 'MD'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspenrolgap = 45&#59<br/><br/>&nbsp&nbsp&nbsp&nbsptype1 = 'Y'&#59<br/><br/>&nbsp&nbsp&nbsp&nbsptype2 = 'N'&#59<br/><br/>&nbsp&nbsp&nbsp&nbsptype3 = 'N'&#59<br/><br/>&nbsp&nbsp&nbsp&nbsptype4 = 'N'&#59<br/><br/>&nbsp&nbsp&nbsp&nbsptype5 = 'N'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcall missing(enrdaysaft)&#59<br/><br/>&nbsp&nbsp&nbsp&nbspchartres = 'N'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcall missing(sex)&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcall missing(race)&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcall missing(hispanic)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsprace_out = 'N'&#59<br/><br/>&nbsp&nbsp&nbsp&nbsphispanic_out = 'N'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspagestrat = '00-09 10-19 20-44 45-64 65-74 75+'&#59<br/><br/>&nbsp&nbsp&nbsp&nbsparray groups {66} $30 g1-g66 &groups&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdo i = 1 to 66&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroup = groups[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*** Check the last 3 characters of a group name to assign the correct washout period&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif substr(group,length(group)-2,3) = '_90' then enrdays = 90&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse if substr(group,length(group)-2,3) = '180' then enrdays = 180&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdrop g1-g66 i&#59<br/>RUN&#59<br/><br/>*----------------------------*<br/>   Create Cohort Codes File<br/>*----------------------------*&#59<br/><br/>*import PILOT1_DIN_LIST&#59<br/>/*data PS1.PILOT1_DIN_LIST&#59*/<br/>/*  set PILOT1_DIN_LIST&#59*/<br/>/*   _din = put(din,z8.)&#59*/<br/>/*   run&#59*/<br/><br/>proc sql&#59<br/>  create table brand_name_list as<br/>  select distinct brand_name from PS1.PILOT1_DIN_LIST&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>  create table check_1 as<br/>  select distinct din from PS1.PILOT1_DIN_LIST&#59<br/>quit&#59&nbsp&nbsp&nbsp&nbsp/*59*/&#59<br/><br/>proc sql&#59<br/>  create table DP_DRG as<br/>  select distinct DRG_NAME, DIN from hqc.DP_DRUG<br/>  where DRG_NAME in (select brand_name from brand_name_list)&#59<br/>  quit&#59<br/>/* All brand_name are existed in DP_DRUG */<br/><br/>proc sql&#59<br/>  create table DINs_specific as<br/>  select DRG_NAME as brand_name length=11, DIN as _din from DP_DRG<br/>  where DIN not in (select distinct _din from PS1.PILOT1_DIN_LIST)&#59<br/>  quit&#59<br/>/*CARBAGLU&nbsp&nbsp&nbsp&nbsp00951056*/<br/><br/>*import QUANTITY_DAYSSUPL_ON&#59<br/>data  PS1.NME_QUANTITY_DAYSSUPL_RATIO_ON&#59 <br/>   set NME_QUANTITY_DAYSSUPL_RATIO_ON&#59<br/>       _din = put(din,z8.)&#59<br/>run&#59<br/><br/>*import QUANTITY_DAYSSUPL_MB&#59<br/>data  PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB&#59 <br/>   set NME_QUANTITY_DAYSUPPL_RATIO_MB&#59<br/>       _din = put(din,z8.)&#59<br/>run&#59<br/><br/>proc sql&#59<br/>  create table DIN_MB as<br/>  select distinct _din from PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB&#59<br/>quit&#59&nbsp&nbsp&nbsp&nbsp/*19*/&#59<br/><br/>proc sql&#59<br/>  create table DIN_ON as<br/>  select distinct _din from PS1.NME_QUANTITY_DAYSSUPL_RATIO_ON&#59<br/>quit&#59/*16*/&#59<br/><br/>proc sql&#59<br/>  create table check_1 as<br/>  select distinct a._din from PS1.NME_QUANTITY_DAYSSUPL_RATIO_ON a, PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB b<br/>  where a._din = b._din&#59<br/>quit&#59/*11*/&#59<br/><br/>proc sql&#59<br/>  create table check_2 as<br/>  select distinct din from PS1.NME_QUANTITY_DAYSSUPL_RATIO_ON <br/>  where din not in (select distinct din from PS1.PILOT1_DIN_LIST)&#59<br/>quit&#59&nbsp&nbsp&nbsp&nbsp/* '09857548' */&#59<br/><br/>proc sql&#59<br/>  create table check_3 as<br/>  select DRG_NAME as brand_name length=11, DIN as _din from DP_DRG<br/>  where DIN ='09857548'&#59<br/>  quit&#59 /* 0 */&#59<br/><br/>data PILOT1_DIN_LIST&#59<br/>   set PS1.PILOT1_DIN_LIST(keep= brand_name _din)<br/>       DINs_specific&#59<br/>run&#59<br/><br/>*** Import drug codes using XLSX SAS engine&#59<br/>DATA DrugCodes&#59<br/>&nbsp&nbsp&nbsp&nbsplength group      $30&#59<br/>&nbsp&nbsp&nbsp&nbsplength code       $11&#59<br/>&nbsp&nbsp&nbsp&nbsplength stockgroup $30&#59<br/>&nbsp&nbsp&nbsp&nbsplength codetype   $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength codecat    $2&#59<br/>&nbsp&nbsp&nbsp&nbsplength caresettingprincipal $30&#59<br/>&nbsp&nbsp&nbsp&nbsplength t1_index $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t2_index $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t2_fup $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t3_index $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t3_fup $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t4_index $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t4_fup $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t5_index $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength rawlabdatetype $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength rawlabresult $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength codesupply 8&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp*** Drug codes are import from a spreadsheet&#59<br/>&nbsp&nbsp&nbsp&nbspset PILOT1_DIN_LIST&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp*** As some drug names have underscores in them, I replace the spaces in the stockgroup names<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspso they can be compared to group names below&#59<br/>&nbsp&nbsp&nbsp&nbspstockgrouptemp = tranwrd(trim(left(propcase(brand_name))), ' ', '_')&#59<br/><br/>&nbsp&nbsp&nbsp&nbspstockgroup = tranwrd(stockgrouptemp, '-', '_')&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcode = _din&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcodetype = '10'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcodecat = 'RX'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspt1_index = 'DEF'&#59<br/>&nbsp&nbsp&nbsp&nbspt2_index = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt2_fup = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt3_index = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt3_fup = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt4_index = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt4_fup = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt5_index = 'NOT'&#59<br/><br/>&nbsp&nbsp&nbsp&nbsparray groups {66} $30 h1-h66 &groups&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdo i = 1 to 66&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*** Unlike pilot studies 2 and 3, each group is only incident with respect to the drug of interest<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspso only needs to be associated with those DINs&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif substr(groups[i],1,6) = substr(stockgroup,1,6) then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroup = groups[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdrop brand_name _din h1-h66 i stockgrouptemp&#59<br/>RUN&#59<br/><br/>*----------------------------------------------------*<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp Note on Dummy 11 Digit Codes<br/>*----------------------------------------------------*&#59<br/><br/>**************************************************************<br/>*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp     *<br/>*  CIDA is expecting 11 digit drug codes and wasn't picking  * <br/>*  up 8 digit ones when I ran this study the first time.     *<br/>*  I asked Libby Dee from Sentinel about it and she said     *<br/>*  to include dummy 11 digit codes.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp     *<br/>*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp     *<br/>**************************************************************&#59<br/><br/>*** Add dummy 11 digit codes&#59<br/>DATA DrugcodesDummy&#59<br/>&nbsp&nbsp&nbsp&nbsplength group      $30&#59<br/>&nbsp&nbsp&nbsp&nbsplength code       $11&#59<br/>&nbsp&nbsp&nbsp&nbsplength stockgroup $30&#59<br/>&nbsp&nbsp&nbsp&nbsplength codetype   $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength codecat    $2&#59<br/>&nbsp&nbsp&nbsp&nbsplength caresettingprincipal $30&#59<br/>&nbsp&nbsp&nbsp&nbsplength t1_index $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t2_index $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t2_fup $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t3_index $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t3_fup $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t4_index $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t4_fup $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength t5_index $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength rawlabdatetype $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength rawlabresult $3&#59<br/>&nbsp&nbsp&nbsp&nbsplength codesupply 8&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcodetype = '11'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcodecat = 'RX'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcode = '99999999999'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspt1_index = 'DEF'&#59<br/>&nbsp&nbsp&nbsp&nbspt2_index = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt2_fup = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt3_index = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt3_fup = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt4_index = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt4_fup = 'NOT'&#59<br/>&nbsp&nbsp&nbsp&nbspt5_index = 'NOT'&#59<br/><br/>&nbsp&nbsp&nbsp&nbsparray groups {66} $30 h1-h66 &groups&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdo i = 1 to 66&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroup = groups[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdrop h1-h66 i&#59<br/>RUN&#59<br/><br/>DATA PS1.P1CohortCodesFile&#59<br/>&nbsp&nbsp&nbsp&nbspset DrugCodes DrugcodesDummy&#59<br/>RUN&#59<br/><br/>PROC SORT data=PS1.P1CohortCodesFile&#59<br/>&nbsp&nbsp&nbsp&nbspby group stockgroup&#59<br/>RUN&#59<br/><br/><br/>*-----------------*<br/>&nbsp&nbsp&nbsp&nbspType 1 file<br/>*-----------------*&#59<br/><br/>DATA PS1.P1Type1File&#59<br/>&nbsp&nbsp&nbsp&nbsplength group $30&#59<br/>&nbsp&nbsp&nbsp&nbsplength t1cohortdef $2&#59<br/>&nbsp&nbsp&nbsp&nbsplength t1washper 8&#59<br/>&nbsp&nbsp&nbsp&nbsplength censor_dth $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength censor_output $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength censor_dpend $1&#59<br/>&nbsp&nbsp&nbsp&nbsplength censor_qryend $1&#59 <br/><br/>&nbsp&nbsp&nbsp&nbspt1cohortdef = '01'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcensor_dth = 'Y'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcensor_output = 'Y'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcensor_dpend = 'Y'&#59<br/><br/>&nbsp&nbsp&nbsp&nbspcensor_qryend = 'N'&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp*** Generate groups&#59<br/>&nbsp&nbsp&nbsp&nbsparray groups {66} $30 h1-h66 &groups&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdo i = 1 to 66&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspgroup = groups[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp*** Assign appropriate washout period&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif index(group,'90') > 0 then t1washper = 90&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse if index(group, '180') > 0 then t1washper = 180&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>&nbsp&nbsp&nbsp&nbspdrop h1-h66 i&#59<br/>RUN&#59<br/><br/><br/>/* SK Site Specific */<br/>%INCLUDE '/SAS_data/dw0/HQC_share/Clean/library_dw0.sas'&#59<br/><br/>%let indata=/SAS_data/dw0/HQC_share/Project_CNODES_CDM/data/&#59<br/>libname indata \"&indata.\"&#59<br/><br/>proc sql&#59<br/>   create table dispensing as<br/>   select * from indata.dispensing<br/>   where NDC in (select _din from PILOT1_DIN_LIST)&#59<br/>quit&#59<br/><br/>/* take the highest frequency of DIN's quant_dayssupl_ratio as an estimate */<br/>proc sort data=PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB&#59<br/>by brand_name _din descending quant_freq_percent&#59<br/>run&#59 <br/><br/>data NME_QUANTITY_DAYSSUPL_RATIO_MB&#59<br/>    set PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB&#59<br/>&nbsp&nbsp&nbsp&nbspby brand_name _din descending quant_freq_percent&#59<br/>&nbsp&nbsp&nbsp&nbspif first._din&#59<br/>run&#59 /* 19 */<br/><br/>proc sql&#59<br/>  select count(distinct _din) from NME_QUANTITY_DAYSSUPL_RATIO_MB&#59<br/>  quit&#59 /*19*/<br/><br/>proc sql&#59<br/>  select count(distinct _din) from PILOT1_DIN_LIST&#59<br/>  quit&#59 /* 60 */<br/><br/>proc sql&#59<br/>  select count(distinct _din) from PILOT1_DIN_LIST<br/>   where _din in (select _din from PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB)&#59<br/>  quit&#59 /* 19 */<br/><br/>proc sql&#59<br/>   create table dispensing_1 as<br/>   select a.quant_dayssupl_ratio, b.*<br/>   from NME_QUANTITY_DAYSSUPL_RATIO_MB a, dispensing b<br/>   where a._din = b.NDC&#59<br/>quit&#59 /* n= 100685 */<br/><br/>/* if not in the ON DIN List then give i to  quant_dayssupl_ratio as an estimate */<br/>proc sql&#59<br/>   create table dispensing_2 as<br/>   select *, 1 as quant_dayssupl_ratio<br/>   from dispensing <br/>   where NDC not in (select _din from NME_QUANTITY_DAYSSUPL_RATIO_MB)&#59<br/>quit&#59 /* n=2036 */<br/><br/>data dispensing_11(drop=quant_dayssupl_ratio)&#59<br/>   set dispensing_1&#59<br/>   RxSup = RxAmt/quant_dayssupl_ratio&#59<br/>run&#59<br/><br/>data dispensing_21(drop=quant_dayssupl_ratio)&#59<br/>   set dispensing_2&#59<br/>   RxSup = RxAmt/quant_dayssupl_ratio&#59<br/>run&#59<br/><br/>data indata.dispensing_NME&#59<br/>   set dispensing_11<br/>       dispensing_21<br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/><br/>proc sql&#59<br/>  select count(distinct NDC) from indata.dispensing_NME&#59<br/>  quit&#59 /* 30 */<br/><br/>proc sql&#59<br/>  create table check_0 as <br/>  select distinct _din from INFOLDER.NME_QUANTITY_DAYSSUPL_RATIO_MB &#59<br/>  quit&#59 /* 19 */<br/><br/><br/>proc sql&#59<br/>  create table check_1 as <br/>  select distinct NDC from indata.dispensing_NME<br/>  where NDC not in (select distinct _din from INFOLDER.PILOT1_DIN_LIST) &#59<br/>  quit&#59 /* 0 */<br/><br/><br/>proc sql&#59<br/>  create table check_2 as <br/>  select distinct NDC from indata.dispensing_NME<br/>  where NDC not in (select distinct _din from INFOLDER.NME_QUANTITY_DAYSSUPL_RATIO_MB) &#59<br/>  quit&#59 /* 13 */<br/><br/>proc sql&#59<br/>  create table check_3 as <br/>  select distinct NDC from indata.dispensing_NME<br/>  where NDC  in (select distinct _din from INFOLDER.NME_QUANTITY_DAYSSUPL_RATIO_MB) &#59<br/>  quit&#59 /* 17 */<br/><br/>/*<br/>1: CARBAGLU&nbsp&nbsp&nbsp&nbsp00951056 Specific in DRUG DP <br/><br/>2: 19 out of 60 DINs had dayssupl information from NME_QUANTITY_DAYSSUPL_RATIO_MB<br/><br/>3: 98% percent dispensation for those 19 DINs and the rest assigned 1 as dayssup<br/><br/>*/<br/><br/><br/>proc sql&#59<br/>  create table dispensing_1 as <br/>  select * from indata.dispensing_NME<br/>  where NDC  in (select distinct _din from INFOLDER.NME_QUANTITY_DAYSSUPL_RATIO_MB) &#59<br/>  quit&#59 /*  */<br/><br/>/* top ten frequency of RxAmt in SK */<br/>proc sort data=dispensing_1&#59<br/>by ndc&#59<br/>run&#59<br/><br/>proc freq data=dispensing_1 order=freq &#59<br/>by ndc&#59<br/>tables RxAmt / list nocum out=RxAmt_out&#59<br/>run&#59<br/><br/>proc sort data=RxAmt_out&#59<br/>by ndc descending percent&#59<br/>run&#59<br/><br/>data RxAmt_out_1&#59<br/>   i=0&#59<br/>   do until(last.ndc)&#59<br/>   set RxAmt_out&#59<br/>   by ndc descending percent&#59<br/>   i+1&#59<br/>   if i <=10 then output&#59<br/>   end&#59<br/>run&#59<br/><br/>proc sort data=INFOLDER.NME_QUANTITY_DAYSSUPL_RATIO_MB out=check_4&#59<br/>by _din descending quant_freq_percent&#59<br/>run&#59<br/><br/>s///<br/>t///","custparents":[{"idx":"CodeTask-SbMLkku5hRGuVfGb"}]},{"idx":"CodeTask-UlOwqL8TSObw5ez1","name":"run_programs","type":"TASK","custparents":[{"idx":"CodeTask-SbMLkku5hRGuVfGb"}]},{"idx":"CodeTask-LFiLD7PBdQhaJFLl","name":"qrp_master_header","type":"TASK","custparents":[{"idx":"CodeTask-SbMLkku5hRGuVfGb"}]}],"custparents":[{"idx":"CodeTask-2EWZUgWyk7dvfLe9"}]}],"custparents":[{"idx":"CodeTask-1nO5AOhrm37TWv37"}]}],"custparents":[{"idx":"CodeTask-klBgI7NRLnI7fn3L"}]}]},{"idx":"CodeTask-NrDC6oJNN34iBg5x","name":"getData from Webin","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*<br/>Creating SK Data<br/>The following was copied from <br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part00.sas<br/>*/<br/><br/>/******<br/>Program name: CNODES CDM         Date: 2017-08-01<br/>stored @ dw0/HQC_share/CNODES CDM/code<br/>Author: Wenbin<br/>Description:  Sentinel Tables Creation<br/>Study: CDM pilot project<br/>Principal Investigator: Dr. Gary Teare <br/>Input data:<br/>Output data:<br/>Variable generated:<br/>External files:<br/>*******/<br/><br/>/*proc datasets lib=temp  nolist kill&#59 quit&#59 run&#59*/<br/><br/>/****************************************************/<br/>/* Using PHRS_PERS_INFO */<br/>/***************************************************/<br/><br/>%INCLUDE '/SAS_data/dw0/HQC_share/Clean/library_dw0.sas'&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/reformat_datevars.sas'&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/coverage_days.sas'&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_CIHI.sas'&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_MSB.sas'&#59<br/><br/>libname temp '/SAS_data/dw0/HQC_share/Project_CNODES_CDM/temporary'&#59<br/>libname cdm '/SAS_data/dw0/HQC_share/Project_CNODES_CDM/data'&#59<br/>libname doc '/SAS_data/dw0/HQC_share/Project_CNODES_CDM/document'&#59<br/><br/>/* Based on team discusion on August 15, 2017 */<br/>%let DRUG_INITIAL_DATE = '01APR1996'd &#59<br/><br/>/* The Latest Xtrc_date */<br/>%let XTRC_DATE = '02JUL2017'd &#59   /* report_start: 07DEC1994&nbsp&nbsp&nbsp&nbspreport_end: 02JUL2017 */<br/>%let _cls = datepart(xtrc_date)=&XTRC_DATE&#59<br/><br/>%let extract_start&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= '01APR1996'd&#59<br/>%let extract_end &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= '31MAR2017'd&#59<br/><br/><br/>/* Import NGS Categories and EncType mapping(NGS Categories_Codes and Descriptions_Subset for AV_DS_SO_18Dec2017)*/<br/>data DOC.EncType&#59<br/>  length NGS_CATEGORY $3&#59<br/>  set work.enctype_0000&#59<br/>  NGS_CATEGORY=substr(DESCRIPTION,1,3)&#59<br/>run&#59<br/><br/>proc sql&#59<br/>  select count(distinct NGS_CATEGORY) from DOC.ngs_fsc_sk&#59<br/>quit&#59 /* 121 */<br/><br/>proc sql&#59<br/>  select count(distinct NGS_CATEGORY) from DOC.EncType&#59<br/>quit&#59 /* 58 */<br/><br/>proc sql&#59&#59<br/>   create table test as <br/>   select distinct NGS_CATEGORY from DOC.EncType<br/>   where NGS_CATEGORY not in (select distinct NGS_CATEGORY from DOC.ngs_fsc_sk)&#59<br/>   quit&#59 /* 0 */<br/><br/>libname tmp '/SAS_data/dw0/HQC_share/Wenbin/LIMPAC/tmp'&#59 <br/><br/>data msb_2&#59<br/>   set tmp.msb&#59<br/>   if MODE='Z' then delete &#59 /* Out of Province Reciprocal Billing */<br/>run&#59<br/><br/>proc sql&#59&#59<br/>   create table FSC_List as <br/>   select distinct fsc from msb_2&#59<br/>   quit&#59 /* 3882 */<br/><br/>proc sql&#59&#59<br/>   select count(distinct fsc) from DOC.ngs_fsc_sk&#59<br/>   quit&#59 /* 4077 */<br/><br/>proc sql&#59&#59<br/>   create table FSC_List_spec as <br/>   select distinct fsc from FSC_List<br/>   where fsc not in (select distinct fsc from DOC.ngs_fsc_sk)&#59<br/>   quit&#59 /* 46 */<br/><br/>/* Temporary created the following files */<br/>/* SCDM: 4.1 Encounter Table*/<br/>%Extract_MSB(<br/>   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp=&nbsp&nbsp&nbsp&nbsp cdm.msb,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp'31MAR1997'd,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt&nbsp&nbsp&nbsp&nbsp &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp'11APR2017'd,<br/>               &nbsp&nbsp&nbsp&nbspdostart&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp&extract_start,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp    dosend&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp&extract_end,<br/>                kept_vars               =   KEY_HSN KEY_DOC_NUM SPEC MG DIAG FSC NUM_SRV DOS LOS CONTACTS AMT_APP MODE<br/>)&#59<br/><br/>/*  Hospital */<br/>%let hosp_file          = clean17.CIHI_EOC_2_OND16_23MAY2017&#59<br/> %Extract_CIHI(ds_in            = &hosp_file,<br/>               ds_out           = cdm.hosp, <br/>               dchg_start_date  = &extract_start,&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>               adms_end_date    = &extract_end,<br/>               ICD_field_list   = ,<br/>               ICD9_list        = ,<br/>               ICD9_excl_exact_list =,<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   ICD10_list       = <br/>&nbsp&nbsp&nbsp&nbsp            )&#59<br/><br/><br/><br/><br/>/* Modification */<br/>data temp.Encounter_hosp&#59<br/>   length DRG_Type $4&#59<br/>   set temp.Encounter_hosp&#59<br/>   DRG_Type = ''&#59<br/>run&#59<br/><br/>temp.Encounter_msb<br/><br/>temp.DIAGNOSIS_MSB<br/><br/>temp.PROCEDURE_MSB<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-vMKtioTg1c4HUcTk","name":"enrol","type":"TASK","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*Creating the enrollment_1 using SK data</div><div class=\"ql-code-block\">the data set specification can be found at:</div><div class=\"ql-code-block\">https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</div><div class=\"ql-code-block\">downloaded and save in:</div><div class=\"ql-code-block\">P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\Documentation\\NewDocsSinceHandOver</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*what does it look like in sentinel demo file?*/</div><div class=\"ql-code-block\">/*%print(data=locald.ENROLLMENT_1);*/</div><div class=\"ql-code-block\">/*proc datasets lib=locald;*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;contents data=ENROLLMENT_1 order=varnum;*/</div><div class=\"ql-code-block\">/*run;*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">PatID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00</div><div class=\"ql-code-block\">Enr_Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.</div><div class=\"ql-code-block\">Enr_End&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.</div><div class=\"ql-code-block\">MedCov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">DrugCov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">Chart&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*What does wenbin's datafile looks like?*/</div><div class=\"ql-code-block\">%print(data=rOldD.ENROLLMENT);</div><div class=\"ql-code-block\">proc datasets lib=rOldD;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=ENROLLMENT order=varnum;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">Enr_Start&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">Enr_End&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</div><div class=\"ql-code-block\">MedCov&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">DrugCov&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">Chart&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Decision:</div><div class=\"ql-code-block\">1. Var length and varnum order follow sentinel demo files</div><div class=\"ql-code-block\">2. MedCov='Y', DrugCov='Y', Chart='N'</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data enrol_tmp1;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID $16.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enr_Start 4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enr_End 4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MedCov $1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DrugCov $1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chart $1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format Enr_Start YYMMDD10. Enr_End YYMMDD10.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">proc datasets ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=enrol_tmp1 order=varnum;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*where is wenbin's code?</div><div class=\"ql-code-block\">P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*Basically just to have coverage periods from the PHRS_PROG File*/</div><div class=\"ql-code-block\">data enrol_tmp2;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;PHRS_Covfile ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where xtrc_date = dhms(&amp;Xtrc_End_Cover, 0,0,0);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn eff_date exp_date report_start report_end xtrc_date;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">/*make a key_hsn list (must have)*/</div><div class=\"ql-code-block\">%distinct(data=enrol_tmp2, target=enrol_tmp3,vars=key_hsn);</div><div class=\"ql-code-block\">%getCoverGAPs(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rawfile=enrol_tmp2, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ptFile=enrol_tmp3, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;theCovXtrc=%str(&amp;Xtrc_End_Cover), </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;start=&amp;dataStartDate, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;end=&amp;dataEndDate , </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrol_tmp4, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;cohortgroup=, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;debug=1</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">%print(data=enrol_tmp4);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data enrol_tmp5;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set enrol_tmp4;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn coverStart coverEnd;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where gaps=0;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rename key_hsn= PatID coverStart =Enr_Start coverEnd = Enr_End;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data enrollment_9618;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set enrol_tmp1 enrol_tmp5;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;MedCov ='Y';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DrugCov='Y';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Chart ='N';</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%UnixZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;source=, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data=enrollment_9618, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrollment_9618.zip </div><div class=\"ql-code-block\">);</div></div><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"CodeTask-1rmjHAhhEUwPQmgZ","name":"Wenbin's enrol code","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Webin's code<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/* SCDM: 1. Enrollment Table */<br/>proc sql&#59<br/>   create table PHRS_PERS_PROG_1 as<br/>   select *<br/>   from hqc.PHRS_PERS_PROG(where=(&_cls))<br/>/*   where key_hsn in (select key_hsn from sample_HSNs)*/<br/>   order by key_hsn,EFF_DATE&#59<br/>quit&#59<br/><br/>%reformat_datevars (work, PHRS_PERS_PROG_1)&#59  /*2,585,904*/<br/><br/>/* EXP_DATE =. occured in the last record */<br/>proc sql&#59<br/>  select count(distinct key_hsn) from PHRS_PERS_PROG_1&#59 quit&#59<br/><br/>data Check_1 Check_2&#59<br/>   set PHRS_PERS_PROG_1&#59<br/>   by key_hsn&#59<br/>   if not last.key_hsn then output Check_1&#59<br/>   else output Check_2&#59<br/>run&#59<br/><br/>data PHRS_PERS_PROG_2&#59<br/>   set PHRS_PERS_PROG_1&#59<br/>   if  EXP_DATE=. then EXP_DATE=REPORT_END&#59<br/>   if  EXP_DATE < &DRUG_INITIAL_DATE then delete&#59<br/>   if EFF_DATE > &extract_end then delete&#59<br/>   if EFF_DATE < &DRUG_INITIAL_DATE then EFF_DATE = &DRUG_INITIAL_DATE&#59<br/>   drop report_end report_frequency report_start report_type sgt_id xtrc_date&#59<br/>run&#59 <br/><br/>/* REPORT_END ('02JUL2017'd) might greater than '31MAR2017'd */<br/>data PHRS_PERS_PROG_3&#59<br/>   set PHRS_PERS_PROG_2&#59<br/>   if  EXP_DATE > &extract_end then EXP_DATE = &extract_end&#59<br/>run&#59 <br/><br/>/* Check MIN and MAX dates  */<br/>proc tabulate data=PHRS_PERS_PROG_3&#59<br/>&nbsp&nbsp&nbsp&nbspvar EFF_DATE EXP_DATE&#59<br/>&nbsp&nbsp&nbsp&nbsptable EFF_DATE EXP_DATE,(min max) *f=yymmdd10. &#59<br/>run&#59<br/><br/>proc sort data=PHRS_PERS_PROG_3 nodupkey&#59 by _all_&#59 run&#59 /* n=2018740 */<br/><br/>* Combine overlapping records&#59<br/>%macro enroll_combine(ID=, strt=, stop=, indata=, outdata=, gap=)&#59<br/><br/>proc sort data=&indata(keep=&ID &strt &stop) out=tmp nodupkey&#59<br/>by &ID &strt &stop&#59<br/>where &strt ne . or &stop ne . &#59<br/>run&#59<br/><br/>data &outdata(keep=&ID strt_f stop_f<br/>         rename=(strt_f=&strt stop_f=&stop))&#59<br/>   retain prev_stop strt_f stop_f&#59<br/> set tmp&#59<br/> by &ID&#59<br/> if first.&ID. then do&#59<br/>    strt_f=&strt&#59<br/>    stop_f=&stop&#59<br/>    prev_stop=&stop&#59<br/>    end&#59<br/> if (&strt>(prev_stop+&gap+1)) then do&#59<br/>    stop_f=prev_stop&#59<br/>    output&#59<br/>    strt_f=&strt&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/> if (&stop>prev_stop) then prev_stop=&stop&#59<br/> if last.&ID. then do&#59<br/>    stop_f=prev_stop&#59<br/>    output&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/> format strt_f stop_f yymmdd10. &#59<br/>run&#59<br/>%mend enroll_combine&#59<br/><br/>%enroll_combine(ID=key_hsn, strt=EFF_DATE, stop=EXP_DATE, indata=PHRS_PERS_PROG_3, outdata=PHRS_PERS_PROG_4, gap=0) &#59   /* n=1936946*/<br/><br/>proc sql&#59<br/>   create table PHRS_PERS_INFO_1 as<br/>   select distinct key_hsn, NATV_STAT_FLAG<br/>   from hqc.PHRS_PERS_INFO(where=(&_cls))&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>   create table PHRS_PERS_PROG_5 as<br/>   select a.*, b.NATV_STAT_FLAG<br/>   from PHRS_PERS_PROG_4 a<br/>   left join<br/>   PHRS_PERS_INFO_1 b<br/>   on a.key_hsn=b.key_hsn&#59<br/>quit&#59<br/><br/>data PHRS_PERS_PROG_51&#59<br/>    set PHRS_PERS_PROG_5&#59<br/>&nbsp&nbsp&nbsp&nbsprename eff_date=Enr_Start&#59<br/>    rename EXP_DATE=Enr_End&#59<br/>    MedCov='Y'&#59<br/>    DrugCov='Y'&#59<br/>&nbsp&nbsp&nbsp&nbspif NATV_STAT_FLAG='1' then DrugCov='N'&#59<br/>&nbsp&nbsp&nbsp&nbspDrop natv_stat_flag&#59<br/>&nbsp&nbsp&nbsp&nbspChart='N'&#59<br/>run&#59<br/><br/>data PHRS_PERS_PROG_52&#59<br/>   retain pre_stop&#59<br/>   set PHRS_PERS_PROG_5&#59<br/>   by key_hsn&#59<br/>   if first.key_hsn then pre_stop=EXP_DATE&#59<br/>   if EFF_DATE-pre_stop > 1 then do&#59<br/>             Enr_Start=pre_stop+1&#59<br/>             Enr_End = EFF_DATE-1&#59<br/>             MedCov='N'&#59<br/><br/>             output&#59<br/>             pre_stop=EXP_DATE&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp end&#59<br/>   format Enr_Start Enr_End pre_stop yymmdd10. &#59<br/>   drop eff_date exp_date pre_stop&#59<br/>run&#59<br/><br/>data cdm.Enrollment&#59<br/>   length Enr_Start Enr_End 4.&#59<br/>   retain key_hsn&#59<br/>   set PHRS_PERS_PROG_51&#59<br/>       rename key_hsn=PatID&#59<br/>run&#59 <br/>proc sort data=cdm.Enrollment nodupkey&#59 by _all_&#59 run&#59 /* n=1936944*/<br/>s///<br/>t///","custparents":[{"idx":"CodeTask-vMKtioTg1c4HUcTk"}]}],"custparents":[{"idx":"CodeTask-NrDC6oJNN34iBg5x"}]},{"idx":"CodeTask-fHlg1SbjMF7xDeY5","name":"demographic","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Creating the demographic_1 using SK data<br/>the data set specification can be found at:<br/>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf<br/>downloaded and save in:<br/>P:\\2018 - CDM CNODES (Wenbin  Nedeene  Amanda)\\Documentation\\NewDocsSinceHandOver<br/>*/<br/><br/>/*what does it look like in sentinel demo file?*/<br/>/*%print(data=locald.demographic_1)&#59*/<br/>/*%nobs(data=locald.demographic_1)&#59*/<br/>/*%distinct(data=locald.demographic_1, target=test, vars=PatID)&#59*/<br/>/*proc datasets lib=locald&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspcontents data=demographic_1 order=varnum&#59*/<br/>/*run&#59*/<br/><br/>/*<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp16&nbsp&nbsp&nbsp&nbsp$16.00&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Birth_date&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspMMDDYY10.&nbsp&nbsp&nbsp&nbspYYMMDD8.&nbsp&nbsp&nbsp&nbsp<br/>Sex&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>hispanic&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>race&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>ZIP&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp5&nbsp&nbsp&nbsp&nbsp$5.00&nbsp&nbsp&nbsp&nbsp$5.00&nbsp&nbsp&nbsp&nbspZIP<br/>ZIP_date&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspMMDDYY10.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/><br/>*/<br/><br/>/*What does wenbin's datafile looks like?*/<br/>%print(data=rOldD.demographic)&#59<br/>proc datasets lib=rOldD&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=demographic order=varnum&#59<br/>run&#59<br/>/*<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbsp$11.00<br/>Birth_Date&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspYYMMDD10.&nbsp&nbsp&nbsp&nbsp<br/>Sex&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp$1.00&nbsp&nbsp&nbsp&nbsp$1.00<br/>Zip_Date&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspYYMMDD10.&nbsp&nbsp&nbsp&nbsp<br/>Hispanic&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Race&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Zip&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp6&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>*/<br/><br/>/* Decision:<br/>1. Var length and varnum order follow sentinel demo files<br/>2. Hispanic='U', Race='0', Zip='XXX' (first 3 digits)<br/>*/<br/><br/>data demographic_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsplength <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatID $16.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspBirth_Date 4.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSex $1.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphispanic $1.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprace $1.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspZIP $5.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspZIP_date 4.<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspformat Birth_Date YYMMDD10. ZIP_date YYMMDD10.&#59<br/>&nbsp&nbsp&nbsp&nbspdelete&#59<br/>run&#59<br/>proc datasets &#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=demographic_tmp1 order=varnum&#59<br/>run&#59<br/><br/>/*where is wenbin's code?<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/*get the enrol list (which was already prepared by the prog 'enrollment')*/<br/>%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=&remotedatapath,<br/>&nbsp&nbsp&nbsp&nbspzip=enrollment_9618,<br/>&nbsp&nbsp&nbsp&nbspzipped=enrollment_9618,<br/>&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsptarget=enrollment_9618<br/>)&#59<br/><br/>/*from above, get the earliest enrol_date*/<br/>%sort(data=enrollment_9618, sorter=PatID Enr_Start Enr_End)&#59<br/>data demographic_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbspset enrollment_9618&#59<br/>&nbsp&nbsp&nbsp&nbspby PatID Enr_Start Enr_End&#59<br/>&nbsp&nbsp&nbsp&nbspif first.PatID&#59<br/>&nbsp&nbsp&nbsp&nbsprename PatID = Key_hsn&#59<br/>run&#59<br/><br/><br/>/*Basically just to have demographic data from  PHRS_INFO File, and FSA from the resc clean file*/<br/><br/>/*Which resi file is appropriate for ZIP (first 3 digits): clean19.phrs_pers_resc_1_ond18_06feb2019*/<br/>/*%print(data=clean19.phrs_pers_resc_1_ond18_06feb2019)&#59*/<br/>/*Note: the follow returns zip close to Enr_Start (%GEO_INCQTL_assign does not return fsa)*/<br/>data demographic_tmp3&#59<br/>&nbsp&nbsp&nbsp&nbspset &PHRS_Resi_cleanFile&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn eff_date exp_date  fsa&#59<br/>&nbsp&nbsp&nbsp&nbspif eff_date =. then eff_date = report_start&#59<br/>&nbsp&nbsp&nbsp&nbspif exp_date=. then exp_date = report_end&#59<br/>run&#59<br/><br/>/*link _tmp2 and _tmp3, calculate the days between enr_start and eff_date*/<br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=demographic_tmp2,<br/>&nbsp&nbsp&nbsp&nbspt2=demographic_tmp3,<br/>&nbsp&nbsp&nbsp&nbsptarget=demographic_tmp4,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, t2.eff_date, t2.exp_date, t2.fsa, abs(t2.eff_date - t1.Enr_Start) as days),<br/>&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbspjvars=key_hsn<br/>)&#59<br/>%sort(data=demographic_tmp4, sorter=key_hsn enr_start days)&#59<br/>data demographic_tmp5&#59<br/>&nbsp&nbsp&nbsp&nbspset demographic_tmp4&#59<br/>&nbsp&nbsp&nbsp&nbspby key_hsn enr_start days&#59<br/>&nbsp&nbsp&nbsp&nbspif first.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbspdrop exp_date days&#59<br/>&nbsp&nbsp&nbsp&nbspformat ZIP $5.&#59<br/>&nbsp&nbsp&nbsp&nbspZIP = strip(fsa)&#59<br/>&nbsp&nbsp&nbsp&nbspdrop fsa MedCov DrugCov Chart Enr_Start Enr_End&#59<br/>&nbsp&nbsp&nbsp&nbsprename eff_date=ZIP_date &#59<br/>run&#59<br/><br/>/*get birth sex (the %getPHRSInfo is too slow)<br/>&nbsp&nbsp&nbsp&nbspconsider using retain to keep record of the last xtrc without sorting (cannot do it, at least key_hsn need to be sorted first)<br/>*/<br/>data demographic_tmp6&#59<br/>&nbsp&nbsp&nbsp&nbspset &phrs_infoFile&#59<br/>&nbsp&nbsp&nbsp&nbsplength Birth_date 4.&#59<br/>&nbsp&nbsp&nbsp&nbspformat Birth_date MMDDYY10.&#59<br/>&nbsp&nbsp&nbsp&nbspBirth_date = mdy(born_month, 15, born_year)&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn Birth_date sex_desc xtrc_date&#59<br/>&nbsp&nbsp&nbsp&nbsprename sex_desc=sex&#59<br/>run&#59<br/>%sort(data=demographic_tmp6, sorter=key_hsn xtrc_date)&#59<br/><br/>data demographic_tmp7&#59<br/>&nbsp&nbsp&nbsp&nbspset demographic_tmp6&#59<br/>&nbsp&nbsp&nbsp&nbspby key_hsn xtrc_date&#59<br/>&nbsp&nbsp&nbsp&nbspif last.key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbspdrop xtrc_date&#59<br/>&nbsp&nbsp&nbsp&nbspformat Birth_date MMDDYY10.&#59 <br/>run&#59<br/><br/>%nobs(data=demographic_tmp5)&#59<br/>%nobs(data=demographic_tmp7)&#59<br/>/*there are more patients in tmp7 than in tmp5, because tmp5 only contains individuals covered<br/>&nbsp&nbsp&nbsp&nbspbetween 1996 and 2018, whilst tmp7 contains more ever enroled in PHRS*/<br/><br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=demographic_tmp5,<br/>&nbsp&nbsp&nbsp&nbspt2=demographic_tmp7,<br/>&nbsp&nbsp&nbsp&nbsptarget=%str(demographic_tmp8 (rename= (key_hsn = PatID))),<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, t2.sex, t2.Birth_date),<br/>&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbspjvars=key_hsn<br/>)&#59<br/><br/><br/>/*Questions:<br/>1. Is the key_hsn unique, or repeat by different time period?<br/>&nbsp&nbsp&nbsp&nbspthere is no duplicated rows (each patient only had one row). So the zip date must take the one most close <br/>&nbsp&nbsp&nbsp&nbspto the starting date....<br/>2. What if FSA is missing? or Sex is missing?<br/>&nbsp&nbsp&nbsp&nbspIn Wenbin's file, if ZIP is missing, leave it blank, leave zip date missing<br/>*/<br/><br/>data demographic_9618&#59<br/>&nbsp&nbsp&nbsp&nbspset demographic_tmp1 demographic_tmp8&#59<br/>&nbsp&nbsp&nbsp&nbspHispanic ='U'&#59<br/>&nbsp&nbsp&nbsp&nbspRace='0'&#59<br/>run&#59<br/><br/>%UnixZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbspdata=demographic_9618, <br/>&nbsp&nbsp&nbsp&nbsptPath=&remotedatapath, <br/>&nbsp&nbsp&nbsp&nbsptarget=demographic_9618.zip <br/>)&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-Riz4N3decp5Xhetg","name":"Wenbin's demo code","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Webin's code<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/*  SCDM: 2.1 Demorgraphic Table*/<br/>/* Postcode INFO */<br/>proc sql&#59<br/>   create table Postcode_1 as<br/>   select *<br/>   from hqc.PHRS_PERS_RESC(where=(&_cls))<br/>   order by key_hsn, eff_date &#59<br/>quit&#59<br/><br/>%reformat_datevars (work, Postcode_1)&#59<br/><br/><br/>data Postcode_2&#59<br/>   set Postcode_1&#59<br/>   if post_code=' ' then delete&#59<br/>   keep key_hsn post_code  eff_date exp_date report_start report_type report_end&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table Postcode_3 as<br/>   select distinct key_hsn, post_code,  eff_date, exp_date from Postcode_2<br/>   order by key_hsn, eff_date&#59<br/>quit&#59<br/><br/>data Postcode_4&#59<br/>   set Postcode_3&#59<br/>   by key_hsn&#59<br/>   if last.key_hsn and  exp_date=. then exp_date='02JUL2017'd&#59<br/>run&#59<br/><br/>proc sort data=Postcode_4&#59<br/>by key_hsn descending eff_date&#59<br/>run&#59<br/><br/>data Postcode_5&#59<br/>   set Postcode_4&#59<br/>   by key_hsn descending eff_date&#59<br/>   lag_eff = lag(eff_date)&#59<br/>   if first.key_hsn then    lag_eff = . &#59<br/>   format lag_eff yymmdd10. &#59<br/>run&#59<br/><br/>data Postcode_6&#59<br/>   set Postcode_5&#59<br/>   if exp_date=. then exp_date_temp=lag_eff-1&#59<br/>   format exp_date_temp yymmdd10. &#59<br/>run&#59<br/><br/>data special_cases&#59<br/>   set Postcode_6&#59<br/>   if exp_date_temp=. and exp_date=.&#59<br/>   run&#59 /* n=21041 */<br/><br/>proc sql&#59<br/>   create table check_1 as<br/>   select * from Postcode_4<br/>   where key_hsn in (select key_hsn from special_cases)<br/>   order by key_hsn, eff_date&#59<br/>quit&#59<br/><br/>data Postcode_7&#59<br/>   set Postcode_5&#59<br/>   if exp_date=. then exp_date=lag_eff-1&#59<br/>   drop lag_eff&#59<br/>run&#59<br/><br/>data Postcode_8&#59<br/>   set Postcode_7&#59<br/>   if exp_date=. then exp_date='02JUL2017'd&#59<br/>run&#59<br/><br/>proc sort data=Postcode_8&#59<br/>by key_hsn eff_date&#59<br/>run&#59<br/><br/>/*  Check if there is overlapping */<br/>data check_2&#59<br/>   set Postcode_8&#59<br/>   by key_hsn eff_date&#59<br/>   lag_eff = lag(eff_date)&#59<br/>   if first.key_hsn then    lag_eff = . &#59<br/>   gap=eff_date-lag_eff&#59<br/>   format lag_eff yymmdd10. &#59<br/>   if gap < 0 and gap^=.&#59<br/>run&#59<br/>/* There is no overlapping records */<br/><br/>proc sql&#59<br/>   create table check_3 as<br/>   select * from Postcode_8<br/>   where key_hsn in (select key_hsn from special_cases)<br/>   order by key_hsn, eff_date&#59<br/>quit&#59<br/><br/>data Postcode_9&#59<br/>length key $18&#59<br/>   set Postcode_8&#59<br/>   key=catt(key_hsn,'_',POST_CODE)&#59<br/>run&#59<br/><br/>* Combine overlapping records&#59<br/>%macro enroll_combine(ID=, strt=, stop=, indata=, outdata=, gap=)&#59<br/><br/>proc sort data=&indata(keep=&ID &strt &stop) out=tmp nodupkey&#59<br/>by &ID &strt &stop&#59<br/>where &strt ne . or &stop ne . &#59<br/>run&#59<br/><br/>data &outdata(keep=&ID strt_f stop_f<br/>         rename=(strt_f=&strt stop_f=&stop))&#59<br/>   retain prev_stop strt_f stop_f&#59<br/> set tmp&#59<br/> by &ID&#59<br/> if first.&ID. then do&#59<br/>    strt_f=&strt&#59<br/>    stop_f=&stop&#59<br/>    prev_stop=&stop&#59<br/>    end&#59<br/> if (&strt>(prev_stop+&gap+1)) then do&#59<br/>    stop_f=prev_stop&#59<br/>    output&#59<br/>    strt_f=&strt&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/> if (&stop>prev_stop) then prev_stop=&stop&#59<br/> if last.&ID. then do&#59<br/>    stop_f=prev_stop&#59<br/>    output&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/> format strt_f stop_f yymmdd10. &#59<br/>run&#59<br/>%mend enroll_combine&#59<br/><br/>%enroll_combine(ID=key, strt=EFF_DATE, stop=EXP_DATE, indata=Postcode_9, outdata=Postcode_10, gap=0) &#59   <br/><br/>data Postcode_11&#59<br/>   set Postcode_10&#59<br/>   key_hsn=substr(key,1,11)&#59<br/>   POST_CODE=substr(key,13)&#59<br/>   drop key&#59<br/>run&#59<br/><br/>data Postcode_12&#59<br/>   length PC $3 &#59<br/>   set Postcode_11&#59 <br/>   rename key_hsn=PatID&#59<br/>   rename eff_date=PC_Start&#59<br/>   rename EXP_DATE=PC_End&#59<br/>   PC =substr(POST_CODE,1,3)&#59<br/>   drop post_code&#59<br/>run&#59<br/><br/>/*  SCDM: 2.2 Location CNODES SPECIFIC Table*/<br/><br/>data cdm.Location_CNODES_Specific&#59<br/>&nbsp&nbsp&nbsp&nbspretain PatID PC PC_Start PC_End&#59<br/>    length PC_Start PC_End 4.&#59<br/>&nbsp&nbsp&nbsp&nbspset Postcode_12&#59<br/>run&#59<br/><br/>proc sort data=cdm.Location_CNODES_Specific&#59<br/>by PatID PC PC_Start&#59<br/>run&#59<br/><br/>data latest_post_code&#59<br/>  set cdm.Location_CNODES_Specific&#59<br/>  by PatID&#59<br/>  if last.PatID&#59<br/>run&#59 /* n=2039809 */<br/><br/>proc sql&#59<br/>   create table PERS_1 as<br/>   select key_hsn as PatID, sex_desc as Sex, mdy(BORN_MONTH,1,BORN_YEAR) as Birth_Date format=yymmdd10.  <br/>   from hqc.PHRS_PERS_INFO(where=(&_cls))&#59<br/>quit&#59<br/><br/>%reformat_datevars (work, PERS_1)&#59 /* n=2059395 */<br/><br/>proc sql&#59<br/>   create table Demographic_1 as<br/>   select a.PC, a.PC_Start, b.*<br/>   from latest_post_code a,PERS_1 b<br/>   where a.PatID=b.PatID&#59<br/>quit&#59   /* n=2,039,808 */<br/><br/>data cdm.Demographic&#59<br/>    retain PatID Birth_Date Sex&#59<br/>    length Birth_Date Zip_Date 4.&#59<br/>    set Demographic_1(rename=(PC_Start=Zip_Date))&#59<br/>&nbsp&nbsp&nbsp&nbspHispanic='U'&#59<br/>&nbsp&nbsp&nbsp&nbspRace='0'&#59<br/>&nbsp&nbsp&nbsp&nbsprename pc=Zip&#59&nbsp&nbsp&nbsp&nbsp<br/>run&#59<br/><br/>/* n=569 people did not have demographic information */<br/>proc sql&#59<br/>  create table test as<br/>  select distinct PatID from cdm.Enrollment <br/>  where PatID not in (select PatID from cdm.Location_CNODES_Specific)&#59<br/>  quit&#59 /* n=569 */<br/>s///<br/>t///","custparents":[{"idx":"CodeTask-fHlg1SbjMF7xDeY5"}]}],"custparents":[{"idx":"CodeTask-NrDC6oJNN34iBg5x"}]},{"idx":"CodeTask-279Q1EcCSphNwwKH","name":"death","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Creating the death_1 using SK data<br/>the data set specification can be found at:<br/>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf<br/>downloaded and save in:<br/>P:\\2018 - CDM CNODES (Wenbin  Nedeene  Amanda)\\Documentation\\NewDocsSinceHandOver<br/>*/<br/><br/>/*what does it look like in sentinel demo file?*/<br/>/*%print(data=locald.death_1)&#59*/<br/>/*%nobs(data=locald.death_1)&#59*/<br/>/*%distinct(data=locald.death_1, target=test, vars=PatID)&#59*/<br/>/*proc datasets lib=locald&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspcontents data=death_1 order=varnum&#59*/<br/>/*run&#59*/<br/><br/>/*<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp16&nbsp&nbsp&nbsp&nbsp$16.00&nbsp&nbsp&nbsp&nbsp<br/>DeathDt&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspMMDDYY10.&nbsp&nbsp&nbsp&nbspYYMMDD8.<br/>DtImpute&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Source&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Confidence&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp<br/><br/>*/<br/><br/>/*What does wenbin's datafile looks like?*/<br/>%print(data=rOldD.death)&#59<br/>proc datasets lib=rOldD&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=death order=varnum&#59<br/>run&#59<br/>/*<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbspKEY_HSN<br/>DeathDt&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspYYMMDD10.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>DtImpute&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Source&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Confidence&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1<br/>*/<br/><br/>/* Decision:<br/>1. Var length and varnum order follow sentinel demo files<br/>2. DtImpute='N', Source='L', Confidence='E' (first 3 digits)<br/>*/<br/>data death_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsplength <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatID $16.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDeathDt 4.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDtImpute $1.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspSource $1.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspConfidence $1.<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspformat DeathDt YYMMDD10. &#59<br/>&nbsp&nbsp&nbsp&nbspdelete&#59<br/>run&#59<br/>proc datasets &#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=death_tmp1 order=varnum&#59<br/>run&#59<br/><br/>/*where is wenbin's code?<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/*Date of death from the PHRS file*/<br/>data death_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbspset &VerfMortFile&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn ddt_novit&#59<br/>&nbsp&nbsp&nbsp&nbspif ddt_novit ne .&#59<br/>&nbsp&nbsp&nbsp&nbsprename key_hsn=PatID ddt_novit=DeathDt&#59<br/>&nbsp&nbsp&nbsp&nbspwhere ddt_novit between &dataStartDate and &dataEndDate&#59<br/>run&#59<br/><br/>data death_9618&#59<br/>&nbsp&nbsp&nbsp&nbspset death_tmp1 death_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbspDtImpute='N'&#59 Source='L'&#59 Confidence='E'&#59<br/>run&#59<br/><br/>%UnixZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbspdata=death_9618, <br/>&nbsp&nbsp&nbsp&nbsptPath=&remotedatapath, <br/>&nbsp&nbsp&nbsp&nbsptarget=death_9618.zip <br/>)&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-EVWCjhA39sQPKbwv","name":"Wenbin's code for death file","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*<br/>death file<br/>Webin's code<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/* SCDM: 5.1 Death Table */<br/>proc sql&#59<br/>   create table PHRS_PERS_RSDC_1 as<br/>   select *<br/>   from  HQC.PHRS_PERS_RSDC(where=(&_cls))&#59<br/>quit&#59 /* n=231,455 */<br/><br/>%reformat_datevars (work, PHRS_PERS_RSDC_1)&#59  /*2,585,904*/<br/><br/>data PHRS_PERS_RSDC_2&#59<br/>   set PHRS_PERS_RSDC_1(keep=key_hsn RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>    where RSDC_STAT_TYPE_CODE =4 &#59<br/>&nbsp&nbsp&nbsp&nbspDeathDt=eff_date-1&#59<br/>    format DeathDt yymmdd10. &#59<br/>&nbsp&nbsp&nbsp&nbsplength DeathDt 4. &#59<br/>run&#59<br/><br/>data CDM.DEATH&#59<br/>   set PHRS_PERS_RSDC_2(drop=RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>   DtImpute = 'N'&#59<br/>   Source = 'L' &#59<br/>   Confidence='E' &#59<br/>   rename key_hsn=PatID&#59<br/>run&#59<br/><br/>s///<br/>t///","custparents":[{"idx":"CodeTask-279Q1EcCSphNwwKH"}]}],"custparents":[{"idx":"CodeTask-NrDC6oJNN34iBg5x"}]},{"idx":"CodeTask-qJq38eUBnhxhdDUZ","name":"dispensing","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Creating the dispensing file using SK data<br/>the data set specification can be found at:<br/>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf<br/>downloaded and save in:<br/>P:\\2018 - CDM CNODES (Wenbin  Nedeene  Amanda)\\Documentation\\NewDocsSinceHandOver<br/>*/<br/><br/>data _null_&#59run&#59<br/><br/><br/>/*what does it look like in sentinel demo file?*/<br/>/*%print(data=locald.DISPENSING_1)&#59*/<br/>/*%nobs(data=locald.DISPENSING_1)&#59*/<br/>/*%distinct(data=locald.DISPENSING_1, target=test, vars=%str(PatID, RXDate, NDC))&#59*/<br/>/*the demo data suggests that patientid-rxDate-NDC combination should be unique*/<br/><br/>/*proc datasets lib=locald&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspcontents data=DISPENSING_1 order=varnum&#59*/<br/>/*run&#59*/<br/><br/>/*<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp16&nbsp&nbsp&nbsp&nbsp$16.00&nbsp&nbsp&nbsp&nbsp<br/>RxDate&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspMMDDYY10.&nbsp&nbsp&nbsp&nbspYYMMDD8.<br/>NDC&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp$19.00&nbsp&nbsp&nbsp&nbsp<br/>RxSup&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>RxAmt&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbsp<br/>*/<br/><br/>/*What does wenbin's datafile looks like?*/<br/>%print(data=rOldD.DISPENSING)&#59<br/>proc datasets lib=rOldD&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=DISPENSING order=varnum&#59<br/>run&#59<br/>/*<br/>RxDate&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspYYMMDD10.&nbsp&nbsp&nbsp&nbspDATETIME20.&nbsp&nbsp&nbsp&nbspRX_DDDDD<br/>RxSup&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>RxAmt&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbspKEY_HSN<br/>NDC&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp8&nbsp&nbsp&nbsp&nbsp$8.00&nbsp&nbsp&nbsp&nbsp$8.00&nbsp&nbsp&nbsp&nbspDIN<br/>*/<br/><br/>/* Decision:<br/>1. Var length and varnum order follow sentinel demo files<br/>2. Leave RxSup =. (subject to algorithm for RxSup of specific projects)<br/>*/<br/>data dispensing_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsplength <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatID $16.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRxDate 4.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNDC $11.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRxSup 4.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspRxAmt 4.<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspformat RxDate YYMMDD10. &#59<br/>&nbsp&nbsp&nbsp&nbspdelete&#59<br/>run&#59<br/>proc datasets &#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=dispensing_tmp1 order=varnum&#59<br/>run&#59<br/><br/>/*where is wenbin's code?<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/>data dispensing_tmp2a&#59<br/>&nbsp&nbsp&nbsp&nbspset &dp_benefitFile &#59<br/>&nbsp&nbsp&nbsp&nbspwhere Rx_ddddd between dhms(&dataStartDate, 0,0,0) and dhms(&dataEndDate, 0,0,0)&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn Rx_ddddd DIN RX_QTY_AMT&#59<br/>run&#59<br/>data dispensing_tmp2b&#59<br/>&nbsp&nbsp&nbsp&nbspset &dp_nonbenefitFile &#59<br/>&nbsp&nbsp&nbsp&nbspwhere Rx_ddddd between dhms(&dataStartDate, 0,0,0) and dhms(&dataEndDate, 0,0,0)&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn Rx_ddddd DIN RX_QTY_AMT&#59<br/>run&#59<br/><br/>data dispensing_tmp2c&#59<br/>&nbsp&nbsp&nbsp&nbspset dispensing_tmp2a dispensing_tmp2b&#59<br/>&nbsp&nbsp&nbsp&nbspRxDate=datepart(Rx_ddddd)&#59<br/>&nbsp&nbsp&nbsp&nbsprename key_hsn = PatID DIN = NDC&#59<br/>run&#59<br/><br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=dispensing_tmp2c,<br/>&nbsp&nbsp&nbsp&nbsptarget=dispensing_tmp2,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.PatID, RxDate, NDC, sum(RX_QTY_AMT) as RxAmt),<br/>&nbsp&nbsp&nbsp&nbspgroupby=%str(PatID, RxDate, NDC)<br/>)&#59<br/><br/>/*From above, only keep those appeared in enroll file*/<br/>%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=&remotedatapath,<br/>&nbsp&nbsp&nbsp&nbspzip=enrollment_9618,<br/>&nbsp&nbsp&nbsp&nbspzipped=enrollment_9618,<br/>&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsptarget=enrollment_9618<br/>)&#59<br/><br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=dispensing_tmp2,<br/>&nbsp&nbsp&nbsp&nbspt2=enrollment_9618,<br/>&nbsp&nbsp&nbsp&nbsptarget=dispensing_tmp3,<br/>&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbspjvars=PatID<br/>)&#59<br/><br/>data DISPENSING_9618&#59<br/>&nbsp&nbsp&nbsp&nbspset dispensing_tmp1 dispensing_tmp3&#59<br/>run&#59<br/><br/>%UnixZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbspdata=DISPENSING_9618, <br/>&nbsp&nbsp&nbsp&nbsptPath=&remotedatapath, <br/>&nbsp&nbsp&nbsp&nbsptarget=DISPENSING_9618.zip <br/>)&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-hFP1Sike6nP9YFoM","name":"Wenbin's dispensing code","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Webin's code for dispensing file<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/*DP_claims Extraction */<br/>proc sql&#59<br/>   create view NON_BEN as<br/>   select key_hsn, DIN,RX_DDDDD, RX_QTY_AMT, 'NON_BEN' as source from hqc.DP_CLAIM_NON_BEN&#59<br/>quit&#59 <br/><br/>proc sql&#59<br/>   create table NON_BEN_1 as<br/>   select key_hsn, DIN,RX_DDDDD, source, sum(RX_QTY_AMT) as RxAmt  from NON_BEN<br/>   group key_hsn, DIN, RX_DDDDD, source&#59<br/>quit&#59 <br/><br/>proc sql&#59<br/>   create view DP_CLAIMS as<br/>   select key_hsn,DIN,RX_DDDDD, RX_QTY_AMT, 'DP_CLAIM' as source from hqc.DP_CLAIM&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>   create table DP_CLAIMS_1 as<br/>   select key_hsn, DIN,RX_DDDDD, source, sum(RX_QTY_AMT) as RxAmt  from DP_CLAIMS<br/>   group key_hsn, DIN, RX_DDDDD, source&#59<br/>quit&#59 <br/><br/>data All_CLAIMS&#59<br/>   set DP_CLAIMS_1<br/>       NON_BEN_1<br/>&#59<br/>if RX_DDDDD >= &DRUG_INITIAL_DATE&#59<br/>rename RX_DDDDD=RxDate&#59<br/>run&#59<br/><br/>%reformat_datevars(work,All_CLAIMS)<br/><br/>proc sort data=All_CLAIMS nodupkey&#59 by _all_&#59 run&#59 <br/><br/>data cdm.Dispensing&#59 <br/>   set All_CLAIMS&#59<br/>   if RxAmt < 0 then delete &#59<br/>   rename key_hsn=PatID&#59<br/>   <br/>   rename DIN=NDC&#59<br/>   length RxDate RxSup 4.&#59<br/>run&#59 /* n=280680427 */<br/><br/>proc sort data=cdm.Dispensing nodupkey&#59 by PatID NDC RxDate&#59 run&#59 /* n=280542250 */<br/><br/><br/>s///<br/>t///","custparents":[{"idx":"CodeTask-qJq38eUBnhxhdDUZ"}]}],"custparents":[{"idx":"CodeTask-NrDC6oJNN34iBg5x"}]},{"idx":"CodeTask-5walNELcwbMmiSXf","name":"encounter","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Creating the encounter file using SK data<br/>the data set specification can be found at:<br/>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf<br/>downloaded and save in:<br/>P:\\2018 - CDM CNODES (Wenbin  Nedeene  Amanda)\\Documentation\\NewDocsSinceHandOver<br/>*/<br/><br/>%freq(data=locald.encounter_1, table = drg_type)<br/><br/>/*what does it look like in sentinel  file?*/<br/>/*%print(data=locald.encounter_1)&#59*/<br/>/*%nobs(data=locald.encounter_1)&#59*/<br/>/*%distinct(data=locald.encounter_1, target=test, vars=%str(?))&#59*/<br/>/*proc datasets lib=locald&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspcontents data=encounter_1 order=varnum&#59*/<br/>/*run&#59*/<br/><br/>/*<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp16&nbsp&nbsp&nbsp&nbsp$16.00&nbsp&nbsp&nbsp&nbsp<br/>EncounterID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp15&nbsp&nbsp&nbsp&nbsp$15.00&nbsp&nbsp&nbsp&nbsp<br/>ADate&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspMMDDYY10.&nbsp&nbsp&nbsp&nbspYYMMDD8.<br/>DDate&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspMMDDYY10.&nbsp&nbsp&nbsp&nbspYYMMDD8.<br/>Provider&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp10&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Facility_Location&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp3&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>EncType&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Facility_Code&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp6&nbsp&nbsp&nbsp&nbsp$6.00&nbsp&nbsp&nbsp&nbsp<br/>Discharge_Disposition&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Discharge_Status&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>DRG&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp3&nbsp&nbsp&nbsp&nbsp$3.00&nbsp&nbsp&nbsp&nbsp<br/>DRG_Type&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Admitting_Source&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp<br/>*/<br/><br/>/*What does wenbin's datafile looks like?*/<br/>%print(data=rOldD.encounter)&#59<br/>proc datasets lib=rOldD&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=encounter order=varnum&#59<br/>run&#59<br/><br/>/*<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbspKEY_HSN<br/>EncounterID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp40&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>ADate&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspYYMMDD10.&nbsp&nbsp&nbsp&nbspDATETIME20.&nbsp&nbsp&nbsp&nbspADM_DATE<br/>DDate&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspYYMMDD10.&nbsp&nbsp&nbsp&nbspDATETIME20.&nbsp&nbsp&nbsp&nbspDSCHG_DATE<br/>Provider&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspKEY_DOC_NUM<br/>Facility_Location&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp3&nbsp&nbsp&nbsp&nbsp$CHAR3.&nbsp&nbsp&nbsp&nbsp$CHAR3.&nbsp&nbsp&nbsp&nbsp<br/>EncType&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Facility_Code&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp3&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Discharge_Disposition&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Discharge_Status&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>DRG&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp3&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>DRG_Type&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>Admitting_Source&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/><br/>*/<br/><br/>/* Decision:<br/>1. Var length and varnum order follow sentinel demo files<br/>2. <br/>&nbsp&nbsp&nbsp&nbspEncounterID not sure why it is so large, anyways it can be rebuilt from<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(PatID, VADate, Provider, and EncType)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspI'll leave it for now. VADate = VValue(ADate). VValue is to have formated value as char <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(e.g., from '01Jan1960'd to '01Jan1960')<br/> &nbsp&nbsp&nbsp&nbspADate= dos_1<br/>&nbsp&nbsp&nbsp&nbspDDate leave it missing&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspProvider = key_doc_num&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspFacility_Location = ''&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncType&nbsp&nbsp&nbsp&nbspChar = '' (This is determined by Some NGS_Category (which is defined by FSC, leave it blank for now)&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspFacility_Code = ''<br/>&nbsp&nbsp&nbsp&nbspDischarge_Disposition = 'U' (according to Wenbin's setting)&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDischarge_Status = ''&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDRG&nbsp&nbsp&nbsp&nbspChar = ''&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDRG_Type ='' &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspAdmitting_Source=''<br/>&nbsp&nbsp&nbsp&nbspalso keep <br/>&nbsp&nbsp&nbsp&nbspSPEC $2.<br/>&nbsp&nbsp&nbsp&nbspMG $2.<br/>&nbsp&nbsp&nbsp&nbspDIAG $3.<br/>&nbsp&nbsp&nbsp&nbspFSC $4.<br/>&nbsp&nbsp&nbsp&nbspNUM_SRV 4.<br/>&nbsp&nbsp&nbsp&nbspLOS $1.<br/>&nbsp&nbsp&nbsp&nbspMODE $1.<br/>*/<br/>%print(data=&MSBFile)&#59<br/>proc datasets lib=hqc&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=msb_billing order=varnum&#59<br/>run&#59<br/><br/>/*doc number was $10. which is not enough for SK key_doc_num ($11.)*/<br/>data encounter_tmp1a&#59<br/>&nbsp&nbsp&nbsp&nbsplength <br/>&nbsp&nbsp&nbsp&nbspPatID&nbsp&nbsp&nbsp&nbsp$16.&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncounterID&nbsp&nbsp&nbsp&nbsp$15.&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbsp4.<br/>&nbsp&nbsp&nbsp&nbspDDate&nbsp&nbsp&nbsp&nbsp4.<br/>&nbsp&nbsp&nbsp&nbspProvider&nbsp&nbsp&nbsp&nbsp$11.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspFacility_Location&nbsp&nbsp&nbsp&nbsp$3.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncType&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp$2.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspFacility_Code&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp$6.&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDischarge_Disposition&nbsp&nbsp&nbsp&nbsp$1.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDischarge_Status $2.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDRG&nbsp&nbsp&nbsp&nbsp$3.<br/>&nbsp&nbsp&nbsp&nbspDRG_Type&nbsp&nbsp&nbsp&nbsp$1.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspAdmitting_Source&nbsp&nbsp&nbsp&nbsp$2.<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspformat ADate YYMMDD10. DDate YYMMDD10. &#59<br/>&nbsp&nbsp&nbsp&nbspdelete&#59<br/>run&#59<br/>proc datasets &#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=encounter_tmp1a order=varnum&#59<br/>run&#59<br/><br/>/*where is wenbin's code?<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/><br/>/**************************************************************************<br/>Part 1 encounters from MSB<br/>****************************************************************************/<br/><br/>/*<br/>Part 1 from MSB:<br/>there is not much to do to this file<br/>&nbsp&nbsp&nbsp&nbspit may need to be customized by projects (e.g., excluding Mode=z, or sluch doc code? , or EncType by FSC categories)<br/>*/<br/><br/>/*%UnixUnZip(*/<br/>/*&nbsp&nbsp&nbsp&nbspsPath=&remotedatapath,*/<br/>/*&nbsp&nbsp&nbsp&nbspzip=diagnosis_tmp1f,*/<br/>/*&nbsp&nbsp&nbsp&nbspzipped=diagnosis_tmp1f,*/<br/>/*&nbsp&nbsp&nbsp&nbsptPath=,*/<br/>/*&nbsp&nbsp&nbsp&nbsptarget=diagnosis_tmp1f*/<br/>/*)&#59*/<br/><br/>/*%vbsUnzip(*/<br/>/*&nbsp&nbsp&nbsp&nbsptgtDir=,*/<br/>/*&nbsp&nbsp&nbsp&nbspzipFile=&localSKDatapath.\\diagnosis_tmp1f.zip,*/<br/>/*&nbsp&nbsp&nbsp&nbspsrcFile=%str(diagnosis_tmp1f.sas7bdat)*/<br/>/*)&#59*/<br/><br/>/*based on diagnosis_tmp1f*/<br/>%distinct(<br/>&nbsp&nbsp&nbsp&nbspdata=&nbsp&nbsp&nbsp&nbspdiagnosis_tmp1f,<br/>&nbsp&nbsp&nbsp&nbsptarget=encounter_tmp1b,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(PatID, Provider, ADate, EncType, i)<br/>)&#59<br/><br/><br/>/*Note:<br/>&nbsp&nbsp&nbsp&nbspEncounterID is specific for patid-provider-adate-enctype<br/>&nbsp&nbsp&nbsp&nbspit should be shared across diag and procudure file<br/>*/<br/>data encounter_msb&#59<br/>&nbsp&nbsp&nbsp&nbspset encounter_tmp1a encounter_tmp1b&#59<br/>&nbsp&nbsp&nbsp&nbspEncounterID = 'M' || put(i, z14.)&#59<br/>&nbsp&nbsp&nbsp&nbspDischarge_Disposition='U'&#59<br/>&nbsp&nbsp&nbsp&nbspDischarge_Status = 'UN'&#59<br/>&nbsp&nbsp&nbsp&nbspAdmitting_Source='UN'&#59<br/>&nbsp&nbsp&nbsp&nbspdrop i&#59<br/>run&#59<br/><br/>%beep&#59<br/><br/>/*zip it*/<br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=encounter_msb.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=encounter_msb, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/><br/><br/><br/>/**************************************************************************<br/>Part 2 encounters from hospital<br/>****************************************************************************/<br/>/*%vbsUnzip(*/<br/>/*&nbsp&nbsp&nbsp&nbsptgtDir=,*/<br/>/*&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\master_hosp.zip),*/<br/>/*&nbsp&nbsp&nbsp&nbspsrcFile=%str(master_hosp.sas7bdat)*/<br/>/*)&#59*/<br/>/*%print(data=master_hosp)&#59*/<br/>/*proc datasets&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspcontents data=master_hosp&#59*/<br/>/*run&#59*/<br/><br/>/* For encounters from hospital:<br/>&nbsp&nbsp&nbsp&nbspPatID&nbsp&nbsp&nbsp&nbsp= key_hsn&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncounterID&nbsp&nbsp&nbsp&nbsp'H' || 000 CIHIRec (length= 15)&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbsp=adm_date<br/>&nbsp&nbsp&nbsp&nbspDDate&nbsp&nbsp&nbsp&nbsp= dischargedate<br/>&nbsp&nbsp&nbsp&nbspProvider <- facility_code&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspFacility_Location&nbsp&nbsp&nbsp&nbsp<-  fac_loc.facility_location&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe file fac_loc can be found at:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspremote: /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplocal: P:\\2018 - CDM CNODES (Wenbin  Nedeene  Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncType&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif DS_IP='DS' then  EncType='SD'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else EncType='IP' &#59<br/>&nbsp&nbsp&nbsp&nbspFacility_Code&nbsp&nbsp&nbsp&nbsp<- HOSP_NUM_C <- Character value of 3-digit hosp_num<br/>&nbsp&nbsp&nbsp&nbspDischarge_Disposition&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   if DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else if DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else Discharge_Disposition =' '&#59&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDischarge_Status  = UN&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDRG&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif EncType='IP' then DRG=CMG&#59 (CMG can be found in master_hosp)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else if EncType='SD' then DRG=''&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DRG_Type=''&#59&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDRG_Type =''&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspalthough the document says that it should be identified for IP and IS type, it is set as '' in Wenbin's code&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspAdmitting_Source&nbsp&nbsp&nbsp&nbsp$2.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif NEWBORN='NA' then Admitting_Source=ENTRY_CODE&#59<br/>   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse Admitting_Source='N'&#59<br/>*/<br/><br/>/*1. According to Wenbin's code:<br/>remove records if<br/>&nbsp&nbsp&nbsp&nbspDSCHG_DATE='01Jan9999'd&#59<br/>&nbsp&nbsp&nbsp&nbspPROV_LOC_SK ^= 'Y'&#59<br/>&nbsp&nbsp&nbsp&nbsphosp_num =.<br/>*/<br/>/*%nobs(data=master_hosp)&#59*/<br/><br/>/*from diagnosis_tmp2f*/<br/>%distinct(<br/>&nbsp&nbsp&nbsp&nbspdata=diagnosis_tmp2f,<br/>&nbsp&nbsp&nbsp&nbsptarget=encounter_tmp2a,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatID, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncounterID, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProvider, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFacility_Location, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncType, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFacility_Code, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDischarge_Disposition, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDischarge_Status, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDRG, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDRG_Type, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspAdmitting_Source<br/>&nbsp&nbsp&nbsp&nbsp)<br/>)&#59<br/><br/>data encounter_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspset encounter_tmp1a encounter_tmp2a&#59<br/>run&#59<br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=encounter_hosp.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=encounter_hosp, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/><br/>/**************************************************************************<br/>Part 3 encounters from emergency department<br/>****************************************************************************/<br/>/*<br/>inclusion:<br/>PROV_LOC_SK = 'Y'<br/>reg_date ne .<br/>reg_date between 1996 and 2018 <br/>key_hsn ne .<br/>*/<br/><br/><br/>/* For encounters from hospital:<br/>&nbsp&nbsp&nbsp&nbspPatID&nbsp&nbsp&nbsp&nbsp= key_hsn&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp/EncounterID <- EncounterID from a unique raw record ID created when import ed data (like E0000xxx)&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbsp= Reg_date<br/>&nbsp&nbsp&nbsp&nbspDDate&nbsp&nbsp&nbsp&nbsp= disp_date<br/>&nbsp&nbsp&nbsp&nbspProvider <- facility_code&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspFacility_Location&nbsp&nbsp&nbsp&nbsp<-  fac_loc.facility_location&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe file fac_loc can be found at:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspremote: /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplocal: P:\\2018 - CDM CNODES (Wenbin  Nedeene  Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncType&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= 'ED'<br/>&nbsp&nbsp&nbsp&nbspFacility_Code&nbsp&nbsp&nbsp&nbsp<- substr(inst_num,3,3)<br/>&nbsp&nbsp&nbsp&nbspDischarge_Disposition&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif visit_disp in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else if visit_disp in ('10','11') then Discharge_Disposition ='E'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else Discharge_Disposition ='A'&#59<br/>&nbsp&nbsp&nbsp&nbspDischarge_Status  = ''&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDRG&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp=''&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDRG_Type =''&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspalthough the document says that it should be identified for IP and IS type, it is set as '' in Wenbin's code&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspAdmitting_Source&nbsp&nbsp&nbsp&nbsp$2.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif adm_ambul in ('A','C','G') then Admitting_source='A'&#59<br/>   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse Admitting_source='D' &#59<br/>*/<br/><br/>/*%vbsUnzip(*/<br/>/*&nbsp&nbsp&nbsp&nbsptgtDir=,*/<br/>/*&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\master_ed_a2012.zip),*/<br/>/*&nbsp&nbsp&nbsp&nbspsrcFile=%str(master_ed_a2012.sas7bdat)*/<br/>/*)&#59*/<br/><br/><br/>%distinct(<br/>&nbsp&nbsp&nbsp&nbspdata=diagnosis_tmp3c,<br/>&nbsp&nbsp&nbsp&nbsptarget=encounter_tmp3a,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncounterID, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatID, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDDate, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFacility_Location, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfacility_code, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProvider, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncType, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDischarge_Disposition, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspAdmitting_source<br/>&nbsp&nbsp&nbsp&nbsp)<br/>)&#59<br/><br/>data encounter_ed&#59<br/>&nbsp&nbsp&nbsp&nbspset encounter_tmp1a encounter_tmp3a&#59<br/>run&#59<br/><br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=encounter_ed.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=encounter_ed, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/><br/><br/>/*******************************************************************************<br/>Putting together<br/>*******************************************************************************/<br/><br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\encounter_msb.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(encounter_msb.sas7bdat)<br/>)&#59<br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\encounter_hosp.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(encounter_hosp.sas7bdat)<br/>)&#59<br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\encounter_ed.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(encounter_ed.sas7bdat)<br/>)&#59<br/><br/>data encounter_9618&#59<br/>&nbsp&nbsp&nbsp&nbspset encounter_msb encounter_hosp encounter_ed&#59<br/>run&#59<br/><br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=encounter_9618.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=encounter_9618, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/><br/>%beep&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-SCB25I1aq4R6t6zc","name":"Wenbin's encounter","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Webin's code for dispensing file<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/**********************************************************************<br/>From MSB<br/>**********************************************************************/<br/><br/><br/>libname doc \"/sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document\"&#59<br/>%print(data=doc.ngs_fsc_sk)&#59<br/>%print(data=doc.enctype)&#59<br/>%freq(data=doc.enctype, table=encounter_type)&#59<br/><br/>/* SCDM: 4.1 Encounter Table*/<br/>%Extract_MSB(<br/>   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp=&nbsp&nbsp&nbsp&nbsp cdm.msb,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp'31MAR1997'd,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt&nbsp&nbsp&nbsp&nbsp &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp'11APR2017'd,<br/>               &nbsp&nbsp&nbsp&nbspdostart&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp&extract_start,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp    dosend&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp&extract_end,<br/>                kept_vars               =   KEY_HSN KEY_DOC_NUM SPEC MG DIAG FSC NUM_SRV DOS LOS CONTACTS AMT_APP MODE<br/>)&#59<br/><br/>/*libname tmp '/SAS_data/dw0/HQC_share/Wenbin/LIMPAC/tmp'&#59 tmp.msb */<br/><br/>data msb_2&#59<br/>   set cdm.msb&#59<br/>   if MODE='Z' then delete &#59 /* Out of Province Reciprocal Billing */<br/>run&#59<br/><br/>/*  only those NGS related records are counted */<br/>proc sql&#59&#59<br/>   create table FSC_NGS as <br/>   select distinct FSC, NGS_CATEGORY from DOC.ngs_fsc_sk&#59<br/>   quit&#59 /* 4077 */<br/><br/>proc sql&#59&#59<br/>   create table msb_3 as <br/>   select a.*, b.NGS_CATEGORY <br/>   from msb_2 a, FSC_NGS b <br/>   where a.fsc = b.fsc&#59<br/>quit&#59<br/><br/>proc sql&#59&#59<br/>   create table msb_4 as <br/>   select a.*, b.ENCOUNTER_TYPE, b.PX_CodeType<br/>   from msb_3 a, DOC.EncType b <br/>   where a.NGS_CATEGORY = b.NGS_CATEGORY&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>  create table msb_5 as<br/>  select key_hsn as PatID, dos_1 as ADate, KEY_DOC_NUM as Provider,DIAG, FSC, LOS, ' ' as Facility_Location length=3, . as DDate, <br/>         ' ' as Facility_Code length=3, 'U' as Discharge_Disposition, ' ' as Discharge_Status length=2, ' ' as DRG length=3, ' ' as DRG_Type length=4, ' ' as Admitting_Source length=2,<br/>         ENCOUNTER_TYPE as EncType, PX_CodeType, NGS_CATEGORY<br/>  from msb_4&#59<br/>quit&#59<br/><br/>data msb_6&#59<br/>   set msb_5&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vdos=vvalue(ADate)&#59<br/>   VADate=compress(Vdos,'/')&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'||Provider ||'_'|| EncType&#59<br/>   drop Vdos&#59<br/>run&#59 /* 98636 */<br/><br/>proc sort data= msb_6&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>/*data msb_7&#59*/<br/>/*  length ADate DDate 4.&#59*/<br/>/*  do _n_=0 by 1 until(last.EncounterID)&#59*/<br/>/*  set msb_6&#59*/<br/>/*  by EncounterID&#59*/<br/>/*  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59*/<br/>/*  output&#59*/<br/>/*  end&#59*/<br/>/*  run&#59*/<br/><br/>proc sql&#59<br/>   create table temp.Encounter_msb as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, Discharge_Status,<br/>                   DRG, DRG_Type, Admitting_Source<br/>   from msb_6&#59<br/>quit&#59 /* 159174738*/<br/><br/>/*  if _n_ >0 then EncounterID=cats(EncounterID,'_',_n_)&#59*/<br/>/* 000xxxxx_06082016_31925314671_10 */<br/><br/>proc sql&#59<br/>   create table test as<br/>   select distinct EncounterID from temp.Encounter_msb&#59quit&#59 /* 159174738*/<br/><br/><br/>/**********************************************************************<br/>From Hosp<br/>**********************************************************************/<br/><br/><br/>/*  Hospital */<br/>%let hosp_file          = clean17.CIHI_EOC_2_OND16_23MAY2017&#59<br/> %Extract_CIHI(ds_in            = &hosp_file,<br/>               ds_out           = cdm.hosp, <br/>               dchg_start_date  = &extract_start,&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>               adms_end_date    = &extract_end,<br/>               ICD_field_list   = ,<br/>               ICD9_list        = ,<br/>               ICD9_excl_exact_list =,<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   ICD10_list       = <br/>&nbsp&nbsp&nbsp&nbsp            )&#59<br/><br/>data check_1&#59<br/>   set cdm.hosp&#59<br/>   if DSCHG_DATE='01Jan9999'd&#59<br/>run&#59<br/><br/>/* DS_IP: DS IP OTH  HOSP_NUM : containing missing value */<br/><br/>data check_1&#59<br/>  set cdm.hosp&#59<br/>  if PROV_LOC_SK ^= 'Y'&#59<br/>run&#59<br/><br/>data check_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =. &#59<br/>run&#59<br/><br/>data hosp_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =.  then delete &#59<br/>  if PROV_LOC_SK ^= 'Y' then delete&#59<br/>  if DSCHG_DATE='01Jan9999'd then delete&#59<br/>run&#59<br/><br/>proc tabulate data=hosp_2&#59<br/>var adm_date dschg_date&#59<br/>table adm_date dschg_date, n nmiss (min max median)*f=mmddyy10.&#59<br/>run&#59<br/><br/>data hosp_21 hosp_22 hosp_23 hosp_24 hosp_25&#59<br/>   set hosp_2&#59<br/>    if coding_class_ind ='NA' then output hosp_21 &#59 /* ICD9 */<br/>&nbsp&nbsp&nbsp&nbspelse if coding_class_ind ='0' then output hosp_22 &#59 /* ICD10 */<br/>&nbsp&nbsp&nbsp&nbspelse if CODING_CLASS_IND in ('','9','C') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp     if proc_loc_sk='Y' then output hosp_23&#59 /* ICD9 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else if FY <'200708' then output hosp_24&#59 /* ICD9 and ICD10 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else  output hosp_25&#59 /* ICD9 and ICD10 dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp end&#59<br/>run&#59 <br/><br/>/* ICD9 */<br/>%macro convert_ICD9(in=, out=)&#59<br/>  data convert9&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS FY ENTRY_CODE NEWBORN dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert9(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '09' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CP'&#59<br/>run&#59<br/>%mend convert_ICD9&#59<br/><br/><br/>/* ICD10 */<br/>%macro convert_ICD10(in=, out=)&#59<br/>  data convert10&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS ENTRY_CODE NEWBORN FY dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>run&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert10(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '10' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CI'&#59<br/>run&#59<br/><br/>%mend convert_ICD10&#59<br/><br/>%convert_ICD9(in=hosp_21, out=hosp_21_conv_1)<br/>%convert_ICD10(in=hosp_22, out=hosp_22_conv_1)<br/><br/><br/>/* ICD9 and ICD10 conv_dx_code : 9 and C */<br/>data hosp_24_1&#59<br/>   set hosp_24(drop= dx_code_1-dx_code_25 INTVN_CODE_1-INTVN_CODE_20)&#59<br/>   rename conv_dx_code_1-conv_dx_code_25=dx_code_1-dx_code_25&#59<br/>   rename conv_proc_code_1-conv_proc_code_20=INTVN_CODE_1-INTVN_CODE_20&#59<br/>   run&#59<br/>proc freq data=hosp_24_1&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/>%convert_ICD9(in=hosp_24_1, out=hosp_24_conv_1)<br/><br/><br/>/* ICD9 and ICD10 dx_code */<br/>proc freq data=hosp_25&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/><br/>data hosp_3&#59<br/>  set hosp_21_conv_1 hosp_22_conv_1 hosp_24_conv_1&#59<br/>  hosp_num_c=put(hosp_num,z3.)&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table hosp_4 as<br/>   select a.*, b.Facility_Location<br/>   from hosp_3 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.hosp_num_c=b.hosp_num&#59<br/>quit&#59<br/><br/>data hosp_5(drop=ds_ip)&#59<br/>   length EncType $2&#59<br/>   set hosp_4&#59<br/>   if DS_IP='DS' then  EncType='SD'&#59<br/>   else EncType='IP' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename adm_date=ADate&#59<br/>   rename dschg_date=DDate&#59<br/>   rename HOSP_NUM_C = Facility_Code&#59<br/><br/>run&#59<br/><br/>data hosp_6&#59<br/>   length DRG $3 DRG_Type $4&#59<br/>   set hosp_5&#59<br/>   if EncType='IP' then DRG=CMG&#59<br/>   else if EncType='SD' then DRG=''&#59 <br/>   DRG_Type=''&#59<br/>run&#59<br/><br/>proc freq data=hosp_6&#59<br/>tables DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_7&#59<br/>   set hosp_6&#59<br/>   if DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E'&#59<br/>   else if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A'&#59<br/>   else Discharge_Disposition =' '&#59<br/>run&#59<br/><br/>data hosp_8&#59<br/>   set hosp_7&#59<br/>   Discharge_Status=DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_9&#59<br/>   length Admitting_Source $2&#59<br/>   set hosp_8&#59<br/>   if NEWBORN='NA' then Admitting_Source=ENTRY_CODE&#59<br/>   else Admitting_Source='N'&#59<br/>run&#59<br/><br/>data hosp_10&#59<br/>   set hosp_9&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'||Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=5506 */<br/><br/>proc sort data= hosp_10&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data hosp_11&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set hosp_10&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>data check_1&#59<br/>   set hosp_11&#59<br/>   if DX=''&#59<br/>   run&#59<br/><br/>data check_2&#59<br/>   set hosp_11&#59<br/>   if PX=''&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_hosp as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, Discharge_Status, DRG, DRG_Type, Admitting_Source<br/>   from hosp_11&#59<br/>quit&#59 /* n=2334 */<br/><br/><br/>/**********************************************************************<br/>From ED<br/>**********************************************************************/<br/><br/>proc sql&#59<br/>   create table ED_1 as <br/>   select distinct *<br/>   from hqc.ED_F_2012<br/>   where datepart(xtrc_date)=\"01AUG2013\"d or datepart(xtrc_date)=\"01AUG2014\"d or datepart(xtrc_date)=\"04AUG2015\"d <br/>         or datepart(xtrc_date)=\"08AUG2016\"d or datepart(xtrc_date)=\"12JUL2017\"d<br/>   order by KEY_HSN, REG_DATE&#59<br/>quit&#59<br/>%reformat_datevars (work, ED_1)&#59  /*1219515*/<br/><br/>proc freq data=ED_1&#59<br/>   tables PROV_LOC_SK / missing&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table ED_2 as<br/>   select distinct key_hsn, reg_date, disp_date, visit_disp, mp_prefix, provdr_type_1, mp_dx as Dx length=18, '10' as Dx_Codetype, substr(inst_num,3,3) as Facility_Code length=3<br/>          , adm_ambul<br/>   from ED_1&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>   create table ED_3 as<br/>   select a.*, b.Facility_Location<br/>   from ED_2 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.Facility_Code=b.hosp_num&#59<br/>quit&#59<br/><br/>proc freq data=ED_3&#59<br/>tables adm_ambul&#59<br/>run&#59<br/><br/>data ED_4(drop=visit_disp adm_ambul)&#59<br/>   length EncType $2  Admitting_source $2&#59<br/>   set ED_3&#59<br/>   EncType='ED'&#59<br/>   if visit_disp in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if visit_disp in ('10','11') then Discharge_Disposition ='E'&#59<br/>   else Discharge_Disposition ='A'&#59<br/>   if adm_ambul in ('A','C','G') then Admitting_source='A'&#59<br/>   else Admitting_source='D' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename reg_date=ADate&#59<br/>   rename disp_date=DDate&#59<br/>run&#59<br/><br/>data ED_5&#59<br/>   set ED_4&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'|| Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=1,212,754*/<br/><br/>proc sort data= ED_5&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data ED_6&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set ED_5&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_ED as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, '' as Discharge_Status length=2, '' as DRG<br/>          length=3, '' as DRG_Type length=4, Admitting_source<br/>   from ED_6&#59<br/>quit&#59 /* 1212754 */<br/><br/>/* PDX='P', PAdmit ='M' for all ED visit */<br/>proc sql&#59<br/>   create table temp.Diagnosis_ED as<br/>   select PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, '' as OrigDx length=18, 'M' as PAdmit length=2, 'P' as PDX<br/>   from ED_6<br/>   order by EncounterID&#59<br/>quit&#59 <br/>s///<br/>t///","custparents":[{"idx":"CodeTask-5walNELcwbMmiSXf"}]}],"custparents":[{"idx":"CodeTask-NrDC6oJNN34iBg5x"},{"idx":"CodeTask-9v6iPCWqkuTujJag"}]},{"idx":"CodeTask-nWkLpebRMNlItMcs","name":"get H ED MSB","type":"TASK","NodeDescription":"///t<br/>///s<br/>%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=&remotedatapath,<br/>&nbsp&nbsp&nbsp&nbspzip=enrollment_9618,<br/>&nbsp&nbsp&nbsp&nbspzipped=enrollment_9618,<br/>&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsptarget=enrollment_9618<br/>)&#59<br/><br/>data getCohortData_hosp_tmp0&#59<br/>&nbsp&nbsp&nbsp&nbspset &hospitalFile&#59<br/>&nbsp&nbsp&nbsp&nbspkeep &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspA_LOS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADM_DATE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspALC_LOS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCIHI_REC<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCONV_DX_CODE_1 - Conv_DX_Code_25<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCONV_PROC_CODE_1 - CONV_PROC_CODE_20<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDS_IP<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDSCHG_DATE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX_CODE_1-DX_CODE_25<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX_TYPE_1-DX_TYPE_25<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspHOSP_NUM<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspINST_NUM<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspINTVN_CODE_1-INTVN_CODE_20<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspKEY_HSN<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPROV_LOC_SK<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCMG<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCODING_CLASS_IND<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdpg<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCACS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspT_LOS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspENTRY_CODE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNEWBORN<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDSCHG_DISP<br/>&#59<br/>run&#59<br/><br/><br/>%distinct(data= enrollment_9618, target=ptlist, vars=%str(patid as key_hsn length= 11))&#59<br/><br/>%Extract_CIHI( <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_in =getCohortData_hosp_tmp0,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out=getCohortData_hosp_tmp1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadms_start_date='01jan1994'd,      <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadms_end_date=&DataEndDate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspICD9_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspICD10_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCP_List=,<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCP_Exact_list=,*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCI_list=,<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCCI_Exact_list=,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcode_logic=,*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_list=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsphsn_file= ptlist<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp )&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp /*apply the additional request conditions, force to have the facility num*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata Master_hosp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_hosp_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep A_LOS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADM_DATE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspALC_LOS CIHI_REC<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCONV_DX_CODE_1 - Conv_DX_Code_25<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCONV_PROC_CODE_1 - CONV_PROC_CODE_20<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDS_IP<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDSCHG_DATE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX_CODE_1-DX_CODE_25<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX_TYPE_1-DX_TYPE_25<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspHOSP_NUM<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspINST_NUM<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspINTVN_CODE_1-INTVN_CODE_20<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspKEY_HSN<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPROV_LOC_SK<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspT_LOS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCMG<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCODING_CLASS_IND<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDPG<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCACS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspENTRY_CODE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNEWBORN<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDSCHG_DISP<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_hosp, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remotedatapath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_hosp.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp%getED_A2012(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=&ed_a2012file,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=getCohortData_ED_A2012_tmp1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvars=t1.*,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdistinctRecord=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatientList=ptlist,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcondition = %str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(DatePart(reg_date) >= '01jan1994'd and DatePart(reg_date) <= &DataEndDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor (DatePart(disp_date) >= '01jan1994'd and DatePart(disp_date) <= &DataEndDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor (DatePart(reg_date) < '01jan1994'd and DatePart(disp_date) > &DataEndDate)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp)<br/>&nbsp&nbsp&nbsp&nbsp)&#59<br/><br/><br/>&nbsp&nbsp&nbsp&nbspdata getCohortData_ED_A2012_tmp2&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset getCohortData_ED_A2012_tmp1&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspARRV_DATE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCHRT_NUM<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDATE_PT_LEFT_ED<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDISP_DATE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspED_LOS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspED_VISIT_IND<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspENC_SEQ_NUM<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspINST_NUM<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspKEY_HSN<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspMP_DX<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspMP_PREFIX<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPIA_DATE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPROV_LOC_SK<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspREG_DATE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTRI_DATE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTRI_LEV<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspVISIT_MODE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspvisit_disp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspprovdr_type_1<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspadm_ambul<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif datepart(xtrc_date) <= &Xtrc_End_ED_A2012&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp/*transform all datetime20. format variables to date9. format*/<br/>&nbsp&nbsp&nbsp&nbsp%DateTime20VarsToDate9(data=getCohortData_ED_A2012_tmp2, target = Master_ED_A2012, debug=)&#59 <br/><br/>&nbsp&nbsp&nbsp&nbsp/*zip it into the RemoteT folder*/<br/>/*&nbsp&nbsp&nbsp&nbsp%UnixSplitZips(*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_ED_A2012,*/<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspTargetLib=remoteT, */<br/>/*&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsizeCutoff_GB=)&#59*/<br/>&nbsp&nbsp&nbsp&nbsp%UnixZip(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsPath=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspsource=, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=Master_ED_A2012, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptPath=&remotedatapath, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=Master_ED_A2012.zip, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdebug=<br/>)&#59<br/><br/>/*MSB*/<br/><br/>/*tho following is to prepare a master MSB data for encounter, diagnosis, and procdure*/<br/>/*%Extract_MSB(*/<br/>/*   &nbsp&nbsp&nbsp&nbspds_out&nbsp&nbsp&nbsp&nbsp=&nbsp&nbsp&nbsp&nbspmsb_raw,*/<br/>/*&nbsp&nbsp&nbsp&nbspxtrc_start_dt = &Xtrc_Start_MSB&nbsp&nbsp&nbsp&nbsp,*/<br/>/*&nbsp&nbsp&nbsp&nbspxtrc_end_dt&nbsp&nbsp&nbsp&nbsp= &Xtrc_End_MSB,*/<br/>/*       dostart&nbsp&nbsp&nbsp&nbsp='01jan1994'd,*/<br/>/*    dosend&nbsp&nbsp&nbsp&nbsp=&nbsp&nbsp&nbsp&nbsp&dataEndDate &nbsp&nbsp&nbsp&nbsp,*/<br/>/*    kept_vars =   KEY_HSN KEY_DOC_NUM SPEC MG DIAG FSC NUM_SRV DOS LOS MODE CONTACTS AMT_APP*/<br/>/*)&#59*/<br/><br/>/*%UnixZip(*/<br/>/*&nbsp&nbsp&nbsp&nbspsPath=, */<br/>/*&nbsp&nbsp&nbsp&nbspsource=, */<br/>/*&nbsp&nbsp&nbsp&nbspdata=master_msb, */<br/>/*&nbsp&nbsp&nbsp&nbsptPath=&remotedatapath, */<br/>/*&nbsp&nbsp&nbsp&nbsptarget=master_msb.zip */<br/>/*)&#59*/<br/>/*the above is to prepare a master MSB data for encounter, diagnosis, and procdure*/<br/>s///<br/>t///","custparents":[{"idx":"CodeTask-NrDC6oJNN34iBg5x"}]},{"idx":"CodeTask-9v6iPCWqkuTujJag","name":"diagnosis","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Creating the diagnosis file using SK data<br/>the data set specification can be found at:<br/>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf<br/>downloaded and save in:<br/>P:\\2018 - CDM CNODES (Wenbin  Nedeene  Amanda)\\Documentation\\NewDocsSinceHandOver<br/>*/<br/><br/>/*%freq(data=locald.diagnosis_1, table = drg_type)*/<br/><br/>/*what does it look like in sentinel  file?*/<br/>/*%print(data=locald.diagnosis_1)&#59*/<br/>/*%nobs(data=locald.diagnosis_1)&#59*/<br/>/*%distinct(data=locald.diagnosis_1, target=test, vars=%str(?))&#59*/<br/>/*<br/>proc datasets lib=locald&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=diagnosis_1 order=varnum&#59<br/>run&#59<br/>*/<br/>/*<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp16&nbsp&nbsp&nbsp&nbsp$16.00&nbsp&nbsp&nbsp&nbsp<br/>EncounterID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp15&nbsp&nbsp&nbsp&nbsp$15.00&nbsp&nbsp&nbsp&nbsp<br/>ADate&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspMMDDYY10.&nbsp&nbsp&nbsp&nbspYYMMDD8.<br/>Provider&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp10&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>EncType&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>DX&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp18&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>DX_codetype&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>OrigDX&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp18&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>PDX&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>PAdmit&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1<br/>*/<br/><br/>/*What does wenbin's datafile looks like?*/<br/>/*<br/>%print(data=rOldD.diagnosis)&#59<br/>proc datasets lib=rOldD&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=diagnosis order=varnum&#59<br/>run&#59<br/>*/<br/>/*<br/>Variables in Creation Order&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>#&nbsp&nbsp&nbsp&nbspVariable&nbsp&nbsp&nbsp&nbspType&nbsp&nbsp&nbsp&nbspLen&nbsp&nbsp&nbsp&nbspFormat&nbsp&nbsp&nbsp&nbspInformat&nbsp&nbsp&nbsp&nbspLabel<br/>1&nbsp&nbsp&nbsp&nbspPatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbspKEY_HSN<br/>2&nbsp&nbsp&nbsp&nbspEncounterID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp40&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>3&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspYYMMDD10.&nbsp&nbsp&nbsp&nbspDATETIME20.&nbsp&nbsp&nbsp&nbspADM_DATE<br/>4&nbsp&nbsp&nbsp&nbspProvider&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspKEY_DOC_NUM<br/>5&nbsp&nbsp&nbsp&nbspEncType&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>6&nbsp&nbsp&nbsp&nbspDX&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp18&nbsp&nbsp&nbsp&nbsp$7.00&nbsp&nbsp&nbsp&nbsp$7.00&nbsp&nbsp&nbsp&nbspdiag_code<br/>7&nbsp&nbsp&nbsp&nbspDx_Codetype&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>8&nbsp&nbsp&nbsp&nbspOrigDX&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp18&nbsp&nbsp&nbsp&nbsp$7.00&nbsp&nbsp&nbsp&nbsp$7.00&nbsp&nbsp&nbsp&nbspDIAG<br/>9&nbsp&nbsp&nbsp&nbspPAdmit&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>10&nbsp&nbsp&nbsp&nbspPDX&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp1<br/>*/<br/><br/>/* Decision:<br/>1. Var length and varnum order follow sentinel demo files<br/>*/<br/><br/>/*doc number was $10. which is not enough for SK key_doc_num ($11.)*/<br/>data diagnosis_tmp1a&#59<br/>&nbsp&nbsp&nbsp&nbsplength <br/>&nbsp&nbsp&nbsp&nbspPatID&nbsp&nbsp&nbsp&nbsp$16.&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncounterID&nbsp&nbsp&nbsp&nbsp$15.&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbsp4.<br/>&nbsp&nbsp&nbsp&nbspProvider&nbsp&nbsp&nbsp&nbsp$11.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncType&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp$2.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDX&nbsp&nbsp&nbsp&nbsp$18.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDX_codetype&nbsp&nbsp&nbsp&nbsp$2.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspOrigDX&nbsp&nbsp&nbsp&nbsp$18.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspPDX&nbsp&nbsp&nbsp&nbsp$1.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspPAdmit $1.<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspformat ADate YYMMDD10. &#59<br/>&nbsp&nbsp&nbsp&nbspdelete&#59<br/>run&#59<br/><br/><br/>/*where is wenbin's code?<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/><br/>/**************************************************************************<br/>Part 1 diagnosiss from MSB<br/>****************************************************************************/<br/>/*<br/>&nbsp&nbsp&nbsp&nbspPatID&nbsp&nbsp&nbsp&nbsp= key_hsn&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncounterID&nbsp&nbsp&nbsp&nbsp<- EncounterID from the zip file<br/>&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbsp= dos_1<br/>&nbsp&nbsp&nbsp&nbspProvider = key_doc_num&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncType <- enctype.encytype <- ngs_fsc_sk.fsc <- msb_master.fsc<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIt seems that a more efficient way is to make a mapping between enctype and fsc directly.<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmake a mapping between enctype and fsc<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe NGSfile and the enctype file has been defined in local and remote setting<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor local<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theNGSfile = localskd.NGS_FSC_SK&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor remote<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theNGSfile = rOldDoc.NGS_FSC_SK&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor local<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theEncTypeFile = localskd.Enctype&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor remote<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theEncTypeFile = rOldDoc.Enctype&#59<br/>&nbsp&nbsp&nbsp&nbspOrigDX&nbsp&nbsp&nbsp&nbsp$18. = diag&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDX&nbsp&nbsp&nbsp&nbsp$18.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp1) diag begins with 'Z': <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdiag <-  sk_zdiag_to_icd9.diag_code <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp(mapped by sk_zdiag_to_icd9.diag_orig_code = sk_zdiag_to_icd9.diag_code)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspor ' ' if unmatched<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2) else:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX = OrigDx<br/><br/>&nbsp&nbsp&nbsp&nbspDX_codetype&nbsp&nbsp&nbsp&nbsp$2.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp1) diag begins with 'Z':<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif  DX=' ' then Dx_Codetype = 'OT'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse Dx_Codetype = '09'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2) Dx_Codetype = '09'&#59<br/>&nbsp&nbsp&nbsp&nbspPDX&nbsp&nbsp&nbsp&nbsp$1.&nbsp&nbsp&nbsp&nbsp=''&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspPAdmit $1. = 'U' (Wenbin put it as ' ', but in the tech_doc it did not say that a missing value is allowed.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmake sense to me to put U for unknown or unable to determine.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspI did not use X (unreported/not used). I am afraid records tagged as X would be ignored in <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe future analyses, which is not expected.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp).<br/><br/>*/<br/><br/>/*<br/>%UnixUnZip(<br/>&nbsp&nbsp&nbsp&nbspsPath=&remotedatapath,<br/>&nbsp&nbsp&nbsp&nbspzip=master_msb,<br/>&nbsp&nbsp&nbsp&nbspzipped=master_msb,<br/>&nbsp&nbsp&nbsp&nbsptPath=,<br/>&nbsp&nbsp&nbsp&nbsptarget=master_msb<br/>)&#59<br/>*/<br/><br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\master_msb.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(master_msb.sas7bdat)<br/>)&#59<br/><br/>/*%print(data=master_msb)&#59*/<br/>/*%nobs(data=master_msb)&#59*/<br/><br/>/*keep those NOT with a mode of 'z', and dos between 1996 and 2018*/<br/>data diagnosis_tmp1b&#59<br/>&nbsp&nbsp&nbsp&nbspset master_msb&#59<br/>&nbsp&nbsp&nbsp&nbspwhere MODE ne 'Z' and dos_1 between '01jan1996'd and '31dec2018'd&#59<br/>&nbsp&nbsp&nbsp&nbspkeep key_hsn key_doc_num diag fsc dos_1&#59<br/>run&#59<br/>proc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbspdelete MASTER_MSB&#59<br/>run&#59<br/><br/>/*According to Wenbin's code, the following steps are to take to keep the relevant data<br/>2. only keep those with FSCs specified in the file ngs_fsc_sk.sas7bdat<br/>&nbsp&nbsp&nbsp&nbspremote: /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document<br/>&nbsp&nbsp&nbsp&nbsplocal: P:\\2018 - CDM CNODES (Wenbin  Nedeene  Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\<br/>3. The encType is mapped out by the ngs_category in the file enctype.sas7bdat<br/>&nbsp&nbsp&nbsp&nbspremote: /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document<br/>&nbsp&nbsp&nbsp&nbsplocal: P:\\2018 - CDM CNODES (Wenbin  Nedeene  Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\<br/><br/>So combining 2 and 3:<br/>The enctype in the final data set is defined by <br/>&nbsp&nbsp&nbsp&nbspenctype <- enctype.encytype <- ngs_fsc_sk.fsc <- msb_master.fsc<br/>It seems that a more efficient way is to make a mapping between enctype and fsc directly.<br/>*/<br/><br/>/*make a mapping between enctype and fsc*/<br/>/*the NGSfile and the enctype file has been defined in local and remote setting*/<br/>/*for local*/<br/>/*%let theNGSfile = localskd.NGS_FSC_SK&#59*/<br/>/*for remote*/<br/>/*%let theNGSfile = rOldDoc.NGS_FSC_SK&#59*/<br/>/*for local*/<br/>/*%let theEncTypeFile = localskd.Enctype&#59*/<br/>/*for remote*/<br/>/*%let theEncTypeFile = rOldDoc.Enctype&#59*/<br/><br/>/*%print(data=&theNGSfile)&#59*/<br/>/*%print(data=&theEncTypeFile)&#59*/<br/>/*for all the fsc in theNGSfile, find the enctype in the Enctype file<br/>Note: In Wenbin's code (making msb_3), it only keeps the records with a fsc that can be matched to a ngs_category.<br/>&nbsp&nbsp&nbsp&nbsphence the inner join here<br/>*/<br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=&theNGSfile,<br/>&nbsp&nbsp&nbsp&nbspt2=&theEncTypeFile,<br/>&nbsp&nbsp&nbsp&nbspTarget=diagnosis_tmp1c,<br/>&nbsp&nbsp&nbsp&nbspdistinct=1,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.fsc, ifc(t1.NGS_Category='', '_M', t1.NGS_Category) as NGS_Category, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspifc(t2.Encounter_type='', '_M', t2.Encounter_type) as EncType length=2),<br/>&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbspjvars= NGS_Category<br/>)&#59<br/>/*4077 rows */<br/>/*%distinct(data=diagnosis_tmp1b, vars=fsc, target=test)&#59*/<br/>/*4077 rows. The above shows that in tmp1b, there is no duplicated fsc code (i.e., fsc is not repeated assigned to different EncType)*/<br/>/*However, the following shows that the majority of fsc codes cannot be matched to the enctypes<br/>&nbsp&nbsp&nbsp&nbspThese unmatched fsc codes are given a enctype of '_M', standing for enctype not matched, and data is from the MSB file<br/>*/<br/>/*%freq(data=diagnosis_tmp1b,table=enctype)&#59*/<br/><br/>/*1. From master_msb,  keep records between 1996 and 2018<br/>&nbsp&nbsp&nbsp&nbspexcluding<br/>&nbsp&nbsp&nbsp&nbsp1) those out of province billing (MODE='z')<br/>&nbsp&nbsp&nbsp&nbsp2) having a fsc code not in diagnosis_tmp1b<br/>*/<br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=&nbsp&nbsp&nbsp&nbspdiagnosis_tmp1b,<br/>&nbsp&nbsp&nbsp&nbspt2 = diagnosis_tmp1c,<br/>&nbsp&nbsp&nbsp&nbsptarget=diagnosis_tmp1d,<br/>&nbsp&nbsp&nbsp&nbspdistinct=1,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.key_hsn as PatID, t1.key_doc_num as Provider, t1.dos_1 as ADate, t1.diag,t1.fsc,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspt2.EncType, t2.NGS_Category<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp),<br/>&nbsp&nbsp&nbsp&nbspjtype=inner,<br/>&nbsp&nbsp&nbsp&nbspjvars=fsc,<br/>&nbsp&nbsp&nbsp&nbsporderby=%str(ADate, PatID, Provider, EncType)<br/>)&#59<br/>/*nobs*/<br/>%beep&#59<br/>proc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbspdelete diagnosis_tmp1c &#59<br/>run&#59<br/><br/><br/>/*add a column to indicate the z_dx*/<br/>/*for local*/<br/>/*%let theDiagMapFile=localskd.SK_ZDIAG_TO_ICD9&#59*/<br/>/*for remote*/<br/>/*%let theDiagMapFile=rOldDoc.SK_ZDIAG_TO_ICD9&#59*/<br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=&nbsp&nbsp&nbsp&nbspdiagnosis_tmp1d,<br/>&nbsp&nbsp&nbsp&nbspt2 = &theDiagMapFile,<br/>&nbsp&nbsp&nbsp&nbsptarget=diagnosis_tmp1e,<br/>&nbsp&nbsp&nbsp&nbspdistinct=1,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, t2.diag_code),<br/>&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbspjterm=%str(t1.diag = t2.diag_orig_code),<br/>&nbsp&nbsp&nbsp&nbsporderby=%str(ADate, PatID, Provider, EncType)<br/>)&#59<br/>/*nobs=*/<br/>%beep&#59<br/>proc datasets nolist&#59<br/>&nbsp&nbsp&nbsp&nbspdelete diagnosis_tmp1d &#59<br/>run&#59<br/><br/>/*Note:<br/>&nbsp&nbsp&nbsp&nbspEncounterID is specific for patid-provider-adate-enctype<br/>&nbsp&nbsp&nbsp&nbspfor the same patid-provider-adate-enctype combination in diagnosis file, <br/>&nbsp&nbsp&nbsp&nbspEncounterID should be the same in the diagnosis file as in the encounter file, and in the procedure file<br/>*/<br/>/*for now, to save file size, use a 8-byte length i instead of the final 15 byte length EncounterID*/<br/>data diagnosis_tmp1f&#59<br/>&nbsp&nbsp&nbsp&nbspretain i&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp1e &#59<br/>&nbsp&nbsp&nbsp&nbspby ADate PatID Provider EncType&#59<br/>&nbsp&nbsp&nbsp&nbspif first.EncType then i+1&#59<br/>&nbsp&nbsp&nbsp&nbspOrigDX = diag&#59<br/>&nbsp&nbsp&nbsp&nbspif diag in: ('Z') then DX = diag_code&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX = OrigDX&#59<br/>&nbsp&nbsp&nbsp&nbspif DX='' then DX_codetype='OT'&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX_codetype='09'&#59<br/>&nbsp&nbsp&nbsp&nbspPX = NGS_Category&#59<br/>&nbsp&nbsp&nbsp&nbspOrigPX = FSC&#59<br/>&nbsp&nbsp&nbsp&nbspdrop diag FSC&#59<br/>run&#59<br/>%beep&#59<br/>/*proc datasets nolist&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete diagnosis_tmp1e &#59*/<br/>/*run&#59*/<br/><br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=diagnosis_tmp1f.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=diagnosis_tmp1f, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/>%beep&#59<br/><br/>/*have disticnt records:*/<br/>%distinct(<br/>&nbsp&nbsp&nbsp&nbspdata=diagnosis_tmp1f,<br/>&nbsp&nbsp&nbsp&nbsptarget=diagnosis_tmp1g,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatID,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcat('M', put(i, z14.)) as EncounterID length=15,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADate,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProvider,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncType,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDx_codetype,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspOrigDX,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp'U' as PAdmit length=1<br/>&nbsp&nbsp&nbsp&nbsp)<br/>)&#59<br/>%beep&#59<br/><br/>data diagnosis_msb&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp1a diagnosis_tmp1g&#59<br/>run&#59<br/><br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=diagnosis_msb.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=diagnosis_msb, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/>%beep&#59<br/><br/><br/><br/>&nbsp&nbsp&nbsp&nbsp<br/>/**************************************************************************<br/>Part 2 diagnosiss from hospital<br/>****************************************************************************/<br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\master_hosp.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(master_hosp.sas7bdat)<br/>)&#59<br/>/*%print(data=master_hosp)&#59*/<br/>/*proc datasets&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspcontents data=master_hosp&#59*/<br/>/*run&#59*/<br/><br/>/* For diagnosiss from hospital:<br/>/*<br/>&nbsp&nbsp&nbsp&nbspPatID&nbsp&nbsp&nbsp&nbsp= key_hsn&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncounterID&nbsp&nbsp&nbsp&nbsp<- EncounterID from the cihi_rec (like H0000xxx)<br/>&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbsp= adm_date<br/>&nbsp&nbsp&nbsp&nbspProvider <- facility_code&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncType <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif DS_IP='DS' then  EncType='SD'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else EncType='IP' &#59<br/>&nbsp&nbsp&nbsp&nbspOrigDX&nbsp&nbsp&nbsp&nbsp$18. = DX&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDX&nbsp&nbsp&nbsp&nbsp$18.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdepending on the CODING_CLASS_IND<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif CODING_CLASS_IND = 'NA', ICD 9 code in dx_code_1 to 25<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif CODING_CLASS_IND = '0', ICD 10 code in dx_code_1 to 25<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif CODING_CLASS_IND = '', '9', 'c', ICD 9 code in conv_dx_code_1 to 25<br/>&nbsp&nbsp&nbsp&nbspDX_codetype&nbsp&nbsp&nbsp&nbsp$2.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp1) diag begins with 'Z':<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif  DX=' ' then Dx_Codetype = 'OT'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse Dx_Codetype = '09'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp2) Dx_Codetype = '09'&#59<br/>&nbsp&nbsp&nbsp&nbspPDX&nbsp&nbsp&nbsp&nbsp$1.&nbsp&nbsp&nbsp&nbsp=''&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif PAdmit ='M' then PDX='P' &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse if PAdmit ='N' or PAdmit=''  then PDX ='X'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse PDX ='S'&#59<br/>&nbsp&nbsp&nbsp&nbspPAdmit = substr(DxType,1,1)&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspAccording to Wenbin's code<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPAdmit = substr(DxType,1,1)&#59<br/>*/<br/><br/>/*1. According to Wenbin's code:<br/>remove records if<br/>&nbsp&nbsp&nbsp&nbspDSCHG_DATE='01Jan9999'd&#59<br/>&nbsp&nbsp&nbsp&nbspPROV_LOC_SK ^= 'Y'&#59<br/>&nbsp&nbsp&nbsp&nbsphosp_num =.<br/>*/<br/>/*%nobs(data=master_hosp)&#59*/<br/><br/>data diagnosis_tmp2a&#59<br/>  set master_hosp&#59<br/>  where hosp_num ne . and PROV_LOC_SK = 'Y' and DSCHG_DATE ne '01Jan9999'd <br/>&nbsp&nbsp&nbsp&nbspand adm_date between &datastartdate and &dataenddate&#59<br/>run&#59<br/><br/><br/>/*According to Wenbin's code, this part is to determine whether to use ICD9 or ICD10 code.<br/>&nbsp&nbsp&nbsp&nbspHowever, it is quite confusing in Wenbin's code:<br/><br/>&nbsp&nbsp&nbsp&nbsp1. As in the dictionary:<br/>&nbsp&nbsp&nbsp&nbspA code which identifies the classification system used for recording Diagnoses and Procedures.   <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp0 = ICD 10&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspC = ICD9CM (converted to ICD9/CCP), <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp9 = ICD9/CCP, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspblank=reciprocal billing claims without a matching CIHI record<br/>&nbsp&nbsp&nbsp&nbspThis is not inline with the following code.<br/>&nbsp&nbsp&nbsp&nbsp2. those of proc_loc_sk ne 'Y' has been deleted in the above step, there should not be any output  to diagnosis_tmp2b3!<br/>*/<br/>/*It seems that:<br/>1. if the coding_class_ind is 'NA', the diagnositc codes are in dx_code_1 to 25, but are icd 9 codes<br/>2. if the coding_class_ind is '0', the diagnositc codes are in dx_code_1 to 25, and are icd 10 codes<br/>3. if the coding_class_ind is missing, c, or 9 , the diagnositc codes are in conv_dx_code_1 to 25, and are icd 9 codes<br/>*/<br/>data <br/>&nbsp&nbsp&nbsp&nbspdiagnosis_tmp2b1 <br/>&nbsp&nbsp&nbsp&nbspdiagnosis_tmp2b2 <br/>&nbsp&nbsp&nbsp&nbspdiagnosis_tmp2b3 <br/>&nbsp&nbsp&nbsp&nbspdiagnosis_tmp2b4 <br/>&nbsp&nbsp&nbsp&nbspdiagnosis_tmp2b5&#59<br/>   set diagnosis_tmp2a&#59<br/>    if coding_class_ind ='NA' then output diagnosis_tmp2b1 &#59 /* ICD9 codes in dx_code_1 to 25*/<br/>&nbsp&nbsp&nbsp&nbspelse if coding_class_ind ='0' then output diagnosis_tmp2b2 &#59 /* ICD10 in dx_code_1 to 25 */<br/>&nbsp&nbsp&nbsp&nbspelse if CODING_CLASS_IND in ('','9','C') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp     if proc_loc_sk='Y' then output diagnosis_tmp2b3&#59 /* no such records*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else if FY <'200708' then output diagnosis_tmp2b4&#59 /* ICD9 codes in conv_dx_code_1 to 25 */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else  output diagnosis_tmp2b5&#59 /* should not have such records */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp end&#59<br/>run&#59 <br/>%beep&#59<br/><br/>/*Yep, the results are only in 3 tables (b1, b2, and b4) out of the 5*/<br/><br/>/* A macro to deal with dx and intervention codes*/<br/>%macro GetDxCode(data=, target=,dxPrefix=, intvnPrefix=,  dxCodeType=, PxCodeType=)&#59<br/>&nbsp&nbsp&nbsp&nbsp%local data target dxPrefix intvnPrefix dxCodeType PxCodeType &#59<br/><br/>&nbsp&nbsp&nbsp&nbspdata &target&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspset &data&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsplength DX $18.  DxType $2. PX $11. DX_CodeType $2. PX_CodeType $2.&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsparray d[25] $ &dxPrefix._1 - &dxPrefix._25&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsparray t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsparray p[20] $ &intvnPrefix._1 - &intvnPrefix._20&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get diagnostic codes 1 to 25, if the field is not missing, and not 'NA'*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdo i=1 to 25&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif d[i] ne '' and d[i] ne 'NA' then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX=d[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX_CodeType = symget('dxCodeType') &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*The following two line is to ensure that when DX has a value, PX does not have a value<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspAs such, the DX and PX records are mutually exclusive*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX=''&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX_CodeType=''&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprecType='DX'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*get intervention codes 1 to 20, if the field is not missing, and not 'NA'*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif i <=20 then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif strip(p[i]) ne '' and p[i] ne 'NA' then do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX_CodeType = symget('PxCodeType')&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp/*The following two line is to ensure that when PX has a value, DX does not have a value<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspAs such, the DX and PX records are mutually exclusive*/<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX=''&#59 <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX_CodeType=''&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprecType='PX'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspoutput&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkeep <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcihi_rec <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspkey_hsn adm_date dschg_date <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcoding_class_ind <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspINST_NUM <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspHOSP_NUM &nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDS_IP CMG DPG CACS FY <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspENTRY_CODE NEWBORN <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdschg_disp <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDXType<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX_CodeType<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX_CodeType<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsprecType<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsprun&#59&nbsp&nbsp&nbsp&nbsp<br/><br/>%mend GetDxCode&#59<br/><br/><br/>/* Dealing with ICD9 codes in dx_code_1 to 25 (2b1) */<br/>%GetDxCode(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=diagnosis_tmp2b1, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=diagnosis_tmp2c1,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxPrefix=dx_code, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspintvnPrefix=INTVN_CODE,  <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxCodeType=09, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPxCodeType=CP<br/>)&#59<br/>/* Dealing with ICD10 codes in dx_code_1 to 25 (2b2) */<br/>%GetDxCode(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=diagnosis_tmp2b2, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=diagnosis_tmp2c2,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxPrefix=dx_code, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspintvnPrefix=INTVN_CODE,  <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxCodeType=10, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPxCodeType=CI<br/>)&#59<br/><br/>/* Dealing with ICD9 codes in conv_dx_code_1 to 25 (2b4) */<br/>%GetDxCode(<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdata=diagnosis_tmp2b4, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsptarget=diagnosis_tmp2c4,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxPrefix=conv_dx_code, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspintvnPrefix=CONV_PROC_CODE,  <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspdxCodeType=09, <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPxCodeType=CP<br/>)&#59<br/><br/>/*combine the 3 tables with DX/PX data*/<br/>data diagnosis_tmp2c&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp2c1 diagnosis_tmp2c2 diagnosis_tmp2c4&#59<br/>run&#59<br/><br/><br/>/*link to facLoc file to get file location*/<br/>/*%print(data=&theFacLocFile)&#59*/<br/>/*%print(data=diagnosis_tmp2a)&#59*/<br/>data diagnosis_tmp2d&#59<br/>&nbsp&nbsp&nbsp&nbspset &theFacLocFile&#59<br/>&nbsp&nbsp&nbsp&nbsphosp_num_N = input(hosp_num, 8.)&#59<br/>run&#59<br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=diagnosis_tmp2c,<br/>&nbsp&nbsp&nbsp&nbspt2=diagnosis_tmp2d,<br/>&nbsp&nbsp&nbsp&nbsptarget=diagnosis_tmp2e,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, t2.hosp_num as hosp_num_C length=3, t2.facility_location),<br/>&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbspjterm=%str(t1.hosp_num = t2.hosp_num_N)<br/>)&#59<br/>/*define other variables*/<br/>data diagnosis_tmp2f&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp2e&#59<br/>&nbsp&nbsp&nbsp&nbsplength Admitting_Source $2. PAdmit $1.&#59<br/>&nbsp&nbsp&nbsp&nbsprename Key_hsn = PatID adm_date = ADate dschg_date = DDate hosp_num_C= Facility_Code &#59<br/>&nbsp&nbsp&nbsp&nbspprovider = hosp_num_C&#59<br/>&nbsp&nbsp&nbsp&nbspif DS_IP='DS' then  EncType='SD'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else EncType='IP' &#59<br/>&nbsp&nbsp&nbsp&nbspif DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspif DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else Discharge_Disposition ='_'&#59&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspDischarge_Status  = 'UN'&#59<br/>&nbsp&nbsp&nbsp&nbspif EncType='IP' then DRG=CMG&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   else if EncType='SD' then DRG='_'&#59 <br/>&nbsp&nbsp&nbsp&nbspDRG_Type=''&#59<br/>&nbsp&nbsp&nbsp&nbspif NEWBORN='NA' then Admitting_Source=ENTRY_CODE&#59<br/>   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse Admitting_Source='N'&#59<br/>&nbsp&nbsp&nbsp&nbspEncounterID = 'H' || put(CIHI_Rec, z14.)&#59<br/>&nbsp&nbsp&nbsp&nbspPAdmit = substr(DxType,1,1)&#59<br/>&nbsp&nbsp&nbsp&nbspif PAdmit ='M' then PDX='P' &#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse if PAdmit ='N' or PAdmit=''  then PDX ='X'&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse PDX ='S'&#59<br/>&nbsp&nbsp&nbsp&nbspdrop <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPROV_LOC_SK<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCIHI_REC<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspINST_NUM<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDS_IP<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspHOSP_NUM&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspT_LOS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspA_LOS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspALC_LOS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCMG<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCODING_CLASS_IND<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDPG<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspCACS<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspENTRY_CODE<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNEWBORN<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDSCHG_DISP<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/><br/><br/>/*to keep cols for the diagnosis table<br/>&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code, the OrigDx was set to missing for Hosp records<br/>&nbsp&nbsp&nbsp&nbsphowever, the tech spec says it should be the same as DX<br/>&nbsp&nbsp&nbsp&nbspDecision: keep it as the same as DX<br/>*/<br/>data diagnosis_tmp2g&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp2f&#59<br/>&nbsp&nbsp&nbsp&nbsplength OrigDX $18. &#59 <br/>&nbsp&nbsp&nbsp&nbspwhere recType='DX'&#59<br/>&nbsp&nbsp&nbsp&nbspOrigDX = DX&#59<br/>&nbsp&nbsp&nbsp&nbspkeep <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatID<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncounterID<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADate<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProvider<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncType<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspOrigDX<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX_codetype<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPDX<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPAdmit<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>/*apply format defined in tmp1a*/<br/>data diagnosis_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp1a diagnosis_tmp2g&#59<br/>run&#59<br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=diagnosis_hosp.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=diagnosis_hosp, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/><br/>/**************************************************************************<br/>Part 3 diagnosiss from emergency department<br/>****************************************************************************/<br/>/*<br/>inclusion:<br/>PROV_LOC_SK = 'Y'<br/>reg_date ne .<br/>reg_date between 1996 and 2018 <br/>key_hsn ne .<br/>*/<br/><br/><br/>/* For diagnosis from ED:<br/>&nbsp&nbsp&nbsp&nbspPatID&nbsp&nbsp&nbsp&nbsp= key_hsn&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncounterID&nbsp&nbsp&nbsp&nbsp<- EncounterID from a unique raw record ID created when import ed data (like E0000xxx)<br/>&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbsp= Reg_date<br/>&nbsp&nbsp&nbsp&nbspProvider <- facility_code&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncType&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code:<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= 'ED'<br/>&nbsp&nbsp&nbsp&nbspOrigDX&nbsp&nbsp&nbsp&nbsp$18. = DX&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspDX&nbsp&nbsp&nbsp&nbsp$18. <- mp_dx<br/>&nbsp&nbsp&nbsp&nbspDX_codetype&nbsp&nbsp&nbsp&nbsp$2.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<- '10'<br/>&nbsp&nbsp&nbsp&nbspPDX&nbsp&nbsp&nbsp&nbsp$1.&nbsp&nbsp&nbsp&nbsp='P'&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspPAdmit = 'M'<br/>*/<br/><br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\master_ed_a2012.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(master_ed_a2012.sas7bdat)<br/>)&#59<br/>%print(data=master_ed_a2012)&#59<br/>data diagnosis_tmp3a&#59<br/>&nbsp&nbsp&nbsp&nbspEncounterID=&nbsp&nbsp&nbsp&nbsp'E' || put(_N_, z14.)&#59<br/>&nbsp&nbsp&nbsp&nbspset master_ed_a2012&#59<br/>&nbsp&nbsp&nbsp&nbspwhere <br/>&nbsp&nbsp&nbsp&nbspPROV_LOC_SK = 'Y' and<br/>&nbsp&nbsp&nbsp&nbspreg_date ne . and <br/>&nbsp&nbsp&nbsp&nbspreg_date between '01jan1996'd and '31dec2018'd and  <br/>&nbsp&nbsp&nbsp&nbspkey_hsn ne ''&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbsplength hosp_num $3.&#59<br/>&nbsp&nbsp&nbsp&nbsphosp_num=substr(inst_num, 3,3)&#59<br/>run&#59<br/><br/>/*link to facLoc file to get file location*/<br/>/*%print(data=&theFacLocFile)&#59*/<br/>/*%print(data=diagnosis_tmp3a)&#59*/<br/>%sqljoinv2(<br/>&nbsp&nbsp&nbsp&nbspt1=diagnosis_tmp3a,<br/>&nbsp&nbsp&nbsp&nbspt2=&theFacLocFile,<br/>&nbsp&nbsp&nbsp&nbsptarget=diagnosis_tmp3b,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(t1.*, t2.facility_location),<br/>&nbsp&nbsp&nbsp&nbspjtype=left,<br/>&nbsp&nbsp&nbsp&nbspjvars=hosp_num<br/>)&#59<br/><br/>data diagnosis_tmp3c&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp3b&#59<br/>&nbsp&nbsp&nbsp&nbsplength <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX $18. DX_Codetype $2. OrigDX $18. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX $11. PX_Codetype $2. OrigPX $18. <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPAdmit $1.<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspPatID = key_hsn&#59<br/>&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbsp= Reg_date&#59<br/>&nbsp&nbsp&nbsp&nbspDDate&nbsp&nbsp&nbsp&nbsp= disp_date&#59<br/>&nbsp&nbsp&nbsp&nbspfacility_code = hosp_num&#59<br/>&nbsp&nbsp&nbsp&nbspProvider= facility_code&#59<br/>&nbsp&nbsp&nbsp&nbspEncType='ED'&#59<br/>&nbsp&nbsp&nbsp&nbspif visit_disp in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>&nbsp&nbsp&nbsp&nbspelse do&#59<br/>&nbsp&nbsp&nbsp&nbsp   if visit_disp in ('10','11') then Discharge_Disposition ='E'&#59<br/>&nbsp&nbsp&nbsp&nbsp   else Discharge_Disposition ='A'&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>&nbsp&nbsp&nbsp&nbspif adm_ambul in ('A','C','G') then Admitting_source='A'&#59<br/>   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspelse Admitting_source='D' &#59<br/>&nbsp&nbsp&nbsp&nbspDX = mp_dx&#59<br/>&nbsp&nbsp&nbsp&nbspDx_Codetype = '10'&#59<br/>&nbsp&nbsp&nbsp&nbspOrigDX=DX&#59<br/>&nbsp&nbsp&nbsp&nbspPAdmit='M'&#59<br/>&nbsp&nbsp&nbsp&nbspPDX='P'&#59<br/>/*&nbsp&nbsp&nbsp&nbspkeep EncounterID PatID ADate DDate Facility_Location facility_code Provider EncType Discharge_Disposition Admitting_source&#59*/<br/>run&#59<br/><br/>data diagnosis_tmp3d&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp3c&#59<br/>&nbsp&nbsp&nbsp&nbspkeep<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatID<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncounterID<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADate<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProvider &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncType&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspOrigDX&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspDX_codetype<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPDX&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPAdmit<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>data diagnosis_ed&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp1a diagnosis_tmp3d&#59<br/>run&#59<br/><br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=diagnosis_ed.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=diagnosis_ed, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/><br/><br/>/*******************************************************************************<br/>Putting together<br/>*******************************************************************************/<br/><br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\diagnosis_msb.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(diagnosis_msb.sas7bdat)<br/>)&#59<br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\diagnosis_hosp.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(diagnosis_hosp.sas7bdat)<br/>)&#59<br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\diagnosis_ed.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(diagnosis_ed.sas7bdat)<br/>)&#59<br/><br/>data diagnosis_9618&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_msb diagnosis_hosp diagnosis_ed&#59<br/>run&#59<br/><br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=diagnosis_9618.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=diagnosis_9618, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/><br/>%beep&#59<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-QmN7xlRFu8BgDFpZ","name":"Wenbin's diagnosis","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Webin's code for diagnosis file<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/**********************************************************************<br/>From MSB<br/>**********************************************************************/<br/><br/>/* SCDM: 4.2 Diagnosis Table */<br/>proc sql&#59<br/>   create table Diagnosis_msb_1 as<br/>   select distinct PatID, EncounterID, ADate, Provider, EncType, DIAG as OrigDX length=18, FSC <br/>   from msb_6&#59<br/>quit&#59<br/><br/>data Diagnosis_msb_21 Diagnosis_msb_22&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_1&#59<br/>&nbsp&nbsp&nbsp&nbspif  upcase(substr(OrigDX,1,1))='Z' then output Diagnosis_msb_21&#59<br/>&nbsp&nbsp&nbsp&nbspelse output Diagnosis_msb_22&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table Diagnosis_msb_31 as<br/>   select a.*, b.diag_code as DX length=18<br/>   from Diagnosis_msb_21 a<br/>   left join <br/>   doc.sk_zdiag_to_icd9 b<br/>   on a.OrigDX=b.diag_orig_code&#59<br/>quit&#59<br/><br/>proc sql&#59<br/> select distinct OrigDX from Diagnosis_msb_31<br/> where DX=' '&#59<br/>quit&#59<br/><br/>/*The following Z codes do not have the matching:  Z31 Z33 Z34 Z35 Z36 Z37 Z53 Z75*/<br/><br/>data Diagnosis_msb_41&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_31&#59<br/>&nbsp&nbsp&nbsp&nbspif  DX=' ' then Dx_Codetype = 'OT'&#59<br/>&nbsp&nbsp&nbsp&nbspelse Dx_Codetype = '09'&#59<br/>run&#59<br/><br/>data Diagnosis_msb_42&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_22&#59<br/>&nbsp&nbsp&nbsp&nbsp    DX = OrigDX&#59<br/>&nbsp&nbsp&nbsp&nbsp    Dx_Codetype = '09'&#59<br/>run&#59<br/><br/>data Diagnosis_msb_5&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_41<br/>        Diagnosis_msb_42<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table temp.DIAGNOSIS_MSB as<br/>   select distinct PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, OrigDX, ' '  as PAdmit length=2, ' ' as PDX<br/>   from Diagnosis_msb_5&#59<br/>quit&#59<br/><br/><br/>/**********************************************************************<br/>From Hosp<br/>**********************************************************************/<br/><br/>/*  Hospital */<br/>%let hosp_file          = clean17.CIHI_EOC_2_OND16_23MAY2017&#59<br/> %Extract_CIHI(ds_in            = &hosp_file,<br/>               ds_out           = cdm.hosp, <br/>               dchg_start_date  = &extract_start,&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>               adms_end_date    = &extract_end,<br/>               ICD_field_list   = ,<br/>               ICD9_list        = ,<br/>               ICD9_excl_exact_list =,<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   ICD10_list       = <br/>&nbsp&nbsp&nbsp&nbsp            )&#59<br/><br/>data check_1&#59<br/>   set cdm.hosp&#59<br/>   if DSCHG_DATE='01Jan9999'd&#59<br/>run&#59<br/><br/>/* DS_IP: DS IP OTH  HOSP_NUM : containing missing value */<br/><br/>data check_1&#59<br/>  set cdm.hosp&#59<br/>  if PROV_LOC_SK ^= 'Y'&#59<br/>run&#59<br/><br/>data check_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =. &#59<br/>run&#59<br/><br/>data hosp_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =.  then delete &#59<br/>  if PROV_LOC_SK ^= 'Y' then delete&#59<br/>  if DSCHG_DATE='01Jan9999'd then delete&#59<br/>run&#59<br/><br/>proc tabulate data=hosp_2&#59<br/>var adm_date dschg_date&#59<br/>table adm_date dschg_date, n nmiss (min max median)*f=mmddyy10.&#59<br/>run&#59<br/><br/>data hosp_21 hosp_22 hosp_23 hosp_24 hosp_25&#59<br/>   set hosp_2&#59<br/>    if coding_class_ind ='NA' then output hosp_21 &#59 /* ICD9 */<br/>&nbsp&nbsp&nbsp&nbspelse if coding_class_ind ='0' then output hosp_22 &#59 /* ICD10 */<br/>&nbsp&nbsp&nbsp&nbspelse if CODING_CLASS_IND in ('','9','C') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp     if proc_loc_sk='Y' then output hosp_23&#59 /* ICD9 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else if FY <'200708' then output hosp_24&#59 /* ICD9 and ICD10 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else  output hosp_25&#59 /* ICD9 and ICD10 dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp end&#59<br/>run&#59 <br/><br/>/* ICD9 */<br/>%macro convert_ICD9(in=, out=)&#59<br/>  data convert9&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS FY ENTRY_CODE NEWBORN dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert9(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '09' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CP'&#59<br/>run&#59<br/>%mend convert_ICD9&#59<br/><br/><br/>/* ICD10 */<br/>%macro convert_ICD10(in=, out=)&#59<br/>  data convert10&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS ENTRY_CODE NEWBORN FY dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>run&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert10(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '10' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CI'&#59<br/>run&#59<br/><br/>%mend convert_ICD10&#59<br/><br/>%convert_ICD9(in=hosp_21, out=hosp_21_conv_1)<br/>%convert_ICD10(in=hosp_22, out=hosp_22_conv_1)<br/><br/><br/>/* ICD9 and ICD10 conv_dx_code : 9 and C */<br/>data hosp_24_1&#59<br/>   set hosp_24(drop= dx_code_1-dx_code_25 INTVN_CODE_1-INTVN_CODE_20)&#59<br/>   rename conv_dx_code_1-conv_dx_code_25=dx_code_1-dx_code_25&#59<br/>   rename conv_proc_code_1-conv_proc_code_20=INTVN_CODE_1-INTVN_CODE_20&#59<br/>   run&#59<br/>proc freq data=hosp_24_1&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/>%convert_ICD9(in=hosp_24_1, out=hosp_24_conv_1)<br/><br/><br/>/* ICD9 and ICD10 dx_code */<br/>proc freq data=hosp_25&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/><br/>data hosp_3&#59<br/>  set hosp_21_conv_1 hosp_22_conv_1 hosp_24_conv_1&#59<br/>  hosp_num_c=put(hosp_num,z3.)&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table hosp_4 as<br/>   select a.*, b.Facility_Location<br/>   from hosp_3 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.hosp_num_c=b.hosp_num&#59<br/>quit&#59<br/><br/>data hosp_5(drop=ds_ip)&#59<br/>   length EncType $2&#59<br/>   set hosp_4&#59<br/>   if DS_IP='DS' then  EncType='SD'&#59<br/>   else EncType='IP' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename adm_date=ADate&#59<br/>   rename dschg_date=DDate&#59<br/>   rename HOSP_NUM_C = Facility_Code&#59<br/><br/>run&#59<br/><br/>data hosp_6&#59<br/>   length DRG $3 DRG_Type $4&#59<br/>   set hosp_5&#59<br/>   if EncType='IP' then DRG=CMG&#59<br/>   else if EncType='SD' then DRG=''&#59 <br/>   DRG_Type=''&#59<br/>run&#59<br/><br/>proc freq data=hosp_6&#59<br/>tables DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_7&#59<br/>   set hosp_6&#59<br/>   if DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E'&#59<br/>   else if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A'&#59<br/>   else Discharge_Disposition =' '&#59<br/>run&#59<br/><br/>data hosp_8&#59<br/>   set hosp_7&#59<br/>   Discharge_Status=DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_9&#59<br/>   length Admitting_Source $2&#59<br/>   set hosp_8&#59<br/>   if NEWBORN='NA' then Admitting_Source=ENTRY_CODE&#59<br/>   else Admitting_Source='N'&#59<br/>run&#59<br/><br/>data hosp_10&#59<br/>   set hosp_9&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'||Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=5506 */<br/><br/>proc sort data= hosp_10&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data hosp_11&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set hosp_10&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>data check_1&#59<br/>   set hosp_11&#59<br/>   if DX=''&#59<br/>   run&#59<br/><br/>data check_2&#59<br/>   set hosp_11&#59<br/>   if PX=''&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_hosp as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, Discharge_Status, DRG, DRG_Type, Admitting_Source<br/>   from hosp_11&#59<br/>quit&#59 /* n=2334 */<br/><br/>/* SCDM: 4.2 Diagnosis Table */<br/>proc freq data=hosp_11&#59<br/>  tables DxType&#59<br/>  run&#59<br/><br/>data hosp_12&#59<br/>  length PAdmit $2 &#59<br/>  set hosp_11 (where=(DX ^= ''))&#59<br/>  PAdmit = substr(DxType,1,1)&#59<br/>  if PAdmit ='M' then PDX='P' &#59<br/>  else if PAdmit in ('N','') then PDX ='X'&#59<br/>  else PDX ='S'&#59<br/>run&#59<br/><br/><br/>proc sql&#59<br/>   create table temp.Diagnosis_hosp as<br/>   select PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, ' ' as OrigDX length=18, PAdmit, PDX<br/>   from hosp_12<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/* SCDM: 4.2 Procedure Table */<br/>proc sql&#59<br/>   create table temp.Procedure_hosp as<br/>   select PatID, EncounterID, ADate, Provider, EncType, PX, Px_Codetype, ' ' as OrigPX length=18<br/>   from hosp_11(where=(PX ^= ''))<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/**********************************************************************<br/>From ED<br/>**********************************************************************/<br/><br/>proc sql&#59<br/>   create table ED_1 as <br/>   select distinct *<br/>   from hqc.ED_F_2012<br/>   where datepart(xtrc_date)=\"01AUG2013\"d or datepart(xtrc_date)=\"01AUG2014\"d or datepart(xtrc_date)=\"04AUG2015\"d <br/>         or datepart(xtrc_date)=\"08AUG2016\"d or datepart(xtrc_date)=\"12JUL2017\"d<br/>   order by KEY_HSN, REG_DATE&#59<br/>quit&#59<br/>%reformat_datevars (work, ED_1)&#59  /*1219515*/<br/><br/>proc freq data=ED_1&#59<br/>   tables PROV_LOC_SK / missing&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table ED_2 as<br/>   select distinct key_hsn, reg_date, disp_date, visit_disp, mp_prefix, provdr_type_1, mp_dx as Dx length=18, '10' as Dx_Codetype, substr(inst_num,3,3) as Facility_Code length=3<br/>          , adm_ambul<br/>   from ED_1&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>   create table ED_3 as<br/>   select a.*, b.Facility_Location<br/>   from ED_2 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.Facility_Code=b.hosp_num&#59<br/>quit&#59<br/><br/>proc freq data=ED_3&#59<br/>tables adm_ambul&#59<br/>run&#59<br/><br/>data ED_4(drop=visit_disp adm_ambul)&#59<br/>   length EncType $2  Admitting_source $2&#59<br/>   set ED_3&#59<br/>   EncType='ED'&#59<br/>   if visit_disp in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if visit_disp in ('10','11') then Discharge_Disposition ='E'&#59<br/>   else Discharge_Disposition ='A'&#59<br/>   if adm_ambul in ('A','C','G') then Admitting_source='A'&#59<br/>   else Admitting_source='D' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename reg_date=ADate&#59<br/>   rename disp_date=DDate&#59<br/>run&#59<br/><br/>data ED_5&#59<br/>   set ED_4&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'|| Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=1,212,754*/<br/><br/>proc sort data= ED_5&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data ED_6&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set ED_5&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_ED as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, '' as Discharge_Status length=2, '' as DRG<br/>          length=3, '' as DRG_Type length=4, Admitting_source<br/>   from ED_6&#59<br/>quit&#59 /* 1212754 */<br/><br/>/* PDX='P', PAdmit ='M' for all ED visit */<br/>proc sql&#59<br/>   create table temp.Diagnosis_ED as<br/>   select PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, '' as OrigDx length=18, 'M' as PAdmit length=2, 'P' as PDX<br/>   from ED_6<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/* SCDM: 5.1 Death Table */<br/>proc sql&#59<br/>   create table PHRS_PERS_RSDC_1 as<br/>   select *<br/>   from  HQC.PHRS_PERS_RSDC(where=(&_cls))&#59<br/>quit&#59 /* n=231,455 */<br/><br/>%reformat_datevars (work, PHRS_PERS_RSDC_1)&#59  /*2,585,904*/<br/><br/>data PHRS_PERS_RSDC_2&#59<br/>   set PHRS_PERS_RSDC_1(keep=key_hsn RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>    where RSDC_STAT_TYPE_CODE =4 &#59<br/>&nbsp&nbsp&nbsp&nbspDeathDt=eff_date-1&#59<br/>    format DeathDt yymmdd10. &#59<br/>&nbsp&nbsp&nbsp&nbsplength DeathDt 4. &#59<br/>run&#59<br/><br/>data CDM.DEATH&#59<br/>   set PHRS_PERS_RSDC_2(drop=RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>   DtImpute = 'N'&#59<br/>   Source = 'L' &#59<br/>   Confidence='E' &#59<br/>   rename key_hsn=PatID&#59<br/>run&#59<br/><br/>data CDM.ENCOUNTER&#59<br/>   set temp.ENCOUNTER_MSB<br/>       temp.ENCOUNTER_HOSP <br/>       temp.ENCOUNTER_ED <br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/><br/>data CDM.DIAGNOSIS&#59<br/>   set <br/>       temp.DIAGNOSIS_MSB <br/>       temp.DIAGNOSIS_HOSP<br/>       temp.DIAGNOSIS_ED<br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/><br/>data CDM.PROCEDURE&#59<br/>   set <br/>       temp.PROCEDURE_MSB<br/>       temp.PROCEDURE_HOSP<br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/>/* length EncounterID $35 Provider $11&#59*/<br/><br/>s///<br/>t///","custparents":[{"idx":"CodeTask-9v6iPCWqkuTujJag"}]}],"custparents":[{"idx":"CodeTask-NrDC6oJNN34iBg5x"}]},{"idx":"CodeTask-EkO98cSPFwPKj46N","name":"procedure","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Creating the procedure file using SK data<br/>the data set specification can be found at:<br/>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf<br/>downloaded and save in:<br/>P:\\2018 - CDM CNODES (Wenbin  Nedeene  Amanda)\\Documentation\\NewDocsSinceHandOver<br/>*/<br/><br/>/*%freq(data=locald.procedure_1, table = drg_type)*/<br/><br/>/*what does it look like in sentinel  file?*/<br/>/*%print(data=locald.procedure_1)&#59*/<br/>/*%nobs(data=locald.procedure_1)&#59*/<br/>/*%distinct(data=locald.procedure_1, target=test, vars=%str(?))&#59*/<br/>/*<br/>proc datasets lib=locald&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=procedure_1 order=varnum&#59<br/>run&#59<br/>*/<br/>/*<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp16&nbsp&nbsp&nbsp&nbsp$16.00&nbsp&nbsp&nbsp&nbsp<br/>EncounterID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp15&nbsp&nbsp&nbsp&nbsp$15.00&nbsp&nbsp&nbsp&nbsp<br/>ADate&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspMMDDYY10.&nbsp&nbsp&nbsp&nbspYYMMDD8.<br/>Provider&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp10&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>EncType&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>PX&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>PX_codetype&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>OrigPX&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>*/<br/><br/>/*What does wenbin's datafile looks like?*/<br/>/*<br/>%print(data=rOldD.procedure)&#59<br/>proc datasets lib=rOldD&#59<br/>&nbsp&nbsp&nbsp&nbspcontents data=procedure order=varnum&#59<br/>run&#59<br/>*/<br/>/*<br/>PatID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbsp$11.00&nbsp&nbsp&nbsp&nbspKEY_HSN<br/>EncounterID&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp40&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>ADate&nbsp&nbsp&nbsp&nbspNum&nbsp&nbsp&nbsp&nbsp4&nbsp&nbsp&nbsp&nbspYYMMDD10.&nbsp&nbsp&nbsp&nbspDATETIME20.&nbsp&nbsp&nbsp&nbspADM_DATE<br/>Provider&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspKEY_DOC_NUM<br/>EncType&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>PX&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp11&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX<br/>PX_CodeType&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp2&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>OrigPX&nbsp&nbsp&nbsp&nbspChar&nbsp&nbsp&nbsp&nbsp18&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspFSC<br/>*/<br/><br/>/* Decision:<br/>1. Var length and varnum order follow sentinel demo files<br/>*/<br/><br/>/*doc number was $10. which is not enough for SK key_doc_num ($11.)*/<br/>data procedure_tmp1a&#59<br/>&nbsp&nbsp&nbsp&nbsplength <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatID&nbsp&nbsp&nbsp&nbsp$16.&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncounterID&nbsp&nbsp&nbsp&nbsp$15.&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbsp4.<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProvider&nbsp&nbsp&nbsp&nbsp$11.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncType&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp$2.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp$11.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX_codetype&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp$2.&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspOrigPX&nbsp&nbsp&nbsp&nbsp$11.&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>&nbsp&nbsp&nbsp&nbspformat ADate YYMMDD10. &#59<br/>&nbsp&nbsp&nbsp&nbspdelete&#59<br/>run&#59<br/><br/><br/>/*where is wenbin's code?<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/><br/>/**************************************************************************<br/>Part 1 procedures from MSB<br/>****************************************************************************/<br/>/*<br/>&nbsp&nbsp&nbsp&nbspAccording to Wenbin's code, only keep records with EncType='SO' or 'DS'<br/><br/>&nbsp&nbsp&nbsp&nbspPatID&nbsp&nbsp&nbsp&nbsp= key_hsn&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncounterID&nbsp&nbsp&nbsp&nbsp<- EncounterID from the zip file<br/>&nbsp&nbsp&nbsp&nbspADate&nbsp&nbsp&nbsp&nbsp= dos_1<br/>&nbsp&nbsp&nbsp&nbspProvider = key_doc_num&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspEncType <- enctype.encytype <- ngs_fsc_sk.fsc <- msb_master.fsc<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspIt seems that a more efficient way is to make a mapping between enctype and fsc directly.<br/><br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmake a mapping between enctype and fsc<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspthe NGSfile and the enctype file has been defined in local and remote setting<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor local<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theNGSfile = localskd.NGS_FSC_SK&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor remote<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theNGSfile = rOldDoc.NGS_FSC_SK&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor local<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theEncTypeFile = localskd.Enctype&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspfor remote<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp%let theEncTypeFile = rOldDoc.Enctype&#59<br/>&nbsp&nbsp&nbsp&nbspOrigPX&nbsp&nbsp&nbsp&nbsp<- FSC&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspNote: Wenbin's code specified OrigPX length = 18. This is not seen in the demo (OrigPX=11)<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspmaybe it is confused with the length of OrigDX (which is $18 as in the demo)&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbspPX&nbsp&nbsp&nbsp&nbsp<- NGS_CATEGORY (from diagnosis_tmpf)<br/>&nbsp&nbsp&nbsp&nbspPX_codetype&nbsp&nbsp&nbsp&nbsp<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<- 'NG' <br/>*/<br/>/*data is from DIAGNOSIS_TMP1F*/<br/>%distinct(<br/>&nbsp&nbsp&nbsp&nbspdata=DIAGNOSIS_TMP1F, <br/>&nbsp&nbsp&nbsp&nbsptarget=procedure_tmp1b,<br/>&nbsp&nbsp&nbsp&nbspvars=%str(PatID, i, ADate, Provider, EncType, NGS_CATEGORY as PX, OrigPX),<br/>&nbsp&nbsp&nbsp&nbspfilters=%str(EncType = 'SO' or EncType='DS')<br/>)&#59<br/><br/>data procedure_msb&#59<br/>&nbsp&nbsp&nbsp&nbspset procedure_tmp1a procedure_tmp1b&#59<br/>&nbsp&nbsp&nbsp&nbspEncounterID = 'M' || put(i, z14.)&#59<br/>&nbsp&nbsp&nbsp&nbspPX_CodeType = 'NG'&#59<br/>&nbsp&nbsp&nbsp&nbspdrop i&#59<br/>run&#59<br/><br/>%beep&#59<br/><br/>/*zip it*/<br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=procedure_msb.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=procedure_msb, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/><br/>/*proc sql&#59*/<br/>/*   create table temp.PROCEDURE_MSB as*/<br/>/*   select distinct PatID, EncounterID, ADate, Provider, EncType, NGS_CATEGORY as PX length=11, */<br/>/*&nbsp&nbsp&nbsp&nbsp'NG' as PX_CodeType, FSC as OrigPX length=18*/<br/>/*   from msb_6*/<br/>/*   where EncType in ('SO','DS')&#59*/<br/>/*quit&#59*/<br/><br/><br/>/**************************************************************************<br/>Part 2 procedures from hosp<br/>****************************************************************************/<br/><br/>/*to keep cols for the diagnosis table<br/>&nbsp&nbsp&nbsp&nbspaccording to Wenbin's code, the OrigPx was set to missing for Hosp records, with a length of 18<br/>&nbsp&nbsp&nbsp&nbsphowever, the tech spec says it should be the same as PX, length=11<br/>&nbsp&nbsp&nbsp&nbspDecision: keep it as the same as PX, length=11<br/>*/<br/>data procedure_tmp2a&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp2f&#59<br/>&nbsp&nbsp&nbsp&nbsplength OrigDX $11. &#59 <br/>&nbsp&nbsp&nbsp&nbspwhere recType='PX'&#59<br/>&nbsp&nbsp&nbsp&nbspOrigPX = PX&#59<br/>&nbsp&nbsp&nbsp&nbspkeep <br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPatID<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncounterID<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspADate<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspProvider<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspEncType<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspOrigPX<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspPX_codetype<br/>&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>/*apply format defined in tmp1a*/<br/>data procedure_hosp&#59<br/>&nbsp&nbsp&nbsp&nbspset procedure_tmp1a procedure_tmp2a&#59<br/>run&#59<br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=procedure_hosp.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=procedure_hosp, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/><br/><br/>/**************************************************************************<br/>Part 3 procedures from ed <br/>There is no data on procedures from the ed file<br/>****************************************************************************/<br/><br/><br/>/*******************************************************************************<br/>Putting together<br/>*******************************************************************************/<br/><br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\procedure_msb.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(procedure_msb.sas7bdat)<br/>)&#59<br/>%vbsUnzip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=,<br/>&nbsp&nbsp&nbsp&nbspzipFile=%str(&localSKDatapath.\\procedure_hosp.zip),<br/>&nbsp&nbsp&nbsp&nbspsrcFile=%str(procedure_hosp.sas7bdat)<br/>)&#59<br/><br/><br/>data procedure_9618&#59<br/>&nbsp&nbsp&nbsp&nbspset procedure_msb procedure_hosp &#59<br/>run&#59<br/><br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=procedure_9618.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=procedure_9618, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/><br/>%beep&#59<br/>s///<br/>t///","children":[{"idx":"CodeTask-2zgvuzHSkvML7zEb","name":"Wenbin's procedure","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Webin's code for procedure file<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/**********************************************************************<br/>From MSB<br/>**********************************************************************/<br/>/* SCDM: 4.3 Procedure Table */<br/>proc sql&#59<br/>   create table temp.PROCEDURE_MSB as<br/>   select distinct PatID, EncounterID, ADate, Provider, EncType, NGS_CATEGORY as PX length=11, 'NG' as PX_CodeType, FSC as OrigPX length=18<br/>   from msb_6<br/>   where EncType in ('SO','DS')&#59<br/>quit&#59<br/><br/><br/>/**********************************************************************<br/>From Hosp<br/>**********************************************************************/<br/>/*Webin's code for diagnosis file<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/**********************************************************************<br/>From MSB<br/>**********************************************************************/<br/><br/>/* SCDM: 4.2 Diagnosis Table */<br/>proc sql&#59<br/>   create table Diagnosis_msb_1 as<br/>   select distinct PatID, EncounterID, ADate, Provider, EncType, DIAG as OrigDX length=18, FSC <br/>   from msb_6&#59<br/>quit&#59<br/><br/>data Diagnosis_msb_21 Diagnosis_msb_22&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_1&#59<br/>&nbsp&nbsp&nbsp&nbspif  upcase(substr(OrigDX,1,1))='Z' then output Diagnosis_msb_21&#59<br/>&nbsp&nbsp&nbsp&nbspelse output Diagnosis_msb_22&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table Diagnosis_msb_31 as<br/>   select a.*, b.diag_code as DX length=18<br/>   from Diagnosis_msb_21 a<br/>   left join <br/>   doc.sk_zdiag_to_icd9 b<br/>   on a.OrigDX=b.diag_orig_code&#59<br/>quit&#59<br/><br/>proc sql&#59<br/> select distinct OrigDX from Diagnosis_msb_31<br/> where DX=' '&#59<br/>quit&#59<br/><br/>/*The following Z codes do not have the matching:  Z31 Z33 Z34 Z35 Z36 Z37 Z53 Z75*/<br/><br/>data Diagnosis_msb_41&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_31&#59<br/>&nbsp&nbsp&nbsp&nbspif  DX=' ' then Dx_Codetype = 'OT'&#59<br/>&nbsp&nbsp&nbsp&nbspelse Dx_Codetype = '09'&#59<br/>run&#59<br/><br/>data Diagnosis_msb_42&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_22&#59<br/>&nbsp&nbsp&nbsp&nbsp    DX = OrigDX&#59<br/>&nbsp&nbsp&nbsp&nbsp    Dx_Codetype = '09'&#59<br/>run&#59<br/><br/>data Diagnosis_msb_5&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_41<br/>        Diagnosis_msb_42<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table temp.DIAGNOSIS_MSB as<br/>   select distinct PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, OrigDX, ' '  as PAdmit length=2, ' ' as PDX<br/>   from Diagnosis_msb_5&#59<br/>quit&#59<br/><br/><br/>/**********************************************************************<br/>From Hosp<br/>**********************************************************************/<br/><br/>/*  Hospital */<br/>%let hosp_file          = clean17.CIHI_EOC_2_OND16_23MAY2017&#59<br/> %Extract_CIHI(ds_in            = &hosp_file,<br/>               ds_out           = cdm.hosp, <br/>               dchg_start_date  = &extract_start,&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>               adms_end_date    = &extract_end,<br/>               ICD_field_list   = ,<br/>               ICD9_list        = ,<br/>               ICD9_excl_exact_list =,<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   ICD10_list       = <br/>&nbsp&nbsp&nbsp&nbsp            )&#59<br/><br/>data check_1&#59<br/>   set cdm.hosp&#59<br/>   if DSCHG_DATE='01Jan9999'd&#59<br/>run&#59<br/><br/>/* DS_IP: DS IP OTH  HOSP_NUM : containing missing value */<br/><br/>data check_1&#59<br/>  set cdm.hosp&#59<br/>  if PROV_LOC_SK ^= 'Y'&#59<br/>run&#59<br/><br/>data check_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =. &#59<br/>run&#59<br/><br/>data hosp_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =.  then delete &#59<br/>  if PROV_LOC_SK ^= 'Y' then delete&#59<br/>  if DSCHG_DATE='01Jan9999'd then delete&#59<br/>run&#59<br/><br/>proc tabulate data=hosp_2&#59<br/>var adm_date dschg_date&#59<br/>table adm_date dschg_date, n nmiss (min max median)*f=mmddyy10.&#59<br/>run&#59<br/><br/>data hosp_21 hosp_22 hosp_23 hosp_24 hosp_25&#59<br/>   set hosp_2&#59<br/>    if coding_class_ind ='NA' then output hosp_21 &#59 /* ICD9 */<br/>&nbsp&nbsp&nbsp&nbspelse if coding_class_ind ='0' then output hosp_22 &#59 /* ICD10 */<br/>&nbsp&nbsp&nbsp&nbspelse if CODING_CLASS_IND in ('','9','C') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp     if proc_loc_sk='Y' then output hosp_23&#59 /* ICD9 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else if FY <'200708' then output hosp_24&#59 /* ICD9 and ICD10 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else  output hosp_25&#59 /* ICD9 and ICD10 dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp end&#59<br/>run&#59 <br/><br/>/* ICD9 */<br/>%macro convert_ICD9(in=, out=)&#59<br/>  data convert9&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS FY ENTRY_CODE NEWBORN dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert9(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '09' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CP'&#59<br/>run&#59<br/>%mend convert_ICD9&#59<br/><br/><br/>/* ICD10 */<br/>%macro convert_ICD10(in=, out=)&#59<br/>  data convert10&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS ENTRY_CODE NEWBORN FY dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>run&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert10(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '10' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CI'&#59<br/>run&#59<br/><br/>%mend convert_ICD10&#59<br/><br/>%convert_ICD9(in=hosp_21, out=hosp_21_conv_1)<br/>%convert_ICD10(in=hosp_22, out=hosp_22_conv_1)<br/><br/><br/>/* ICD9 and ICD10 conv_dx_code : 9 and C */<br/>data hosp_24_1&#59<br/>   set hosp_24(drop= dx_code_1-dx_code_25 INTVN_CODE_1-INTVN_CODE_20)&#59<br/>   rename conv_dx_code_1-conv_dx_code_25=dx_code_1-dx_code_25&#59<br/>   rename conv_proc_code_1-conv_proc_code_20=INTVN_CODE_1-INTVN_CODE_20&#59<br/>   run&#59<br/>proc freq data=hosp_24_1&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/>%convert_ICD9(in=hosp_24_1, out=hosp_24_conv_1)<br/><br/><br/>/* ICD9 and ICD10 dx_code */<br/>proc freq data=hosp_25&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/><br/>data hosp_3&#59<br/>  set hosp_21_conv_1 hosp_22_conv_1 hosp_24_conv_1&#59<br/>  hosp_num_c=put(hosp_num,z3.)&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table hosp_4 as<br/>   select a.*, b.Facility_Location<br/>   from hosp_3 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.hosp_num_c=b.hosp_num&#59<br/>quit&#59<br/><br/>data hosp_5(drop=ds_ip)&#59<br/>   length EncType $2&#59<br/>   set hosp_4&#59<br/>   if DS_IP='DS' then  EncType='SD'&#59<br/>   else EncType='IP' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename adm_date=ADate&#59<br/>   rename dschg_date=DDate&#59<br/>   rename HOSP_NUM_C = Facility_Code&#59<br/><br/>run&#59<br/><br/>data hosp_6&#59<br/>   length DRG $3 DRG_Type $4&#59<br/>   set hosp_5&#59<br/>   if EncType='IP' then DRG=CMG&#59<br/>   else if EncType='SD' then DRG=''&#59 <br/>   DRG_Type=''&#59<br/>run&#59<br/><br/>proc freq data=hosp_6&#59<br/>tables DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_7&#59<br/>   set hosp_6&#59<br/>   if DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E'&#59<br/>   else if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A'&#59<br/>   else Discharge_Disposition =' '&#59<br/>run&#59<br/><br/>data hosp_8&#59<br/>   set hosp_7&#59<br/>   Discharge_Status=DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_9&#59<br/>   length Admitting_Source $2&#59<br/>   set hosp_8&#59<br/>   if NEWBORN='NA' then Admitting_Source=ENTRY_CODE&#59<br/>   else Admitting_Source='N'&#59<br/>run&#59<br/><br/>data hosp_10&#59<br/>   set hosp_9&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'||Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=5506 */<br/><br/>proc sort data= hosp_10&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data hosp_11&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set hosp_10&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>data check_1&#59<br/>   set hosp_11&#59<br/>   if DX=''&#59<br/>   run&#59<br/><br/>data check_2&#59<br/>   set hosp_11&#59<br/>   if PX=''&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_hosp as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, Discharge_Status, DRG, DRG_Type, Admitting_Source<br/>   from hosp_11&#59<br/>quit&#59 /* n=2334 */<br/><br/>/* SCDM: 4.2 Diagnosis Table */<br/>proc freq data=hosp_11&#59<br/>  tables DxType&#59<br/>  run&#59<br/><br/>data hosp_12&#59<br/>  length PAdmit $2 &#59<br/>  set hosp_11 (where=(DX ^= ''))&#59<br/>  PAdmit = substr(DxType,1,1)&#59<br/>  if PAdmit ='M' then PDX='P' &#59<br/>  else if PAdmit in ('N','') then PDX ='X'&#59<br/>  else PDX ='S'&#59<br/>run&#59<br/><br/><br/>proc sql&#59<br/>   create table temp.Diagnosis_hosp as<br/>   select PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, ' ' as OrigDX length=18, PAdmit, PDX<br/>   from hosp_12<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/* SCDM: 4.2 Procedure Table */<br/>proc sql&#59<br/>   create table temp.Procedure_hosp as<br/>   select PatID, EncounterID, ADate, Provider, EncType, PX, Px_Codetype, ' ' as OrigPX length=18<br/>   from hosp_11(where=(PX ^= ''))<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/**********************************************************************<br/>From ED<br/>**********************************************************************/<br/><br/><br/>proc sql&#59<br/>   create table ED_1 as <br/>   select distinct *<br/>   from hqc.ED_F_2012<br/>   where datepart(xtrc_date)=\"01AUG2013\"d or datepart(xtrc_date)=\"01AUG2014\"d or datepart(xtrc_date)=\"04AUG2015\"d <br/>         or datepart(xtrc_date)=\"08AUG2016\"d or datepart(xtrc_date)=\"12JUL2017\"d<br/>   order by KEY_HSN, REG_DATE&#59<br/>quit&#59<br/>%reformat_datevars (work, ED_1)&#59  /*1219515*/<br/><br/>proc freq data=ED_1&#59<br/>   tables PROV_LOC_SK / missing&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table ED_2 as<br/>   select distinct key_hsn, reg_date, disp_date, visit_disp, mp_prefix, provdr_type_1, mp_dx as Dx length=18, '10' as Dx_Codetype, substr(inst_num,3,3) as Facility_Code length=3<br/>          , adm_ambul<br/>   from ED_1&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>   create table ED_3 as<br/>   select a.*, b.Facility_Location<br/>   from ED_2 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.Facility_Code=b.hosp_num&#59<br/>quit&#59<br/><br/>proc freq data=ED_3&#59<br/>tables adm_ambul&#59<br/>run&#59<br/><br/>data ED_4(drop=visit_disp adm_ambul)&#59<br/>   length EncType $2  Admitting_source $2&#59<br/>   set ED_3&#59<br/>   EncType='ED'&#59<br/>   if visit_disp in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if visit_disp in ('10','11') then Discharge_Disposition ='E'&#59<br/>   else Discharge_Disposition ='A'&#59<br/>   if adm_ambul in ('A','C','G') then Admitting_source='A'&#59<br/>   else Admitting_source='D' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename reg_date=ADate&#59<br/>   rename disp_date=DDate&#59<br/>run&#59<br/><br/>data ED_5&#59<br/>   set ED_4&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'|| Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=1,212,754*/<br/><br/>proc sort data= ED_5&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data ED_6&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set ED_5&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_ED as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, '' as Discharge_Status length=2, '' as DRG<br/>          length=3, '' as DRG_Type length=4, Admitting_source<br/>   from ED_6&#59<br/>quit&#59 /* 1212754 */<br/><br/>/* PDX='P', PAdmit ='M' for all ED visit */<br/>proc sql&#59<br/>   create table temp.Diagnosis_ED as<br/>   select PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, '' as OrigDx length=18, 'M' as PAdmit length=2, 'P' as PDX<br/>   from ED_6<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/* SCDM: 5.1 Death Table */<br/>proc sql&#59<br/>   create table PHRS_PERS_RSDC_1 as<br/>   select *<br/>   from  HQC.PHRS_PERS_RSDC(where=(&_cls))&#59<br/>quit&#59 /* n=231,455 */<br/><br/>%reformat_datevars (work, PHRS_PERS_RSDC_1)&#59  /*2,585,904*/<br/><br/>data PHRS_PERS_RSDC_2&#59<br/>   set PHRS_PERS_RSDC_1(keep=key_hsn RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>    where RSDC_STAT_TYPE_CODE =4 &#59<br/>&nbsp&nbsp&nbsp&nbspDeathDt=eff_date-1&#59<br/>    format DeathDt yymmdd10. &#59<br/>&nbsp&nbsp&nbsp&nbsplength DeathDt 4. &#59<br/>run&#59<br/><br/>data CDM.DEATH&#59<br/>   set PHRS_PERS_RSDC_2(drop=RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>   DtImpute = 'N'&#59<br/>   Source = 'L' &#59<br/>   Confidence='E' &#59<br/>   rename key_hsn=PatID&#59<br/>run&#59<br/><br/>data CDM.ENCOUNTER&#59<br/>   set temp.ENCOUNTER_MSB<br/>       temp.ENCOUNTER_HOSP <br/>       temp.ENCOUNTER_ED <br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/><br/>data CDM.DIAGNOSIS&#59<br/>   set <br/>       temp.DIAGNOSIS_MSB <br/>       temp.DIAGNOSIS_HOSP<br/>       temp.DIAGNOSIS_ED<br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/><br/>data CDM.PROCEDURE&#59<br/>   set <br/>       temp.PROCEDURE_MSB<br/>       temp.PROCEDURE_HOSP<br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/>/* length EncounterID $35 Provider $11&#59*/<br/><br/><br/>s///<br/>t///","custparents":[{"idx":"CodeTask-EkO98cSPFwPKj46N"}]},{"idx":"CodeTask-pSgxKfMNLHXEBKjA","name":"to be deleted","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*redo 1f as it should keep origpx, drop fsc instead of drop origpx keep fsc*/<br/><br/>data diagnosis_tmp1f&#59<br/>&nbsp&nbsp&nbsp&nbspretain i&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp1e &#59<br/>&nbsp&nbsp&nbsp&nbspby ADate PatID Provider EncType&#59<br/>&nbsp&nbsp&nbsp&nbspif first.EncType then i+1&#59<br/>&nbsp&nbsp&nbsp&nbspOrigDX = diag&#59<br/>&nbsp&nbsp&nbsp&nbspif diag in: ('Z') then DX = diag_code&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX = OrigDX&#59<br/>&nbsp&nbsp&nbsp&nbspif DX='' then DX_codetype='OT'&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX_codetype='09'&#59<br/>&nbsp&nbsp&nbsp&nbspPX = NGS_Category&#59<br/>&nbsp&nbsp&nbsp&nbspOrigPX = FSC&#59<br/>&nbsp&nbsp&nbsp&nbspdrop diag FSC&#59<br/>run&#59<br/>%beep&#59<br/>/*proc datasets nolist&#59*/<br/>/*&nbsp&nbsp&nbsp&nbspdelete diagnosis_tmp1e &#59*/<br/>/*run&#59*/<br/><br/>%vbsZip(<br/>&nbsp&nbsp&nbsp&nbsptgtDir=&localSKDatapath, <br/>&nbsp&nbsp&nbsp&nbspzipFile=diagnosis_tmp1f.zip, <br/>&nbsp&nbsp&nbsp&nbspsrcFile=diagnosis_tmp1f, <br/>&nbsp&nbsp&nbsp&nbspsrcDir=<br/>)&#59<br/>%beep&#59<br/>s///<br/>t///","custparents":[{"idx":"CodeTask-EkO98cSPFwPKj46N"}]}],"custparents":[{"idx":"CodeTask-NrDC6oJNN34iBg5x"},{"idx":"CodeTask-9v6iPCWqkuTujJag"}]}],"custparents":[{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"}]},{"idx":"MY761326cc-0eec-4a1c-aeae-3ca72820511e","name":"Tools","custparents":[{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"}],"children":[],"_substeps":{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37","name":"substeps","custparents":[{"idx":"MY761326cc-0eec-4a1c-aeae-3ca72820511e"}],"children":[{"idx":"CodeTask-HaW91mdqQDKhx4Dg","name":"beep","type":"TASK","NodeDescription":"///t<br/>///s<br/>%beep&#59<br/>s///<br/>t///","children":[],"custparents":[{"idx":"CodeTask-qYA6cXbGlJZ99igP"},{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37"}]},{"idx":"CodeTask-n5AASdQWrOSKpmDd","name":"CDM_part01","type":"TASK","custparents":[{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37"}]},{"idx":"CodeTask-g9y4nybG5SYk1d3e","name":"local_test","type":"TASK","NodeDescription":"///t<br/>///s<br/><br/>s///<br/>t///","custparents":[{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37"}]},{"idx":"CodeTask-z4263UVKYtXBduWP","name":"TestRemote","type":"TASK","NodeDescription":"///t<br/>///s<br/>data _null_&#59run&#59<br/><br/>s///<br/>t///","custparents":[{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37"}]},{"idx":"CodeTask-Q8Ft3sPerp3NaQ17","name":"learning","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Learning*/<br/>%macro notrun&#59<br/><br/>/*wrong*/<br/>data diagnosis_tmp1f&#59<br/>&nbsp&nbsp&nbsp&nbspi=1&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp1e (obs=500)&#59<br/>&nbsp&nbsp&nbsp&nbspby ADate PatID Provider EncType&#59<br/>&nbsp&nbsp&nbsp&nbspif first.EncType then i+1&#59<br/>&nbsp&nbsp&nbsp&nbspOrigDX = diag&#59<br/>&nbsp&nbsp&nbsp&nbspif diag in: ('Z') then DX = diag_code&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX = OrigDX&#59<br/>&nbsp&nbsp&nbsp&nbspif DX='' then DX_codetype='OT'&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX_codetype='09'&#59<br/>&nbsp&nbsp&nbsp&nbspPX = NGS_Category&#59<br/>&nbsp&nbsp&nbsp&nbspOrigPX = FSC&#59<br/>&nbsp&nbsp&nbsp&nbspdrop diag OrigPX&#59<br/>run&#59<br/>/*correct*/<br/>data diagnosis_tmp1f&#59<br/>&nbsp&nbsp&nbsp&nbspretain i&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp1e (obs=500)&#59<br/>&nbsp&nbsp&nbsp&nbspby ADate PatID Provider EncType&#59<br/>&nbsp&nbsp&nbsp&nbspif first.EncType then i+1&#59<br/>&nbsp&nbsp&nbsp&nbspOrigDX = diag&#59<br/>&nbsp&nbsp&nbsp&nbspif diag in: ('Z') then DX = diag_code&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX = OrigDX&#59<br/>&nbsp&nbsp&nbsp&nbspif DX='' then DX_codetype='OT'&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX_codetype='09'&#59<br/>&nbsp&nbsp&nbsp&nbspPX = NGS_Category&#59<br/>&nbsp&nbsp&nbsp&nbspOrigPX = FSC&#59<br/>&nbsp&nbsp&nbsp&nbspdrop diag OrigPX&#59<br/>run&#59<br/><br/>%mend notrun&#59<br/>s///<br/>t///","custparents":[{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37"}]}]}}],"NodeDescription":"<p>///t</p><p>This tree diagram is based on:</p><p>F:\\Personal\\Dropbox\\Project\\CNODEs_CDM\\PilotV910_20191218.egp</p><p>t///</p>"}