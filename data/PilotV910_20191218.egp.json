[{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8","name":"CDM PilotV910_20191218","children":[{"idx":"MY349d85cb-7ba2-4156-812a-6b6427e52047","name":"A demo","custparents":[{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"}],"children":[{"idx":"CodeTask-klBgI7NRLnI7fn3L","name":"Download package","NodeDescription":"<iframe class=\"ql-video\" frameborder=\"0\" allowfullscreen=\"true\" src=\"https://www.youtube.com/embed/EXL1lgmy7tQ?showinfo=0\" data-blot-formatter-unclickable-bound=\"true\"></iframe><p><br></p><p><br></p><p>///t</p><p>///s</p><p>/*Download package*/</p><p><br></p><p>/*</p><p>1. The SQRP (Sentinel query routine package) were downloaded from</p><p>https://dev.sentinelsystem.org/projects/AD/repos/qrp/browse</p><p>It is constantly updating. As of today 2019-12-18, the most recent version is package 9.1.0.</p><p><br></p><p>2. The sample databases were downloaded from</p><p>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_datasets/browse</p><p>*/</p><p><br></p><p>/*Download these packages, and save into the project folder</p><p>P:\\cdmpilot9_v1\\projectfolder</p><p>in which the subfolders are:</p><p>-docs</p><p>-dplocal</p><p>-inputfiles</p><p>-msoc</p><p>-sasprograms</p><p><br></p><p>Addtionally, the sample databases will be put in</p><p>-indata</p><p>*/</p><p>s///</p><p>t///</p>","children":[{"idx":"CodeTask-1nO5AOhrm37TWv37","name":"TheSRQ Analysis list","NodeDescription":"<iframe class=\"ql-video\" frameborder=\"0\" allowfullscreen=\"true\" src=\"https://www.youtube.com/embed/dIr2qS1ytxE?showinfo=0\" data-blot-formatter-unclickable-bound=\"true\"></iframe><p><br></p><p><br></p><p>///t</p><p>///s</p><p>/*</p><p>A list of Sentinel Routine Querying Moduels and COHORT IDENTIFICATION AND DESCRIPTIVE ANALYSIS (CIDA) MODULEs </p><p>can be found at </p><p>https://dev.sentinelsystem.org/projects/SENTINEL/repos/sentinel-routine-querying-tool-documentation/browse</p><p><br></p><p>*/</p><p>s///</p><p>t///</p>","children":[{"idx":"CodeTask-SbMLkku5hRGuVfGb","name":"Prepare  the input setting files","NodeDescription":"<iframe class=\"ql-video\" frameborder=\"0\" allowfullscreen=\"true\" src=\"https://www.youtube.com/embed/5zxBupqcFuA?showinfo=0\" data-blot-formatter-unclickable-bound=\"true\"></iframe><p><br></p><p><br></p><p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*Preparing files required for type1 analysis</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*set path*/ </div><div class=\"ql-code-block\" data-language=\"plain\">%let localDatapath =P:/cdmpilot9_v1/projectfolder/indata;</div><div class=\"ql-code-block\" data-language=\"plain\">libname locald \"&amp;localDatapath\";</div><div class=\"ql-code-block\" data-language=\"plain\">%let inputfiles =P:/cdmpilot9_v1/projectfolder/inputfiles;</div><div class=\"ql-code-block\" data-language=\"plain\">libname infiles \"&amp;inputfiles\";</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\">data _null_;run;</div><div class=\"ql-code-block\" data-language=\"plain\">/*1. in the inputfile folder, prepare a dataset called montioringfile</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;the data set contains 3 cols:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;periodid, startdate, enddate</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;it seems that the enrol date of the sample files is from 2008 to 2010. Therefore here</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the pilot will take the segment from the middle</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*The start date col should be named startdate, NOT startfollowup, This is different from wenbin's file*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data infiles.monitoringfile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format periodid 8. startdate date9. enddate date9.;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;periodid=1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;startdate='01jan2008'd;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enddate='30jun2010'd;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*create a file (cohortfile) to define cohorts</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;the description of the fields can be found at:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;https://dev.sentinelsystem.org/projects/SENTINEL/repos/sentinel-routine-querying-tool-documentation/browse/files/file526-typeall-cohortfile.md</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;in wenbin's file, the col was named 'group'. This is wrong. It should be named cohortgrp.</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data infiles.cohortfile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;cohortgrp&nbsp;&nbsp;&nbsp;&nbsp;$40.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;coverage&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrolgap&nbsp;&nbsp;&nbsp;&nbsp;8.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrdays&nbsp;&nbsp;&nbsp;&nbsp;8.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type1&nbsp;&nbsp;&nbsp;&nbsp;$1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type2&nbsp;&nbsp;&nbsp;&nbsp;$1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type3&nbsp;&nbsp;&nbsp;&nbsp;$1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type4&nbsp;&nbsp;&nbsp;&nbsp;$1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type5&nbsp;&nbsp;&nbsp;&nbsp;$1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrdaysaft&nbsp;&nbsp;&nbsp;&nbsp;8.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;chartres&nbsp;&nbsp;&nbsp;&nbsp;$1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;sex&nbsp;&nbsp;&nbsp;&nbsp;$3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;race&nbsp;&nbsp;&nbsp;&nbsp;$1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;hispanic&nbsp;&nbsp;&nbsp;&nbsp;$1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;race_out&nbsp;&nbsp;&nbsp;&nbsp;$1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;hispanic_out&nbsp;&nbsp;&nbsp;&nbsp;$1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;agestrat&nbsp;&nbsp;&nbsp;&nbsp;$100.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;geog&nbsp;&nbsp;&nbsp;&nbsp;$50.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;/*in this pilot, several groups will be established to test the different settings</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Briefly, the criteria include:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1) coverage for medical insurance/drug plans (M/D/MD),&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2) allowed gap days between insurance covreage periods</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3) minimal days of continuous insurance coverage</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;*/</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type1='Y';&nbsp;&nbsp;&nbsp;&nbsp;type2='N'; type3='N';&nbsp;&nbsp;&nbsp;&nbsp;type4='N'; type5='N';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;chartres='N';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;race_out='N';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;hispanic_out='N';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;agestrat='00-09 10-19 20-44 45-64 65-74 75+';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;cohortgrp='G1_MD7360';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;coverage='M';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrolgap=7;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrdays = 360;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;cohortgrp='G2_M7360';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;coverage='M';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrolgap=7;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrdays = 360;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;cohortgrp='G3_MD30360';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;coverage='MD';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrolgap=30;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrdays = 360;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;cohortgrp='G4_MD7180';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;coverage='MD';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrolgap=7;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrdays = 180;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*prepare a cohortcodesfile, which contains diagnostic codes to make cases</div><div class=\"ql-code-block\" data-language=\"plain\">The required vars in the file can be found at :</div><div class=\"ql-code-block\" data-language=\"plain\">https://dev.sentinelsystem.org/projects/SENTINEL/repos/sentinel-routine-querying-tool-documentation/browse/files/file590-typeall-cohortcodes.md</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*list out the drug codes (NDC) in the dispensing file*/</div><div class=\"ql-code-block\" data-language=\"plain\">%freq(data=locald.dispensing_1 noprint , table=ndc, option=%str(out = _tmp1));</div><div class=\"ql-code-block\" data-language=\"plain\">%sort(data=_tmp1, sorter=%str(descending count));</div><div class=\"ql-code-block\" data-language=\"plain\">/*keep the top ten ndc (drug code) from the dispensing file*/</div><div class=\"ql-code-block\" data-language=\"plain\">data _tmp2;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set _tmp1 (obs=10);</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;keep ndc;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*make a cross join between the drug code list, and the cohort file*/</div><div class=\"ql-code-block\" data-language=\"plain\">%print(data=infiles.cohortfile);</div><div class=\"ql-code-block\" data-language=\"plain\">%sqljoinv2(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1=infiles.cohortfile,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2=_tmp2,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=_tmp3,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.cohortgrp as group, t2.ndc as code),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=cross</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">/*make a pseudo code (Guess it is for all codes)*/</div><div class=\"ql-code-block\" data-language=\"plain\">data _tmp4;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set infiles.cohortfile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;keep cohortgrp code;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rename cohortgrp = group;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;code='99999999999';</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">/*merge the above 2*/</div><div class=\"ql-code-block\" data-language=\"plain\">data _tmp5;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set _tmp3 _tmp4;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data infiles.cohortcodesfile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;group $40.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;code $11.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;stockgroup $30.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;codetype $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;codecat $2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;caresettingprincipal $41.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1_index $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2_index $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2_fup $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t3_index $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t3_fup $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t4_index $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t4_fup $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t5_index $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t6_index $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;conc_fup $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rawlabdatetype $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rawlabresult $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;codesupply 8.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;excludesupply $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;productapprovaldate Date9. productmarketingdate Date9. otherproductdate Date9.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rawlabdatetype $3. rawlabresult $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set _tmp5;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if code = '99999999999' then do;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stockgroup='';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;codetype=11;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;else do;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stockgroup='Med';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;codetype=11;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;codecat = 'RX';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1_index = 'DEF';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t3_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t4_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t5_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t6_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2_fup = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t3_fup = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t4_fup = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;conc_fup = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*Make the type1file*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data _tmp1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set infiles.cohortfile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;keep cohortgrp;rename cohortgrp = group;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data infiles.Type1File;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;group $30.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1cohortdef $2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1washper 8.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_dth $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_output $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_dpend $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_qryend $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set _tmp1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1cohortdef=1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1washper =360;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if _n_=4 then t1washper=180;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_dth='Y';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_output = 'Y';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_dpend = 'Y';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_qryend = 'N';</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div></div><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"MY627d58d9-0132-4122-8cd5-17eba8cfd859","name":"Customize the run_program","custparents":[{"idx":"CodeTask-SbMLkku5hRGuVfGb"}],"children":[{"idx":"CodeTask-LFiLD7PBdQhaJFLl","name":"Customize qrp_master_header","custparents":[{"idx":"MY627d58d9-0132-4122-8cd5-17eba8cfd859"}],"NodeDescription":"<p><br></p><p><br></p><p>Customization of the qrp_master_header</p><iframe class=\"ql-video\" frameborder=\"0\" allowfullscreen=\"true\" src=\"https://www.youtube.com/embed/StNO-bVbR1o?showinfo=0\" data-blot-formatter-unclickable-bound=\"true\"></iframe><p><br></p><p><br></p><p>///t</p><p>t///</p><p><br></p><p><br></p><p><br></p>","children":[{"idx":"CodeTask-UlOwqL8TSObw5ez1","name":"run_programs","custparents":[{"idx":"CodeTask-LFiLD7PBdQhaJFLl"}],"NodeDescription":"<p>Report</p><iframe class=\"ql-video\" frameborder=\"0\" allowfullscreen=\"true\" src=\"https://www.youtube.com/embed/8nLfkLP88cE?showinfo=0\" data-blot-formatter-unclickable-bound=\"true\"></iframe><p><br></p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">options linesize=100 pagesize=50;</div><div class=\"ql-code-block\">/****************************************************************************************</div><div class=\"ql-code-block\">*                                     SENTINEL PROGRAM</div><div class=\"ql-code-block\">*****************************************************************************************</div><div class=\"ql-code-block\">* NAME:  </div><div class=\"ql-code-block\">*</div><div class=\"ql-code-block\">* PURPOSE:</div><div class=\"ql-code-block\">*</div><div class=\"ql-code-block\">* MAJOR STEPS: </div><div class=\"ql-code-block\">*</div><div class=\"ql-code-block\">* KEY DEPENDENCIES/CONSTRAINTS/CAVEATS:</div><div class=\"ql-code-block\">*</div><div class=\"ql-code-block\">*----------------------------------------------------------------------------------------</div><div class=\"ql-code-block\">* CONTACT INFO: </div><div class=\"ql-code-block\">*  Sentinel Coordinating Center</div><div class=\"ql-code-block\">*  info@sentinelsystem.org</div><div class=\"ql-code-block\">*</div><div class=\"ql-code-block\">*----------------------------------------------------------------------------------------</div><div class=\"ql-code-block\">* HISTORY:</div><div class=\"ql-code-block\">*  Create date (mm/dd/yyyy): NA</div><div class=\"ql-code-block\">*  Last modified date (mm/dd/yyyy): 12/18/2019</div><div class=\"ql-code-block\">*  Package version: 9.1.0</div><div class=\"ql-code-block\">*</div><div class=\"ql-code-block\">*  Sentinel master program header version: 3.0.0 (DO NOT EDIT)</div><div class=\"ql-code-block\">****************************************************************************************/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*---------------------------------------------------------------------------------------</div><div class=\"ql-code-block\">*                                      DEFINITIONS</div><div class=\"ql-code-block\">*----------------------------------------------------------------------------------------</div><div class=\"ql-code-block\">* SCC... Location of Sentinel Common-Components (CC) request associated with the most</div><div class=\"ql-code-block\">*        recent production ETL for either Phase A (standard SCDM) or Phase B (standard</div><div class=\"ql-code-block\">*        SCDM plus MIL table). Specific to each Data Partner/Data Site, the CC utility </div><div class=\"ql-code-block\">*        macro defines key:</div><div class=\"ql-code-block\">*          - macro variables (e.g. Data Partner ID, Min and Max Dates, SCDM table names) </div><div class=\"ql-code-block\">*          - libname assignments (e.g. libref INDATA is assigned to SCDM tables)</div><div class=\"ql-code-block\">*        NOTE: This parameter needs to be set by programmer at the Data Partner/Data Site</div><div class=\"ql-code-block\">*              in QA CC request.</div><div class=\"ql-code-block\">*</div><div class=\"ql-code-block\">* ReqID... Sentinel Project Request-ID (formerly MSReqID)</div><div class=\"ql-code-block\">*          NOTE: This parameter needs to be set by the programmer/analyst preparing the </div><div class=\"ql-code-block\">*               Request-ID in coordination with the Sentinel Operations Center (SOC)</div><div class=\"ql-code-block\">*</div><div class=\"ql-code-block\">* The following paths for the current request are automatically derived from QA CC</div><div class=\"ql-code-block\">*    DPLOCAL  ... path for data created that remains local (i.e. behind the DP firewall)</div><div class=\"ql-code-block\">*    MSOC     ... path for data created to share with Sentinel Operations Center</div><div class=\"ql-code-block\">*    INFOLDER ... path for program inputs (e.g. lookup data, program modules, macros)</div><div class=\"ql-code-block\">*    SASPROGRAMS ... path for the main SAS program for the request</div><div class=\"ql-code-block\">*--------------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">*---------------------------------------------------------------------------------------</div><div class=\"ql-code-block\">* NOTES:</div><div class=\"ql-code-block\">*  For reasons of compatibility and standardization, ALL PATHS must meet the following</div><div class=\"ql-code-block\">*  criteria:</div><div class=\"ql-code-block\">*     1- Starting with the request directory, all subdirectory names must be specified</div><div class=\"ql-code-block\">*        in lower case (for UNIX compatibility)</div><div class=\"ql-code-block\">*     2- Slashes must be forward-leaning slashes '/' (for UNIX compatibility)</div><div class=\"ql-code-block\">*     3- Paths must end with a final forward-leaning slash '/' (extra slashes are fine)</div><div class=\"ql-code-block\">*     4- Paths must NOT contain any embedded spaces</div><div class=\"ql-code-block\">*---------------------------------------------------------------------------------------;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*-------------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">/* Section 1: Data Partner/Data Site programmer defines parameters in this section.    */</div><div class=\"ql-code-block\">/*-------------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">/* 1a. Edit macro variable SCC to point to the directory containing the executed Common</div><div class=\"ql-code-block\">         Components (CC) request associated with the relevant production ETL, INCLUDING </div><div class=\"ql-code-block\">         the Request-id. </div><div class=\"ql-code-block\">       NOTE: ORGANIZATIONS WITHOUT CC SHOULD LEAVE BLANK (DO NOT comment out)</div><div class=\"ql-code-block\">             AND COMPLETE ALL OF SECTION 1c.             </div><div class=\"ql-code-block\">       Example: %let SCC = /sentinel/requests/etl4/soc_cca_wp001_xxxx_v01/             */</div><div class=\"ql-code-block\">   %let SCC = ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* 1b. Program-specific parameters                                                     */</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* Edit this parameter to identify the list of patients to exclude (if applicable).</div><div class=\"ql-code-block\">       Dataset should contain one variable, patid, and list all patids that should be</div><div class=\"ql-code-block\">       excluded. Must include libname (e.g., indata.PtsToExclude).</div><div class=\"ql-code-block\">     */</div><div class=\"ql-code-block\">    %let PTSTOEXCLUDE=;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* Edit this parameter to make it point to the folder containing dplocal datasets</div><div class=\"ql-code-block\">       from the prior runs (Prior DPLocal) </div><div class=\"ql-code-block\">    */</div><div class=\"ql-code-block\">    %let DPLPrior=;   * Enter the path to the prior run data; </div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/***************************************************************************************/</div><div class=\"ql-code-block\">/* 1c. OPTIONAL: Organizations WITHOUT Common Components define parameters in this </div><div class=\"ql-code-block\">       section, leaving STEP 1a. above blank.                                          */</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* _DP is a descriptive identifier for your organization. Specify a 3-6 UPPERCASE </div><div class=\"ql-code-block\">       character abbreviation for _DP. Example: %let DP=ABCDE ;                        */</div><div class=\"ql-code-block\">       %let _DP=MY ; /*changed 20191218*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* Specify the path(s) to the four (4) request package subfolders (dplocal, msoc,</div><div class=\"ql-code-block\">       inputfiles, and sasprograms). </div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">       Please note, some organizations choose to separate the package subfolders prior to </div><div class=\"ql-code-block\">       execution.  This is optional, but ALL four macro variables below MUST be populated, </div><div class=\"ql-code-block\">       even if they are all in the same location (DO NOT comment out). </div><div class=\"ql-code-block\">       </div><div class=\"ql-code-block\">    /* Example: %let packageroot_dplocal = A:/sentinel/requests/&lt;package-name&gt;/dplocal/ */</div><div class=\"ql-code-block\">       %let _packageroot_dplocal=P:/cdmpilot9_v1/projectfolder/dplocal/ ;/*changed 20191218*/</div><div class=\"ql-code-block\">       %let _packageroot_msoc =P:/cdmpilot9_v1/projectfolder/msoc/ ;/*changed 20191218*/</div><div class=\"ql-code-block\">       %let _packageroot_inputfiles =P:/cdmpilot9_v1/projectfolder/inputfiles/  ;/*changed 20191218*/</div><div class=\"ql-code-block\">       %let _packageroot_sasprograms=P:/cdmpilot9_v1/projectfolder/sasprograms/  ;/*changed 20191218*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* Specify the file path(s) to the location of your Sentinel CDM datasets. If </div><div class=\"ql-code-block\">       Example: %let prod_scdm= A:/sentinel/etl1/phaseA/scdm/ ;        */</div><div class=\"ql-code-block\">       %let prod_scdm=P:/cdmpilot9_v1/projectfolder/indata/ ;/*changed 20191218*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* The following metadata describe characteristics of your SCDM. If known, modify the</div><div class=\"ql-code-block\">       following parameters:      </div><div class=\"ql-code-block\">    /* DP_MinDate: Specify the overall SCDM minimum date in the format \"DDMMMYYYY\"d </div><div class=\"ql-code-block\">                   Default value is \"01Jan2000\"d                                       */</div><div class=\"ql-code-block\">       %let _DP_MinDate=\"01Jan2000\"d ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* DP_MaxDate: Specify the overall SCDM maximum date in the format \"DDMMMYYYY\"d </div><div class=\"ql-code-block\">                    Default value is today's date (e.g. \"&amp;sysdate.\"d)                  */</div><div class=\"ql-code-block\">       %let _DP_MaxDate = \"&amp;sysdate.\"d ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* ETL: Please enter the ETL version # for the production SCDM. </div><div class=\"ql-code-block\">              Default is 1                                                             */</div><div class=\"ql-code-block\">       %let _ETL = 1 ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* Phase: Please enter the Phase (A or B) of the associated ETL SCDM. </div><div class=\"ql-code-block\">              Default is A                                                             */</div><div class=\"ql-code-block\">       %let _Phase = A ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* Specify the name of each of the Sentinel Common Data Model tables, if different</div><div class=\"ql-code-block\">       from the default values entered. Do NOT include '.sas7bdat'. DO NOT leave blank.</div><div class=\"ql-code-block\">       Example: %let _ENRTABLE=enrollment ;                                            */</div><div class=\"ql-code-block\">       %let _ENRTABLE=enrollment_1 ; *specify the enrollment table name *;/*changed 20191218*/</div><div class=\"ql-code-block\">       %let _DEMTABLE=demographic_1 ; *specify the demographic table name *;/*changed 20191218*/</div><div class=\"ql-code-block\">       %let _DISTABLE=dispensing_1 ; *specify the rx dispensing table name *;/*changed 20191218*/</div><div class=\"ql-code-block\">       %let _ENCTABLE=encounter_1 ; *specify the encounter table name *;/*changed 20191218*/</div><div class=\"ql-code-block\">       %let _DIATABLE=diagnosis_1 ; *specify the diagnosis table name *;/*changed 20191218*/</div><div class=\"ql-code-block\">       %let _PROCTABLE=procedure_1 ;*specify the procedure table name *;/*changed 20191218*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /****************************************************************************\\</div><div class=\"ql-code-block\">       The following tables are optional. Leave BLANK if they are not available </div><div class=\"ql-code-block\">       at your site (DO NOT COMMENT OUT).</div><div class=\"ql-code-block\">    \\****************************************************************************/</div><div class=\"ql-code-block\">       %let _DEATHTABLE=death_1 ;  *specify the death table name *;/*changed 20191218*/</div><div class=\"ql-code-block\">       %let _CODTABLE= ;    *specify the cause of death table name *; </div><div class=\"ql-code-block\">       %let _LABTABLE= ;    *specify the lab result table name *;</div><div class=\"ql-code-block\">       %let _VITTABLE= ;    *specify the vital signs table name *;</div><div class=\"ql-code-block\">       %let _IPHARMTABLE= ; *specify the inpatient pharmacy table name *;</div><div class=\"ql-code-block\">       %let _ITRANSTABLE= ; *specify the inpatient transfusion table name *;</div><div class=\"ql-code-block\">       %let _MILTABLE= ;    *specify the mother-infant-linkage table name (Phase B only);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/********************************** END OF SECTION 1 ***********************************/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*-------------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">/* SECTION 2: SOC Programmer/Analyst preparing the Request sets each parameter prior</div><div class=\"ql-code-block\">              to distributing to DP </div><div class=\"ql-code-block\">/*-------------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\"> /* Specific request IDs are made up of the following 5 tokens:</div><div class=\"ql-code-block\">    project-ID, workplan-type, workplan-ID, unique-DPID, version-ID */</div><div class=\"ql-code-block\"> /*-------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">  *  If this is your request   . . . . . . . then set parameter values as follows</div><div class=\"ql-code-block\">  *  ---------------------------------       --------------------------------------</div><div class=\"ql-code-block\">  *   [Project-ID: CDER]                      %let ProjID= cder ;  </div><div class=\"ql-code-block\">  *   [Workplan-Type: ad hoc request]         %let WPType = ahr ; </div><div class=\"ql-code-block\">  *   [Workplan-ID: 5]                        %let WPID =   wp005 ; </div><div class=\"ql-code-block\">  *   [Unique-DPID: non-specific DP]          %let DPID =   nsdp ;     </div><div class=\"ql-code-block\">  *   [Version-ID: beta 3]                    %let VerID =  b03 ;         </div><div class=\"ql-code-block\">  *   [use underscores as delimiter]          %let dlm = _ ;                </div><div class=\"ql-code-block\">  *</div><div class=\"ql-code-block\">  *   The example values above would produce Request-ID --&gt; cder_ahr_wp005_nsdp_b03 ;</div><div class=\"ql-code-block\"> /*------------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\"> /* Specify project-ID, workplan-type, workplan-ID, workplan-type, dpid, version-ID    */</div><div class=\"ql-code-block\">   %let ProjID = p1 ; /*changed 20191218*/</div><div class=\"ql-code-block\">   %let WPType = test ; /*changed 20191218*/</div><div class=\"ql-code-block\">   %let WPID = wp1 ; /*changed 20191218*/</div><div class=\"ql-code-block\">   %let DPID = all ;/*changed 20191218*/</div><div class=\"ql-code-block\">   %let VerID = v1 ;/*changed 20191218*/</div><div class=\"ql-code-block\"> </div><div class=\"ql-code-block\">  /* Create request-id delimiter - Default is underscore (_)                           */</div><div class=\"ql-code-block\">   %let dlm = _ ;  /* Do not edit */     </div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">****************************************************************************************</div><div class=\"ql-code-block\">*******                             END OF USER INPUT                             ******</div><div class=\"ql-code-block\">*******                        DO NOT EDIT BELOW THIS LINE                        ******</div><div class=\"ql-code-block\">******* (Consult with SOC or Sentinel team leader if you feel edits are required) ******</div><div class=\"ql-code-block\">****************************************************************************************;</div><div class=\"ql-code-block\">/*-------------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">/* SECTION 3a: Standard SOC environment setup code -- DO NOT EDIT</div><div class=\"ql-code-block\">/*-------------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">/* System options */</div><div class=\"ql-code-block\">options nosymbolgen nomlogic;</div><div class=\"ql-code-block\">options ls=100 nocenter ;</div><div class=\"ql-code-block\">options obs=MAX ;</div><div class=\"ql-code-block\">options msglevel=i ;</div><div class=\"ql-code-block\">options mprint mprintnest ;</div><div class=\"ql-code-block\">options errorcheck=strict errors=0 ;</div><div class=\"ql-code-block\">options merror serror ;</div><div class=\"ql-code-block\">options dkricond=error dkrocond=error mergenoby=warn;</div><div class=\"ql-code-block\">options dsoptions=nonote2err noquotelenmax ;</div><div class=\"ql-code-block\">options reuse=no ;</div><div class=\"ql-code-block\">options fullstimer ;</div><div class=\"ql-code-block\">options missing = .;</div><div class=\"ql-code-block\">options validvarname = v7;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%global reqid soc_master_program_version ccbypass;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Request-ID (must be lower case) */</div><div class=\"ql-code-block\">%let ReqID = %lowcase(&amp;ProjID.&amp;dlm.&amp;WPType.&amp;dlm.&amp;WPID.&amp;dlm.&amp;DPID.&amp;dlm.&amp;VerID);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Sentinel master program header version for use in signature files */</div><div class=\"ql-code-block\">%let soc_master_program_version= 3.0.0 ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%macro scc_yn; /* Please DO NOT edit */</div><div class=\"ql-code-block\">  /*-----------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">  /* If common components specified, define all file paths                             */</div><div class=\"ql-code-block\">  /*-----------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">  %if %str(\"&amp;SCC.\") ne (\"\") %then %do;</div><div class=\"ql-code-block\">    %let ccbypass=N;</div><div class=\"ql-code-block\">    /* Include Common Components */</div><div class=\"ql-code-block\">    %inc \"&amp;SCC./inputfiles/cc_utility/cc_macvars.sas\" /nosource2 ;</div><div class=\"ql-code-block\">    %end;</div><div class=\"ql-code-block\">  /*-----------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">  /* If common components NOT specified, define all file paths and CC macro parameters */</div><div class=\"ql-code-block\">  /*-----------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">  %else %if %str(\"&amp;SCC.\") = (\"\") %then %do;</div><div class=\"ql-code-block\">    %let ccbypass=Y;</div><div class=\"ql-code-block\">  /*-----------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">  /* Define all macro parameters as global - DO NOT EDIT                               */</div><div class=\"ql-code-block\">    %global etl dp phase dp_mindate dp_maxdate dplocal msoc infolder sasprograms</div><div class=\"ql-code-block\">            enrtable demtable distable enctable diatable proctable  </div><div class=\"ql-code-block\">            deathtable codtable labtable vittable ipharmtable itranstable miltable;</div><div class=\"ql-code-block\">  /*-----------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">    /* Assign Macro variables*/</div><div class=\"ql-code-block\">    %let dp=&amp;_dp;</div><div class=\"ql-code-block\">    %let etl=&amp;_etl;</div><div class=\"ql-code-block\">    %let dp_mindate=%sysfunc(putn(%superq(_dp_mindate),best12.));</div><div class=\"ql-code-block\">    %let dp_maxdate=%sysfunc(putn(%superq(_dp_maxdate),best12.));</div><div class=\"ql-code-block\">    %let enrtable= &amp;_enrtable;</div><div class=\"ql-code-block\">    %let demtable= &amp;_demtable;</div><div class=\"ql-code-block\">    %let distable= &amp;_distable;</div><div class=\"ql-code-block\">    %let enctable= &amp;_enctable;</div><div class=\"ql-code-block\">    %let diatable= &amp;_diatable;</div><div class=\"ql-code-block\">    %let proctable= &amp;_proctable;</div><div class=\"ql-code-block\">    %let deathtable= &amp;_deathtable;</div><div class=\"ql-code-block\">    %let codtable= &amp;_codtable;</div><div class=\"ql-code-block\">    %let labtable= &amp;_labtable;</div><div class=\"ql-code-block\">    %let vittable= &amp;_vittable;</div><div class=\"ql-code-block\">    %let ipharmtable= &amp;_ipharmtable;</div><div class=\"ql-code-block\">    %let itranstable= &amp;_itranstable;</div><div class=\"ql-code-block\">    %let miltable=&amp;_miltable;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    /* Delete temporary macro variables */</div><div class=\"ql-code-block\">    %symdel _dp _etl _dp_mindate _dp_maxdate _enrtable _demtable _distable _enctable _diatable _proctable;</div><div class=\"ql-code-block\">    %symdel _deathtable _codtable _labtable _vittable _ipharmtable _itranstable _miltable ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    %macro soc_clean_paths(paths);</div><div class=\"ql-code-block\">      %local j ln subpath temppath;  </div><div class=\"ql-code-block\">      %if %length(%superq(paths)) eq 0 %then %do;</div><div class=\"ql-code-block\">      %put The parameter path must be non-missing.; %abort cancel; %end;</div><div class=\"ql-code-block\">      %let paths=%qsysfunc(translate(&amp;paths,%str(/),%str(\\)));</div><div class=\"ql-code-block\">      %do j=1 %to %qsysfunc(countw(&amp;paths.,%str( )));</div><div class=\"ql-code-block\">      %let subpath=%qscan(&amp;paths,&amp;j,%str( )); %let ln=%length(&amp;subpath);</div><div class=\"ql-code-block\">      %if %qsubstr(&amp;subpath,&amp;ln,1) ne %str(/) %then %do; %let subpath=&amp;subpath./; %end;</div><div class=\"ql-code-block\">      %let d_exist = %soc_dirExist(&amp;subpath) ;  </div><div class=\"ql-code-block\">      %if &amp;d_exist eq 0 %then %do; %put Path &amp;subpath. does not exist; %abort cancel; %end; </div><div class=\"ql-code-block\">      %let temppath=&amp;temppath. &amp;subpath.; %end;</div><div class=\"ql-code-block\">      %let paths=%qleft(&amp;temppath);</div><div class=\"ql-code-block\">      &amp;paths   /* returns value to calling environment, like a function */</div><div class=\"ql-code-block\">    %mend soc_clean_paths;</div><div class=\"ql-code-block\">    %macro soc_dirExist(dir) ; </div><div class=\"ql-code-block\">      %if %length(&amp;dir.) eq 0 %then %do; </div><div class=\"ql-code-block\">      %put The parameter dir must be non-missing.; %abort cancel; %end;</div><div class=\"ql-code-block\">      %local rc fileref return; %let rc=%qsysfunc(filename(fileref,&amp;dir.)); </div><div class=\"ql-code-block\">      %let return=%qsysfunc(fexist(&amp;fileref.));  </div><div class=\"ql-code-block\">      &amp;return  /* returns value to calling enivornment, like a function */</div><div class=\"ql-code-block\">      %let rc=%qsysfunc(filename(fileref));  </div><div class=\"ql-code-block\">    %mend soc_dirExist;</div><div class=\"ql-code-block\">    %macro soc_quotepath(list);</div><div class=\"ql-code-block\">      %local j d_exist path_ct path subpath temppath; %let list_ct=%qsysfunc(countw(&amp;list,%str( )));</div><div class=\"ql-code-block\">      %do j=1 %to &amp;list_ct.;</div><div class=\"ql-code-block\">      %let subpath=%qscan(&amp;list,&amp;j,%str( )); %let d_exist = %soc_dirExist(&amp;subpath);  </div><div class=\"ql-code-block\">      %if &amp;d_exist eq 0 %then %do; %put Path &amp;subpath does not exist; %abort cancel; %end;</div><div class=\"ql-code-block\">      %let subpath=\"&amp;subpath.\"; %let temppath=&amp;temppath. &amp;subpath.; %end;</div><div class=\"ql-code-block\">      %let list=%qleft(&amp;temppath);</div><div class=\"ql-code-block\">      &amp;list /* returns value to calling enivornment, like a function */</div><div class=\"ql-code-block\">    %mend soc_quotepath;</div><div class=\"ql-code-block\">    %macro soc_lib(ref, paths, options=) ;</div><div class=\"ql-code-block\">      %local libpaths; %if %length(&amp;ref) eq 0 %then %do; %put libref is blank; %abort cancel; %end;</div><div class=\"ql-code-block\">      %if %length(%superq(paths)) eq 0 %then %do ;</div><div class=\"ql-code-block\">      %put SOC-NOTE: For libref &amp;ref the path is blank, libname assignment skipped; %end;</div><div class=\"ql-code-block\">      %let libpaths= %soc_quotepath(&amp;paths) ;</div><div class=\"ql-code-block\">      libname &amp;ref. %unquote((&amp;libpaths.)) &amp;options.;</div><div class=\"ql-code-block\">    %mend soc_lib;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">   /* Define request specific subdirectories */</div><div class=\"ql-code-block\">    %let DPLOCAL = %soc_clean_paths(&amp;_packageroot_dplocal.);</div><div class=\"ql-code-block\">    %let MSOC = %soc_clean_paths(&amp;_packageroot_msoc.);      </div><div class=\"ql-code-block\">    %let INFOLDER = %soc_clean_paths(&amp;_packageroot_inputfiles.);</div><div class=\"ql-code-block\">    %let SASPROGRAMS =%soc_clean_paths(&amp;_packageroot_sasprograms.);</div><div class=\"ql-code-block\">    %let INDATA=%soc_clean_paths(&amp;prod_scdm.) ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">    %soc_lib(INDATA, &amp;INDATA, options=%str(access=readonly))</div><div class=\"ql-code-block\">  %end;</div><div class=\"ql-code-block\">%mend scc_yn;</div><div class=\"ql-code-block\">%scc_yn</div><div class=\"ql-code-block\">  </div><div class=\"ql-code-block\">/* Assign libnames */</div><div class=\"ql-code-block\">/* %soc_lib(libref-name, path-name, options=%str(options-name=options-value)) */</div><div class=\"ql-code-block\">%soc_lib(DPLOCAL,&amp;DPLOCAL)</div><div class=\"ql-code-block\">%soc_lib(MSOC,&amp;MSOC)</div><div class=\"ql-code-block\">%soc_lib(INFOLDER,&amp;INFOLDER, options=%str(access=readonly))</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Delete macro variable used as delimiter as no longer needed */</div><div class=\"ql-code-block\">%symdel dlm ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Create clean work environment */</div><div class=\"ql-code-block\">proc datasets lib=work kill memtype=data nolist nodetails;</div><div class=\"ql-code-block\">quit;</div><div class=\"ql-code-block\">    %macro convertdpdate(datevar=, dpdate=);</div><div class=\"ql-code-block\">    %if %sysfunc(findc(&amp;dpdate.,'kd')) %then %do;</div><div class=\"ql-code-block\">    data _null_;</div><div class=\"ql-code-block\">        dp=&amp;dpdate.;</div><div class=\"ql-code-block\">        call symputx(\"&amp;datevar.\", dp);</div><div class=\"ql-code-block\">    run;</div><div class=\"ql-code-block\">    %end;</div><div class=\"ql-code-block\">    %mend;</div><div class=\"ql-code-block\">    %convertdpdate(datevar=dp_mindate, dpdate=&amp;dp_mindate);</div><div class=\"ql-code-block\">    %convertdpdate(datevar=dp_maxdate, dpdate=&amp;dp_maxdate);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">****************************************************************************************</div><div class=\"ql-code-block\">*****                                BEGIN PROGRAM                                 *****</div><div class=\"ql-code-block\">****************************************************************************************</div><div class=\"ql-code-block\">***** NOTE: Programmer developing a packages writes the rest of the program below  *****</div><div class=\"ql-code-block\">****************************************************************************************;</div><div class=\"ql-code-block\">/*-------------------------------------------------------------------------------------*/</div><div class=\"ql-code-block\">/* 1-                                                                                  */</div><div class=\"ql-code-block\">/*-------------------------------------------------------------------------------------*/ </div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/********** FOLDER CONTAINING INPUT SAS MACROS USED BY THE MAIN PROGRAM *************************/;</div><div class=\"ql-code-block\">/*Macro Files Location*/          %let sasmacr=&amp;INFOLDER.macros/;          </div><div class=\"ql-code-block\">/*Report Macro Files Location*/   %let reportmacr=&amp;INFOLDER.macros/reportmacros/;   </div><div class=\"ql-code-block\">/* QRP Version */ %let QRPVer=9.1.0;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">*Added for Routine Querying System;</div><div class=\"ql-code-block\">**Include macro and program files ** ;  </div><div class=\"ql-code-block\">%include \"&amp;sasmacr.combo.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_agestrat.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_assigncalmacrovars.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_attrition.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_caresettingprincipal.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_cci_elix.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_cidacov.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_cidadenom.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_cidanum.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_cidatables.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_cidatablest3.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_cidatablest4.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_cidatablest5.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_cidatablest6.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_codedistribution.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_create_enrollment_spans.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createcat.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createcensortable.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createclaimepi.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createclaimsfiles.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createdistbaselinetable.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createnopreggroup.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createpov1.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createpov1t4.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createpov2.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createpov3.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createpov4.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createpov4t4.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createpov56.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createt5episodes.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createptsmasterlist.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createriskset.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_debug.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_delpatients.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_envelope.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_episoderec.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_episoderec2.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_extractanniversarydate.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_extractdeaths.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_extractdrugs.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_extractlabs.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_extractmeds.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_extractmilinkage.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_finalizemoiepisodes.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_finalizeptsmasterlist.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_findgap.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_freezedata.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_initmacrovariables.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_loopmeds.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_macros.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_mfu.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_moimetrics.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_outputruntimes.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_periodsoverlap.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_processinputfiles.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_processwildcards.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_setdatadrivenqueryperiod.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_setnumloopmacrovars.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_shaveinside.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_shaveoutside.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_squaredtableshell.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_stockpiling.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_surveillance.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_time.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_util.sas\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_nvrexposed.sas\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_covariate_adjustment.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_matchtables.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_nearestneighbormatch.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_appendfiles.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_hdps.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_runmodel.sas\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_switching.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_evalsecondaryepi.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_evalsecondarytables.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_its.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_concomitantuse.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_concomitantusetables.sas\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_createmicohorts.sas\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_treeconvertchildparent.sas\";</div><div class=\"ql-code-block\">%include \"&amp;sasmacr.ms_treeextraction.sas\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">**Include reporting macros ** ;  </div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_addstatetozip3.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_assignformats.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_createcdf.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_createreport.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_createbaselinetable.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_definegroupsruns.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_initializemacrovariables.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_outputbaselinetable.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_outputfigures.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_outputreport.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2_outputt1t2table.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t1t2table.sas\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t5_aggregate_tables.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t5_create_censoring_table.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t5_create_distribution_tables.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t5_create_figures.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t5_create_gaps_table.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t5_create_toc.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t5_createreport.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t5_output_report.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_t5_set_reportparameters.sas\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_compute_baselinetable.sas\";</div><div class=\"ql-code-block\">%include \"&amp;reportmacr.ms_reportutilitymacros.sas\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">**Include run_programs;</div><div class=\"ql-code-block\">%include \"&amp;infolder.run_programs.sas\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">*+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+;</div><div class=\"ql-code-block\">* End qrp_master_header.sas                                               ;</div><div class=\"ql-code-block\">*+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+;</div><div class=\"ql-code-block\"><br></div></div><p>///t</p><p>t///</p>"}]}],"NodeDescription":"<p>Customization of the run_program</p><iframe class=\"ql-video\" frameborder=\"0\" allowfullscreen=\"true\" src=\"https://www.youtube.com/embed/wtSSPUGqCNI?showinfo=0\" data-blot-formatter-unclickable-bound=\"true\"></iframe><p><br></p><p>///t</p><p>t///</p>"},{"idx":"CodeTask-pypwaJWDu1aXADlD","name":"Ref. Wenbin's code of creating inputfiles (pilot 1)","NodeDescription":"<iframe class=\"ql-video\" frameborder=\"0\" allowfullscreen=\"true\" src=\"https://www.youtube.com/embed/wtSSPUGqCNI?showinfo=0\" data-blot-formatter-unclickable-bound=\"true\"></iframe><p><br></p><p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*The following is a copy of</div><div class=\"ql-code-block\" data-language=\"plain\">P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\01_create_inputfiles_PS1.sas</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%INCLUDE '/SAS_data/dw0/HQC_share/Clean/library_dw0.sas';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%let MSProjID = soc;</div><div class=\"ql-code-block\" data-language=\"plain\">%let MSWPType = qar;</div><div class=\"ql-code-block\" data-language=\"plain\">%let MSWPID = wp001;</div><div class=\"ql-code-block\" data-language=\"plain\">%let MSDPID = pilot1;</div><div class=\"ql-code-block\" data-language=\"plain\">%let MSVerID = v01;</div><div class=\"ql-code-block\" data-language=\"plain\">%let dlm = _ ;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%let MSReqID = &amp;MSProjID.&amp;dlm.&amp;MSWPType.&amp;dlm.&amp;MSWPID.&amp;dlm.&amp;MSDPID.&amp;dlm.&amp;MSVerID ;</div><div class=\"ql-code-block\" data-language=\"plain\">/* Request-Id parameter value must be lower case */</div><div class=\"ql-code-block\" data-language=\"plain\">%let MSReqID = %lowcase(&amp;MSReqID) ;</div><div class=\"ql-code-block\" data-language=\"plain\">%put &amp;MSReqID ;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%LET _root= /SAS_data/dw0/HQC_share/Project_CNODES_CDM/;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* Define Request Specific Subdirectories */</div><div class=\"ql-code-block\" data-language=\"plain\">%let MSOC = &amp;_root./&amp;MSReqID./msoc/ ;</div><div class=\"ql-code-block\" data-language=\"plain\">%let INFOLDER = &amp;_root./&amp;MSReqID./inputfiles/ ;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* Assign libnames */</div><div class=\"ql-code-block\" data-language=\"plain\">libname ps1 \"&amp;INFOLDER.\" ;</div><div class=\"ql-code-block\" data-language=\"plain\">libname data \"&amp;MSOC.\" ;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*----------------------------*</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Create Monitoring File</div><div class=\"ql-code-block\" data-language=\"plain\">*----------------------------*;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">DATA PS1.P1MonitoringFile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length periodid 8;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length startfollowup 8;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length enddate 8;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;periodid = 1;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;startfollowup = '01jan2015'd;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enddate = '31dec2017'd;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format startfollowup enddate date9.;</div><div class=\"ql-code-block\" data-language=\"plain\">RUN;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*----------------------------------------------------*</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Study Groups</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*----------------------------------------------------*;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">**********************************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">* Each combination of drug of interest and washout period must be its own group&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;(ex. Alprolix_90 is Alprolix with a washout period of 90 days&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;All of the groups are incident with respect to the drug of interest AND all other drugs *</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;considered in the study&nbsp;&nbsp;&nbsp;&nbsp;(i.e. new users cannot be current users of any other statin&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;considered.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;34 drugs x 2 washout periods = 66 groups&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;Names of groups are put into macro variables to be made into arrays and then looped *</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;through to create group records&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">**********************************************************************************************;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%let groups = ('Alprolix_90' 'Alprolix_180' 'Carbaglu_90' 'Carbaglu_180' 'Cosentyx_90' 'Cosentyx_180' 'Cyramza_90' 'Cyramza_180' 'Daklinza_90'</div><div class=\"ql-code-block\" data-language=\"plain\">'Daklinza_180' 'Dapagliflozin_Metformin_90' 'Dapagliflozin_Metformin_180' 'Dymista_90' 'Dymista_180' 'Egrifta_90' 'Egrifta_180'</div><div class=\"ql-code-block\" data-language=\"plain\">'Entresto_90' 'Entresto_180' 'Entyvio_90' 'Entyvio_180' 'Ferriprox_90' 'Ferriprox_180' 'Fetzima_90' 'Fetzima_180' 'Forxiga_90'</div><div class=\"ql-code-block\" data-language=\"plain\">'Forxiga_180' 'Gardasil_90' 'Gardasil_180' 'Holkira_Pak_90' 'Holkira_Pak_180' 'Iclusig_90' 'Iclusig_180' 'Jardiance_90'</div><div class=\"ql-code-block\" data-language=\"plain\">'Jardiance_180' 'Keytruda_90' 'Keytruda_180' 'Movantik_90' 'Movantik_180' 'Opdivo_90' 'Opdivo_180' 'Peginterferon_Alfa_2b_90'</div><div class=\"ql-code-block\" data-language=\"plain\">'Peginterferon_Alfa_2b_180' 'Pheburane_90' 'Pheburane_180' 'Plegridy_90' 'Plegridy_180' 'Prolensa_90' 'Prolensa_180' 'Repatha_90'</div><div class=\"ql-code-block\" data-language=\"plain\">'Repatha_180' 'Revestive_90' 'Revestive_180' 'Rosiver_90' 'Rosiver_180' 'Secukinumab_Recombinant_90' 'Secukinumab_Recombinant_180'</div><div class=\"ql-code-block\" data-language=\"plain\">'Sodium_Phenyl_90' 'Sodium_Phenyl_180'</div><div class=\"ql-code-block\" data-language=\"plain\">'Strensiq_90' 'Strensiq_180' 'Sylvant_90' 'Sylvant_180' 'Zydelig_90' 'Zydelig_180' 'Zykadia_90' 'Zykadia_180');</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">DATA PS1.P1CohortFile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length group $ 30;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length coverage $ 2;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length enrolgap 8;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length enrdays 8;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length type1 $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length type2 $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length type3 $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length type4 $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length type5 $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length enrdaysaft 8;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length chartres $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length sex $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length race $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length hispanic $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length race_out $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length hispanic_out $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length agestrat $100;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length geog $50;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;coverage = 'MD';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enrolgap = 45;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type1 = 'Y';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type2 = 'N';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type3 = 'N';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type4 = 'N';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;type5 = 'N';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;call missing(enrdaysaft);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;chartres = 'N';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;call missing(sex);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;call missing(race);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;call missing(hispanic);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;race_out = 'N';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;hispanic_out = 'N';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;agestrat = '00-09 10-19 20-44 45-64 65-74 75+';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;array groups {66} $30 g1-g66 &amp;groups;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;do i = 1 to 66;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group = groups[i];</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*** Check the last 3 characters of a group name to assign the correct washout period;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if substr(group,length(group)-2,3) = '_90' then enrdays = 90;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if substr(group,length(group)-2,3) = '180' then enrdays = 180;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop g1-g66 i;</div><div class=\"ql-code-block\" data-language=\"plain\">RUN;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*----------------------------*</div><div class=\"ql-code-block\" data-language=\"plain\">Create Cohort Codes File</div><div class=\"ql-code-block\" data-language=\"plain\">*----------------------------*;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*import PILOT1_DIN_LIST;</div><div class=\"ql-code-block\" data-language=\"plain\">/*data PS1.PILOT1_DIN_LIST;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/* set PILOT1_DIN_LIST;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/* _din = put(din,z8.);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/* run;*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table brand_name_list as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct brand_name from PS1.PILOT1_DIN_LIST;</div><div class=\"ql-code-block\" data-language=\"plain\">quit;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table check_1 as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct din from PS1.PILOT1_DIN_LIST;</div><div class=\"ql-code-block\" data-language=\"plain\">quit;&nbsp;&nbsp;&nbsp;&nbsp;/*59*/;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table DP_DRG as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct DRG_NAME, DIN from hqc.DP_DRUG</div><div class=\"ql-code-block\" data-language=\"plain\">where DRG_NAME in (select brand_name from brand_name_list);</div><div class=\"ql-code-block\" data-language=\"plain\">quit;</div><div class=\"ql-code-block\" data-language=\"plain\">/* All brand_name are existed in DP_DRUG */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table DINs_specific as</div><div class=\"ql-code-block\" data-language=\"plain\">select DRG_NAME as brand_name length=11, DIN as _din from DP_DRG</div><div class=\"ql-code-block\" data-language=\"plain\">where DIN not in (select distinct _din from PS1.PILOT1_DIN_LIST);</div><div class=\"ql-code-block\" data-language=\"plain\">quit;</div><div class=\"ql-code-block\" data-language=\"plain\">/*CARBAGLU&nbsp;&nbsp;&nbsp;&nbsp;00951056*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*import QUANTITY_DAYSSUPL_ON;</div><div class=\"ql-code-block\" data-language=\"plain\">data PS1.NME_QUANTITY_DAYSSUPL_RATIO_ON;</div><div class=\"ql-code-block\" data-language=\"plain\">set NME_QUANTITY_DAYSSUPL_RATIO_ON;</div><div class=\"ql-code-block\" data-language=\"plain\">_din = put(din,z8.);</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*import QUANTITY_DAYSSUPL_MB;</div><div class=\"ql-code-block\" data-language=\"plain\">data PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB;</div><div class=\"ql-code-block\" data-language=\"plain\">set NME_QUANTITY_DAYSUPPL_RATIO_MB;</div><div class=\"ql-code-block\" data-language=\"plain\">_din = put(din,z8.);</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table DIN_MB as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct _din from PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB;</div><div class=\"ql-code-block\" data-language=\"plain\">quit;&nbsp;&nbsp;&nbsp;&nbsp;/*19*/;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table DIN_ON as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct _din from PS1.NME_QUANTITY_DAYSSUPL_RATIO_ON;</div><div class=\"ql-code-block\" data-language=\"plain\">quit;/*16*/;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table check_1 as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct a._din from PS1.NME_QUANTITY_DAYSSUPL_RATIO_ON a, PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB b</div><div class=\"ql-code-block\" data-language=\"plain\">where a._din = b._din;</div><div class=\"ql-code-block\" data-language=\"plain\">quit;/*11*/;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table check_2 as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct din from PS1.NME_QUANTITY_DAYSSUPL_RATIO_ON</div><div class=\"ql-code-block\" data-language=\"plain\">where din not in (select distinct din from PS1.PILOT1_DIN_LIST);</div><div class=\"ql-code-block\" data-language=\"plain\">quit;&nbsp;&nbsp;&nbsp;&nbsp;/* '09857548' */;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table check_3 as</div><div class=\"ql-code-block\" data-language=\"plain\">select DRG_NAME as brand_name length=11, DIN as _din from DP_DRG</div><div class=\"ql-code-block\" data-language=\"plain\">where DIN ='09857548';</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* 0 */;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data PILOT1_DIN_LIST;</div><div class=\"ql-code-block\" data-language=\"plain\">set PS1.PILOT1_DIN_LIST(keep= brand_name _din)</div><div class=\"ql-code-block\" data-language=\"plain\">DINs_specific;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*** Import drug codes using XLSX SAS engine;</div><div class=\"ql-code-block\" data-language=\"plain\">DATA DrugCodes;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length group $30;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length code $11;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length stockgroup $30;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length codetype $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length codecat $2;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length caresettingprincipal $30;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t1_index $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t2_index $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t2_fup $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t3_index $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t3_fup $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t4_index $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t4_fup $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t5_index $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length rawlabdatetype $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length rawlabresult $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length codesupply 8;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;*** Drug codes are import from a spreadsheet;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set PILOT1_DIN_LIST;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;*** As some drug names have underscores in them, I replace the spaces in the stockgroup names</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so they can be compared to group names below;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;stockgrouptemp = tranwrd(trim(left(propcase(brand_name))), ' ', '_');</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;stockgroup = tranwrd(stockgrouptemp, '-', '_');</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;code = _din;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;codetype = '10';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;codecat = 'RX';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1_index = 'DEF';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2_fup = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t3_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t3_fup = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t4_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t4_fup = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t5_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;array groups {66} $30 h1-h66 &amp;groups;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;do i = 1 to 66;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*** Unlike pilot studies 2 and 3, each group is only incident with respect to the drug of interest</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;so only needs to be associated with those DINs;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if substr(groups[i],1,6) = substr(stockgroup,1,6) then do;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group = groups[i];</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop brand_name _din h1-h66 i stockgrouptemp;</div><div class=\"ql-code-block\" data-language=\"plain\">RUN;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*----------------------------------------------------*</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note on Dummy 11 Digit Codes</div><div class=\"ql-code-block\" data-language=\"plain\">*----------------------------------------------------*;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">**************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">* CIDA is expecting 11 digit drug codes and wasn't picking *</div><div class=\"ql-code-block\" data-language=\"plain\">* up 8 digit ones when I ran this study the first time. *</div><div class=\"ql-code-block\" data-language=\"plain\">* I asked Libby Dee from Sentinel about it and she said *</div><div class=\"ql-code-block\" data-language=\"plain\">* to include dummy 11 digit codes.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*</div><div class=\"ql-code-block\" data-language=\"plain\">**************************************************************;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*** Add dummy 11 digit codes;</div><div class=\"ql-code-block\" data-language=\"plain\">DATA DrugcodesDummy;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length group $30;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length code $11;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length stockgroup $30;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length codetype $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length codecat $2;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length caresettingprincipal $30;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t1_index $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t2_index $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t2_fup $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t3_index $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t3_fup $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t4_index $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t4_fup $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t5_index $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length rawlabdatetype $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length rawlabresult $3;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length codesupply 8;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;codetype = '11';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;codecat = 'RX';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;code = '99999999999';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1_index = 'DEF';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2_fup = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t3_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t3_fup = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t4_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t4_fup = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t5_index = 'NOT';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;array groups {66} $30 h1-h66 &amp;groups;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;do i = 1 to 66;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group = groups[i];</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop h1-h66 i;</div><div class=\"ql-code-block\" data-language=\"plain\">RUN;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">DATA PS1.P1CohortCodesFile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set DrugCodes DrugcodesDummy;</div><div class=\"ql-code-block\" data-language=\"plain\">RUN;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">PROC SORT data=PS1.P1CohortCodesFile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;by group stockgroup;</div><div class=\"ql-code-block\" data-language=\"plain\">RUN;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*-----------------*</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Type 1 file</div><div class=\"ql-code-block\" data-language=\"plain\">*-----------------*;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">DATA PS1.P1Type1File;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length group $30;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t1cohortdef $2;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length t1washper 8;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length censor_dth $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length censor_output $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length censor_dpend $1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length censor_qryend $1;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1cohortdef = '01';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_dth = 'Y';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_output = 'Y';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_dpend = 'Y';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;censor_qryend = 'N';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;*** Generate groups;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;array groups {66} $30 h1-h66 &amp;groups;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;do i = 1 to 66;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group = groups[i];</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*** Assign appropriate washout period;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if index(group,'90') &gt; 0 then t1washper = 90;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if index(group, '180') &gt; 0 then t1washper = 180;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop h1-h66 i;</div><div class=\"ql-code-block\" data-language=\"plain\">RUN;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* SK Site Specific */</div><div class=\"ql-code-block\" data-language=\"plain\">%INCLUDE '/SAS_data/dw0/HQC_share/Clean/library_dw0.sas';</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%let indata=/SAS_data/dw0/HQC_share/Project_CNODES_CDM/data/;</div><div class=\"ql-code-block\" data-language=\"plain\">libname indata \"&amp;indata.\";</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table dispensing as</div><div class=\"ql-code-block\" data-language=\"plain\">select * from indata.dispensing</div><div class=\"ql-code-block\" data-language=\"plain\">where NDC in (select _din from PILOT1_DIN_LIST);</div><div class=\"ql-code-block\" data-language=\"plain\">quit;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* take the highest frequency of DIN's quant_dayssupl_ratio as an estimate */</div><div class=\"ql-code-block\" data-language=\"plain\">proc sort data=PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB;</div><div class=\"ql-code-block\" data-language=\"plain\">by brand_name _din descending quant_freq_percent;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data NME_QUANTITY_DAYSSUPL_RATIO_MB;</div><div class=\"ql-code-block\" data-language=\"plain\">set PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;by brand_name _din descending quant_freq_percent;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if first._din;</div><div class=\"ql-code-block\" data-language=\"plain\">run; /* 19 */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">select count(distinct _din) from NME_QUANTITY_DAYSSUPL_RATIO_MB;</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /*19*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">select count(distinct _din) from PILOT1_DIN_LIST;</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* 60 */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">select count(distinct _din) from PILOT1_DIN_LIST</div><div class=\"ql-code-block\" data-language=\"plain\">where _din in (select _din from PS1.NME_QUANTITY_DAYSSUPL_RATIO_MB);</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* 19 */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table dispensing_1 as</div><div class=\"ql-code-block\" data-language=\"plain\">select a.quant_dayssupl_ratio, b.*</div><div class=\"ql-code-block\" data-language=\"plain\">from NME_QUANTITY_DAYSSUPL_RATIO_MB a, dispensing b</div><div class=\"ql-code-block\" data-language=\"plain\">where a._din = b.NDC;</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* n= 100685 */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* if not in the ON DIN List then give i to quant_dayssupl_ratio as an estimate */</div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table dispensing_2 as</div><div class=\"ql-code-block\" data-language=\"plain\">select *, 1 as quant_dayssupl_ratio</div><div class=\"ql-code-block\" data-language=\"plain\">from dispensing</div><div class=\"ql-code-block\" data-language=\"plain\">where NDC not in (select _din from NME_QUANTITY_DAYSSUPL_RATIO_MB);</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* n=2036 */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data dispensing_11(drop=quant_dayssupl_ratio);</div><div class=\"ql-code-block\" data-language=\"plain\">set dispensing_1;</div><div class=\"ql-code-block\" data-language=\"plain\">RxSup = RxAmt/quant_dayssupl_ratio;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data dispensing_21(drop=quant_dayssupl_ratio);</div><div class=\"ql-code-block\" data-language=\"plain\">set dispensing_2;</div><div class=\"ql-code-block\" data-language=\"plain\">RxSup = RxAmt/quant_dayssupl_ratio;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data indata.dispensing_NME;</div><div class=\"ql-code-block\" data-language=\"plain\">set dispensing_11</div><div class=\"ql-code-block\" data-language=\"plain\">dispensing_21</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">select count(distinct NDC) from indata.dispensing_NME;</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* 30 */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table check_0 as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct _din from INFOLDER.NME_QUANTITY_DAYSSUPL_RATIO_MB ;</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* 19 */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table check_1 as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct NDC from indata.dispensing_NME</div><div class=\"ql-code-block\" data-language=\"plain\">where NDC not in (select distinct _din from INFOLDER.PILOT1_DIN_LIST) ;</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* 0 */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table check_2 as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct NDC from indata.dispensing_NME</div><div class=\"ql-code-block\" data-language=\"plain\">where NDC not in (select distinct _din from INFOLDER.NME_QUANTITY_DAYSSUPL_RATIO_MB) ;</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* 13 */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table check_3 as</div><div class=\"ql-code-block\" data-language=\"plain\">select distinct NDC from indata.dispensing_NME</div><div class=\"ql-code-block\" data-language=\"plain\">where NDC in (select distinct _din from INFOLDER.NME_QUANTITY_DAYSSUPL_RATIO_MB) ;</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* 17 */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">1: CARBAGLU&nbsp;&nbsp;&nbsp;&nbsp;00951056 Specific in DRUG DP</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">2: 19 out of 60 DINs had dayssupl information from NME_QUANTITY_DAYSSUPL_RATIO_MB</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">3: 98% percent dispensation for those 19 DINs and the rest assigned 1 as dayssup</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sql;</div><div class=\"ql-code-block\" data-language=\"plain\">create table dispensing_1 as</div><div class=\"ql-code-block\" data-language=\"plain\">select * from indata.dispensing_NME</div><div class=\"ql-code-block\" data-language=\"plain\">where NDC in (select distinct _din from INFOLDER.NME_QUANTITY_DAYSSUPL_RATIO_MB) ;</div><div class=\"ql-code-block\" data-language=\"plain\">quit; /* */</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* top ten frequency of RxAmt in SK */</div><div class=\"ql-code-block\" data-language=\"plain\">proc sort data=dispensing_1;</div><div class=\"ql-code-block\" data-language=\"plain\">by ndc;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc freq data=dispensing_1 order=freq ;</div><div class=\"ql-code-block\" data-language=\"plain\">by ndc;</div><div class=\"ql-code-block\" data-language=\"plain\">tables RxAmt / list nocum out=RxAmt_out;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sort data=RxAmt_out;</div><div class=\"ql-code-block\" data-language=\"plain\">by ndc descending percent;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data RxAmt_out_1;</div><div class=\"ql-code-block\" data-language=\"plain\">i=0;</div><div class=\"ql-code-block\" data-language=\"plain\">do until(last.ndc);</div><div class=\"ql-code-block\" data-language=\"plain\">set RxAmt_out;</div><div class=\"ql-code-block\" data-language=\"plain\">by ndc descending percent;</div><div class=\"ql-code-block\" data-language=\"plain\">i+1;</div><div class=\"ql-code-block\" data-language=\"plain\">if i &lt;=10 then output;</div><div class=\"ql-code-block\" data-language=\"plain\">end;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">proc sort data=INFOLDER.NME_QUANTITY_DAYSSUPL_RATIO_MB out=check_4;</div><div class=\"ql-code-block\" data-language=\"plain\">by _din descending quant_freq_percent;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div></div><p><br></p><p>s///</p><p>t///</p>","custparents":[{"idx":"CodeTask-SbMLkku5hRGuVfGb"},{"idx":"CodeTask-SbMLkku5hRGuVfGb"}]}],"custparents":[{"idx":"CodeTask-2EWZUgWyk7dvfLe9"},{"idx":"CodeTask-1nO5AOhrm37TWv37"}]}],"custparents":[{"idx":"CodeTask-klBgI7NRLnI7fn3L"}]}],"custparents":[{"idx":"MY349d85cb-7ba2-4156-812a-6b6427e52047"}]}],"NodeDescription":"<p>///t</p><p>[_Q]</p><p>t///</p>"},{"idx":"CodeTask-NrDC6oJNN34iBg5x","name":"Prepare SK study data","NodeDescription":"///t<br/>///s<br/>/*<br/>Creating SK Data<br/>The following was copied from <br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part00.sas<br/>*/<br/><br/>/******<br/>Program name: CNODES CDM         Date: 2017-08-01<br/>stored @ dw0/HQC_share/CNODES CDM/code<br/>Author: Wenbin<br/>Description:  Sentinel Tables Creation<br/>Study: CDM pilot project<br/>Principal Investigator: Dr. Gary Teare <br/>Input data:<br/>Output data:<br/>Variable generated:<br/>External files:<br/>*******/<br/><br/>/*proc datasets lib=temp  nolist kill&#59 quit&#59 run&#59*/<br/><br/>/****************************************************/<br/>/* Using PHRS_PERS_INFO */<br/>/***************************************************/<br/><br/>%INCLUDE '/SAS_data/dw0/HQC_share/Clean/library_dw0.sas'&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/reformat_datevars.sas'&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/coverage_days.sas'&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_CIHI.sas'&#59<br/>%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_MSB.sas'&#59<br/><br/>libname temp '/SAS_data/dw0/HQC_share/Project_CNODES_CDM/temporary'&#59<br/>libname cdm '/SAS_data/dw0/HQC_share/Project_CNODES_CDM/data'&#59<br/>libname doc '/SAS_data/dw0/HQC_share/Project_CNODES_CDM/document'&#59<br/><br/>/* Based on team discusion on August 15, 2017 */<br/>%let DRUG_INITIAL_DATE = '01APR1996'd &#59<br/><br/>/* The Latest Xtrc_date */<br/>%let XTRC_DATE = '02JUL2017'd &#59   /* report_start: 07DEC1994&nbsp&nbsp&nbsp&nbspreport_end: 02JUL2017 */<br/>%let _cls = datepart(xtrc_date)=&XTRC_DATE&#59<br/><br/>%let extract_start&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= '01APR1996'd&#59<br/>%let extract_end &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= '31MAR2017'd&#59<br/><br/><br/>/* Import NGS Categories and EncType mapping(NGS Categories_Codes and Descriptions_Subset for AV_DS_SO_18Dec2017)*/<br/>data DOC.EncType&#59<br/>  length NGS_CATEGORY $3&#59<br/>  set work.enctype_0000&#59<br/>  NGS_CATEGORY=substr(DESCRIPTION,1,3)&#59<br/>run&#59<br/><br/>proc sql&#59<br/>  select count(distinct NGS_CATEGORY) from DOC.ngs_fsc_sk&#59<br/>quit&#59 /* 121 */<br/><br/>proc sql&#59<br/>  select count(distinct NGS_CATEGORY) from DOC.EncType&#59<br/>quit&#59 /* 58 */<br/><br/>proc sql&#59&#59<br/>   create table test as <br/>   select distinct NGS_CATEGORY from DOC.EncType<br/>   where NGS_CATEGORY not in (select distinct NGS_CATEGORY from DOC.ngs_fsc_sk)&#59<br/>   quit&#59 /* 0 */<br/><br/>libname tmp '/SAS_data/dw0/HQC_share/Wenbin/LIMPAC/tmp'&#59 <br/><br/>data msb_2&#59<br/>   set tmp.msb&#59<br/>   if MODE='Z' then delete &#59 /* Out of Province Reciprocal Billing */<br/>run&#59<br/><br/>proc sql&#59&#59<br/>   create table FSC_List as <br/>   select distinct fsc from msb_2&#59<br/>   quit&#59 /* 3882 */<br/><br/>proc sql&#59&#59<br/>   select count(distinct fsc) from DOC.ngs_fsc_sk&#59<br/>   quit&#59 /* 4077 */<br/><br/>proc sql&#59&#59<br/>   create table FSC_List_spec as <br/>   select distinct fsc from FSC_List<br/>   where fsc not in (select distinct fsc from DOC.ngs_fsc_sk)&#59<br/>   quit&#59 /* 46 */<br/><br/>/* Temporary created the following files */<br/>/* SCDM: 4.1 Encounter Table*/<br/>%Extract_MSB(<br/>   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp=&nbsp&nbsp&nbsp&nbsp cdm.msb,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp'31MAR1997'd,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt&nbsp&nbsp&nbsp&nbsp &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp'11APR2017'd,<br/>               &nbsp&nbsp&nbsp&nbspdostart&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp&extract_start,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp    dosend&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp&extract_end,<br/>                kept_vars               =   KEY_HSN KEY_DOC_NUM SPEC MG DIAG FSC NUM_SRV DOS LOS CONTACTS AMT_APP MODE<br/>)&#59<br/><br/>/*  Hospital */<br/>%let hosp_file          = clean17.CIHI_EOC_2_OND16_23MAY2017&#59<br/> %Extract_CIHI(ds_in            = &hosp_file,<br/>               ds_out           = cdm.hosp, <br/>               dchg_start_date  = &extract_start,&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>               adms_end_date    = &extract_end,<br/>               ICD_field_list   = ,<br/>               ICD9_list        = ,<br/>               ICD9_excl_exact_list =,<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   ICD10_list       = <br/>&nbsp&nbsp&nbsp&nbsp            )&#59<br/><br/><br/><br/><br/>/* Modification */<br/>data temp.Encounter_hosp&#59<br/>   length DRG_Type $4&#59<br/>   set temp.Encounter_hosp&#59<br/>   DRG_Type = ''&#59<br/>run&#59<br/><br/>temp.Encounter_msb<br/><br/>temp.DIAGNOSIS_MSB<br/><br/>temp.PROCEDURE_MSB<br/><br/>s///<br/>t///","children":[{"idx":"CodeTask-2EWZUgWyk7dvfLe9","name":"Local Settings","NodeDescription":"<p>///t</p><p>///s</p><p>/*local settings*/</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let mymacros=S:\\Collaborative_researchers\\Shenzhen\\My Project\\Projects\\DoNotDelete Common Macros\\MyMacros.sas;</div><div class=\"ql-code-block\">%include \"&amp;mymacros\" /LRECL=32767;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let localDatapath =P:/cdmpilot9_v1/projectfolder/indata;</div><div class=\"ql-code-block\">libname locald \"&amp;localDatapath\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let inputfiles =P:/cdmpilot9_v1/projectfolder/inputfiles;</div><div class=\"ql-code-block\">libname infiles \"&amp;inputfiles\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*the path to hold real data of SK*/</div><div class=\"ql-code-block\">%let localSKDatapath =P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\NewVersion_Shenzhen_Since20191219\\data;</div><div class=\"ql-code-block\">libname localSKd \"&amp;localSKDatapath\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let datastartdate='01Jan1996'd;</div><div class=\"ql-code-block\">%let dataenddate='31dec2018'd;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*for local*/</div><div class=\"ql-code-block\">%let theNGSfile = localskd.NGS_FSC_SK;</div><div class=\"ql-code-block\">/*for local*/</div><div class=\"ql-code-block\">%let theEncTypeFile = localskd.Enctype;</div><div class=\"ql-code-block\">/*for local*/</div><div class=\"ql-code-block\">%let theFacLocFile = localskd.fac_loc;</div><div class=\"ql-code-block\">/*for local*/</div><div class=\"ql-code-block\">%let theDiagMapFile=localskd.SK_ZDIAG_TO_ICD9;</div></div><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"CodeTask-fHlg1SbjMF7xDeY5","name":"demographic","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*Creating the demographic_1 using SK data</div><div class=\"ql-code-block\">the data set specification can be found at:</div><div class=\"ql-code-block\">https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</div><div class=\"ql-code-block\">downloaded and save in:</div><div class=\"ql-code-block\">P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\Documentation\\NewDocsSinceHandOver</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*what does it look like in sentinel demo file?*/</div><div class=\"ql-code-block\">/*%print(data=locald.demographic_1);*/</div><div class=\"ql-code-block\">/*%nobs(data=locald.demographic_1);*/</div><div class=\"ql-code-block\">/*%distinct(data=locald.demographic_1, target=test, vars=PatID);*/</div><div class=\"ql-code-block\">/*proc datasets lib=locald;*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;contents data=demographic_1 order=varnum;*/</div><div class=\"ql-code-block\">/*run;*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">Birth_date&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">Sex&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">hispanic&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">race&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">ZIP&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;$5.00&nbsp;&nbsp;&nbsp;&nbsp;$5.00&nbsp;&nbsp;&nbsp;&nbsp;ZIP</div><div class=\"ql-code-block\">ZIP_date&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*where is wenbin's code?</div><div class=\"ql-code-block\">P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">/*What does wenbin's datafile looks like?</div><div class=\"ql-code-block\">%print(data=rOldD.demographic);</div><div class=\"ql-code-block\">proc datasets lib=rOldD;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=demographic order=varnum;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00</div><div class=\"ql-code-block\">Birth_Date&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">Sex&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;$1.00&nbsp;&nbsp;&nbsp;&nbsp;$1.00</div><div class=\"ql-code-block\">Zip_Date&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">Hispanic&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">Race&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">Zip&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Decision:</div><div class=\"ql-code-block\">1. Var length and varnum order follow sentinel demo files</div><div class=\"ql-code-block\">2. Hispanic='U', Race='0', Zip='XXX' (first 3 digits)</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data demographic_tmp1;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID $16.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Birth_Date 4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sex $1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hispanic $1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;race $1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZIP $5.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZIP_date 4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format Birth_Date YYMMDD10. ZIP_date YYMMDD10.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">proc datasets ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=demographic_tmp1 order=varnum;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*get the enrol list (which was already prepared by the prog 'enrollment')*/</div><div class=\"ql-code-block\">%UnixUnZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=&amp;remotedatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zip=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipped=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrollment_9618</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*from above, get the earliest enrol_date*/</div><div class=\"ql-code-block\">%sort(data=enrollment_9618, sorter=PatID Enr_Start Enr_End);</div><div class=\"ql-code-block\">data demographic_tmp2;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set enrollment_9618;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;by PatID Enr_Start Enr_End;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if first.PatID;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rename PatID = Key_hsn;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*Basically just to have demographic data from PHRS_INFO File, and FSA from the resc clean file*/</div><div class=\"ql-code-block\">/*Which resi file is appropriate for ZIP (first 3 digits): clean19.phrs_pers_resc_1_ond18_06feb2019*/</div><div class=\"ql-code-block\">/*%print(data=clean19.phrs_pers_resc_1_ond18_06feb2019);*/</div><div class=\"ql-code-block\">/*Note: the follow returns zip close to Enr_Start (%GEO_INCQTL_assign does not return fsa)*/</div><div class=\"ql-code-block\">data demographic_tmp3;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;PHRS_Resi_cleanFile;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn eff_date exp_date fsa;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if eff_date =. then eff_date = report_start;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if exp_date=. then exp_date = report_end;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*link _tmp2 and _tmp3, calculate the days between enr_start and eff_date*/</div><div class=\"ql-code-block\">%sqljoinv2(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t1=demographic_tmp2,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t2=demographic_tmp3,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=demographic_tmp4,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.*, t2.eff_date, t2.exp_date, t2.fsa, abs(t2.eff_date - t1.Enr_Start) as days),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=left,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jvars=key_hsn</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%sort(data=demographic_tmp4, sorter=key_hsn enr_start days);</div><div class=\"ql-code-block\">data demographic_tmp5;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set demographic_tmp4;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;by key_hsn enr_start days;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if first.key_hsn;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;drop exp_date days;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format ZIP $5.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ZIP = strip(fsa);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;drop fsa MedCov DrugCov Chart Enr_Start Enr_End;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rename eff_date=ZIP_date ;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*get birth sex (the %getPHRSInfo is too slow)</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;consider using retain to keep record of the last xtrc without sorting (cannot do it, at least key_hsn need to be sorted first)</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">data demographic_tmp6;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;phrs_infoFile;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length Birth_date 4.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format Birth_date MMDDYY10.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Birth_date = mdy(born_month, 15, born_year);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn Birth_date sex_desc xtrc_date;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rename sex_desc=sex;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%sort(data=demographic_tmp6, sorter=key_hsn xtrc_date);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data demographic_tmp7;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set demographic_tmp6;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;by key_hsn xtrc_date;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if last.key_hsn;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;drop xtrc_date;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format Birth_date MMDDYY10.; </div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%nobs(data=demographic_tmp5);</div><div class=\"ql-code-block\">%nobs(data=demographic_tmp7);</div><div class=\"ql-code-block\">/*there are more patients in tmp7 than in tmp5, because tmp5 only contains individuals covered</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;between 1996 and 2018, whilst tmp7 contains more ever enroled in PHRS*/</div><div class=\"ql-code-block\">%sqljoinv2(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t1=demographic_tmp5,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t2=demographic_tmp7,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=%str(demographic_tmp8 (rename= (key_hsn = PatID))),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.*, t2.sex, t2.Birth_date),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=inner,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jvars=key_hsn</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">[_Q]</div><div class=\"ql-code-block\">/*Questions:</div><div class=\"ql-code-block\">1. Is the key_hsn unique, or repeat by different time period?</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;there is no duplicated rows (each patient only had one row). So the zip date must take the one most close </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;to the starting date....</div><div class=\"ql-code-block\">2. What if FSA is missing? or Sex is missing?</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;In Wenbin's file, if ZIP is missing, leave it blank, leave zip date missing</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data demographic_9618;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set demographic_tmp1 demographic_tmp8;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Hispanic ='U';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Race='0';</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%UnixZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;source=, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data=demographic_9618, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=demographic_9618.zip </div><div class=\"ql-code-block\">);</div></div><p><br></p><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"CodeTask-vMKtioTg1c4HUcTk"},{"idx":"CodeTask-2EWZUgWyk7dvfLe9"}],"_substeps":{"idx":"db802ce0-ae09-4d6c-9a82-93b80d6f330d","name":"substeps","children":[{"idx":"0fee1e8e-acec-4566-adc9-9f16230683bf","name":"Table definition","NodeDescription":"<p>///t</p><p>///s</p><p><br></p><p>/*Creating&nbsp;the&nbsp;demographic_1&nbsp;using&nbsp;SK&nbsp;data</p><p>the&nbsp;data&nbsp;set&nbsp;specification&nbsp;can&nbsp;be&nbsp;found&nbsp;at:</p><p>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</p><p>downloaded&nbsp;and&nbsp;save&nbsp;in:</p><p>P:\\2018&nbsp;-&nbsp;CDM&nbsp;CNODES&nbsp;(Wenbin&nbsp;Nedeene&nbsp;Amanda)\\Documentation\\NewDocsSinceHandOver</p><p>*/</p><p><br></p><p>/*what&nbsp;does&nbsp;it&nbsp;look&nbsp;like&nbsp;in&nbsp;sentinel&nbsp;demo&nbsp;file?*/</p><p>/*%print(data=locald.demographic_1);*/</p><p>/*%nobs(data=locald.demographic_1);*/</p><p>/*%distinct(data=locald.demographic_1,&nbsp;target=test,&nbsp;vars=PatID);*/</p><p>/*proc&nbsp;datasets&nbsp;lib=locald;*/</p><p>/*&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=demographic_1&nbsp;order=varnum;*/</p><p>/*run;*/</p><p><br></p><p><br></p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Birth_date&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Sex&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>hispanic&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>race&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>ZIP&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;$5.00&nbsp;&nbsp;&nbsp;&nbsp;$5.00&nbsp;&nbsp;&nbsp;&nbsp;ZIP</p><p>ZIP_date&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;</p><p>*/</p><p><br></p><p><br></p><p>/*where&nbsp;is&nbsp;wenbin's&nbsp;code?</p><p>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from&nbsp;pilot1&nbsp;to&nbsp;compare\\datacreation\\CDM_part01.sas</p><p>*/</p><p>/*What&nbsp;does&nbsp;wenbin's&nbsp;datafile&nbsp;looks&nbsp;like?</p><p>%print(data=rOldD.demographic);</p><p>proc&nbsp;datasets&nbsp;lib=rOldD;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=demographic&nbsp;order=varnum;</p><p>run;</p><p>*/</p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00</p><p>Birth_Date&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Sex&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;$1.00&nbsp;&nbsp;&nbsp;&nbsp;$1.00</p><p>Zip_Date&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Hispanic&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Race&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Zip&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;</p><p>*/</p><p><br></p><p><br></p><p>/*&nbsp;Decision:</p><p>1.&nbsp;Var&nbsp;length&nbsp;and&nbsp;varnum&nbsp;order&nbsp;follow&nbsp;sentinel&nbsp;demo&nbsp;files</p><p>2.&nbsp;Hispanic='U',&nbsp;Race='0',&nbsp;Zip='XXX'&nbsp;(first&nbsp;3&nbsp;digits)</p><p>*/</p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"MY77db2d36-c87b-4c5e-9098-07a58da67f41","name":"Make an empty table with defined vars","custparents":[{"idx":"0fee1e8e-acec-4566-adc9-9f16230683bf"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">data&nbsp;demographic_tmp1;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;$16.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Birth_Date&nbsp;4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sex&nbsp;$1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hispanic&nbsp;$1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;race&nbsp;$1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZIP&nbsp;$5.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ZIP_date&nbsp;4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format&nbsp;Birth_Date&nbsp;YYMMDD10.&nbsp;ZIP_date&nbsp;YYMMDD10.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">proc&nbsp;datasets&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=demographic_tmp1&nbsp;order=varnum;</div><div class=\"ql-code-block\">run;</div></div><p>t///</p>","children":[{"idx":"MY137ce836-ccb4-46dc-8973-c089cd3dd0e1","name":"Get the patient list from the enrollment file","custparents":[{"idx":"MY77db2d36-c87b-4c5e-9098-07a58da67f41"},{"idx":"6710625a-6de1-427c-b0fd-8112e64ddb05"},{"idx":"CodeTask-vMKtioTg1c4HUcTk"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*get&nbsp;the&nbsp;enrol&nbsp;list&nbsp;(which&nbsp;was&nbsp;already&nbsp;prepared&nbsp;by&nbsp;the&nbsp;prog&nbsp;'enrollment')*/</div><div class=\"ql-code-block\">%UnixUnZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=&amp;remotedatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zip=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipped=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrollment_9618</div><div class=\"ql-code-block\">);</div></div><p><br></p><p>t///</p>","children":[{"idx":"MYd01327b3-6db9-4fae-b784-1b2caef8d33e","name":"Determine the first enrollment period","custparents":[{"idx":"MY137ce836-ccb4-46dc-8973-c089cd3dd0e1"}],"children":[{"idx":"MYe3da3abe-bdeb-464e-8451-cb133fb60994","name":"Covering days","custparents":[{"idx":"MYd01327b3-6db9-4fae-b784-1b2caef8d33e"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*link _tmp2 and _tmp3, calculate the days between enr_start and eff_date*/</div><div class=\"ql-code-block\" data-language=\"plain\">%sqljoinv2(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1=demographic_tmp2,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2=demographic_tmp3,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=demographic_tmp4,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.*, t2.eff_date, t2.exp_date, t2.fsa, abs(t2.eff_date - t1.Enr_Start) as days),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=left,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jvars=key_hsn</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div></div><p>t///</p>","children":[{"idx":"MY3729e43c-07ed-4d86-bd7c-25a6dedd4e24","name":"Determine zip and the effective date","custparents":[{"idx":"MYe3da3abe-bdeb-464e-8451-cb133fb60994"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">%sort(data=demographic_tmp4, sorter=key_hsn enr_start days);</div><div class=\"ql-code-block\" data-language=\"plain\">data demographic_tmp5;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set demographic_tmp4;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;by key_hsn enr_start days;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if first.key_hsn;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop exp_date days;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format ZIP $5.;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ZIP = strip(fsa);</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop fsa MedCov DrugCov Chart Enr_Start Enr_End;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rename eff_date=ZIP_date ;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div></div><p><br></p><p>t///</p>","children":[{"idx":"MYf5da24c7-7fcc-4ae1-847f-6255076a0c21","name":"Determine sex and birth","custparents":[{"idx":"MY3729e43c-07ed-4d86-bd7c-25a6dedd4e24"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*get birth sex (the %getPHRSInfo is too slow)</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;consider using retain to keep record of the last xtrc without sorting (cannot do it, at least key_hsn need to be sorted first)</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">data demographic_tmp6;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;phrs_infoFile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length Birth_date 4.;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format Birth_date MMDDYY10.;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Birth_date = mdy(born_month, 15, born_year);</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn Birth_date sex_desc xtrc_date;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rename sex_desc=sex;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">%sort(data=demographic_tmp6, sorter=key_hsn xtrc_date);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*keep the record of the latest xtrc_date*/</div><div class=\"ql-code-block\" data-language=\"plain\">data demographic_tmp7;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set demographic_tmp6;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;by key_hsn xtrc_date;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if last.key_hsn;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop xtrc_date;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format Birth_date MMDDYY10.;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%nobs(data=demographic_tmp5);</div><div class=\"ql-code-block\" data-language=\"plain\">%nobs(data=demographic_tmp7);</div><div class=\"ql-code-block\" data-language=\"plain\">/*there are more patients in tmp7 than in tmp5, because tmp5 only contains individuals covered</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;between 1996 and 2018, whilst tmp7 contains more ever enroled in PHRS*/</div><div class=\"ql-code-block\" data-language=\"plain\">%sqljoinv2(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1=demographic_tmp5,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2=demographic_tmp7,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=%str(demographic_tmp8 (rename= (key_hsn = PatID))),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.*, t2.sex, t2.Birth_date),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=inner,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jvars=key_hsn</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div></div><p><br></p><p>t///</p>","children":[{"idx":"MY4c96e7de-5c6a-4b1e-b9e1-c122d4b3d240","name":"Make and zip the demographic file","custparents":[{"idx":"MYf5da24c7-7fcc-4ae1-847f-6255076a0c21"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">data demographic_9618;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set demographic_tmp1 demographic_tmp8;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Hispanic ='U';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Race='0';</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">%UnixZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;source=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;data=demographic_9618,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=demographic_9618.zip</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">[_Q]</div><div class=\"ql-code-block\" data-language=\"plain\">/*Questions:</div><div class=\"ql-code-block\" data-language=\"plain\">1. Is the key_hsn unique, or repeat by different time period?</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;there is no duplicated rows (each patient only had one row). So the zip date must be the one most close to the starting date...</div><div class=\"ql-code-block\" data-language=\"plain\">2. What if FSA is missing? or Sex is missing?</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;In Wenbin's file, if ZIP is missing, leave it blank, leave zip date missing</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div></div><p><br></p><p>t///</p>"}]}]}]}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*from above, get the earliest enrol_date*/</div><div class=\"ql-code-block\" data-language=\"plain\">%sort(data=enrollment_9618, sorter=PatID Enr_Start Enr_End);</div><div class=\"ql-code-block\" data-language=\"plain\">data demographic_tmp2;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set enrollment_9618;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;by PatID Enr_Start Enr_End;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if first.PatID;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rename PatID = Key_hsn;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div></div><p>t///</p>"}]}]}]},{"idx":"CodeTask-Riz4N3decp5Xhetg","name":"Ref. Wenbin's demo code","NodeDescription":"///t<br/>///s<br/>/*Webin's code<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/*  SCDM: 2.1 Demorgraphic Table*/<br/>/* Postcode INFO */<br/>proc sql&#59<br/>   create table Postcode_1 as<br/>   select *<br/>   from hqc.PHRS_PERS_RESC(where=(&_cls))<br/>   order by key_hsn, eff_date &#59<br/>quit&#59<br/><br/>%reformat_datevars (work, Postcode_1)&#59<br/><br/><br/>data Postcode_2&#59<br/>   set Postcode_1&#59<br/>   if post_code=' ' then delete&#59<br/>   keep key_hsn post_code  eff_date exp_date report_start report_type report_end&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table Postcode_3 as<br/>   select distinct key_hsn, post_code,  eff_date, exp_date from Postcode_2<br/>   order by key_hsn, eff_date&#59<br/>quit&#59<br/><br/>data Postcode_4&#59<br/>   set Postcode_3&#59<br/>   by key_hsn&#59<br/>   if last.key_hsn and  exp_date=. then exp_date='02JUL2017'd&#59<br/>run&#59<br/><br/>proc sort data=Postcode_4&#59<br/>by key_hsn descending eff_date&#59<br/>run&#59<br/><br/>data Postcode_5&#59<br/>   set Postcode_4&#59<br/>   by key_hsn descending eff_date&#59<br/>   lag_eff = lag(eff_date)&#59<br/>   if first.key_hsn then    lag_eff = . &#59<br/>   format lag_eff yymmdd10. &#59<br/>run&#59<br/><br/>data Postcode_6&#59<br/>   set Postcode_5&#59<br/>   if exp_date=. then exp_date_temp=lag_eff-1&#59<br/>   format exp_date_temp yymmdd10. &#59<br/>run&#59<br/><br/>data special_cases&#59<br/>   set Postcode_6&#59<br/>   if exp_date_temp=. and exp_date=.&#59<br/>   run&#59 /* n=21041 */<br/><br/>proc sql&#59<br/>   create table check_1 as<br/>   select * from Postcode_4<br/>   where key_hsn in (select key_hsn from special_cases)<br/>   order by key_hsn, eff_date&#59<br/>quit&#59<br/><br/>data Postcode_7&#59<br/>   set Postcode_5&#59<br/>   if exp_date=. then exp_date=lag_eff-1&#59<br/>   drop lag_eff&#59<br/>run&#59<br/><br/>data Postcode_8&#59<br/>   set Postcode_7&#59<br/>   if exp_date=. then exp_date='02JUL2017'd&#59<br/>run&#59<br/><br/>proc sort data=Postcode_8&#59<br/>by key_hsn eff_date&#59<br/>run&#59<br/><br/>/*  Check if there is overlapping */<br/>data check_2&#59<br/>   set Postcode_8&#59<br/>   by key_hsn eff_date&#59<br/>   lag_eff = lag(eff_date)&#59<br/>   if first.key_hsn then    lag_eff = . &#59<br/>   gap=eff_date-lag_eff&#59<br/>   format lag_eff yymmdd10. &#59<br/>   if gap < 0 and gap^=.&#59<br/>run&#59<br/>/* There is no overlapping records */<br/><br/>proc sql&#59<br/>   create table check_3 as<br/>   select * from Postcode_8<br/>   where key_hsn in (select key_hsn from special_cases)<br/>   order by key_hsn, eff_date&#59<br/>quit&#59<br/><br/>data Postcode_9&#59<br/>length key $18&#59<br/>   set Postcode_8&#59<br/>   key=catt(key_hsn,'_',POST_CODE)&#59<br/>run&#59<br/><br/>* Combine overlapping records&#59<br/>%macro enroll_combine(ID=, strt=, stop=, indata=, outdata=, gap=)&#59<br/><br/>proc sort data=&indata(keep=&ID &strt &stop) out=tmp nodupkey&#59<br/>by &ID &strt &stop&#59<br/>where &strt ne . or &stop ne . &#59<br/>run&#59<br/><br/>data &outdata(keep=&ID strt_f stop_f<br/>         rename=(strt_f=&strt stop_f=&stop))&#59<br/>   retain prev_stop strt_f stop_f&#59<br/> set tmp&#59<br/> by &ID&#59<br/> if first.&ID. then do&#59<br/>    strt_f=&strt&#59<br/>    stop_f=&stop&#59<br/>    prev_stop=&stop&#59<br/>    end&#59<br/> if (&strt>(prev_stop+&gap+1)) then do&#59<br/>    stop_f=prev_stop&#59<br/>    output&#59<br/>    strt_f=&strt&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/> if (&stop>prev_stop) then prev_stop=&stop&#59<br/> if last.&ID. then do&#59<br/>    stop_f=prev_stop&#59<br/>    output&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/> format strt_f stop_f yymmdd10. &#59<br/>run&#59<br/>%mend enroll_combine&#59<br/><br/>%enroll_combine(ID=key, strt=EFF_DATE, stop=EXP_DATE, indata=Postcode_9, outdata=Postcode_10, gap=0) &#59   <br/><br/>data Postcode_11&#59<br/>   set Postcode_10&#59<br/>   key_hsn=substr(key,1,11)&#59<br/>   POST_CODE=substr(key,13)&#59<br/>   drop key&#59<br/>run&#59<br/><br/>data Postcode_12&#59<br/>   length PC $3 &#59<br/>   set Postcode_11&#59 <br/>   rename key_hsn=PatID&#59<br/>   rename eff_date=PC_Start&#59<br/>   rename EXP_DATE=PC_End&#59<br/>   PC =substr(POST_CODE,1,3)&#59<br/>   drop post_code&#59<br/>run&#59<br/><br/>/*  SCDM: 2.2 Location CNODES SPECIFIC Table*/<br/><br/>data cdm.Location_CNODES_Specific&#59<br/>&nbsp&nbsp&nbsp&nbspretain PatID PC PC_Start PC_End&#59<br/>    length PC_Start PC_End 4.&#59<br/>&nbsp&nbsp&nbsp&nbspset Postcode_12&#59<br/>run&#59<br/><br/>proc sort data=cdm.Location_CNODES_Specific&#59<br/>by PatID PC PC_Start&#59<br/>run&#59<br/><br/>data latest_post_code&#59<br/>  set cdm.Location_CNODES_Specific&#59<br/>  by PatID&#59<br/>  if last.PatID&#59<br/>run&#59 /* n=2039809 */<br/><br/>proc sql&#59<br/>   create table PERS_1 as<br/>   select key_hsn as PatID, sex_desc as Sex, mdy(BORN_MONTH,1,BORN_YEAR) as Birth_Date format=yymmdd10.  <br/>   from hqc.PHRS_PERS_INFO(where=(&_cls))&#59<br/>quit&#59<br/><br/>%reformat_datevars (work, PERS_1)&#59 /* n=2059395 */<br/><br/>proc sql&#59<br/>   create table Demographic_1 as<br/>   select a.PC, a.PC_Start, b.*<br/>   from latest_post_code a,PERS_1 b<br/>   where a.PatID=b.PatID&#59<br/>quit&#59   /* n=2,039,808 */<br/><br/>data cdm.Demographic&#59<br/>    retain PatID Birth_Date Sex&#59<br/>    length Birth_Date Zip_Date 4.&#59<br/>    set Demographic_1(rename=(PC_Start=Zip_Date))&#59<br/>&nbsp&nbsp&nbsp&nbspHispanic='U'&#59<br/>&nbsp&nbsp&nbsp&nbspRace='0'&#59<br/>&nbsp&nbsp&nbsp&nbsprename pc=Zip&#59&nbsp&nbsp&nbsp&nbsp<br/>run&#59<br/><br/>/* n=569 people did not have demographic information */<br/>proc sql&#59<br/>  create table test as<br/>  select distinct PatID from cdm.Enrollment <br/>  where PatID not in (select PatID from cdm.Location_CNODES_Specific)&#59<br/>  quit&#59 /* n=569 */<br/>s///<br/>t///","custparents":[{"idx":"db802ce0-ae09-4d6c-9a82-93b80d6f330d"}]}]}},{"idx":"CodeTask-279Q1EcCSphNwwKH","name":"death","NodeDescription":"<p>///t</p><p>///s</p><p>/*Creating the death_1 using SK data</p><p>the data set specification can be found at:</p><p>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</p><p>downloaded and save in:</p><p>P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\Documentation\\NewDocsSinceHandOver</p><p>*/</p><p><br></p><p>/*what does it look like in sentinel demo file?*/</p><p>/*%print(data=locald.death_1);*/</p><p>/*%nobs(data=locald.death_1);*/</p><p>/*%distinct(data=locald.death_1, target=test, vars=PatID);*/</p><p>/*proc datasets lib=locald;*/</p><p>/*&nbsp;&nbsp;&nbsp;&nbsp;contents data=death_1 order=varnum;*/</p><p>/*run;*/</p><p><br></p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>DeathDt&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</p><p>DtImpute&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Source&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Confidence&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</p><p><br></p><p>*/</p><p><br></p><p>/*What does wenbin's datafile looks like?*/</p><p>%print(data=rOldD.death);</p><p>proc datasets lib=rOldD;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;contents data=death order=varnum;</p><p>run;</p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</p><p>DeathDt&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>DtImpute&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Source&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Confidence&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1</p><p>*/</p><p><br></p><p>/* Decision:</p><p>1. Var length and varnum order follow sentinel demo files</p><p>2. DtImpute='N', Source='L', Confidence='E' (first 3 digits)</p><p>*/</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">data death_tmp1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID $16.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeathDt 4.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DtImpute $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Confidence $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format DeathDt YYMMDD10. ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=death_tmp1 order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*where is wenbin's code?</div><div class=\"ql-code-block\" data-language=\"plain\">P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*Date of death from the PHRS file*/</div><div class=\"ql-code-block\" data-language=\"plain\">data death_tmp2;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;VerfMortFile;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn ddt_novit;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if ddt_novit ne .;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rename key_hsn=PatID ddt_novit=DeathDt;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;where ddt_novit between &amp;dataStartDate and &amp;dataEndDate;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data death_9618;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set death_tmp1 death_tmp2;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DtImpute='N'; Source='L'; Confidence='E';</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%UnixZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;source=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;data=death_9618,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=death_9618.zip</div><div class=\"ql-code-block\" data-language=\"plain\">);</div></div><p><br></p><p>s///</p><p>[_Q]</p><p>where is the step to exclude patients not in enrollment file?</p><p>t///</p><p>[to do]</p>","children":[],"custparents":[{"idx":"CodeTask-2EWZUgWyk7dvfLe9"}],"_substeps":{"idx":"a837a6b6-baba-4167-831d-82d047518c70","name":"substeps","children":[{"idx":"444a1428-213f-4f06-9ab5-5106dd4a2b21","name":"Table definition","NodeDescription":"<p>///t</p><p>///s</p><p><br></p><p>/*Creating&nbsp;the&nbsp;death_1&nbsp;using&nbsp;SK&nbsp;data</p><p>the&nbsp;data&nbsp;set&nbsp;specification&nbsp;can&nbsp;be&nbsp;found&nbsp;at:</p><p>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</p><p>downloaded&nbsp;and&nbsp;save&nbsp;in:</p><p>P:\\2018&nbsp;-&nbsp;CDM&nbsp;CNODES&nbsp;(Wenbin&nbsp;&nbsp;Nedeene&nbsp;&nbsp;Amanda)\\Documentation\\NewDocsSinceHandOver</p><p>*/</p><p><br></p><p>/*what&nbsp;does&nbsp;it&nbsp;look&nbsp;like&nbsp;in&nbsp;sentinel&nbsp;demo&nbsp;file?*/</p><p>/*%print(data=locald.death_1);*/</p><p>/*%nobs(data=locald.death_1);*/</p><p>/*%distinct(data=locald.death_1,&nbsp;target=test,&nbsp;vars=PatID);*/</p><p>/*proc&nbsp;datasets&nbsp;lib=locald;*/</p><p>/*&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=death_1&nbsp;order=varnum;*/</p><p>/*run;*/</p><p><br></p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>DeathDt&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</p><p>DtImpute&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Source&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Confidence&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</p><p><br></p><p>*/</p><p><br></p><p><br></p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</p><p>DeathDt&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>DtImpute&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Source&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Confidence&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1</p><p>*/</p><p>/*What&nbsp;does&nbsp;wenbin's&nbsp;datafile&nbsp;looks&nbsp;like?</p><p>%print(data=rOldD.death);</p><p>proc&nbsp;datasets&nbsp;lib=rOldD;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=death&nbsp;order=varnum;</p><p>run;;</p><p>*/</p><p>/*&nbsp;Decision:</p><p>1.&nbsp;Var&nbsp;length&nbsp;and&nbsp;varnum&nbsp;order&nbsp;follow&nbsp;sentinel&nbsp;demo&nbsp;files</p><p>2.&nbsp;DtImpute='N',&nbsp;Source='L',&nbsp;Confidence='E'&nbsp;(first&nbsp;3&nbsp;digits)</p><p>*/</p><p>/*where&nbsp;is&nbsp;wenbin's&nbsp;code?</p><p>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from&nbsp;pilot1&nbsp;to&nbsp;compare\\datacreation\\CDM_part01.sas</p><p>*/</p><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"MYb3abb651-375d-47f1-8fcc-549006f5e791","name":"Make an empty table with defined vars","custparents":[{"idx":"444a1428-213f-4f06-9ab5-5106dd4a2b21"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">data&nbsp;death_tmp1;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;$16.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeathDt&nbsp;4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DtImpute&nbsp;$1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Source&nbsp;$1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Confidence&nbsp;$1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format&nbsp;DeathDt&nbsp;YYMMDD10.&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\">run;;</div><div class=\"ql-code-block\">proc&nbsp;datasets&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=death_tmp1&nbsp;order=varnum;</div><div class=\"ql-code-block\">run;</div></div><p>t///</p>","children":[{"idx":"2f29a12e-b975-4c23-86fd-6995232c0826","name":"Get death events and dates","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*Date&nbsp;of&nbsp;death&nbsp;from&nbsp;the&nbsp;PHRS&nbsp;file*/</div><div class=\"ql-code-block\">data&nbsp;death_tmp2;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;&amp;VerfMortFile;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep&nbsp;key_hsn&nbsp;ddt_novit;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;ddt_novit&nbsp;ne&nbsp;.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rename&nbsp;key_hsn=PatID&nbsp;ddt_novit=DeathDt;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;ddt_novit&nbsp;between&nbsp;&amp;dataStartDate&nbsp;and&nbsp;&amp;dataEndDate;</div><div class=\"ql-code-block\">run;</div></div><p>s///</p><p>t///</p>","children":[{"idx":"79bd5d8a-699b-45f7-859e-1536929c413e","name":"Make and zip the death event file","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">data&nbsp;death_9618;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;death_tmp1&nbsp;death_tmp2;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DtImpute='N';&nbsp;Source='L';&nbsp;Confidence='E';</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%UnixZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;source=,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data=death_9618,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=death_9618.zip&nbsp;</div><div class=\"ql-code-block\">);</div></div><p>s///</p><p>t///</p>"}],"custparents":[{"idx":"MYb3abb651-375d-47f1-8fcc-549006f5e791"}]}]}]},{"idx":"CodeTask-EVWCjhA39sQPKbwv","name":"Ref. Wenbin's code for death file","NodeDescription":"///t<br/>///s<br/>/*<br/>death file<br/>Webin's code<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/* SCDM: 5.1 Death Table */<br/>proc sql&#59<br/>   create table PHRS_PERS_RSDC_1 as<br/>   select *<br/>   from  HQC.PHRS_PERS_RSDC(where=(&_cls))&#59<br/>quit&#59 /* n=231,455 */<br/><br/>%reformat_datevars (work, PHRS_PERS_RSDC_1)&#59  /*2,585,904*/<br/><br/>data PHRS_PERS_RSDC_2&#59<br/>   set PHRS_PERS_RSDC_1(keep=key_hsn RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>    where RSDC_STAT_TYPE_CODE =4 &#59<br/>&nbsp&nbsp&nbsp&nbspDeathDt=eff_date-1&#59<br/>    format DeathDt yymmdd10. &#59<br/>&nbsp&nbsp&nbsp&nbsplength DeathDt 4. &#59<br/>run&#59<br/><br/>data CDM.DEATH&#59<br/>   set PHRS_PERS_RSDC_2(drop=RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>   DtImpute = 'N'&#59<br/>   Source = 'L' &#59<br/>   Confidence='E' &#59<br/>   rename key_hsn=PatID&#59<br/>run&#59<br/><br/>s///<br/>t///","custparents":[{"idx":"a837a6b6-baba-4167-831d-82d047518c70"}]}],"NodeDescription":"<p>///t</p><p>t///</p><p><br></p>"}},{"idx":"CodeTask-qJq38eUBnhxhdDUZ","name":"dispensing","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*Creating the dispensing file using SK data</div><div class=\"ql-code-block\">the data set specification can be found at:</div><div class=\"ql-code-block\">https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</div><div class=\"ql-code-block\">downloaded and save in:</div><div class=\"ql-code-block\">P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\Documentation\\NewDocsSinceHandOver</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">data _null_;run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*what does it look like in sentinel demo file?*/</div><div class=\"ql-code-block\">/*%print(data=locald.DISPENSING_1);*/</div><div class=\"ql-code-block\">/*%nobs(data=locald.DISPENSING_1);*/</div><div class=\"ql-code-block\">/*%distinct(data=locald.DISPENSING_1, target=test, vars=%str(PatID, RXDate, NDC));*/</div><div class=\"ql-code-block\">/*the demo data suggests that patientid-rxDate-NDC combination should be unique*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*proc datasets lib=locald;*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;contents data=DISPENSING_1 order=varnum;*/</div><div class=\"ql-code-block\">/*run;*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">RxDate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</div><div class=\"ql-code-block\">NDC&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$19.00&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">RxSup&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">RxAmt&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*What does wenbin's datafile looks like?*/</div><div class=\"ql-code-block\">%print(data=rOldD.DISPENSING);</div><div class=\"ql-code-block\">proc datasets lib=rOldD;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=DISPENSING order=varnum;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">RxDate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;DATETIME20.&nbsp;&nbsp;&nbsp;&nbsp;RX_DDDDD</div><div class=\"ql-code-block\">RxSup&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">RxAmt&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</div><div class=\"ql-code-block\">NDC&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;$8.00&nbsp;&nbsp;&nbsp;&nbsp;$8.00&nbsp;&nbsp;&nbsp;&nbsp;DIN</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Decision:</div><div class=\"ql-code-block\">1. Var length and varnum order follow sentinel demo files</div><div class=\"ql-code-block\">2. Leave RxSup =. (subject to algorithm for RxSup of specific projects)</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">data dispensing_tmp1;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID $16.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RxDate 4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NDC $11.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RxSup 4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RxAmt 4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format RxDate YYMMDD10. ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">proc datasets ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=dispensing_tmp1 order=varnum;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*where is wenbin's code?</div><div class=\"ql-code-block\">P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">data dispensing_tmp2a;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;dp_benefitFile ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where Rx_ddddd between dhms(&amp;dataStartDate, 0,0,0) and dhms(&amp;dataEndDate, 0,0,0);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn Rx_ddddd DIN RX_QTY_AMT;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">data dispensing_tmp2b;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;dp_nonbenefitFile ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where Rx_ddddd between dhms(&amp;dataStartDate, 0,0,0) and dhms(&amp;dataEndDate, 0,0,0);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn Rx_ddddd DIN RX_QTY_AMT;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data dispensing_tmp2c;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set dispensing_tmp2a dispensing_tmp2b;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;RxDate=datepart(Rx_ddddd);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rename key_hsn = PatID DIN = NDC;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%sqljoinv2(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t1=dispensing_tmp2c,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=dispensing_tmp2,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.PatID, RxDate, NDC, sum(RX_QTY_AMT) as RxAmt),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;groupby=%str(PatID, RxDate, NDC)</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*From above, only keep those appeared in enroll file*/</div><div class=\"ql-code-block\">%UnixUnZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=&amp;remotedatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zip=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipped=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrollment_9618</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%sqljoinv2(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t1=dispensing_tmp2,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t2=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=dispensing_tmp3,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=t1.*,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=inner,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jvars=PatID</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data DISPENSING_9618;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set dispensing_tmp1 dispensing_tmp3;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%UnixZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;source=, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data=DISPENSING_9618, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=DISPENSING_9618.zip </div><div class=\"ql-code-block\">);</div></div><p><br></p><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"CodeTask-vMKtioTg1c4HUcTk"},{"idx":"CodeTask-2EWZUgWyk7dvfLe9"}],"_substeps":{"idx":"3a4d0069-04b1-4075-b374-a546755f9c23","name":"substeps","children":[{"idx":"54f7b0d9-b477-4d3e-a6c7-67273ba701f5","name":"Table definition","NodeDescription":"<p>///t</p><p>///s</p><p><br></p><p>/*Creating&nbsp;the&nbsp;dispensing&nbsp;file&nbsp;using&nbsp;SK&nbsp;data</p><p>the&nbsp;data&nbsp;set&nbsp;specification&nbsp;can&nbsp;be&nbsp;found&nbsp;at:</p><p>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</p><p>downloaded&nbsp;and&nbsp;save&nbsp;in:</p><p>P:\\2018&nbsp;-&nbsp;CDM&nbsp;CNODES&nbsp;(Wenbin&nbsp;&nbsp;Nedeene&nbsp;&nbsp;Amanda)\\Documentation\\NewDocsSinceHandOver</p><p>*/</p><p>data&nbsp;_null_;run;</p><p><br></p><p><br></p><p>/*what&nbsp;does&nbsp;it&nbsp;look&nbsp;like&nbsp;in&nbsp;sentinel&nbsp;demo&nbsp;file?*/</p><p>/*%print(data=locald.DISPENSING_1);*/</p><p>/*%nobs(data=locald.DISPENSING_1);*/</p><p>/*%distinct(data=locald.DISPENSING_1,&nbsp;target=test,&nbsp;vars=%str(PatID,&nbsp;RXDate,&nbsp;NDC));*/</p><p>/*the&nbsp;demo&nbsp;data&nbsp;suggests&nbsp;that&nbsp;patientid-rxDate-NDC&nbsp;combination&nbsp;should&nbsp;be&nbsp;unique*/</p><p><br></p><p>/*proc&nbsp;datasets&nbsp;lib=locald;*/</p><p>/*&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=DISPENSING_1&nbsp;order=varnum;*/</p><p>/*run;*/</p><p><br></p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>RxDate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</p><p>NDC&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$19.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>RxSup&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>RxAmt&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;</p><p>*/</p><p><br></p><p>/*What&nbsp;does&nbsp;wenbin's&nbsp;datafile&nbsp;looks&nbsp;like?*/</p><p>%print(data=rOldD.DISPENSING);</p><p>proc&nbsp;datasets&nbsp;lib=rOldD;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=DISPENSING&nbsp;order=varnum;</p><p>run;;</p><p>/*</p><p>RxDate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;DATETIME20.&nbsp;&nbsp;&nbsp;&nbsp;RX_DDDDD</p><p>RxSup&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>RxAmt&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</p><p>NDC&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;&nbsp;$8.00&nbsp;&nbsp;&nbsp;&nbsp;$8.00&nbsp;&nbsp;&nbsp;&nbsp;DIN</p><p>*/</p><p><br></p><p>/*&nbsp;Decision:</p><p>1.&nbsp;Var&nbsp;length&nbsp;and&nbsp;varnum&nbsp;order&nbsp;follow&nbsp;sentinel&nbsp;demo&nbsp;files</p><p>2.&nbsp;Leave&nbsp;RxSup&nbsp;=.&nbsp;(subject&nbsp;to&nbsp;algorithm&nbsp;for&nbsp;RxSup&nbsp;of&nbsp;specific&nbsp;projects)</p><p>*/</p><p>/*where&nbsp;is&nbsp;wenbin's&nbsp;code?</p><p>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from&nbsp;pilot1&nbsp;to&nbsp;compare\\datacreation\\CDM_part01.sas</p><p>*/</p><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"b004d0a2-fec3-4e5f-ab40-e8ca482e2833","name":"Make an empty table with defined vars","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">data&nbsp;dispensing_tmp1;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;$16.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RxDate&nbsp;4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NDC&nbsp;$11.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RxSup&nbsp;4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RxAmt&nbsp;4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format&nbsp;RxDate&nbsp;YYMMDD10.&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">proc&nbsp;datasets&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=dispensing_tmp1&nbsp;order=varnum;</div><div class=\"ql-code-block\">run;</div></div><p>s///</p><p>t///</p>","children":[{"idx":"ac8d99a5-6c97-4de1-abdd-b540a8e5ba4f","name":"Get dispensing data","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*get dispensing data from raw file within the defined period*/</div><div class=\"ql-code-block\">data&nbsp;dispensing_tmp2a;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;&amp;dp_benefitFile&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;Rx_ddddd&nbsp;between&nbsp;dhms(&amp;dataStartDate,&nbsp;0,0,0)&nbsp;and&nbsp;dhms(&amp;dataEndDate,&nbsp;0,0,0);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep&nbsp;key_hsn&nbsp;Rx_ddddd&nbsp;DIN&nbsp;RX_QTY_AMT;</div><div class=\"ql-code-block\">run;;</div><div class=\"ql-code-block\">data&nbsp;dispensing_tmp2b;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;&amp;dp_nonbenefitFile&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;Rx_ddddd&nbsp;between&nbsp;dhms(&amp;dataStartDate,&nbsp;0,0,0)&nbsp;and&nbsp;dhms(&amp;dataEndDate,&nbsp;0,0,0);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep&nbsp;key_hsn&nbsp;Rx_ddddd&nbsp;DIN&nbsp;RX_QTY_AMT;</div><div class=\"ql-code-block\">run;</div></div><p>s///</p><p>t///</p>","children":[{"idx":"bf14b344-bf1f-418f-9cd7-4afd649a8a16","name":"Determin patientID, DIN (NDC), and RxDate","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">data&nbsp;dispensing_tmp2c;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;dispensing_tmp2a&nbsp;dispensing_tmp2b;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;RxDate=datepart(Rx_ddddd);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rename&nbsp;key_hsn&nbsp;=&nbsp;PatID&nbsp;DIN&nbsp;=&nbsp;NDC;</div><div class=\"ql-code-block\">run;</div></div><p>s///</p><p>t///</p>","children":[{"idx":"b2e97dc4-0977-40f2-b08e-0b3c143ce498","name":"sum the dispensing amount","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*sum the dispensing amount by date*/</div><div class=\"ql-code-block\">%sqljoinv2(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t1=dispensing_tmp2c,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=dispensing_tmp2,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.PatID,&nbsp;RxDate,&nbsp;NDC,&nbsp;sum(RX_QTY_AMT)&nbsp;as&nbsp;RxAmt),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;groupby=%str(PatID,&nbsp;RxDate,&nbsp;NDC)</div><div class=\"ql-code-block\">)</div></div><p>s///</p><p>t///</p>","children":[{"idx":"2c807e7a-ba3c-41cf-9d67-49a723169e3f","name":"Get patients in the enrollment file","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*Get patients in the enrollment file*/</div><div class=\"ql-code-block\">%UnixUnZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=&amp;remotedatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zip=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipped=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrollment_9618</div><div class=\"ql-code-block\">)</div></div><p>s///</p><p>t///</p>","children":[{"idx":"487fbda5-287b-4f04-a407-c305cd2e97d8","name":"Keep dispensing data of patients in the enrollment file","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*From&nbsp;above,&nbsp;only&nbsp;keep&nbsp;those&nbsp;appeared&nbsp;in&nbsp;enroll&nbsp;file*/</div><div class=\"ql-code-block\">%sqljoinv2(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t1=dispensing_tmp2,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t2=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=dispensing_tmp3,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=t1.*,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=inner,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jvars=PatID</div><div class=\"ql-code-block\">)</div></div><p>s///</p><p>t///</p>","children":[{"idx":"dab8fc70-75b0-4390-ab8d-2ae7bdce8341","name":"Make and zip the dispensing file","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">data&nbsp;DISPENSING_9618;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;dispensing_tmp1&nbsp;dispensing_tmp3;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%UnixZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;source=,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data=DISPENSING_9618,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=DISPENSING_9618.zip&nbsp;</div><div class=\"ql-code-block\">)</div></div><p>s///</p><p>t///</p>"}]}],"custparents":[{"idx":"CodeTask-vMKtioTg1c4HUcTk"},{"idx":"6710625a-6de1-427c-b0fd-8112e64ddb05"}]}]}]}]}]}]},{"idx":"CodeTask-hFP1Sike6nP9YFoM","name":"Ref. Wenbin's dispensing code","NodeDescription":"///t<br/>///s<br/>/*Webin's code for dispensing file<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/*DP_claims Extraction */<br/>proc sql&#59<br/>   create view NON_BEN as<br/>   select key_hsn, DIN,RX_DDDDD, RX_QTY_AMT, 'NON_BEN' as source from hqc.DP_CLAIM_NON_BEN&#59<br/>quit&#59 <br/><br/>proc sql&#59<br/>   create table NON_BEN_1 as<br/>   select key_hsn, DIN,RX_DDDDD, source, sum(RX_QTY_AMT) as RxAmt  from NON_BEN<br/>   group key_hsn, DIN, RX_DDDDD, source&#59<br/>quit&#59 <br/><br/>proc sql&#59<br/>   create view DP_CLAIMS as<br/>   select key_hsn,DIN,RX_DDDDD, RX_QTY_AMT, 'DP_CLAIM' as source from hqc.DP_CLAIM&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>   create table DP_CLAIMS_1 as<br/>   select key_hsn, DIN,RX_DDDDD, source, sum(RX_QTY_AMT) as RxAmt  from DP_CLAIMS<br/>   group key_hsn, DIN, RX_DDDDD, source&#59<br/>quit&#59 <br/><br/>data All_CLAIMS&#59<br/>   set DP_CLAIMS_1<br/>       NON_BEN_1<br/>&#59<br/>if RX_DDDDD >= &DRUG_INITIAL_DATE&#59<br/>rename RX_DDDDD=RxDate&#59<br/>run&#59<br/><br/>%reformat_datevars(work,All_CLAIMS)<br/><br/>proc sort data=All_CLAIMS nodupkey&#59 by _all_&#59 run&#59 <br/><br/>data cdm.Dispensing&#59 <br/>   set All_CLAIMS&#59<br/>   if RxAmt < 0 then delete &#59<br/>   rename key_hsn=PatID&#59<br/>   <br/>   rename DIN=NDC&#59<br/>   length RxDate RxSup 4.&#59<br/>run&#59 /* n=280680427 */<br/><br/>proc sort data=cdm.Dispensing nodupkey&#59 by PatID NDC RxDate&#59 run&#59 /* n=280542250 */<br/><br/><br/>s///<br/>t///","custparents":[{"idx":"3a4d0069-04b1-4075-b374-a546755f9c23"}]}]}},{"idx":"MY508b95ae-9444-4917-bc1b-20182a28a274","name":"Encounter Diagnosis & Procedure","custparents":[{"idx":"CodeTask-2EWZUgWyk7dvfLe9"}],"children":[{"idx":"CodeTask-nWkLpebRMNlItMcs","name":"Prepare master data from hosp, MSB and ED","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%UnixUnZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=&amp;remotedatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zip=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipped=enrollment_9618,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrollment_9618</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data getCohortData_hosp_tmp0;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;hospitalFile;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADM_DATE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALC_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CIHI_REC</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONV_DX_CODE_1 - Conv_DX_Code_25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONV_PROC_CODE_1 - CONV_PROC_CODE_20</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DS_IP</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DATE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_CODE_1-DX_CODE_25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_TYPE_1-DX_TYPE_25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOSP_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INST_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTVN_CODE_1-INTVN_CODE_20</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROV_LOC_SK</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CMG</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CODING_CLASS_IND</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dpg</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CACS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENTRY_CODE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEWBORN</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DISP</div><div class=\"ql-code-block\">;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%distinct(data= enrollment_9618, target=ptlist, vars=%str(patid as key_hsn length= 11));</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%Extract_CIHI(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds_in =getCohortData_hosp_tmp0,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ds_out=getCohortData_hosp_tmp1,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adms_start_date='01jan1994'd,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adms_end_date=&amp;DataEndDate,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICD9_list=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ICD10_list=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CCP_List=,</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CCP_Exact_list=,*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CCI_list=,</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CCI_Exact_list=,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;code_logic=,*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsn_list=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hsn_file= ptlist</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*apply the additional request conditions, force to have the facility num*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data Master_hosp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set getCohortData_hosp_tmp1;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keep A_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADM_DATE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALC_LOS CIHI_REC</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONV_DX_CODE_1 - Conv_DX_Code_25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CONV_PROC_CODE_1 - CONV_PROC_CODE_20</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DS_IP</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DATE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_CODE_1-DX_CODE_25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_TYPE_1-DX_TYPE_25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOSP_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INST_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INTVN_CODE_1-INTVN_CODE_20</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROV_LOC_SK</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CMG</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CODING_CLASS_IND</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPG</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CACS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENTRY_CODE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEWBORN</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DISP</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;/*zip it into the RemoteT folder*/</div><div class=\"ql-code-block\">%UnixZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sPath=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=Master_hosp,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=Master_hosp.zip,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug=</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;%getED_A2012(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=&amp;ed_a2012file,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=getCohortData_ED_A2012_tmp1,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vars=t1.*,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;distinctRecord=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatientList=ptlist,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;condition = %str(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(DatePart(reg_date) &gt;= '01jan1994'd and DatePart(reg_date) &lt;= &amp;DataEndDate)</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or (DatePart(disp_date) &gt;= '01jan1994'd and DatePart(disp_date) &lt;= &amp;DataEndDate)</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or (DatePart(reg_date) &lt; '01jan1994'd and DatePart(disp_date) &gt; &amp;DataEndDate)</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data getCohortData_ED_A2012_tmp2;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set getCohortData_ED_A2012_tmp1;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keep</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARRV_DATE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CHRT_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATE_PT_LEFT_ED</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DISP_DATE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ED_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ED_VISIT_IND</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENC_SEQ_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INST_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MP_DX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MP_PREFIX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PIA_DATE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROV_LOC_SK</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REG_DATE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRI_DATE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TRI_LEV</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VISIT_MODE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;visit_disp</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;provdr_type_1</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adm_ambul</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if datepart(xtrc_date) &lt;= &amp;Xtrc_End_ED_A2012;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;/*transform all datetime20. format variables to date9. format*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;%DateTime20VarsToDate9(data=getCohortData_ED_A2012_tmp2, target = Master_ED_A2012, debug=);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;/*zip it into the RemoteT folder*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;%UnixSplitZips(*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=Master_ED_A2012,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug=, */</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TargetLib=remoteT, */</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sizeCutoff_GB=);*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;%UnixZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sPath=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=Master_ED_A2012,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=Master_ED_A2012.zip,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug=</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*MSB*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*tho following is to prepare a master MSB data for encounter, diagnosis, and procdure*/</div><div class=\"ql-code-block\">/*%Extract_MSB(*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;ds_out&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;msb_raw,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;xtrc_start_dt = &amp;Xtrc_Start_MSB&nbsp;&nbsp;&nbsp;&nbsp;,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;xtrc_end_dt&nbsp;&nbsp;&nbsp;&nbsp;= &amp;Xtrc_End_MSB,*/</div><div class=\"ql-code-block\">/* dostart&nbsp;&nbsp;&nbsp;&nbsp;='01jan1994'd,*/</div><div class=\"ql-code-block\">/* dosend&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&amp;dataEndDate&nbsp;&nbsp;&nbsp;&nbsp;,*/</div><div class=\"ql-code-block\">/* kept_vars = KEY_HSN KEY_DOC_NUM SPEC MG DIAG FSC NUM_SRV DOS LOS MODE CONTACTS AMT_APP*/</div><div class=\"ql-code-block\">/*);*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*%UnixZip(*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;sPath=, */</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;source=, */</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;data=master_msb, */</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath, */</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;target=master_msb.zip */</div><div class=\"ql-code-block\">/*);*/</div><div class=\"ql-code-block\">/*the above is to prepare a master MSB data for encounter, diagnosis, and procdure*/</div></div><p>s///</p><p>t///</p>","custparents":[{"idx":"MY508b95ae-9444-4917-bc1b-20182a28a274"}],"children":[{"idx":"CodeTask-9v6iPCWqkuTujJag","name":"diagnosis","NodeDescription":"<p>///t</p><p>///s</p><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"CodeTask-nWkLpebRMNlItMcs"}],"_substeps":{"idx":"MY6261459e-b5ee-4b6e-a0b4-f77c41e7b85e","name":"substeps","custparents":[{"idx":"CodeTask-9v6iPCWqkuTujJag"}],"children":[{"idx":"MY8ae034e0-084e-4bb0-83c5-d066e1a1dd7a","name":"Define the file","custparents":[{"idx":"MY6261459e-b5ee-4b6e-a0b4-f77c41e7b85e"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*Creating the diagnosis file using SK data</div><div class=\"ql-code-block\" data-language=\"plain\">the data set specification can be found at:</div><div class=\"ql-code-block\" data-language=\"plain\">https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</div><div class=\"ql-code-block\" data-language=\"plain\">downloaded and save in:</div><div class=\"ql-code-block\" data-language=\"plain\">P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\Documentation\\NewDocsSinceHandOver</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*%freq(data=locald.diagnosis_1, table = drg_type)*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*what does it look like in sentinel file?*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=locald.diagnosis_1);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%nobs(data=locald.diagnosis_1);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%distinct(data=locald.diagnosis_1, target=test, vars=%str(?));*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets lib=locald;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=diagnosis_1 order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">EncounterID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;$15.00&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">ADate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</div><div class=\"ql-code-block\" data-language=\"plain\">Provider&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">DX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">DX_codetype&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">OrigDX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">PDX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">PAdmit&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*where is wenbin's code?</div><div class=\"ql-code-block\" data-language=\"plain\">P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*What does wenbin's datafile looks like?*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">%print(data=rOldD.diagnosis);</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets lib=rOldD;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=diagnosis order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">Variables in Creation Order&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">#&nbsp;&nbsp;&nbsp;&nbsp;Variable&nbsp;&nbsp;&nbsp;&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;Len&nbsp;&nbsp;&nbsp;&nbsp;Format&nbsp;&nbsp;&nbsp;&nbsp;Informat&nbsp;&nbsp;&nbsp;&nbsp;Label</div><div class=\"ql-code-block\" data-language=\"plain\">1&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</div><div class=\"ql-code-block\" data-language=\"plain\">2&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">3&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;DATETIME20.&nbsp;&nbsp;&nbsp;&nbsp;ADM_DATE</div><div class=\"ql-code-block\" data-language=\"plain\">4&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEY_DOC_NUM</div><div class=\"ql-code-block\" data-language=\"plain\">5&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">6&nbsp;&nbsp;&nbsp;&nbsp;DX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;$7.00&nbsp;&nbsp;&nbsp;&nbsp;$7.00&nbsp;&nbsp;&nbsp;&nbsp;diag_code</div><div class=\"ql-code-block\" data-language=\"plain\">7&nbsp;&nbsp;&nbsp;&nbsp;Dx_Codetype&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">8&nbsp;&nbsp;&nbsp;&nbsp;OrigDX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;$7.00&nbsp;&nbsp;&nbsp;&nbsp;$7.00&nbsp;&nbsp;&nbsp;&nbsp;DIAG</div><div class=\"ql-code-block\" data-language=\"plain\">9&nbsp;&nbsp;&nbsp;&nbsp;PAdmit&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">10&nbsp;&nbsp;&nbsp;&nbsp;PDX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* Decision:</div><div class=\"ql-code-block\" data-language=\"plain\">1. Var length and varnum order follow sentinel demo files</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div></div><p>t///</p>","children":[{"idx":"MYbb49f164-d868-45fd-9733-c4f16e59deb4","name":"create an empty data set","custparents":[{"idx":"MY8ae034e0-084e-4bb0-83c5-d066e1a1dd7a"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*doc number was $10. which is not enough for SK key_doc_num ($11.)*/</div><div class=\"ql-code-block\">data diagnosis_tmp1a;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;$16.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;$15.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;&nbsp;&nbsp;&nbsp;$11.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DX&nbsp;&nbsp;&nbsp;&nbsp;$18.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype&nbsp;&nbsp;&nbsp;&nbsp;$2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX&nbsp;&nbsp;&nbsp;&nbsp;$18.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PDX&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit $1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format ADate YYMMDD10. ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\">run;</div></div><p>t///</p>","children":[{"idx":"MY7252ea20-0f21-4b86-9968-ef21f45e5164","name":"Diagnosis from MSB","custparents":[{"idx":"MYbb49f164-d868-45fd-9733-c4f16e59deb4"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/**************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">Part 1 diagnosiss from MSB</div><div class=\"ql-code-block\" data-language=\"plain\">****************************************************************************/</div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;= key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;&lt;- EncounterID from the zip file</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= dos_1</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider = key_doc_num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType &lt;- enctype.encytype &lt;- ngs_fsc_sk.fsc &lt;- msb_master.fsc</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It seems that a more efficient way is to make a mapping between enctype and fsc directly.</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make a mapping between enctype and fsc</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the NGSfile and the enctype file has been defined in local and remote setting</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for local</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theNGSfile = localskd.NGS_FSC_SK;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for remote</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theNGSfile = rOldDoc.NGS_FSC_SK;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for local</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theEncTypeFile = localskd.Enctype;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for remote</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theEncTypeFile = rOldDoc.Enctype;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX&nbsp;&nbsp;&nbsp;&nbsp;$18. = diag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DX&nbsp;&nbsp;&nbsp;&nbsp;$18.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1) diag begins with 'Z':</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diag &lt;- sk_zdiag_to_icd9.diag_code</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(mapped by sk_zdiag_to_icd9.diag_orig_code = sk_zdiag_to_icd9.diag_code)</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or ' ' if unmatched</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2) else:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX = OrigDx</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1) diag begins with 'Z':</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DX=' ' then Dx_Codetype = 'OT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Dx_Codetype = '09';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2) Dx_Codetype = '09';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PDX&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;=''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit $1. = 'U' (Wenbin put it as ' ', but in the tech_doc it did not say that a missing value is allowed.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make sense to me to put U for unknown or unable to determine.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I did not use X (unreported/not used). I am afraid records tagged as X would be ignored in</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the future analyses, which is not expected.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">%UnixUnZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=&amp;remotedatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zip=master_msb,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipped=master_msb,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=master_msb</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsUnzip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\master_msb.zip),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(master_msb.sas7bdat)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=master_msb);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%nobs(data=master_msb);*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*keep those NOT with a mode of 'z', and dos between 1996 and 2018*/</div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_tmp1b;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set master_msb;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;where MODE ne 'Z' and dos_1 between '01jan1996'd and '31dec2018'd;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn key_doc_num diag fsc dos_1;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets nolist;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;delete MASTER_MSB;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*According to Wenbin's code, the following steps are to take to keep the relevant data</div><div class=\"ql-code-block\" data-language=\"plain\">2. only keep those with FSCs specified in the file ngs_fsc_sk.sas7bdat</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;remote: /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;local: P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\</div><div class=\"ql-code-block\" data-language=\"plain\">3. The encType is mapped out by the ngs_category in the file enctype.sas7bdat</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;remote: /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;local: P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">So combining 2 and 3:</div><div class=\"ql-code-block\" data-language=\"plain\">The enctype in the final data set is defined by</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enctype &lt;- enctype.encytype &lt;- ngs_fsc_sk.fsc &lt;- msb_master.fsc</div><div class=\"ql-code-block\" data-language=\"plain\">It seems that a more efficient way is to make a mapping between enctype and fsc directly.</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*make a mapping between enctype and fsc*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*the NGSfile and the enctype file has been defined in local and remote setting*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for local*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%let theNGSfile = localskd.NGS_FSC_SK;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for remote*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%let theNGSfile = rOldDoc.NGS_FSC_SK;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for local*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%let theEncTypeFile = localskd.Enctype;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for remote*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%let theEncTypeFile = rOldDoc.Enctype;*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=&amp;theNGSfile);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=&amp;theEncTypeFile);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for all the fsc in theNGSfile, find the enctype in the Enctype file</div><div class=\"ql-code-block\" data-language=\"plain\">Note: In Wenbin's code (making msb_3), it only keeps the records with a fsc that can be matched to a ngs_category.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;hence the inner join here</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">%sqljoinv2(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1=&amp;theNGSfile,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2=&amp;theEncTypeFile,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Target=diagnosis_tmp1c,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;distinct=1,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.fsc, ifc(t1.NGS_Category='', '_M', t1.NGS_Category) as NGS_Category,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ifc(t2.Encounter_type='', '_M', t2.Encounter_type) as EncType length=2),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=inner,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jvars= NGS_Category</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">/*4077 rows */</div><div class=\"ql-code-block\" data-language=\"plain\">/*%distinct(data=diagnosis_tmp1b, vars=fsc, target=test);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*4077 rows. The above shows that in tmp1b, there is no duplicated fsc code (i.e., fsc is not repeated assigned to different EncType)*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*However, the following shows that the majority of fsc codes cannot be matched to the enctypes</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;These unmatched fsc codes are given a enctype of '_M', standing for enctype not matched, and data is from the MSB file</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%freq(data=diagnosis_tmp1b,table=enctype);*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*From master_msb, keep select relevant columns</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">%sqljoinv2(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1=&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp1b,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2 = diagnosis_tmp1c,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp1d,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;distinct=1,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.key_hsn as PatID, t1.key_doc_num as Provider, t1.dos_1 as ADate, t1.diag,t1.fsc,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2.EncType, t2.NGS_Category</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=inner,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jvars=fsc,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;orderby=%str(ADate, PatID, Provider, EncType)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">/*nobs*/</div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets nolist;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;delete diagnosis_tmp1c ;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*add a column to indicate the z_dx*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for local*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%let theDiagMapFile=localskd.SK_ZDIAG_TO_ICD9;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for remote*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%let theDiagMapFile=rOldDoc.SK_ZDIAG_TO_ICD9;*/</div><div class=\"ql-code-block\" data-language=\"plain\">%sqljoinv2(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1=&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp1d,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2 = &amp;theDiagMapFile,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp1e,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;distinct=1,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.*, t2.diag_code),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=left,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jterm=%str(t1.diag = t2.diag_orig_code),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;orderby=%str(ADate, PatID, Provider, EncType)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">/*nobs=*/</div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets nolist;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;delete diagnosis_tmp1d ;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*[_W]Note:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID is specific for patid-provider-adate-enctype</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;for the same patid-provider-adate-enctype combination in diagnosis file,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID should be the same in the diagnosis file as in the encounter file, and in the procedure file</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for now, to save file size, use a 8-byte length i instead of the final 15 byte length EncounterID*/</div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_tmp1f;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;retain i;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp1e ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;by ADate PatID Provider EncType;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if first.EncType then i+1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX = diag;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if diag in: ('Z') then DX = diag_code;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;else DX = OrigDX;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if DX='' then DX_codetype='OT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;else DX_codetype='09';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PX = NGS_Category;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;OrigPX = FSC;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop diag FSC;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div><div class=\"ql-code-block\" data-language=\"plain\">/*proc datasets nolist;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;delete diagnosis_tmp1e ;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*run;*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=diagnosis_tmp1f.zip,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=diagnosis_tmp1f,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*have disticnt records:*/</div><div class=\"ql-code-block\" data-language=\"plain\">%distinct(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp1f,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp1g,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat('M', put(i, z14.)) as EncounterID length=15,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dx_codetype,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigDX,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'U' as PAdmit length=1</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_msb;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp1a diagnosis_tmp1g;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=diagnosis_msb.zip,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=diagnosis_msb,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div></div><p>t///</p>","children":[],"_substeps":{"idx":"MY845207c0-dac6-4114-96c6-ca833af1e431","name":"substeps","custparents":[{"idx":"MY7252ea20-0f21-4b86-9968-ef21f45e5164"}],"children":[{"idx":"MY5b9603af-ec53-447c-8331-ad224d73d293","name":"Define the file","custparents":[{"idx":"MY845207c0-dac6-4114-96c6-ca833af1e431"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/**************************************************************************</div><div class=\"ql-code-block\">Part 1 diagnosiss from MSB</div><div class=\"ql-code-block\">****************************************************************************/</div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;= key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;&lt;- EncounterID from the zip file</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= dos_1</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Provider = key_doc_num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncType &lt;- enctype.encytype &lt;- ngs_fsc_sk.fsc &lt;- msb_master.fsc</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It seems that a more efficient way is to make a mapping between enctype and fsc directly.</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make a mapping between enctype and fsc</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the NGSfile and the enctype file has been defined in local and remote setting</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for local</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theNGSfile = localskd.NGS_FSC_SK;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for remote</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theNGSfile = rOldDoc.NGS_FSC_SK;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for local</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theEncTypeFile = localskd.Enctype;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for remote</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theEncTypeFile = rOldDoc.Enctype;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX&nbsp;&nbsp;&nbsp;&nbsp;$18. = diag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DX&nbsp;&nbsp;&nbsp;&nbsp;$18.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1) diag begins with 'Z':</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;diag &lt;- sk_zdiag_to_icd9.diag_code</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(mapped by sk_zdiag_to_icd9.diag_orig_code = sk_zdiag_to_icd9.diag_code)</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or ' ' if unmatched</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2) else:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX = OrigDx</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1) diag begins with 'Z':</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DX=' ' then Dx_Codetype = 'OT';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Dx_Codetype = '09';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2) Dx_Codetype = '09';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PDX&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;=''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit $1. = 'U' (Wenbin put it as ' ', but in the tech_doc it did not say that a missing value is allowed.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make sense to me to put U for unknown or unable to determine.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I did not use X (unreported/not used). I am afraid records tagged as X would be ignored in</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the future analyses, which is not expected.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">*/</div></div><p>t///</p>"},{"idx":"MY3cc15f18-24e6-4481-9975-6987ae803db4","name":"Unzip master msb","custparents":[{"idx":"MY845207c0-dac6-4114-96c6-ca833af1e431"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">%UnixUnZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=&amp;remotedatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zip=master_msb,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipped=master_msb,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=master_msb</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%vbsUnzip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\master_msb.zip),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(master_msb.sas7bdat)</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*%print(data=master_msb);*/</div><div class=\"ql-code-block\">/*%nobs(data=master_msb);*/</div></div><p>t///</p>","children":[{"idx":"MY034f3439-a70e-435d-91f5-c81352df9c8e","name":"Apply inclusion exclusion","custparents":[{"idx":"MY3cc15f18-24e6-4481-9975-6987ae803db4"},{"idx":"MY5b9603af-ec53-447c-8331-ad224d73d293"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*keep those NOT with a mode of 'z', and dos between 1996 and 2018*/</div><div class=\"ql-code-block\">data diagnosis_tmp1b;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set master_msb;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where MODE ne 'Z' and dos_1 between '01jan1996'd and '31dec2018'd;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn key_doc_num diag fsc dos_1;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">proc datasets nolist;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;delete MASTER_MSB;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div></div><p>t///</p>","children":[{"idx":"MY19b6e61d-7137-4b33-80a4-1a7040b76796","name":"Select columns","custparents":[{"idx":"MY034f3439-a70e-435d-91f5-c81352df9c8e"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*From master_msb, keep select relevant columns</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">%sqljoinv2(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t1=&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp1b,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t2 = diagnosis_tmp1c,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp1d,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;distinct=1,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.key_hsn as PatID, t1.key_doc_num as Provider, t1.dos_1 as ADate, t1.diag,t1.fsc,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2.EncType, t2.NGS_Category</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=inner,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jvars=fsc,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;orderby=%str(ADate, PatID, Provider, EncType)</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">/*nobs*/</div><div class=\"ql-code-block\">%beep;</div><div class=\"ql-code-block\">proc datasets nolist;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;delete diagnosis_tmp1c ;</div><div class=\"ql-code-block\">run;</div></div><p>t///</p>","children":[{"idx":"MY4b7f51b9-02d6-41bf-9ce2-3d7e7814035f","name":"Define DX OrigDX DX_codetype","custparents":[{"idx":"MY19b6e61d-7137-4b33-80a4-1a7040b76796"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*[_W]Note:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID is specific for patid-provider-adate-enctype</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;for the same patid-provider-adate-enctype combination in diagnosis file,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID should be the same in the diagnosis file as in the encounter file, and in the procedure file</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for now, to save file size, use a 8-byte length i instead of the final 15 byte length EncounterID*/</div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_tmp1f;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;retain i;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp1e ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;by ADate PatID Provider EncType;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if first.EncType then i+1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX = diag;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if diag in: ('Z') then DX = diag_code;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;else DX = OrigDX;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if DX='' then DX_codetype='OT';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;else DX_codetype='09';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PX = NGS_Category;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;OrigPX = FSC;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop diag FSC;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div><div class=\"ql-code-block\" data-language=\"plain\">/*proc datasets nolist;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;delete diagnosis_tmp1e ;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*run;*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=diagnosis_tmp1f.zip,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=diagnosis_tmp1f,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div></div><p><br></p><p>t///</p>","children":[{"idx":"MYac9f06e3-33f4-4934-9dca-932c0e7d0f11","name":"Keep distinct records of DX related vars","custparents":[{"idx":"MY4b7f51b9-02d6-41bf-9ce2-3d7e7814035f"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*have disticnt records:*/</div><div class=\"ql-code-block\">%distinct(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp1f,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp1g,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat('M', put(i, z14.)) as EncounterID length=15,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dx_codetype,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigDX,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'U' as PAdmit length=1</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;)</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">%beep;</div></div><p>t///</p>","children":[{"idx":"MY23ab9ddf-4d6c-4d24-890f-1854b9b45a76","name":"Make and zip Diagonsis_MSB","custparents":[{"idx":"MYac9f06e3-33f4-4934-9dca-932c0e7d0f11"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">data diagnosis_msb;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp1a diagnosis_tmp1g;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%vbsZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=diagnosis_msb.zip,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=diagnosis_msb,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\">);</div></div><p>t///</p>"}]}]}]}]}]},{"idx":"MYe275640d-c46b-44a8-b355-f21a5dcf2870","name":"Mapping NGS_Category and EncType","custparents":[{"idx":"MY034f3439-a70e-435d-91f5-c81352df9c8e"},{"idx":"MY845207c0-dac6-4114-96c6-ca833af1e431"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*According to Wenbin's code, the following steps are to take to keep the relevant data</div><div class=\"ql-code-block\" data-language=\"plain\">2. only keep those with FSCs specified in the file ngs_fsc_sk.sas7bdat</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;remote: /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;local: P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\</div><div class=\"ql-code-block\" data-language=\"plain\">3. The encType is mapped out by the ngs_category in the file enctype.sas7bdat</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;remote: /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;local: P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">So combining 2 and 3:</div><div class=\"ql-code-block\" data-language=\"plain\">The enctype in the final data set is defined by</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;enctype &lt;- enctype.encytype &lt;- ngs_fsc_sk.fsc &lt;- msb_master.fsc</div><div class=\"ql-code-block\" data-language=\"plain\">It seems that a more efficient way is to make a mapping between enctype and fsc directly.</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*make a mapping between enctype and fsc*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*the NGSfile and the enctype file has been defined in local and remote setting*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for local*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%let theNGSfile = localskd.NGS_FSC_SK;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for remote*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%let theNGSfile = rOldDoc.NGS_FSC_SK;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for local*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%let theEncTypeFile = localskd.Enctype;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for remote*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%let theEncTypeFile = rOldDoc.Enctype;*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=&amp;theNGSfile);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=&amp;theEncTypeFile);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*for all the fsc in theNGSfile, find the enctype in the Enctype file</div><div class=\"ql-code-block\" data-language=\"plain\">Note: In Wenbin's code (making msb_3), it only keeps the records with a fsc that can be matched to a ngs_category.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;hence the inner join here</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">%sqljoinv2(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1=&amp;theNGSfile,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2=&amp;theEncTypeFile,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Target=diagnosis_tmp1c,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;distinct=1,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.fsc, ifc(t1.NGS_Category='', '_M', t1.NGS_Category) as NGS_Category,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ifc(t2.Encounter_type='', '_M', t2.Encounter_type) as EncType length=2),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=inner,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jvars= NGS_Category</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">/*4077 rows */</div><div class=\"ql-code-block\" data-language=\"plain\">/*%distinct(data=diagnosis_tmp1b, vars=fsc, target=test);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*4077 rows. The above shows that in tmp1b, there is no duplicated fsc code (i.e., fsc is not repeated assigned to different EncType)*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">[_Q]</div><div class=\"ql-code-block\" data-language=\"plain\">[_W]</div><div class=\"ql-code-block\" data-language=\"plain\">However, the following shows that the majority of fsc codes cannot be matched to the enctypes</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;These unmatched fsc codes are given a enctype of '_M', standing for enctype not matched, and data is from the MSB file</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%freq(data=diagnosis_tmp1b,table=enctype);*/</div></div><p>t///</p><p>[to do]</p>","children":[]}]}},{"idx":"MY4104af34-6583-4ca3-aa23-43daf2216080","name":"Diagnosis from Hosp","custparents":[{"idx":"MYbb49f164-d868-45fd-9733-c4f16e59deb4"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/**************************************************************************</div><div class=\"ql-code-block\">Part 2 diagnosiss from hospital</div><div class=\"ql-code-block\">****************************************************************************/</div><div class=\"ql-code-block\">%vbsUnzip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\master_hosp.zip),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(master_hosp.sas7bdat)</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">/*%print(data=master_hosp);*/</div><div class=\"ql-code-block\">/*proc datasets;*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;contents data=master_hosp;*/</div><div class=\"ql-code-block\">/*run;*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* For diagnosiss from hospital:</div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;= key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;&lt;- EncounterID from the cihi_rec (like H0000xxx)</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= adm_date</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Provider &lt;- facility_code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DS_IP='DS' then EncType='SD';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else EncType='IP' ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX&nbsp;&nbsp;&nbsp;&nbsp;$18. = DX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DX&nbsp;&nbsp;&nbsp;&nbsp;$18.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depending on the CODING_CLASS_IND</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if CODING_CLASS_IND = 'NA', ICD 9 code in dx_code_1 to 25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if CODING_CLASS_IND = '0', ICD 10 code in dx_code_1 to 25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if CODING_CLASS_IND = '', '9', 'c', ICD 9 code in conv_dx_code_1 to 25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1) diag begins with 'Z':</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DX=' ' then Dx_Codetype = 'OT';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Dx_Codetype = '09';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2) Dx_Codetype = '09';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PDX&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;=''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if PAdmit ='M' then PDX='P' ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if PAdmit ='N' or PAdmit='' then PDX ='X';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else PDX ='S';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit = substr(DxType,1,1);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;According to Wenbin's code</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAdmit = substr(DxType,1,1);</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*1. According to Wenbin's code:</div><div class=\"ql-code-block\">remove records if</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DATE='01Jan9999'd;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PROV_LOC_SK ^= 'Y';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;hosp_num =.</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">/*%nobs(data=master_hosp);*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data diagnosis_tmp2a;</div><div class=\"ql-code-block\">set master_hosp;</div><div class=\"ql-code-block\">where hosp_num ne . and PROV_LOC_SK = 'Y' and DSCHG_DATE ne '01Jan9999'd</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;and adm_date between &amp;datastartdate and &amp;dataenddate;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*According to Wenbin's code, this part is to determine whether to use ICD9 or ICD10 code.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;However, it is quite confusing in Wenbin's code:</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;1. As in the dictionary:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;A code which identifies the classification system used for recording Diagnoses and Procedures.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 = ICD 10;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C = ICD9CM (converted to ICD9/CCP),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9 = ICD9/CCP,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blank=reciprocal billing claims without a matching CIHI record</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;This is not inline with the following code.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;2. those of proc_loc_sk ne 'Y' has been deleted in the above step, there should not be any output to diagnosis_tmp2b3!</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">/*It seems that:</div><div class=\"ql-code-block\">1. if the coding_class_ind is 'NA', the diagnositc codes are in dx_code_1 to 25, but are icd 9 codes</div><div class=\"ql-code-block\">2. if the coding_class_ind is '0', the diagnositc codes are in dx_code_1 to 25, and are icd 10 codes</div><div class=\"ql-code-block\">3. if the coding_class_ind is missing, c, or 9 , the diagnositc codes are in conv_dx_code_1 to 25, and are icd 9 codes</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">data</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp2b1</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp2b2</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp2b3</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp2b4</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp2b5;</div><div class=\"ql-code-block\">set diagnosis_tmp2a;</div><div class=\"ql-code-block\">if coding_class_ind ='NA' then output diagnosis_tmp2b1 ; /* ICD9 codes in dx_code_1 to 25*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;else if coding_class_ind ='0' then output diagnosis_tmp2b2 ; /* ICD10 in dx_code_1 to 25 */</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;else if CODING_CLASS_IND in ('','9','C') then do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if proc_loc_sk='Y' then output diagnosis_tmp2b3; /* no such records*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if FY &lt;'200708' then output diagnosis_tmp2b4; /* ICD9 codes in conv_dx_code_1 to 25 */</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else output diagnosis_tmp2b5; /* should not have such records */</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%beep;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*Yep, the results are only in 3 tables (b1, b2, and b4) out of the 5*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* A macro to deal with dx and intervention codes*/</div><div class=\"ql-code-block\">%macro GetDxCode(data=, target=,dxPrefix=, intvnPrefix=, dxCodeType=, PxCodeType=);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;%local data target dxPrefix intvnPrefix dxCodeType PxCodeType ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data &amp;target;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set &amp;data;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;length DX $18. DxType $2. PX $11. DX_CodeType $2. PX_CodeType $2.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array d[25] $ &amp;dxPrefix._1 - &amp;dxPrefix._25;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array t[25] $ DX_TYPE_1 - DX_TYPE_25;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array p[20] $ &amp;intvnPrefix._1 - &amp;intvnPrefix._20;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*get diagnostic codes 1 to 25, if the field is not missing, and not 'NA'*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do i=1 to 25;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if d[i] ne '' and d[i] ne 'NA' then do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX=d[i];</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DxType=t[i];</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_CodeType = symget('dxCodeType') ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*The following two line is to ensure that when DX has a value, PX does not have a value</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As such, the DX and PX records are mutually exclusive*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX='';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_CodeType='';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recType='DX';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*get intervention codes 1 to 20, if the field is not missing, and not 'NA'*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if i &lt;=20 then do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if strip(p[i]) ne '' and p[i] ne 'NA' then do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX=p[i];</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_CodeType = symget('PxCodeType');</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*The following two line is to ensure that when PX has a value, DX does not have a value</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As such, the DX and PX records are mutually exclusive*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX='';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_CodeType='';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recType='PX';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keep</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cihi_rec</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key_hsn adm_date dschg_date</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coding_class_ind</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INST_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOSP_NUM&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DS_IP CMG DPG CACS FY</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENTRY_CODE NEWBORN</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dschg_disp</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DXType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_CodeType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_CodeType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;run;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%mend GetDxCode;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Dealing with ICD9 codes in dx_code_1 to 25 (2b1) */</div><div class=\"ql-code-block\">%GetDxCode(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp2b1,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp2c1,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxPrefix=dx_code,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intvnPrefix=INTVN_CODE,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxCodeType=09,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PxCodeType=CP</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">/* Dealing with ICD10 codes in dx_code_1 to 25 (2b2) */</div><div class=\"ql-code-block\">%GetDxCode(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp2b2,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp2c2,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxPrefix=dx_code,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intvnPrefix=INTVN_CODE,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxCodeType=10,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PxCodeType=CI</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Dealing with ICD9 codes in conv_dx_code_1 to 25 (2b4) */</div><div class=\"ql-code-block\">%GetDxCode(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp2b4,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp2c4,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxPrefix=conv_dx_code,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intvnPrefix=CONV_PROC_CODE,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxCodeType=09,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PxCodeType=CP</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*combine the 3 tables with DX/PX data*/</div><div class=\"ql-code-block\">data diagnosis_tmp2c;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp2c1 diagnosis_tmp2c2 diagnosis_tmp2c4;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*link to facLoc file to get file location*/</div><div class=\"ql-code-block\">/*%print(data=&amp;theFacLocFile);*/</div><div class=\"ql-code-block\">/*%print(data=diagnosis_tmp2a);*/</div><div class=\"ql-code-block\">data diagnosis_tmp2d;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;theFacLocFile;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;hosp_num_N = input(hosp_num, 8.);</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%sqljoinv2(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t1=diagnosis_tmp2c,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t2=diagnosis_tmp2d,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp2e,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.*, t2.hosp_num as hosp_num_C length=3, t2.facility_location),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=left,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jterm=%str(t1.hosp_num = t2.hosp_num_N)</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">/*define other variables*/</div><div class=\"ql-code-block\">data diagnosis_tmp2f;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp2e;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length Admitting_Source $2. PAdmit $1.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rename Key_hsn = PatID adm_date = ADate dschg_date = DDate hosp_num_C= Facility_Code ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;provider = hosp_num_C;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if DS_IP='DS' then EncType='SD';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else EncType='IP' ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;else do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Discharge_Disposition ='_';&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status = 'UN';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if EncType='IP' then DRG=CMG;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if EncType='SD' then DRG='_';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type='';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if NEWBORN='NA' then Admitting_Source=ENTRY_CODE;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Admitting_Source='N';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID = 'H' || put(CIHI_Rec, z14.);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit = substr(DxType,1,1);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if PAdmit ='M' then PDX='P' ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if PAdmit ='N' or PAdmit='' then PDX ='X';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else PDX ='S';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;drop</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROV_LOC_SK</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CIHI_REC</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INST_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DS_IP</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOSP_NUM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALC_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CMG</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CODING_CLASS_IND</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPG</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CACS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENTRY_CODE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEWBORN</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DISP</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*to keep cols for the diagnosis table</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code, the OrigDx was set to missing for Hosp records</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;however, the tech spec says it should be the same as DX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Decision: keep it as the same as DX</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">data diagnosis_tmp2g;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp2f;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length OrigDX $18. ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where recType='DX';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX = DX;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigDX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PDX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAdmit</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*apply format defined in tmp1a*/</div><div class=\"ql-code-block\">data diagnosis_hosp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp1a diagnosis_tmp2g;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%vbsZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=diagnosis_hosp.zip,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=diagnosis_hosp,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\">);</div></div><p>t///</p>","children":[],"_substeps":{"idx":"MYb0293674-d5b0-46b1-b5ab-a5efec38f7d2","name":"substeps","custparents":[{"idx":"MY4104af34-6583-4ca3-aa23-43daf2216080"}],"children":[{"idx":"MYe333c8da-7de4-470f-a46d-dbcb287b35c6","name":"Define the file","custparents":[{"idx":"MYb0293674-d5b0-46b1-b5ab-a5efec38f7d2"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/**************************************************************************</div><div class=\"ql-code-block\">Part 2 diagnosiss from hospital</div><div class=\"ql-code-block\">****************************************************************************/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* For diagnosis from hospital:*/</div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;= key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;&lt;- EncounterID from the cihi_rec (like H0000xxx)</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= adm_date</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Provider &lt;- facility_code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DS_IP='DS' then EncType='SD';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else EncType='IP' ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX&nbsp;&nbsp;&nbsp;&nbsp;$18. = DX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DX&nbsp;&nbsp;&nbsp;&nbsp;$18.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;depending on the CODING_CLASS_IND</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if CODING_CLASS_IND = 'NA', ICD 9 code in dx_code_1 to 25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if CODING_CLASS_IND = '0', ICD 10 code in dx_code_1 to 25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if CODING_CLASS_IND = '', '9', 'c', ICD 9 code in conv_dx_code_1 to 25</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1) diag begins with 'Z':</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DX=' ' then Dx_Codetype = 'OT';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Dx_Codetype = '09';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2) Dx_Codetype = '09';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PDX&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;=''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if PAdmit ='M' then PDX='P' ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if PAdmit ='N' or PAdmit='' then PDX ='X';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else PDX ='S';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit = substr(DxType,1,1);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;According to Wenbin's code</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAdmit = substr(DxType,1,1);</div><div class=\"ql-code-block\">*/</div></div><p>t///</p>","children":[{"idx":"MYcd6a9a92-f749-4b8f-a94f-d6f208edbe98","name":"Inclusion exclusion","custparents":[{"idx":"MYe333c8da-7de4-470f-a46d-dbcb287b35c6"},{"idx":"MY77c1b9d8-5265-4ae1-a872-38af3965503d"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*1. According to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">remove records if</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DATE='01Jan9999'd;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PROV_LOC_SK ^= 'Y';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;hosp_num =.</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%nobs(data=master_hosp);</div></div><p>t///</p>","children":[{"idx":"MYe92247aa-d288-4972-8cff-ea1d09c665d5","name":"Determine the DX and PX code and code type","custparents":[{"idx":"MYcd6a9a92-f749-4b8f-a94f-d6f208edbe98"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*According to Wenbin's code, this part is to determine whether to use ICD9 or ICD10 code.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;However, it is quite confusing in Wenbin's code:</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;1. As in the dictionary:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;A code which identifies the classification system used for recording Diagnoses and Procedures.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 = ICD 10;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C = ICD9CM (converted to ICD9/CCP),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9 = ICD9/CCP,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blank=reciprocal billing claims without a matching CIHI record</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;This is not inline with the following code.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;2. those of proc_loc_sk ne 'Y' has been deleted in the above step, there should not be any output to diagnosis_tmp2b3!</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">/*It seems that:</div><div class=\"ql-code-block\">1. if the coding_class_ind is 'NA', the diagnositc codes are in dx_code_1 to 25, but are icd 9 codes</div><div class=\"ql-code-block\">2. if the coding_class_ind is '0', the diagnositc codes are in dx_code_1 to 25, and are icd 10 codes</div><div class=\"ql-code-block\">3. if the coding_class_ind is missing, c, or 9 , the diagnositc codes are in conv_dx_code_1 to 25, and are icd 9 codes</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">data</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp2b1</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp2b2</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp2b3</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp2b4</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp2b5;</div><div class=\"ql-code-block\">set diagnosis_tmp2a;</div><div class=\"ql-code-block\">if coding_class_ind ='NA' then output diagnosis_tmp2b1 ; /* ICD9 codes in dx_code_1 to 25*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;else if coding_class_ind ='0' then output diagnosis_tmp2b2 ; /* ICD10 in dx_code_1 to 25 */</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;else if CODING_CLASS_IND in ('','9','C') then do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if proc_loc_sk='Y' then output diagnosis_tmp2b3; /* no such records*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if FY &lt;'200708' then output diagnosis_tmp2b4; /* ICD9 codes in conv_dx_code_1 to 25 */</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else output diagnosis_tmp2b5; /* should not have such records */</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%beep;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*Yep, the results are only in 3 tables (b1, b2, and b4) out of the 5*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* A macro to deal with dx and intervention codes*/</div><div class=\"ql-code-block\">%macro GetDxCode(data=, target=,dxPrefix=, intvnPrefix=, dxCodeType=, PxCodeType=);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;%local data target dxPrefix intvnPrefix dxCodeType PxCodeType ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data &amp;target;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set &amp;data;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;length DX $18. DxType $2. PX $11. DX_CodeType $2. PX_CodeType $2.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array d[25] $ &amp;dxPrefix._1 - &amp;dxPrefix._25;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array t[25] $ DX_TYPE_1 - DX_TYPE_25;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array p[20] $ &amp;intvnPrefix._1 - &amp;intvnPrefix._20;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*get diagnostic codes 1 to 25, if the field is not missing, and not 'NA'*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do i=1 to 25;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if d[i] ne '' and d[i] ne 'NA' then do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX=d[i];</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DxType=t[i];</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_CodeType = symget('dxCodeType') ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*The following two line is to ensure that when DX has a value, PX does not have a value</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As such, the DX and PX records are mutually exclusive*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX='';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_CodeType='';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recType='DX';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*get intervention codes 1 to 20, if the field is not missing, and not 'NA'*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if i &lt;=20 then do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if strip(p[i]) ne '' and p[i] ne 'NA' then do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX=p[i];</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_CodeType = symget('PxCodeType');</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*The following two line is to ensure that when PX has a value, DX does not have a value</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;As such, the DX and PX records are mutually exclusive*/</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX='';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_CodeType='';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recType='PX';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keep</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cihi_rec</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key_hsn adm_date dschg_date</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;coding_class_ind</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INST_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOSP_NUM&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DS_IP CMG DPG CACS FY</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENTRY_CODE NEWBORN</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dschg_disp</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DXType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_CodeType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_CodeType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;run;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%mend GetDxCode;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Dealing with ICD9 codes in dx_code_1 to 25 (2b1) */</div><div class=\"ql-code-block\">%GetDxCode(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp2b1,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp2c1,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxPrefix=dx_code,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intvnPrefix=INTVN_CODE,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxCodeType=09,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PxCodeType=CP</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">/* Dealing with ICD10 codes in dx_code_1 to 25 (2b2) */</div><div class=\"ql-code-block\">%GetDxCode(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp2b2,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp2c2,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxPrefix=dx_code,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intvnPrefix=INTVN_CODE,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxCodeType=10,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PxCodeType=CI</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* Dealing with ICD9 codes in conv_dx_code_1 to 25 (2b4) */</div><div class=\"ql-code-block\">%GetDxCode(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp2b4,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp2c4,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxPrefix=conv_dx_code,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intvnPrefix=CONV_PROC_CODE,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dxCodeType=09,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PxCodeType=CP</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*combine the 3 tables with DX/PX data*/</div><div class=\"ql-code-block\">data diagnosis_tmp2c;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp2c1 diagnosis_tmp2c2 diagnosis_tmp2c4;</div><div class=\"ql-code-block\">run;</div></div><p>t///</p>","children":[{"idx":"MY8033b655-aaca-4e01-9a02-2cd805031faa","name":"Determine the relevant vars","custparents":[{"idx":"MYe92247aa-d288-4972-8cff-ea1d09c665d5"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*link to facLoc file to get file location*/</div><div class=\"ql-code-block\">/*%print(data=&amp;theFacLocFile);*/</div><div class=\"ql-code-block\">/*%print(data=diagnosis_tmp2a);*/</div><div class=\"ql-code-block\">data diagnosis_tmp2d;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;theFacLocFile;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;hosp_num_N = input(hosp_num, 8.);</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%sqljoinv2(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t1=diagnosis_tmp2c,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;t2=diagnosis_tmp2d,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp2e,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.*, t2.hosp_num as hosp_num_C length=3, t2.facility_location),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=left,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;jterm=%str(t1.hosp_num = t2.hosp_num_N)</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">/*define other variables*/</div><div class=\"ql-code-block\">data diagnosis_tmp2f;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp2e;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length Admitting_Source $2. PAdmit $1.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rename Key_hsn = PatID adm_date = ADate dschg_date = DDate hosp_num_C= Facility_Code ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;provider = hosp_num_C;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if DS_IP='DS' then EncType='SD';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else EncType='IP' ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;else do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else do;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Discharge_Disposition ='_';&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status = 'UN';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if EncType='IP' then DRG=CMG;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if EncType='SD' then DRG='_';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type='';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if NEWBORN='NA' then Admitting_Source=ENTRY_CODE;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Admitting_Source='N';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID = 'H' || put(CIHI_Rec, z14.);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit = substr(DxType,1,1);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;if PAdmit ='M' then PDX='P' ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if PAdmit ='N' or PAdmit='' then PDX ='X';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else PDX ='S';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;drop</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROV_LOC_SK</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CIHI_REC</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INST_NUM</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DS_IP</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HOSP_NUM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;T_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALC_LOS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CMG</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CODING_CLASS_IND</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DPG</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CACS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENTRY_CODE</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NEWBORN</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DISP</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div></div><p>t///</p>","children":[{"idx":"MYbd23dc53-3e98-4468-bad7-961247d96a7b","name":"Keep DX related vars","custparents":[{"idx":"MY8033b655-aaca-4e01-9a02-2cd805031faa"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*to keep cols for the diagnosis table</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code, the OrigDx was set to missing for Hosp records</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;however, the tech spec says it should be the same as DX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Decision: keep it as the same as DX</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">data diagnosis_tmp2g;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp2f;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length OrigDX $18. ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where recType='DX';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX = DX;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigDX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PDX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAdmit</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">run;</div></div><p>t///</p>","children":[{"idx":"MY7cff4cdb-97d9-4263-8295-8c61e98f7e7f","name":"Make and zip diagnosis_hosp","custparents":[{"idx":"MYbd23dc53-3e98-4468-bad7-961247d96a7b"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*apply format defined in tmp1a*/</div><div class=\"ql-code-block\">data diagnosis_hosp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp1a diagnosis_tmp2g;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%vbsZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=diagnosis_hosp.zip,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=diagnosis_hosp,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\">);</div></div><p>t///</p>"}]}]}]}]}]},{"idx":"MY77c1b9d8-5265-4ae1-a872-38af3965503d","name":"Unzip master hosp","custparents":[{"idx":"MYb0293674-d5b0-46b1-b5ab-a5efec38f7d2"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">%vbsUnzip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\master_hosp.zip),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(master_hosp.sas7bdat)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=master_hosp);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*proc datasets;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;contents data=master_hosp;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*run;*/</div></div><p><br></p><p>t///</p>"}]}},{"idx":"MY412be9af-947a-4bba-a571-ee510302cc25","name":"Diagnosis from ED","custparents":[{"idx":"MYbb49f164-d868-45fd-9733-c4f16e59deb4"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/**************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">Part 3 diagnosiss from emergency department</div><div class=\"ql-code-block\" data-language=\"plain\">****************************************************************************/</div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">inclusion:</div><div class=\"ql-code-block\" data-language=\"plain\">PROV_LOC_SK = 'Y'</div><div class=\"ql-code-block\" data-language=\"plain\">reg_date ne .</div><div class=\"ql-code-block\" data-language=\"plain\">reg_date between 1996 and 2018</div><div class=\"ql-code-block\" data-language=\"plain\">key_hsn ne .</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* For diagnosis from ED:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;= key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;&lt;- EncounterID from a unique raw record ID created when import ed data (like E0000xxx)</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= Reg_date</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider &lt;- facility_code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 'ED'</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX&nbsp;&nbsp;&nbsp;&nbsp;$18. = DX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DX&nbsp;&nbsp;&nbsp;&nbsp;$18. &lt;- mp_dx</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- '10'</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PDX&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;='P'&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit = 'M'</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsUnzip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\master_ed_a2012.zip),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(master_ed_a2012.sas7bdat)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">%print(data=master_ed_a2012);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_tmp3a;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID=&nbsp;&nbsp;&nbsp;&nbsp;'E' || put(_N_, z14.);</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set master_ed_a2012;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;where</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PROV_LOC_SK = 'Y' and</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;reg_date ne . and</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;reg_date between '01jan1996'd and '31dec2018'd and</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;key_hsn ne ''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length hosp_num $3.;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;hosp_num=substr(inst_num, 3,3);</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*link to facLoc file to get file location*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=&amp;theFacLocFile);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=diagnosis_tmp3a);*/</div><div class=\"ql-code-block\" data-language=\"plain\">%sqljoinv2(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1=diagnosis_tmp3a,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2=&amp;theFacLocFile,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp3b,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.*, t2.facility_location),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=left,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jvars=hosp_num</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_tmp3c;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp3b;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX $18. DX_Codetype $2. OrigDX $18.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX $11. PX_Codetype $2. OrigPX $18.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAdmit $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PatID = key_hsn;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= Reg_date;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DDate&nbsp;&nbsp;&nbsp;&nbsp;= disp_date;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;facility_code = hosp_num;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider= facility_code;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType='ED';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if visit_disp in ('','ZZ') then Discharge_Disposition ='U';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;else do;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if visit_disp in ('10','11') then Discharge_Disposition ='E';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;else Discharge_Disposition ='A';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if adm_ambul in ('A','C','G') then Admitting_source='A';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Admitting_source='D' ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DX = mp_dx;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Dx_Codetype = '10';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX=DX;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit='M';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PDX='P';</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;keep EncounterID PatID ADate DDate Facility_Location facility_code Provider EncType Discharge_Disposition Admitting_source;*/</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_tmp3d;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp3c;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;keep</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigDX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PDX&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAdmit</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_ed;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp1a diagnosis_tmp3d;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=diagnosis_ed.zip,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=diagnosis_ed,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*******************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">Putting together</div><div class=\"ql-code-block\" data-language=\"plain\">*******************************************************************************/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsUnzip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\diagnosis_msb.zip),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(diagnosis_msb.sas7bdat)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">%vbsUnzip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\diagnosis_hosp.zip),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(diagnosis_hosp.sas7bdat)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">%vbsUnzip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\diagnosis_ed.zip),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(diagnosis_ed.sas7bdat)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_9618;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_msb diagnosis_hosp diagnosis_ed;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=diagnosis_9618.zip,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=diagnosis_9618,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">);</div></div><p>t///</p>","children":[],"_substeps":{"idx":"MY69ef46ef-96c0-47b4-9cf0-cd1dd79dfec2","name":"substeps","custparents":[{"idx":"MY412be9af-947a-4bba-a571-ee510302cc25"}],"children":[{"idx":"MY52ae943a-7d0c-42fd-96c0-fdb692bb6f91","name":"Define the file","custparents":[{"idx":"MY69ef46ef-96c0-47b4-9cf0-cd1dd79dfec2"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/**************************************************************************</div><div class=\"ql-code-block\">Part 3 diagnosiss from emergency department</div><div class=\"ql-code-block\">****************************************************************************/</div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">inclusion:</div><div class=\"ql-code-block\">PROV_LOC_SK = 'Y'</div><div class=\"ql-code-block\">reg_date ne .</div><div class=\"ql-code-block\">reg_date between 1996 and 2018</div><div class=\"ql-code-block\">key_hsn ne .</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/* For diagnosis from ED:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;= key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;&lt;- EncounterID from a unique raw record ID created when import ed data (like E0000xxx)</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= Reg_date</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Provider &lt;- facility_code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 'ED'</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX&nbsp;&nbsp;&nbsp;&nbsp;$18. = DX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DX&nbsp;&nbsp;&nbsp;&nbsp;$18. &lt;- mp_dx</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- '10'</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PDX&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;='P'&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit = 'M'</div><div class=\"ql-code-block\">*/</div></div><p>t///</p>","children":[{"idx":"MYdc9cd388-ac30-4f34-a7b9-24cbd838f209","name":"Inclusion exclusion","custparents":[{"idx":"MY52ae943a-7d0c-42fd-96c0-fdb692bb6f91"},{"idx":"MY299198cc-18a8-40b0-85a4-55364e916fd7"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*[_W] Create an Encounter ID for each record*/</div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_tmp3a;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID=&nbsp;&nbsp;&nbsp;&nbsp;'E' || put(_N_, z14.);</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set master_ed_a2012;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;where</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PROV_LOC_SK = 'Y' and</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;reg_date ne . and</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;reg_date between '01jan1996'd and '31dec2018'd and</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;key_hsn ne ''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length hosp_num $3.;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;hosp_num=substr(inst_num, 3,3);</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div></div><p>t///</p>","children":[{"idx":"MY24fabbee-3c14-4917-8c85-74d8d417421d","name":"Determine location and other relevant vars","custparents":[{"idx":"MYdc9cd388-ac30-4f34-a7b9-24cbd838f209"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*link to facLoc file to get file location*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=&amp;theFacLocFile);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=diagnosis_tmp3a);*/</div><div class=\"ql-code-block\" data-language=\"plain\">%sqljoinv2(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t1=diagnosis_tmp3a,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;t2=&amp;theFacLocFile,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp3b,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(t1.*, t2.facility_location),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jtype=left,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;jvars=hosp_num</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data diagnosis_tmp3c;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp3b;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX $18. DX_Codetype $2. OrigDX $18.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX $11. PX_Codetype $2. OrigPX $18.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAdmit $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PatID = key_hsn;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= Reg_date;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DDate&nbsp;&nbsp;&nbsp;&nbsp;= disp_date;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;facility_code = hosp_num;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider= facility_code;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType='ED';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if visit_disp in ('','ZZ') then Discharge_Disposition ='U';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;else do;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if visit_disp in ('10','11') then Discharge_Disposition ='E';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;else Discharge_Disposition ='A';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;end;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;if adm_ambul in ('A','C','G') then Admitting_source='A';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Admitting_source='D' ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DX = mp_dx;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Dx_Codetype = '10';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;OrigDX=DX;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PAdmit='M';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PDX='P';</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;keep EncounterID PatID ADate DDate Facility_Location facility_code Provider EncType Discharge_Disposition Admitting_source;*/</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div></div><p>t///</p>","children":[{"idx":"MYc8f3917a-dfaf-40da-bb47-a39214910311","name":"Keep DX related vars and records","custparents":[{"idx":"MY24fabbee-3c14-4917-8c85-74d8d417421d"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data diagnosis_tmp3d;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp3c;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigDX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DX_codetype</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PDX&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAdmit</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div></div><p>t///</p>","children":[{"idx":"MYf79d5a33-bac1-44c1-a807-e87a53f375fe","name":"Make and zip the diagnosis_ed file","custparents":[{"idx":"MYc8f3917a-dfaf-40da-bb47-a39214910311"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">data diagnosis_ed;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp1a diagnosis_tmp3d;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%vbsZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=diagnosis_ed.zip,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=diagnosis_ed,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\">);</div></div><p>t///</p>"}]}]}]}]},{"idx":"MY299198cc-18a8-40b0-85a4-55364e916fd7","name":"Unzip master ed","custparents":[{"idx":"MY69ef46ef-96c0-47b4-9cf0-cd1dd79dfec2"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">%vbsUnzip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\master_ed_a2012.zip),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(master_ed_a2012.sas7bdat)</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">%print(data=master_ed_a2012);</div></div><p>t///</p>"}]}}]}]},{"idx":"CodeTask-QmN7xlRFu8BgDFpZ","name":"Ref. Wenbin's diagnosis","NodeDescription":"///t<br/>///s<br/>/*Webin's code for diagnosis file<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/**********************************************************************<br/>From MSB<br/>**********************************************************************/<br/><br/>/* SCDM: 4.2 Diagnosis Table */<br/>proc sql&#59<br/>   create table Diagnosis_msb_1 as<br/>   select distinct PatID, EncounterID, ADate, Provider, EncType, DIAG as OrigDX length=18, FSC <br/>   from msb_6&#59<br/>quit&#59<br/><br/>data Diagnosis_msb_21 Diagnosis_msb_22&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_1&#59<br/>&nbsp&nbsp&nbsp&nbspif  upcase(substr(OrigDX,1,1))='Z' then output Diagnosis_msb_21&#59<br/>&nbsp&nbsp&nbsp&nbspelse output Diagnosis_msb_22&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table Diagnosis_msb_31 as<br/>   select a.*, b.diag_code as DX length=18<br/>   from Diagnosis_msb_21 a<br/>   left join <br/>   doc.sk_zdiag_to_icd9 b<br/>   on a.OrigDX=b.diag_orig_code&#59<br/>quit&#59<br/><br/>proc sql&#59<br/> select distinct OrigDX from Diagnosis_msb_31<br/> where DX=' '&#59<br/>quit&#59<br/><br/>/*The following Z codes do not have the matching:  Z31 Z33 Z34 Z35 Z36 Z37 Z53 Z75*/<br/><br/>data Diagnosis_msb_41&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_31&#59<br/>&nbsp&nbsp&nbsp&nbspif  DX=' ' then Dx_Codetype = 'OT'&#59<br/>&nbsp&nbsp&nbsp&nbspelse Dx_Codetype = '09'&#59<br/>run&#59<br/><br/>data Diagnosis_msb_42&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_22&#59<br/>&nbsp&nbsp&nbsp&nbsp    DX = OrigDX&#59<br/>&nbsp&nbsp&nbsp&nbsp    Dx_Codetype = '09'&#59<br/>run&#59<br/><br/>data Diagnosis_msb_5&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_41<br/>        Diagnosis_msb_42<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table temp.DIAGNOSIS_MSB as<br/>   select distinct PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, OrigDX, ' '  as PAdmit length=2, ' ' as PDX<br/>   from Diagnosis_msb_5&#59<br/>quit&#59<br/><br/><br/>/**********************************************************************<br/>From Hosp<br/>**********************************************************************/<br/><br/>/*  Hospital */<br/>%let hosp_file          = clean17.CIHI_EOC_2_OND16_23MAY2017&#59<br/> %Extract_CIHI(ds_in            = &hosp_file,<br/>               ds_out           = cdm.hosp, <br/>               dchg_start_date  = &extract_start,&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>               adms_end_date    = &extract_end,<br/>               ICD_field_list   = ,<br/>               ICD9_list        = ,<br/>               ICD9_excl_exact_list =,<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   ICD10_list       = <br/>&nbsp&nbsp&nbsp&nbsp            )&#59<br/><br/>data check_1&#59<br/>   set cdm.hosp&#59<br/>   if DSCHG_DATE='01Jan9999'd&#59<br/>run&#59<br/><br/>/* DS_IP: DS IP OTH  HOSP_NUM : containing missing value */<br/><br/>data check_1&#59<br/>  set cdm.hosp&#59<br/>  if PROV_LOC_SK ^= 'Y'&#59<br/>run&#59<br/><br/>data check_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =. &#59<br/>run&#59<br/><br/>data hosp_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =.  then delete &#59<br/>  if PROV_LOC_SK ^= 'Y' then delete&#59<br/>  if DSCHG_DATE='01Jan9999'd then delete&#59<br/>run&#59<br/><br/>proc tabulate data=hosp_2&#59<br/>var adm_date dschg_date&#59<br/>table adm_date dschg_date, n nmiss (min max median)*f=mmddyy10.&#59<br/>run&#59<br/><br/>data hosp_21 hosp_22 hosp_23 hosp_24 hosp_25&#59<br/>   set hosp_2&#59<br/>    if coding_class_ind ='NA' then output hosp_21 &#59 /* ICD9 */<br/>&nbsp&nbsp&nbsp&nbspelse if coding_class_ind ='0' then output hosp_22 &#59 /* ICD10 */<br/>&nbsp&nbsp&nbsp&nbspelse if CODING_CLASS_IND in ('','9','C') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp     if proc_loc_sk='Y' then output hosp_23&#59 /* ICD9 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else if FY <'200708' then output hosp_24&#59 /* ICD9 and ICD10 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else  output hosp_25&#59 /* ICD9 and ICD10 dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp end&#59<br/>run&#59 <br/><br/>/* ICD9 */<br/>%macro convert_ICD9(in=, out=)&#59<br/>  data convert9&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS FY ENTRY_CODE NEWBORN dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert9(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '09' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CP'&#59<br/>run&#59<br/>%mend convert_ICD9&#59<br/><br/><br/>/* ICD10 */<br/>%macro convert_ICD10(in=, out=)&#59<br/>  data convert10&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS ENTRY_CODE NEWBORN FY dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>run&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert10(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '10' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CI'&#59<br/>run&#59<br/><br/>%mend convert_ICD10&#59<br/><br/>%convert_ICD9(in=hosp_21, out=hosp_21_conv_1)<br/>%convert_ICD10(in=hosp_22, out=hosp_22_conv_1)<br/><br/><br/>/* ICD9 and ICD10 conv_dx_code : 9 and C */<br/>data hosp_24_1&#59<br/>   set hosp_24(drop= dx_code_1-dx_code_25 INTVN_CODE_1-INTVN_CODE_20)&#59<br/>   rename conv_dx_code_1-conv_dx_code_25=dx_code_1-dx_code_25&#59<br/>   rename conv_proc_code_1-conv_proc_code_20=INTVN_CODE_1-INTVN_CODE_20&#59<br/>   run&#59<br/>proc freq data=hosp_24_1&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/>%convert_ICD9(in=hosp_24_1, out=hosp_24_conv_1)<br/><br/><br/>/* ICD9 and ICD10 dx_code */<br/>proc freq data=hosp_25&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/><br/>data hosp_3&#59<br/>  set hosp_21_conv_1 hosp_22_conv_1 hosp_24_conv_1&#59<br/>  hosp_num_c=put(hosp_num,z3.)&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table hosp_4 as<br/>   select a.*, b.Facility_Location<br/>   from hosp_3 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.hosp_num_c=b.hosp_num&#59<br/>quit&#59<br/><br/>data hosp_5(drop=ds_ip)&#59<br/>   length EncType $2&#59<br/>   set hosp_4&#59<br/>   if DS_IP='DS' then  EncType='SD'&#59<br/>   else EncType='IP' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename adm_date=ADate&#59<br/>   rename dschg_date=DDate&#59<br/>   rename HOSP_NUM_C = Facility_Code&#59<br/><br/>run&#59<br/><br/>data hosp_6&#59<br/>   length DRG $3 DRG_Type $4&#59<br/>   set hosp_5&#59<br/>   if EncType='IP' then DRG=CMG&#59<br/>   else if EncType='SD' then DRG=''&#59 <br/>   DRG_Type=''&#59<br/>run&#59<br/><br/>proc freq data=hosp_6&#59<br/>tables DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_7&#59<br/>   set hosp_6&#59<br/>   if DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E'&#59<br/>   else if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A'&#59<br/>   else Discharge_Disposition =' '&#59<br/>run&#59<br/><br/>data hosp_8&#59<br/>   set hosp_7&#59<br/>   Discharge_Status=DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_9&#59<br/>   length Admitting_Source $2&#59<br/>   set hosp_8&#59<br/>   if NEWBORN='NA' then Admitting_Source=ENTRY_CODE&#59<br/>   else Admitting_Source='N'&#59<br/>run&#59<br/><br/>data hosp_10&#59<br/>   set hosp_9&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'||Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=5506 */<br/><br/>proc sort data= hosp_10&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data hosp_11&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set hosp_10&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>data check_1&#59<br/>   set hosp_11&#59<br/>   if DX=''&#59<br/>   run&#59<br/><br/>data check_2&#59<br/>   set hosp_11&#59<br/>   if PX=''&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_hosp as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, Discharge_Status, DRG, DRG_Type, Admitting_Source<br/>   from hosp_11&#59<br/>quit&#59 /* n=2334 */<br/><br/>/* SCDM: 4.2 Diagnosis Table */<br/>proc freq data=hosp_11&#59<br/>  tables DxType&#59<br/>  run&#59<br/><br/>data hosp_12&#59<br/>  length PAdmit $2 &#59<br/>  set hosp_11 (where=(DX ^= ''))&#59<br/>  PAdmit = substr(DxType,1,1)&#59<br/>  if PAdmit ='M' then PDX='P' &#59<br/>  else if PAdmit in ('N','') then PDX ='X'&#59<br/>  else PDX ='S'&#59<br/>run&#59<br/><br/><br/>proc sql&#59<br/>   create table temp.Diagnosis_hosp as<br/>   select PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, ' ' as OrigDX length=18, PAdmit, PDX<br/>   from hosp_12<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/* SCDM: 4.2 Procedure Table */<br/>proc sql&#59<br/>   create table temp.Procedure_hosp as<br/>   select PatID, EncounterID, ADate, Provider, EncType, PX, Px_Codetype, ' ' as OrigPX length=18<br/>   from hosp_11(where=(PX ^= ''))<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/**********************************************************************<br/>From ED<br/>**********************************************************************/<br/><br/>proc sql&#59<br/>   create table ED_1 as <br/>   select distinct *<br/>   from hqc.ED_F_2012<br/>   where datepart(xtrc_date)=\"01AUG2013\"d or datepart(xtrc_date)=\"01AUG2014\"d or datepart(xtrc_date)=\"04AUG2015\"d <br/>         or datepart(xtrc_date)=\"08AUG2016\"d or datepart(xtrc_date)=\"12JUL2017\"d<br/>   order by KEY_HSN, REG_DATE&#59<br/>quit&#59<br/>%reformat_datevars (work, ED_1)&#59  /*1219515*/<br/><br/>proc freq data=ED_1&#59<br/>   tables PROV_LOC_SK / missing&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table ED_2 as<br/>   select distinct key_hsn, reg_date, disp_date, visit_disp, mp_prefix, provdr_type_1, mp_dx as Dx length=18, '10' as Dx_Codetype, substr(inst_num,3,3) as Facility_Code length=3<br/>          , adm_ambul<br/>   from ED_1&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>   create table ED_3 as<br/>   select a.*, b.Facility_Location<br/>   from ED_2 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.Facility_Code=b.hosp_num&#59<br/>quit&#59<br/><br/>proc freq data=ED_3&#59<br/>tables adm_ambul&#59<br/>run&#59<br/><br/>data ED_4(drop=visit_disp adm_ambul)&#59<br/>   length EncType $2  Admitting_source $2&#59<br/>   set ED_3&#59<br/>   EncType='ED'&#59<br/>   if visit_disp in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if visit_disp in ('10','11') then Discharge_Disposition ='E'&#59<br/>   else Discharge_Disposition ='A'&#59<br/>   if adm_ambul in ('A','C','G') then Admitting_source='A'&#59<br/>   else Admitting_source='D' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename reg_date=ADate&#59<br/>   rename disp_date=DDate&#59<br/>run&#59<br/><br/>data ED_5&#59<br/>   set ED_4&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'|| Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=1,212,754*/<br/><br/>proc sort data= ED_5&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data ED_6&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set ED_5&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_ED as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, '' as Discharge_Status length=2, '' as DRG<br/>          length=3, '' as DRG_Type length=4, Admitting_source<br/>   from ED_6&#59<br/>quit&#59 /* 1212754 */<br/><br/>/* PDX='P', PAdmit ='M' for all ED visit */<br/>proc sql&#59<br/>   create table temp.Diagnosis_ED as<br/>   select PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, '' as OrigDx length=18, 'M' as PAdmit length=2, 'P' as PDX<br/>   from ED_6<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/* SCDM: 5.1 Death Table */<br/>proc sql&#59<br/>   create table PHRS_PERS_RSDC_1 as<br/>   select *<br/>   from  HQC.PHRS_PERS_RSDC(where=(&_cls))&#59<br/>quit&#59 /* n=231,455 */<br/><br/>%reformat_datevars (work, PHRS_PERS_RSDC_1)&#59  /*2,585,904*/<br/><br/>data PHRS_PERS_RSDC_2&#59<br/>   set PHRS_PERS_RSDC_1(keep=key_hsn RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>    where RSDC_STAT_TYPE_CODE =4 &#59<br/>&nbsp&nbsp&nbsp&nbspDeathDt=eff_date-1&#59<br/>    format DeathDt yymmdd10. &#59<br/>&nbsp&nbsp&nbsp&nbsplength DeathDt 4. &#59<br/>run&#59<br/><br/>data CDM.DEATH&#59<br/>   set PHRS_PERS_RSDC_2(drop=RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>   DtImpute = 'N'&#59<br/>   Source = 'L' &#59<br/>   Confidence='E' &#59<br/>   rename key_hsn=PatID&#59<br/>run&#59<br/><br/>data CDM.ENCOUNTER&#59<br/>   set temp.ENCOUNTER_MSB<br/>       temp.ENCOUNTER_HOSP <br/>       temp.ENCOUNTER_ED <br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/><br/>data CDM.DIAGNOSIS&#59<br/>   set <br/>       temp.DIAGNOSIS_MSB <br/>       temp.DIAGNOSIS_HOSP<br/>       temp.DIAGNOSIS_ED<br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/><br/>data CDM.PROCEDURE&#59<br/>   set <br/>       temp.PROCEDURE_MSB<br/>       temp.PROCEDURE_HOSP<br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/>/* length EncounterID $35 Provider $11&#59*/<br/><br/>s///<br/>t///","custparents":[{"idx":"MY6261459e-b5ee-4b6e-a0b4-f77c41e7b85e"},{"idx":"MY6261459e-b5ee-4b6e-a0b4-f77c41e7b85e"},{"idx":"MY6261459e-b5ee-4b6e-a0b4-f77c41e7b85e"}]}]}},{"idx":"CodeTask-EkO98cSPFwPKj46N","name":"procedure","NodeDescription":"<p>///t</p><p>///s</p><p>/*Creating the procedure file using SK data</p><p>the data set specification can be found at:</p><p>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</p><p>downloaded and save in:</p><p>P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\Documentation\\NewDocsSinceHandOver</p><p>*/</p><p><br></p><p>/*%freq(data=locald.procedure_1, table = drg_type)*/</p><p><br></p><p>/*what does it look like in sentinel file?*/</p><p>/*%print(data=locald.procedure_1);*/</p><p>/*%nobs(data=locald.procedure_1);*/</p><p>/*%distinct(data=locald.procedure_1, target=test, vars=%str(?));*/</p><p>/*</p><p>proc datasets lib=locald;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;contents data=procedure_1 order=varnum;</p><p>run;</p><p>*/</p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>EncounterID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;$15.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>ADate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</p><p>Provider&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>PX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>PX_codetype&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>OrigPX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>*/</p><p><br></p><p>/*What does wenbin's datafile looks like?*/</p><p>/*</p><p>%print(data=rOldD.procedure);</p><p>proc datasets lib=rOldD;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;contents data=procedure order=varnum;</p><p>run;</p><p>*/</p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</p><p>EncounterID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>ADate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;DATETIME20.&nbsp;&nbsp;&nbsp;&nbsp;ADM_DATE</p><p>Provider&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEY_DOC_NUM</p><p>EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>PX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX</p><p>PX_CodeType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>OrigPX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FSC</p><p>*/</p><p><br></p><p>/* Decision:</p><p>1. Var length and varnum order follow sentinel demo files</p><p>*/</p><p><br></p><p>/*doc number was $10. which is not enough for SK key_doc_num ($11.)*/</p><p>data procedure_tmp1a;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;length </p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;$16.&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;$15.&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;4.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;&nbsp;&nbsp;&nbsp;$11.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$11.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_codetype&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigPX&nbsp;&nbsp;&nbsp;&nbsp;$11.&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;format ADate YYMMDD10. ;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;delete;</p><p>run;</p><p><br></p><p><br></p><p>/*where is wenbin's code?</p><p>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas</p><p>*/</p><p><br></p><p><br></p><p>/**************************************************************************</p><p>Part 1 procedures from MSB</p><p>****************************************************************************/</p><p>/*</p><p>&nbsp;&nbsp;&nbsp;&nbsp;According to Wenbin's code, only keep records with EncType='SO' or 'DS'</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;= key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;&lt;- EncounterID from the zip file</p><p>&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= dos_1</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Provider = key_doc_num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;EncType &lt;- enctype.encytype &lt;- ngs_fsc_sk.fsc &lt;- msb_master.fsc</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It seems that a more efficient way is to make a mapping between enctype and fsc directly.</p><p><br></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make a mapping between enctype and fsc</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the NGSfile and the enctype file has been defined in local and remote setting</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for local</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theNGSfile = localskd.NGS_FSC_SK;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for remote</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theNGSfile = rOldDoc.NGS_FSC_SK;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for local</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theEncTypeFile = localskd.Enctype;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for remote</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theEncTypeFile = rOldDoc.Enctype;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;OrigPX&nbsp;&nbsp;&nbsp;&nbsp;&lt;- FSC&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note: Wenbin's code specified OrigPX length = 18. This is not seen in the demo (OrigPX=11)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maybe it is confused with the length of OrigDX (which is $18 as in the demo)&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;PX&nbsp;&nbsp;&nbsp;&nbsp;&lt;- NGS_CATEGORY (from diagnosis_tmpf)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;PX_codetype&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- 'NG' </p><p>*/</p><p>/*data is from DIAGNOSIS_TMP1F*/</p><p>%distinct(</p><p>&nbsp;&nbsp;&nbsp;&nbsp;data=DIAGNOSIS_TMP1F, </p><p>&nbsp;&nbsp;&nbsp;&nbsp;target=procedure_tmp1b,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(PatID, i, ADate, Provider, EncType, NGS_CATEGORY as PX, OrigPX),</p><p>&nbsp;&nbsp;&nbsp;&nbsp;filters=%str(EncType = 'SO' or EncType='DS')</p><p>);</p><p><br></p><p>data procedure_msb;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set procedure_tmp1a procedure_tmp1b;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;EncounterID = 'M' || put(i, z14.);</p><p>&nbsp;&nbsp;&nbsp;&nbsp;PX_CodeType = 'NG';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;drop i;</p><p>run;</p><p><br></p><p>%beep;</p><p><br></p><p>/*zip it*/</p><p>%vbsZip(</p><p>&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath, </p><p>&nbsp;&nbsp;&nbsp;&nbsp;zipFile=procedure_msb.zip, </p><p>&nbsp;&nbsp;&nbsp;&nbsp;srcFile=procedure_msb, </p><p>&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</p><p>);</p><p><br></p><p>/*proc sql;*/</p><p>/* create table temp.PROCEDURE_MSB as*/</p><p>/* select distinct PatID, EncounterID, ADate, Provider, EncType, NGS_CATEGORY as PX length=11, */</p><p>/*&nbsp;&nbsp;&nbsp;&nbsp;'NG' as PX_CodeType, FSC as OrigPX length=18*/</p><p>/* from msb_6*/</p><p>/* where EncType in ('SO','DS');*/</p><p>/*quit;*/</p><p><br></p><p><br></p><p>/**************************************************************************</p><p>Part 2 procedures from hosp</p><p>****************************************************************************/</p><p><br></p><p>/*to keep cols for the diagnosis table</p><p>&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code, the OrigPx was set to missing for Hosp records, with a length of 18</p><p>&nbsp;&nbsp;&nbsp;&nbsp;however, the tech spec says it should be the same as PX, length=11</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Decision: keep it as the same as PX, length=11</p><p>*/</p><p>data procedure_tmp2a;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp2f;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;length OrigDX $11. ; </p><p>&nbsp;&nbsp;&nbsp;&nbsp;where recType='PX';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;OrigPX = PX;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;keep </p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigPX</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_codetype</p><p>&nbsp;&nbsp;&nbsp;&nbsp;;</p><p>run;</p><p><br></p><p>/*apply format defined in tmp1a*/</p><p>data procedure_hosp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set procedure_tmp1a procedure_tmp2a;</p><p>run;</p><p>%vbsZip(</p><p>&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath, </p><p>&nbsp;&nbsp;&nbsp;&nbsp;zipFile=procedure_hosp.zip, </p><p>&nbsp;&nbsp;&nbsp;&nbsp;srcFile=procedure_hosp, </p><p>&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</p><p>);</p><p><br></p><p><br></p><p>/**************************************************************************</p><p>[_W]</p><p>Part 3 procedures from ed </p><p>There is no data on procedures from the ed file</p><p><br></p><p>****************************************************************************/</p><p><br></p><p><br></p><p>/*******************************************************************************</p><p>Putting together</p><p>*******************************************************************************/</p><p><br></p><p>%vbsUnzip(</p><p>&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\procedure_msb.zip),</p><p>&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(procedure_msb.sas7bdat)</p><p>);</p><p>%vbsUnzip(</p><p>&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\procedure_hosp.zip),</p><p>&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(procedure_hosp.sas7bdat)</p><p>);</p><p><br></p><p><br></p><p>data procedure_9618;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set procedure_msb procedure_hosp ;</p><p>run;</p><p><br></p><p>%vbsZip(</p><p>&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath, </p><p>&nbsp;&nbsp;&nbsp;&nbsp;zipFile=procedure_9618.zip, </p><p>&nbsp;&nbsp;&nbsp;&nbsp;srcFile=procedure_9618, </p><p>&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</p><p>);</p><p><br></p><p>%beep;</p><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"CodeTask-nWkLpebRMNlItMcs"},{"idx":"CodeTask-9v6iPCWqkuTujJag"}],"_substeps":{"idx":"0181b913-7ae2-4132-a282-017b54ad9602","name":"substeps","children":[{"idx":"183e0a36-c6ae-423d-98ed-b0816523a2c5","name":"Define the file","NodeDescription":"<p>///t</p><p>///s</p><p><br></p><p>/*Creating&nbsp;the&nbsp;procedure&nbsp;file&nbsp;using&nbsp;SK&nbsp;data</p><p>the&nbsp;data&nbsp;set&nbsp;specification&nbsp;can&nbsp;be&nbsp;found&nbsp;at:</p><p>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</p><p>downloaded&nbsp;and&nbsp;save&nbsp;in:</p><p>P:\\2018&nbsp;-&nbsp;CDM&nbsp;CNODES&nbsp;(Wenbin&nbsp;&nbsp;Nedeene&nbsp;&nbsp;Amanda)\\Documentation\\NewDocsSinceHandOver</p><p>*/</p><p><br></p><p>/*%freq(data=locald.procedure_1,&nbsp;table&nbsp;=&nbsp;drg_type)*/</p><p><br></p><p>/*what&nbsp;does&nbsp;it&nbsp;look&nbsp;like&nbsp;in&nbsp;sentinel&nbsp;&nbsp;file?*/</p><p>/*%print(data=locald.procedure_1);*/</p><p>/*%nobs(data=locald.procedure_1);*/</p><p>/*%distinct(data=locald.procedure_1,&nbsp;target=test,&nbsp;vars=%str(?));*/</p><p>/*</p><p>proc&nbsp;datasets&nbsp;lib=locald;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=procedure_1&nbsp;order=varnum;</p><p>run;</p><p>*/</p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>EncounterID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;$15.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>ADate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</p><p>Provider&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>PX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>PX_codetype&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>OrigPX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>*/</p><p><br></p><p>/*What&nbsp;does&nbsp;wenbin's&nbsp;datafile&nbsp;looks&nbsp;like?*/</p><p>/*</p><p>%print(data=rOldD.procedure);</p><p>proc&nbsp;datasets&nbsp;lib=rOldD;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=procedure&nbsp;order=varnum;</p><p>run;</p><p>*/</p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</p><p>EncounterID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>ADate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;DATETIME20.&nbsp;&nbsp;&nbsp;&nbsp;ADM_DATE</p><p>Provider&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEY_DOC_NUM</p><p>EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>PX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX</p><p>PX_CodeType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>OrigPX&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FSC</p><p>*/</p><p><br></p><p>/*&nbsp;Decision:</p><p>1.&nbsp;Var&nbsp;length&nbsp;and&nbsp;varnum&nbsp;order&nbsp;follow&nbsp;sentinel&nbsp;demo&nbsp;files</p><p>*/</p><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"4a755e3a-b143-4719-9783-bf32bab4d88d","name":"create an empty data set","NodeDescription":"<p>///t</p><p>///s</p><p>/*doc&nbsp;number&nbsp;was&nbsp;$10.&nbsp;which&nbsp;is&nbsp;not&nbsp;enough&nbsp;for&nbsp;SK&nbsp;key_doc_num&nbsp;($11.)*/</p><p>data&nbsp;procedure_tmp1a;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;$16.&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;$15.&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;4.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;&nbsp;&nbsp;&nbsp;$11.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$11.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_codetype&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigPX&nbsp;&nbsp;&nbsp;&nbsp;$11.&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;format&nbsp;ADate&nbsp;YYMMDD10.&nbsp;;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;delete;</p><p>run;</p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"MYc13c3652-7cf2-4208-94e7-43776360d4cc","name":"Procedure from MSB","custparents":[{"idx":"4a755e3a-b143-4719-9783-bf32bab4d88d"},{"idx":"MY7252ea20-0f21-4b86-9968-ef21f45e5164"}],"children":[],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/**************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">Part 1 procedures from MSB</div><div class=\"ql-code-block\" data-language=\"plain\">****************************************************************************/</div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;According to Wenbin's code, only keep records with EncType='SO' or 'DS'</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;= key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;&lt;- EncounterID from the zip file</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= dos_1</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider = key_doc_num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType &lt;- enctype.encytype &lt;- ngs_fsc_sk.fsc &lt;- msb_master.fsc</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;It seems that a more efficient way is to make a mapping between enctype and fsc directly.</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;make a mapping between enctype and fsc</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the NGSfile and the enctype file has been defined in local and remote setting</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for local</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theNGSfile = localskd.NGS_FSC_SK;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for remote</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theNGSfile = rOldDoc.NGS_FSC_SK;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for local</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theEncTypeFile = localskd.Enctype;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for remote</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%let theEncTypeFile = rOldDoc.Enctype;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;OrigPX&nbsp;&nbsp;&nbsp;&nbsp;&lt;- FSC&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note: Wenbin's code specified OrigPX length = 18. This is not seen in the demo (OrigPX=11)</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maybe it is confused with the length of OrigDX (which is $18 as in the demo)&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PX&nbsp;&nbsp;&nbsp;&nbsp;&lt;- NGS_CATEGORY (from diagnosis_tmpf)</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PX_codetype&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- 'NG'</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*data is from DIAGNOSIS_TMP1F*/</div><div class=\"ql-code-block\" data-language=\"plain\">%distinct(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;data=DIAGNOSIS_TMP1F,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=procedure_tmp1b,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(PatID, i, ADate, Provider, EncType, NGS_CATEGORY as PX, OrigPX),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;filters=%str(EncType = 'SO' or EncType='DS')</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data procedure_msb;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set procedure_tmp1a procedure_tmp1b;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID = 'M' || put(i, z14.);</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PX_CodeType = 'NG';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop i;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*zip it*/</div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=procedure_msb.zip,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=procedure_msb,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*proc sql;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/* create table temp.PROCEDURE_MSB as*/</div><div class=\"ql-code-block\" data-language=\"plain\">/* select distinct PatID, EncounterID, ADate, Provider, EncType, NGS_CATEGORY as PX length=11, */</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;'NG' as PX_CodeType, FSC as OrigPX length=18*/</div><div class=\"ql-code-block\" data-language=\"plain\">/* from msb_6*/</div><div class=\"ql-code-block\" data-language=\"plain\">/* where EncType in ('SO','DS');*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*quit;*/</div></div><p>t///</p>","_substeps":{"idx":"MY90e1d799-c819-49cc-ab5a-2c798c2cfb95","name":"substeps","custparents":[{"idx":"MYc13c3652-7cf2-4208-94e7-43776360d4cc"}],"children":[{"idx":"4531f668-aa85-41e3-be6d-9a24bb8ac1ac","name":"unzip diagnosis_tmp1f","NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*%UnixUnZip(*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;sPath=&amp;remotedatapath,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;zip=diagnosis_tmp1f,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;zipped=diagnosis_tmp1f,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;tPath=,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp1f*/</div><div class=\"ql-code-block\">/*);*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*%vbsUnzip(*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;zipFile=&amp;localSKDatapath.\\diagnosis_tmp1f.zip,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(diagnosis_tmp1f.sas7bdat)*/</div><div class=\"ql-code-block\">/*);*/</div></div><p>t///</p>","children":[{"idx":"b941fadd-5263-4d70-b9ef-80f84ab2d1ce","name":"Get distinct records of PX related Vars","NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*data is from DIAGNOSIS_TMP1F*/</div><div class=\"ql-code-block\">%distinct(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data=DIAGNOSIS_TMP1F,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=procedure_tmp1b,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(PatID, i, ADate, Provider, EncType, NGS_CATEGORY as PX, OrigPX),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;filters=%str(EncType = 'SO' or EncType='DS')</div><div class=\"ql-code-block\">);</div></div><p><br></p><p>t///</p>","children":[{"idx":"bd9202ab-d6ef-498e-89cc-8d40b6f28cec","name":"Make and zip the procedure_msb","NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">data procedure_msb;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set procedure_tmp1a procedure_tmp1b;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID = 'M' || put(i, z14.);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PX_CodeType = 'NG';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;drop i;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%beep;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*zip it*/</div><div class=\"ql-code-block\">%vbsZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=procedure_msb.zip,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=procedure_msb,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\">);</div></div><p><br></p><p>t///</p>","custparents":[{"idx":"b941fadd-5263-4d70-b9ef-80f84ab2d1ce"}]}],"custparents":[{"idx":"4531f668-aa85-41e3-be6d-9a24bb8ac1ac"}]}],"custparents":[{"idx":"MY90e1d799-c819-49cc-ab5a-2c798c2cfb95"},{"idx":"MY4b7f51b9-02d6-41bf-9ce2-3d7e7814035f"},{"idx":"MY7252ea20-0f21-4b86-9968-ef21f45e5164"}]}]}},{"idx":"MY5746ead9-adc8-4f17-b51a-e6334a8e6a1c","name":"Procedure from Hosp","custparents":[{"idx":"4a755e3a-b143-4719-9783-bf32bab4d88d"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/**************************************************************************</div><div class=\"ql-code-block\">Part 2 procedures from hosp</div><div class=\"ql-code-block\">****************************************************************************/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*to keep cols for the diagnosis table</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code, the OrigPx was set to missing for Hosp records, with a length of 18</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;however, the tech spec says it should be the same as PX, length=11</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Decision: keep it as the same as PX, length=11</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">data procedure_tmp2a;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp2f;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length OrigDX $11. ; </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where recType='PX';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;OrigPX = PX;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigPX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_codetype</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*apply format defined in tmp1a*/</div><div class=\"ql-code-block\">data procedure_hosp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set procedure_tmp1a procedure_tmp2a;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%vbsZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=procedure_hosp.zip, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=procedure_hosp, </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\"><br></div></div><p>t///</p>","children":[],"_substeps":{"idx":"MYdd478393-5fe3-47f0-95cb-b2e50186fce8","name":"substeps","custparents":[{"idx":"MY5746ead9-adc8-4f17-b51a-e6334a8e6a1c"}],"children":[{"idx":"MYd299b2ea-0fcf-4279-b175-7bbea59d713f","name":"Get records of PX related vars","custparents":[{"idx":"MY6dea5981-3068-4fc7-bcee-bd395aa6b19c"},{"idx":"MYdd478393-5fe3-47f0-95cb-b2e50186fce8"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data procedure_tmp2a;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set diagnosis_tmp2f;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length OrigDX $11. ;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where recType='PX';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;OrigPX = PX;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrigPX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PX_codetype</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div></div><p>t///</p>","children":[{"idx":"MY585998b7-22e0-42fd-bdae-88c8841261cc","name":"Make and zip procedure_hosp","custparents":[{"idx":"MYd299b2ea-0fcf-4279-b175-7bbea59d713f"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/*apply format defined in tmp1a*/</div><div class=\"ql-code-block\">data procedure_hosp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set procedure_tmp1a procedure_tmp2a;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%vbsZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=procedure_hosp.zip,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=procedure_hosp,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\">);</div></div><p>t///</p>"}]}]}}]}]},{"idx":"CodeTask-2zgvuzHSkvML7zEb","name":"Ref. Wenbin's procedure","NodeDescription":"///t<br/>///s<br/>/*Webin's code for procedure file<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/**********************************************************************<br/>From MSB<br/>**********************************************************************/<br/>/* SCDM: 4.3 Procedure Table */<br/>proc sql&#59<br/>   create table temp.PROCEDURE_MSB as<br/>   select distinct PatID, EncounterID, ADate, Provider, EncType, NGS_CATEGORY as PX length=11, 'NG' as PX_CodeType, FSC as OrigPX length=18<br/>   from msb_6<br/>   where EncType in ('SO','DS')&#59<br/>quit&#59<br/><br/><br/>/**********************************************************************<br/>From Hosp<br/>**********************************************************************/<br/>/*Webin's code for diagnosis file<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/**********************************************************************<br/>From MSB<br/>**********************************************************************/<br/><br/>/* SCDM: 4.2 Diagnosis Table */<br/>proc sql&#59<br/>   create table Diagnosis_msb_1 as<br/>   select distinct PatID, EncounterID, ADate, Provider, EncType, DIAG as OrigDX length=18, FSC <br/>   from msb_6&#59<br/>quit&#59<br/><br/>data Diagnosis_msb_21 Diagnosis_msb_22&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_1&#59<br/>&nbsp&nbsp&nbsp&nbspif  upcase(substr(OrigDX,1,1))='Z' then output Diagnosis_msb_21&#59<br/>&nbsp&nbsp&nbsp&nbspelse output Diagnosis_msb_22&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table Diagnosis_msb_31 as<br/>   select a.*, b.diag_code as DX length=18<br/>   from Diagnosis_msb_21 a<br/>   left join <br/>   doc.sk_zdiag_to_icd9 b<br/>   on a.OrigDX=b.diag_orig_code&#59<br/>quit&#59<br/><br/>proc sql&#59<br/> select distinct OrigDX from Diagnosis_msb_31<br/> where DX=' '&#59<br/>quit&#59<br/><br/>/*The following Z codes do not have the matching:  Z31 Z33 Z34 Z35 Z36 Z37 Z53 Z75*/<br/><br/>data Diagnosis_msb_41&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_31&#59<br/>&nbsp&nbsp&nbsp&nbspif  DX=' ' then Dx_Codetype = 'OT'&#59<br/>&nbsp&nbsp&nbsp&nbspelse Dx_Codetype = '09'&#59<br/>run&#59<br/><br/>data Diagnosis_msb_42&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_22&#59<br/>&nbsp&nbsp&nbsp&nbsp    DX = OrigDX&#59<br/>&nbsp&nbsp&nbsp&nbsp    Dx_Codetype = '09'&#59<br/>run&#59<br/><br/>data Diagnosis_msb_5&#59<br/>&nbsp&nbsp&nbsp&nbspset Diagnosis_msb_41<br/>        Diagnosis_msb_42<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table temp.DIAGNOSIS_MSB as<br/>   select distinct PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, OrigDX, ' '  as PAdmit length=2, ' ' as PDX<br/>   from Diagnosis_msb_5&#59<br/>quit&#59<br/><br/><br/>/**********************************************************************<br/>From Hosp<br/>**********************************************************************/<br/><br/>/*  Hospital */<br/>%let hosp_file          = clean17.CIHI_EOC_2_OND16_23MAY2017&#59<br/> %Extract_CIHI(ds_in            = &hosp_file,<br/>               ds_out           = cdm.hosp, <br/>               dchg_start_date  = &extract_start,&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>               adms_end_date    = &extract_end,<br/>               ICD_field_list   = ,<br/>               ICD9_list        = ,<br/>               ICD9_excl_exact_list =,<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   ICD10_list       = <br/>&nbsp&nbsp&nbsp&nbsp            )&#59<br/><br/>data check_1&#59<br/>   set cdm.hosp&#59<br/>   if DSCHG_DATE='01Jan9999'd&#59<br/>run&#59<br/><br/>/* DS_IP: DS IP OTH  HOSP_NUM : containing missing value */<br/><br/>data check_1&#59<br/>  set cdm.hosp&#59<br/>  if PROV_LOC_SK ^= 'Y'&#59<br/>run&#59<br/><br/>data check_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =. &#59<br/>run&#59<br/><br/>data hosp_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =.  then delete &#59<br/>  if PROV_LOC_SK ^= 'Y' then delete&#59<br/>  if DSCHG_DATE='01Jan9999'd then delete&#59<br/>run&#59<br/><br/>proc tabulate data=hosp_2&#59<br/>var adm_date dschg_date&#59<br/>table adm_date dschg_date, n nmiss (min max median)*f=mmddyy10.&#59<br/>run&#59<br/><br/>data hosp_21 hosp_22 hosp_23 hosp_24 hosp_25&#59<br/>   set hosp_2&#59<br/>    if coding_class_ind ='NA' then output hosp_21 &#59 /* ICD9 */<br/>&nbsp&nbsp&nbsp&nbspelse if coding_class_ind ='0' then output hosp_22 &#59 /* ICD10 */<br/>&nbsp&nbsp&nbsp&nbspelse if CODING_CLASS_IND in ('','9','C') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp     if proc_loc_sk='Y' then output hosp_23&#59 /* ICD9 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else if FY <'200708' then output hosp_24&#59 /* ICD9 and ICD10 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else  output hosp_25&#59 /* ICD9 and ICD10 dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp end&#59<br/>run&#59 <br/><br/>/* ICD9 */<br/>%macro convert_ICD9(in=, out=)&#59<br/>  data convert9&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS FY ENTRY_CODE NEWBORN dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert9(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '09' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CP'&#59<br/>run&#59<br/>%mend convert_ICD9&#59<br/><br/><br/>/* ICD10 */<br/>%macro convert_ICD10(in=, out=)&#59<br/>  data convert10&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS ENTRY_CODE NEWBORN FY dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>run&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert10(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '10' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CI'&#59<br/>run&#59<br/><br/>%mend convert_ICD10&#59<br/><br/>%convert_ICD9(in=hosp_21, out=hosp_21_conv_1)<br/>%convert_ICD10(in=hosp_22, out=hosp_22_conv_1)<br/><br/><br/>/* ICD9 and ICD10 conv_dx_code : 9 and C */<br/>data hosp_24_1&#59<br/>   set hosp_24(drop= dx_code_1-dx_code_25 INTVN_CODE_1-INTVN_CODE_20)&#59<br/>   rename conv_dx_code_1-conv_dx_code_25=dx_code_1-dx_code_25&#59<br/>   rename conv_proc_code_1-conv_proc_code_20=INTVN_CODE_1-INTVN_CODE_20&#59<br/>   run&#59<br/>proc freq data=hosp_24_1&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/>%convert_ICD9(in=hosp_24_1, out=hosp_24_conv_1)<br/><br/><br/>/* ICD9 and ICD10 dx_code */<br/>proc freq data=hosp_25&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/><br/>data hosp_3&#59<br/>  set hosp_21_conv_1 hosp_22_conv_1 hosp_24_conv_1&#59<br/>  hosp_num_c=put(hosp_num,z3.)&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table hosp_4 as<br/>   select a.*, b.Facility_Location<br/>   from hosp_3 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.hosp_num_c=b.hosp_num&#59<br/>quit&#59<br/><br/>data hosp_5(drop=ds_ip)&#59<br/>   length EncType $2&#59<br/>   set hosp_4&#59<br/>   if DS_IP='DS' then  EncType='SD'&#59<br/>   else EncType='IP' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename adm_date=ADate&#59<br/>   rename dschg_date=DDate&#59<br/>   rename HOSP_NUM_C = Facility_Code&#59<br/><br/>run&#59<br/><br/>data hosp_6&#59<br/>   length DRG $3 DRG_Type $4&#59<br/>   set hosp_5&#59<br/>   if EncType='IP' then DRG=CMG&#59<br/>   else if EncType='SD' then DRG=''&#59 <br/>   DRG_Type=''&#59<br/>run&#59<br/><br/>proc freq data=hosp_6&#59<br/>tables DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_7&#59<br/>   set hosp_6&#59<br/>   if DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E'&#59<br/>   else if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A'&#59<br/>   else Discharge_Disposition =' '&#59<br/>run&#59<br/><br/>data hosp_8&#59<br/>   set hosp_7&#59<br/>   Discharge_Status=DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_9&#59<br/>   length Admitting_Source $2&#59<br/>   set hosp_8&#59<br/>   if NEWBORN='NA' then Admitting_Source=ENTRY_CODE&#59<br/>   else Admitting_Source='N'&#59<br/>run&#59<br/><br/>data hosp_10&#59<br/>   set hosp_9&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'||Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=5506 */<br/><br/>proc sort data= hosp_10&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data hosp_11&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set hosp_10&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>data check_1&#59<br/>   set hosp_11&#59<br/>   if DX=''&#59<br/>   run&#59<br/><br/>data check_2&#59<br/>   set hosp_11&#59<br/>   if PX=''&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_hosp as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, Discharge_Status, DRG, DRG_Type, Admitting_Source<br/>   from hosp_11&#59<br/>quit&#59 /* n=2334 */<br/><br/>/* SCDM: 4.2 Diagnosis Table */<br/>proc freq data=hosp_11&#59<br/>  tables DxType&#59<br/>  run&#59<br/><br/>data hosp_12&#59<br/>  length PAdmit $2 &#59<br/>  set hosp_11 (where=(DX ^= ''))&#59<br/>  PAdmit = substr(DxType,1,1)&#59<br/>  if PAdmit ='M' then PDX='P' &#59<br/>  else if PAdmit in ('N','') then PDX ='X'&#59<br/>  else PDX ='S'&#59<br/>run&#59<br/><br/><br/>proc sql&#59<br/>   create table temp.Diagnosis_hosp as<br/>   select PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, ' ' as OrigDX length=18, PAdmit, PDX<br/>   from hosp_12<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/* SCDM: 4.2 Procedure Table */<br/>proc sql&#59<br/>   create table temp.Procedure_hosp as<br/>   select PatID, EncounterID, ADate, Provider, EncType, PX, Px_Codetype, ' ' as OrigPX length=18<br/>   from hosp_11(where=(PX ^= ''))<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/**********************************************************************<br/>From ED<br/>**********************************************************************/<br/><br/><br/>proc sql&#59<br/>   create table ED_1 as <br/>   select distinct *<br/>   from hqc.ED_F_2012<br/>   where datepart(xtrc_date)=\"01AUG2013\"d or datepart(xtrc_date)=\"01AUG2014\"d or datepart(xtrc_date)=\"04AUG2015\"d <br/>         or datepart(xtrc_date)=\"08AUG2016\"d or datepart(xtrc_date)=\"12JUL2017\"d<br/>   order by KEY_HSN, REG_DATE&#59<br/>quit&#59<br/>%reformat_datevars (work, ED_1)&#59  /*1219515*/<br/><br/>proc freq data=ED_1&#59<br/>   tables PROV_LOC_SK / missing&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table ED_2 as<br/>   select distinct key_hsn, reg_date, disp_date, visit_disp, mp_prefix, provdr_type_1, mp_dx as Dx length=18, '10' as Dx_Codetype, substr(inst_num,3,3) as Facility_Code length=3<br/>          , adm_ambul<br/>   from ED_1&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>   create table ED_3 as<br/>   select a.*, b.Facility_Location<br/>   from ED_2 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.Facility_Code=b.hosp_num&#59<br/>quit&#59<br/><br/>proc freq data=ED_3&#59<br/>tables adm_ambul&#59<br/>run&#59<br/><br/>data ED_4(drop=visit_disp adm_ambul)&#59<br/>   length EncType $2  Admitting_source $2&#59<br/>   set ED_3&#59<br/>   EncType='ED'&#59<br/>   if visit_disp in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if visit_disp in ('10','11') then Discharge_Disposition ='E'&#59<br/>   else Discharge_Disposition ='A'&#59<br/>   if adm_ambul in ('A','C','G') then Admitting_source='A'&#59<br/>   else Admitting_source='D' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename reg_date=ADate&#59<br/>   rename disp_date=DDate&#59<br/>run&#59<br/><br/>data ED_5&#59<br/>   set ED_4&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'|| Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=1,212,754*/<br/><br/>proc sort data= ED_5&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data ED_6&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set ED_5&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_ED as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, '' as Discharge_Status length=2, '' as DRG<br/>          length=3, '' as DRG_Type length=4, Admitting_source<br/>   from ED_6&#59<br/>quit&#59 /* 1212754 */<br/><br/>/* PDX='P', PAdmit ='M' for all ED visit */<br/>proc sql&#59<br/>   create table temp.Diagnosis_ED as<br/>   select PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, '' as OrigDx length=18, 'M' as PAdmit length=2, 'P' as PDX<br/>   from ED_6<br/>   order by EncounterID&#59<br/>quit&#59 <br/><br/>/* SCDM: 5.1 Death Table */<br/>proc sql&#59<br/>   create table PHRS_PERS_RSDC_1 as<br/>   select *<br/>   from  HQC.PHRS_PERS_RSDC(where=(&_cls))&#59<br/>quit&#59 /* n=231,455 */<br/><br/>%reformat_datevars (work, PHRS_PERS_RSDC_1)&#59  /*2,585,904*/<br/><br/>data PHRS_PERS_RSDC_2&#59<br/>   set PHRS_PERS_RSDC_1(keep=key_hsn RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>    where RSDC_STAT_TYPE_CODE =4 &#59<br/>&nbsp&nbsp&nbsp&nbspDeathDt=eff_date-1&#59<br/>    format DeathDt yymmdd10. &#59<br/>&nbsp&nbsp&nbsp&nbsplength DeathDt 4. &#59<br/>run&#59<br/><br/>data CDM.DEATH&#59<br/>   set PHRS_PERS_RSDC_2(drop=RSDC_STAT_TYPE_CODE RSDC_STAT_TYPE_DESC eff_date)&#59<br/>   DtImpute = 'N'&#59<br/>   Source = 'L' &#59<br/>   Confidence='E' &#59<br/>   rename key_hsn=PatID&#59<br/>run&#59<br/><br/>data CDM.ENCOUNTER&#59<br/>   set temp.ENCOUNTER_MSB<br/>       temp.ENCOUNTER_HOSP <br/>       temp.ENCOUNTER_ED <br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/><br/>data CDM.DIAGNOSIS&#59<br/>   set <br/>       temp.DIAGNOSIS_MSB <br/>       temp.DIAGNOSIS_HOSP<br/>       temp.DIAGNOSIS_ED<br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/><br/>data CDM.PROCEDURE&#59<br/>   set <br/>       temp.PROCEDURE_MSB<br/>       temp.PROCEDURE_HOSP<br/>&nbsp&nbsp&nbsp&nbsp   &#59<br/>run&#59<br/>/* length EncounterID $35 Provider $11&#59*/<br/><br/><br/>s///<br/>t///","custparents":[{"idx":"0181b913-7ae2-4132-a282-017b54ad9602"}]}]}},{"idx":"CodeTask-5walNELcwbMmiSXf","name":"encounter","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*Creating the encounter file using SK data</div><div class=\"ql-code-block\" data-language=\"plain\">the data set specification can be found at:</div><div class=\"ql-code-block\" data-language=\"plain\">https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</div><div class=\"ql-code-block\" data-language=\"plain\">downloaded and save in:</div><div class=\"ql-code-block\" data-language=\"plain\">P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\Documentation\\NewDocsSinceHandOver</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%freq(data=locald.encounter_1, table = drg_type)</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*what does it look like in sentinel file?*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=locald.encounter_1);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%nobs(data=locald.encounter_1);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%distinct(data=locald.encounter_1, target=test, vars=%str(?));*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*proc datasets lib=locald;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;contents data=encounter_1 order=varnum;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*run;*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">EncounterID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;$15.00&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">ADate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</div><div class=\"ql-code-block\" data-language=\"plain\">DDate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</div><div class=\"ql-code-block\" data-language=\"plain\">Provider&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Facility_Location&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Facility_Code&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;$6.00&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Discharge_Disposition&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Discharge_Status&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">DRG&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;$3.00&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">DRG_Type&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Admitting_Source&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*What does wenbin's datafile looks like?*/</div><div class=\"ql-code-block\" data-language=\"plain\">%print(data=rOldD.encounter);</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets lib=rOldD;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=encounter order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</div><div class=\"ql-code-block\" data-language=\"plain\">EncounterID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">ADate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;DATETIME20.&nbsp;&nbsp;&nbsp;&nbsp;ADM_DATE</div><div class=\"ql-code-block\" data-language=\"plain\">DDate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;DATETIME20.&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DATE</div><div class=\"ql-code-block\" data-language=\"plain\">Provider&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEY_DOC_NUM</div><div class=\"ql-code-block\" data-language=\"plain\">Facility_Location&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;$CHAR3.&nbsp;&nbsp;&nbsp;&nbsp;$CHAR3.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Facility_Code&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Discharge_Disposition&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Discharge_Status&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">DRG&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">DRG_Type&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Admitting_Source&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* Decision:</div><div class=\"ql-code-block\" data-language=\"plain\">1. Var length and varnum order follow sentinel demo files</div><div class=\"ql-code-block\" data-language=\"plain\">2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID not sure why it is so large, anyways it can be rebuilt from</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(PatID, VADate, Provider, and EncType)</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I'll leave it for now. VADate = VValue(ADate). VValue is to have formated value as char</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g., from '01Jan1960'd to '01Jan1960')</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate= dos_1</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DDate leave it missing&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider = key_doc_num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location = ''&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;Char = '' (This is determined by Some NGS_Category (which is defined by FSC, leave it blank for now)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Code = ''</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition = 'U' (according to Wenbin's setting)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status = ''&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG&nbsp;&nbsp;&nbsp;&nbsp;Char = ''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type =''&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source=''</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;also keep</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;SPEC $2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;MG $2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DIAG $3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;FSC $4.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;NUM_SRV 4.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;LOS $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;MODE $1.</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">%print(data=&amp;MSBFile);</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets lib=hqc;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=msb_billing order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*doc number was $10. which is not enough for SK key_doc_num ($11.)*/</div><div class=\"ql-code-block\" data-language=\"plain\">data encounter_tmp1a;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;$16.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;$15.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;4.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DDate&nbsp;&nbsp;&nbsp;&nbsp;4.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;&nbsp;&nbsp;&nbsp;$11.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location&nbsp;&nbsp;&nbsp;&nbsp;$3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$6.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status $2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG&nbsp;&nbsp;&nbsp;&nbsp;$3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format ADate YYMMDD10. DDate YYMMDD10. ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=encounter_tmp1a order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*where is wenbin's code?</div><div class=\"ql-code-block\" data-language=\"plain\">P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/**************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">Part 1 encounters from MSB</div><div class=\"ql-code-block\" data-language=\"plain\">****************************************************************************/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">Part 1 from MSB:</div><div class=\"ql-code-block\" data-language=\"plain\">there is not much to do to this file</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;it may need to be customized by projects (e.g., excluding Mode=z, or sluch doc code? , or EncType by FSC categories)</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*%UnixUnZip(*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;sPath=&amp;remotedatapath,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;zip=diagnosis_tmp1f,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;zipped=diagnosis_tmp1f,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;tPath=,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp1f*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*);*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*%vbsUnzip(*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;zipFile=&amp;localSKDatapath.\\diagnosis_tmp1f.zip,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(diagnosis_tmp1f.sas7bdat)*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*);*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*based on diagnosis_tmp1f*/</div><div class=\"ql-code-block\" data-language=\"plain\">%distinct(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;data=&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp1f,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=encounter_tmp1b,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(PatID, Provider, ADate, EncType, i)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">[_W] /*Warning/notice*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*Note:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID is specific for patid-provider-adate-enctype</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;it should be shared across diag and procudure file</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">data encounter_msb;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set encounter_tmp1a encounter_tmp1b;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID = 'M' || put(i, z14.);</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition='U';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status = 'UN';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source='UN';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;drop i;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*zip it*/</div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=encounter_msb.zip,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=encounter_msb,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/**************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">Part 2 encounters from hospital</div><div class=\"ql-code-block\" data-language=\"plain\">****************************************************************************/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%vbsUnzip(*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\master_hosp.zip),*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(master_hosp.sas7bdat)*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=master_hosp);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*proc datasets;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;contents data=master_hosp;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*run;*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* For encounters from hospital:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;= key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;'H' || 000 CIHIRec (length= 15)&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;=adm_date</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DDate&nbsp;&nbsp;&nbsp;&nbsp;= dischargedate</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider &lt;- facility_code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location&nbsp;&nbsp;&nbsp;&nbsp;&lt;- fac_loc.facility_location&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the file fac_loc can be found at:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remote: /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local: P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DS_IP='DS' then EncType='SD';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else EncType='IP' ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Code&nbsp;&nbsp;&nbsp;&nbsp;&lt;- HOSP_NUM_C &lt;- Character value of 3-digit hosp_num</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Discharge_Disposition =' ';&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status = UN&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if EncType='IP' then DRG=CMG; (CMG can be found in master_hosp)</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if EncType='SD' then DRG='';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type='';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type =''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;although the document says that it should be identified for IP and IS type, it is set as '' in Wenbin's code&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if NEWBORN='NA' then Admitting_Source=ENTRY_CODE;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Admitting_Source='N';</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*1. According to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">remove records if</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DATE='01Jan9999'd;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PROV_LOC_SK ^= 'Y';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;hosp_num =.</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%nobs(data=master_hosp);*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*from diagnosis_tmp2f*/</div><div class=\"ql-code-block\" data-language=\"plain\">%distinct(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp2f,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=encounter_tmp2a,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DDate,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Facility_Code,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRG,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data encounter_hosp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set encounter_tmp1a encounter_tmp2a;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=encounter_hosp.zip,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=encounter_hosp,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/**************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">Part 3 encounters from emergency department</div><div class=\"ql-code-block\" data-language=\"plain\">****************************************************************************/</div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">inclusion:</div><div class=\"ql-code-block\" data-language=\"plain\">PROV_LOC_SK = 'Y'</div><div class=\"ql-code-block\" data-language=\"plain\">reg_date ne .</div><div class=\"ql-code-block\" data-language=\"plain\">reg_date between 1996 and 2018</div><div class=\"ql-code-block\" data-language=\"plain\">key_hsn ne .</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* For encounters from hospital:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;= key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;/EncounterID &lt;- EncounterID from a unique raw record ID created when import ed data (like E0000xxx)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;= Reg_date</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DDate&nbsp;&nbsp;&nbsp;&nbsp;= disp_date</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider &lt;- facility_code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location&nbsp;&nbsp;&nbsp;&nbsp;&lt;- fac_loc.facility_location&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the file fac_loc can be found at:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remote: /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local: P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 'ED'</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Code&nbsp;&nbsp;&nbsp;&nbsp;&lt;- substr(inst_num,3,3)</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if visit_disp in ('','ZZ') then Discharge_Disposition ='U';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if visit_disp in ('10','11') then Discharge_Disposition ='E';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Discharge_Disposition ='A';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status = ''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type =''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;although the document says that it should be identified for IP and IS type, it is set as '' in Wenbin's code&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according to Wenbin's code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if adm_ambul in ('A','C','G') then Admitting_source='A';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else Admitting_source='D' ;</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*%vbsUnzip(*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\master_ed_a2012.zip),*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(master_ed_a2012.sas7bdat)*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*);*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%distinct(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp3c,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=encounter_tmp3a,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DDate,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;facility_code,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Admitting_source</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data encounter_ed;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set encounter_tmp1a encounter_tmp3a;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=encounter_ed.zip,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=encounter_ed,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*******************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">Putting together</div><div class=\"ql-code-block\" data-language=\"plain\">*******************************************************************************/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsUnzip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\encounter_msb.zip),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(encounter_msb.sas7bdat)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">%vbsUnzip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\encounter_hosp.zip),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(encounter_hosp.sas7bdat)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">%vbsUnzip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\encounter_ed.zip),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(encounter_ed.sas7bdat)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data encounter_9618;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set encounter_msb encounter_hosp encounter_ed;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=encounter_9618.zip,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=encounter_9618,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%beep;</div></div><p><br></p><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"CodeTask-nWkLpebRMNlItMcs"},{"idx":"CodeTask-vMKtioTg1c4HUcTk"},{"idx":"CodeTask-nWkLpebRMNlItMcs"},{"idx":"CodeTask-9v6iPCWqkuTujJag"}],"_substeps":{"idx":"207b3cff-9b62-4fe1-a46e-2aa875a030fd","name":"substeps","children":[{"idx":"e9867837-0534-42bc-852f-29f1f26ba9ff","name":"Define the file","NodeDescription":"<p>///t</p><p>///s</p><p><br></p><p>/*Creating&nbsp;the&nbsp;encounter&nbsp;file&nbsp;using&nbsp;SK&nbsp;data</p><p>the&nbsp;data&nbsp;set&nbsp;specification&nbsp;can&nbsp;be&nbsp;found&nbsp;at:</p><p>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</p><p>downloaded&nbsp;and&nbsp;save&nbsp;in:</p><p>P:\\2018&nbsp;-&nbsp;CDM&nbsp;CNODES&nbsp;(Wenbin&nbsp;&nbsp;Nedeene&nbsp;&nbsp;Amanda)\\Documentation\\NewDocsSinceHandOver</p><p>*/</p><p><br></p><p>%freq(data=locald.encounter_1,&nbsp;table&nbsp;=&nbsp;drg_type)</p><p><br></p><p>/*what&nbsp;does&nbsp;it&nbsp;look&nbsp;like&nbsp;in&nbsp;sentinel&nbsp;&nbsp;file?*/</p><p>/*%print(data=locald.encounter_1);*/</p><p>/*%nobs(data=locald.encounter_1);*/</p><p>/*%distinct(data=locald.encounter_1,&nbsp;target=test,&nbsp;vars=%str(?));*/</p><p>/*proc&nbsp;datasets&nbsp;lib=locald;*/</p><p>/*&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=encounter_1&nbsp;order=varnum;*/</p><p>/*run;*/</p><p><br></p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>EncounterID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;$15.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>ADate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</p><p>DDate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD8.</p><p>Provider&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Facility_Location&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Facility_Code&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;&nbsp;$6.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Discharge_Disposition&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Discharge_Status&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>DRG&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;$3.00&nbsp;&nbsp;&nbsp;&nbsp;</p><p>DRG_Type&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Admitting_Source&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p><br></p><p>*/</p><p><br></p><p>/*What&nbsp;does&nbsp;wenbin's&nbsp;datafile&nbsp;looks&nbsp;like?*/</p><p>%print(data=rOldD.encounter);</p><p>proc&nbsp;datasets&nbsp;lib=rOldD;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=encounter&nbsp;order=varnum;</p><p>run;</p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</p><p>EncounterID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>ADate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;DATETIME20.&nbsp;&nbsp;&nbsp;&nbsp;ADM_DATE</p><p>DDate&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;DATETIME20.&nbsp;&nbsp;&nbsp;&nbsp;DSCHG_DATE</p><p>Provider&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KEY_DOC_NUM</p><p>Facility_Location&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;$CHAR3.&nbsp;&nbsp;&nbsp;&nbsp;$CHAR3.&nbsp;&nbsp;&nbsp;&nbsp;</p><p>EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Facility_Code&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Discharge_Disposition&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Discharge_Status&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>DRG&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>DRG_Type&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Admitting_Source&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p><br></p><p>*/</p><p><br></p><p>/*&nbsp;Decision:</p><p>1.&nbsp;Var&nbsp;length&nbsp;and&nbsp;varnum&nbsp;order&nbsp;follow&nbsp;sentinel&nbsp;demo&nbsp;files</p><p>2.&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;not&nbsp;sure&nbsp;why&nbsp;it&nbsp;is&nbsp;so&nbsp;large,&nbsp;anyways&nbsp;it&nbsp;can&nbsp;be&nbsp;rebuilt&nbsp;from</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(PatID,&nbsp;VADate,&nbsp;Provider,&nbsp;and&nbsp;EncType)</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I'll&nbsp;leave&nbsp;it&nbsp;for&nbsp;now.&nbsp;VADate&nbsp;=&nbsp;VValue(ADate).&nbsp;VValue&nbsp;is&nbsp;to&nbsp;have&nbsp;formated&nbsp;value&nbsp;as&nbsp;char&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g.,&nbsp;from&nbsp;'01Jan1960'd&nbsp;to&nbsp;'01Jan1960')</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate=&nbsp;dos_1</p><p>&nbsp;&nbsp;&nbsp;&nbsp;DDate&nbsp;leave&nbsp;it&nbsp;missing&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;=&nbsp;key_doc_num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location&nbsp;=&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;=&nbsp;''&nbsp;(This&nbsp;is&nbsp;determined&nbsp;by&nbsp;Some&nbsp;NGS_Category&nbsp;(which&nbsp;is&nbsp;defined&nbsp;by&nbsp;FSC,&nbsp;leave&nbsp;it&nbsp;blank&nbsp;for&nbsp;now)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Facility_Code&nbsp;=&nbsp;''</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition&nbsp;=&nbsp;'U'&nbsp;(according&nbsp;to&nbsp;Wenbin's&nbsp;setting)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status&nbsp;=&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;DRG&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;=&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type&nbsp;=''&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source=''</p><p>&nbsp;&nbsp;&nbsp;&nbsp;also&nbsp;keep&nbsp;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;SPEC&nbsp;$2.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;MG&nbsp;$2.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;DIAG&nbsp;$3.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;FSC&nbsp;$4.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;NUM_SRV&nbsp;4.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;LOS&nbsp;$1.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;MODE&nbsp;$1.</p><p>*/</p><p><br></p><p><br></p><p>/*where&nbsp;is&nbsp;wenbin's&nbsp;code?</p><p>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from&nbsp;pilot1&nbsp;to&nbsp;compare\\datacreation\\CDM_part01.sas</p><p>*/</p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"6d5000b6-9981-46cc-a779-67969fc4ad54","name":"create an empty data set","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*doc&nbsp;number&nbsp;was&nbsp;$10.&nbsp;which&nbsp;is&nbsp;not&nbsp;enough&nbsp;for&nbsp;SK&nbsp;key_doc_num&nbsp;($11.)*/</div><div class=\"ql-code-block\" data-language=\"plain\">data&nbsp;encounter_tmp1a;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;$16.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;$15.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;4.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DDate&nbsp;&nbsp;&nbsp;&nbsp;4.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;&nbsp;&nbsp;&nbsp;$11.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location&nbsp;&nbsp;&nbsp;&nbsp;$3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$6.&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status&nbsp;$2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG&nbsp;&nbsp;&nbsp;&nbsp;$3.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type&nbsp;&nbsp;&nbsp;&nbsp;$1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format&nbsp;ADate&nbsp;YYMMDD10.&nbsp;DDate&nbsp;YYMMDD10.&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\" data-language=\"plain\">run;;</div><div class=\"ql-code-block\" data-language=\"plain\">proc&nbsp;datasets&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=encounter_tmp1a&nbsp;order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">%print(data=&amp;MSBFile);</div><div class=\"ql-code-block\" data-language=\"plain\">proc&nbsp;datasets&nbsp;lib=hqc;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=msb_billing&nbsp;order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div></div><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"2d0179f5-aa8c-42d0-ab4e-87c2cfac93e5","name":"Encounters from MSB","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/**************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">Part&nbsp;1&nbsp;encounters&nbsp;from&nbsp;MSB</div><div class=\"ql-code-block\" data-language=\"plain\">****************************************************************************/</div></div><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"6d5000b6-9981-46cc-a779-67969fc4ad54"},{"idx":"MY7252ea20-0f21-4b86-9968-ef21f45e5164"}],"_substeps":{"idx":"MYdb6a2a23-3e71-42a7-955d-b6908409bc21","name":"substeps","custparents":[{"idx":"2d0179f5-aa8c-42d0-ab4e-87c2cfac93e5"}],"children":[{"idx":"MY48c4f9cb-10a7-4129-b3ee-55e13cca2c11","name":"Unzip diagnosis_tmp1f, get distinct records","custparents":[{"idx":"MYdb6a2a23-3e71-42a7-955d-b6908409bc21"},{"idx":"MY4b7f51b9-02d6-41bf-9ce2-3d7e7814035f"},{"idx":"MY7252ea20-0f21-4b86-9968-ef21f45e5164"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*%UnixUnZip(*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;sPath=&amp;remotedatapath,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;zip=diagnosis_tmp1f,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;zipped=diagnosis_tmp1f,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;tPath=,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;target=diagnosis_tmp1f*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*);*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*%vbsUnzip(*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;zipFile=&amp;localSKDatapath.\\diagnosis_tmp1f.zip,*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(diagnosis_tmp1f.sas7bdat)*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*);*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*based on diagnosis_tmp1f*/</div><div class=\"ql-code-block\" data-language=\"plain\">%distinct(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;data=&nbsp;&nbsp;&nbsp;&nbsp;diagnosis_tmp1f,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=encounter_tmp1b,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(PatID, Provider, ADate, EncType, i)</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div></div><p><br></p><p>t///</p>","children":[{"idx":"02a08f0d-e25e-4dab-9bda-5ef1346da991","name":"Make and zip the encounter_MSB file","NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">///s</div><div class=\"ql-code-block\">/*Note:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;is&nbsp;specific&nbsp;for&nbsp;patid-provider-adate-enctype</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;should&nbsp;be&nbsp;shared&nbsp;across&nbsp;diag&nbsp;and&nbsp;procudure&nbsp;file</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">data&nbsp;encounter_msb;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;encounter_tmp1a&nbsp;encounter_tmp1b;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;=&nbsp;'M'&nbsp;||&nbsp;put(i,&nbsp;z14.);</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition='U';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status&nbsp;=&nbsp;'UN';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source='UN';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;drop&nbsp;i;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">/*zip&nbsp;it*/</div><div class=\"ql-code-block\">%vbsZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=encounter_msb.zip,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=encounter_msb,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\">)</div></div><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"MY48c4f9cb-10a7-4129-b3ee-55e13cca2c11"}]}]}]}},{"idx":"MYa95f3f00-736c-47b1-8a7e-f7789925ad44","name":"Encounters from Hosp","custparents":[{"idx":"6d5000b6-9981-46cc-a779-67969fc4ad54"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/**************************************************************************</div><div class=\"ql-code-block\" data-language=\"plain\">Part&nbsp;2&nbsp;encounters&nbsp;from&nbsp;hospital</div><div class=\"ql-code-block\" data-language=\"plain\">****************************************************************************/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;For&nbsp;encounters&nbsp;from&nbsp;hospital:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncounterID&nbsp;&nbsp;&nbsp;&nbsp;'H'&nbsp;||&nbsp;000&nbsp;CIHIRec&nbsp;(length=&nbsp;15)&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;=adm_date</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DDate&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;dischargedate</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;&lt;-&nbsp;facility_code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&nbsp;&nbsp;fac_loc.facility_location&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;file&nbsp;fac_loc&nbsp;can&nbsp;be&nbsp;found&nbsp;at:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remote:&nbsp;/sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local:&nbsp;P:\\2018&nbsp;-&nbsp;CDM&nbsp;CNODES&nbsp;(Wenbin&nbsp;&nbsp;Nedeene&nbsp;&nbsp;Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;Wenbin's&nbsp;code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;DS_IP='DS'&nbsp;then&nbsp;&nbsp;EncType='SD';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;EncType='IP'&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Code&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&nbsp;HOSP_NUM_C&nbsp;&lt;-&nbsp;Character&nbsp;value&nbsp;of&nbsp;3-digit&nbsp;hosp_num</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;Wenbin's&nbsp;code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;DSCHG_DISP&nbsp;in&nbsp;('','ZZ')&nbsp;then&nbsp;Discharge_Disposition&nbsp;='U';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;DSCHG_DISP&nbsp;in&nbsp;('07',&nbsp;'08','09')&nbsp;then&nbsp;Discharge_Disposition&nbsp;='E';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;DSCHG_DISP&nbsp;in&nbsp;('01',&nbsp;'02',&nbsp;'03',&nbsp;'04',&nbsp;'05',&nbsp;'06','12',&nbsp;'13')&nbsp;then&nbsp;Discharge_Disposition&nbsp;='A';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Discharge_Disposition&nbsp;='&nbsp;';&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status&nbsp;&nbsp;=&nbsp;UN&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;Wenbin's&nbsp;code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;EncType='IP'&nbsp;then&nbsp;DRG=CMG;&nbsp;(CMG&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;master_hosp)</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;EncType='SD'&nbsp;then&nbsp;DRG='';&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type='';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type&nbsp;=''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;although&nbsp;the&nbsp;document&nbsp;says&nbsp;that&nbsp;it&nbsp;should&nbsp;be&nbsp;identified&nbsp;for&nbsp;IP&nbsp;and&nbsp;IS&nbsp;type,&nbsp;it&nbsp;is&nbsp;set&nbsp;as&nbsp;''&nbsp;in&nbsp;Wenbin's&nbsp;code&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;Wenbin's&nbsp;code:</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;NEWBORN='NA'&nbsp;then&nbsp;Admitting_Source=ENTRY_CODE;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Admitting_Source='N';</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div></div><p>t///</p>","children":[{"idx":"1604fa14-9a91-475c-a74a-987dd32277a4","name":"Put all encounters together and zip it","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*******************************************************************************</div><div class=\"ql-code-block\">Putting&nbsp;together</div><div class=\"ql-code-block\">*******************************************************************************/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%vbsUnzip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\encounter_msb.zip),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(encounter_msb.sas7bdat)</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">%vbsUnzip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\encounter_hosp.zip),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(encounter_hosp.sas7bdat)</div><div class=\"ql-code-block\">);</div><div class=\"ql-code-block\">%vbsUnzip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\encounter_ed.zip),</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(encounter_ed.sas7bdat)</div><div class=\"ql-code-block\">)</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data&nbsp;encounter_9618;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;encounter_msb&nbsp;encounter_hosp&nbsp;encounter_ed;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%vbsZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=encounter_9618.zip,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=encounter_9618,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\">);</div></div><p><br></p><p>s///</p><p>t///</p>","custparents":[{"idx":"4c0b9408-c39b-464a-979a-88e04339dc50"},{"idx":"02a08f0d-e25e-4dab-9bda-5ef1346da991"},{"idx":"e9987409-e429-4a02-b0c0-13e3a87cee2c"},{"idx":"2d0179f5-aa8c-42d0-ab4e-87c2cfac93e5"},{"idx":"887f18b1-9414-4f34-8d0c-822b3429fdee"},{"idx":"MYa95f3f00-736c-47b1-8a7e-f7789925ad44"},{"idx":"MYa95f3f00-736c-47b1-8a7e-f7789925ad44"}]}],"_substeps":{"idx":"MY89b83e3e-840b-4506-b581-004fc0e85359","name":"substeps","custparents":[{"idx":"MYa95f3f00-736c-47b1-8a7e-f7789925ad44"}],"children":[{"idx":"3cfdbff3-99e2-457d-bab6-dc1735bf5200","name":"Get distinct records","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*%vbsUnzip(*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=,*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;zipFile=%str(&amp;localSKDatapath.\\master_hosp.zip),*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;srcFile=%str(master_hosp.sas7bdat)*/</div><div class=\"ql-code-block\">/*);*/</div><div class=\"ql-code-block\">/*%print(data=master_hosp);*/</div><div class=\"ql-code-block\">/*proc&nbsp;datasets;*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=master_hosp;*/</div><div class=\"ql-code-block\">/*run;*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*from&nbsp;diagnosis_tmp2f*/</div><div class=\"ql-code-block\">%distinct(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp2f,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=encounter_tmp2a,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DDate,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Facility_Code,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRG,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;)</div><div class=\"ql-code-block\">);</div></div><p>s///</p><p>t///</p>","children":[{"idx":"4c0b9408-c39b-464a-979a-88e04339dc50","name":"Make and zip the Encounter_Hosp file","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">data&nbsp;encounter_hosp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;encounter_tmp1a&nbsp;encounter_tmp2a;</div><div class=\"ql-code-block\">run;</div><div class=\"ql-code-block\">%vbsZip(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=encounter_hosp.zip,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=encounter_hosp,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\">);</div></div><p>s///</p><p>t///</p>","children":[]}],"custparents":[{"idx":"MY89b83e3e-840b-4506-b581-004fc0e85359"}]}]}},{"idx":"887f18b1-9414-4f34-8d0c-822b3429fdee","name":"Encounters from ED","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\">/**************************************************************************</div><div class=\"ql-code-block\">Part&nbsp;3&nbsp;encounters&nbsp;from&nbsp;emergency&nbsp;department</div><div class=\"ql-code-block\">****************************************************************************/</div><div class=\"ql-code-block\">/*&nbsp;For&nbsp;encounters&nbsp;from&nbsp;ED:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;key_hsn&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;/EncounterID&nbsp;&lt;-&nbsp;EncounterID&nbsp;from&nbsp;a&nbsp;unique&nbsp;raw&nbsp;record&nbsp;ID&nbsp;created&nbsp;when&nbsp;import&nbsp;ed&nbsp;data&nbsp;(like&nbsp;E0000xxx)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ADate&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Reg_date</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DDate&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;disp_date</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Provider&nbsp;&lt;-&nbsp;facility_code&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&nbsp;&nbsp;fac_loc.facility_location&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;file&nbsp;fac_loc&nbsp;can&nbsp;be&nbsp;found&nbsp;at:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remote:&nbsp;/sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;local:&nbsp;P:\\2018&nbsp;-&nbsp;CDM&nbsp;CNODES&nbsp;(Wenbin&nbsp;&nbsp;Nedeene&nbsp;&nbsp;Amanda)\\NewVersion_Shenzhen_Since20191219\\data\\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;EncType&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;Wenbin's&nbsp;code:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;'ED'</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Facility_Code&nbsp;&nbsp;&nbsp;&nbsp;&lt;-&nbsp;substr(inst_num,3,3)</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;Wenbin's&nbsp;code:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;visit_disp&nbsp;in&nbsp;('','ZZ')&nbsp;then&nbsp;Discharge_Disposition&nbsp;='U';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;visit_disp&nbsp;in&nbsp;('10','11')&nbsp;then&nbsp;Discharge_Disposition&nbsp;='E';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Discharge_Disposition&nbsp;='A';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Status&nbsp;&nbsp;=&nbsp;''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DRG&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;Wenbin's&nbsp;code:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;DRG_Type&nbsp;=''&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;although&nbsp;the&nbsp;document&nbsp;says&nbsp;that&nbsp;it&nbsp;should&nbsp;be&nbsp;identified&nbsp;for&nbsp;IP&nbsp;and&nbsp;IS&nbsp;type,&nbsp;it&nbsp;is&nbsp;set&nbsp;as&nbsp;''&nbsp;in&nbsp;Wenbin's&nbsp;code&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;Admitting_Source&nbsp;&nbsp;&nbsp;&nbsp;$2.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;according&nbsp;to&nbsp;Wenbin's&nbsp;code:</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;adm_ambul&nbsp;in&nbsp;('A','C','G')&nbsp;then&nbsp;Admitting_source='A';</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Admitting_source='D'&nbsp;;</div><div class=\"ql-code-block\">*/</div></div><p><br></p><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"6d5000b6-9981-46cc-a779-67969fc4ad54"}],"_substeps":{"idx":"MY217b1bcb-263d-4041-bddc-2047b525ab82","name":"substeps","custparents":[{"idx":"887f18b1-9414-4f34-8d0c-822b3429fdee"}],"children":[{"idx":"MY89f2fef7-c393-4348-94e9-ab65685836cd","name":"Get distinct records","custparents":[{"idx":"MY217b1bcb-263d-4041-bddc-2047b525ab82"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%distinct(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;data=diagnosis_tmp3c,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;target=encounter_tmp3a,</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;vars=%str(</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncounterID,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADate,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DDate,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Facility_Location,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;facility_code,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Provider,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EncType,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Discharge_Disposition,&nbsp;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Admitting_source</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;)</div><div class=\"ql-code-block\">)</div></div><p>t///</p>","children":[{"idx":"e9987409-e429-4a02-b0c0-13e3a87cee2c","name":"Make and zip the Encounter_ED file","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">data&nbsp;encounter_ed;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;encounter_tmp1a&nbsp;encounter_tmp3a;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">%vbsZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tgtDir=&amp;localSKDatapath,&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;zipFile=encounter_ed.zip,&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcFile=encounter_ed,&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;srcDir=</div><div class=\"ql-code-block\" data-language=\"plain\">)</div></div><p>s///</p><p>t///</p>","custparents":[{"idx":"MY89f2fef7-c393-4348-94e9-ab65685836cd"}]}]}]}}]}]},{"idx":"CodeTask-SCB25I1aq4R6t6zc","name":"Ref. Wenbin's encounter","NodeDescription":"///t<br/>///s<br/>/*Webin's code for dispensing file<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/**********************************************************************<br/>From MSB<br/>**********************************************************************/<br/><br/><br/>libname doc \"/sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document\"&#59<br/>%print(data=doc.ngs_fsc_sk)&#59<br/>%print(data=doc.enctype)&#59<br/>%freq(data=doc.enctype, table=encounter_type)&#59<br/><br/>/* SCDM: 4.1 Encounter Table*/<br/>%Extract_MSB(<br/>   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspds_out&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp=&nbsp&nbsp&nbsp&nbsp cdm.msb,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_start_dt&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp'31MAR1997'd,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspxtrc_end_dt&nbsp&nbsp&nbsp&nbsp &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp'11APR2017'd,<br/>               &nbsp&nbsp&nbsp&nbspdostart&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp&extract_start,<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp    dosend&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp= &nbsp&nbsp&nbsp&nbsp&extract_end,<br/>                kept_vars               =   KEY_HSN KEY_DOC_NUM SPEC MG DIAG FSC NUM_SRV DOS LOS CONTACTS AMT_APP MODE<br/>)&#59<br/><br/>/*libname tmp '/SAS_data/dw0/HQC_share/Wenbin/LIMPAC/tmp'&#59 tmp.msb */<br/><br/>data msb_2&#59<br/>   set cdm.msb&#59<br/>   if MODE='Z' then delete &#59 /* Out of Province Reciprocal Billing */<br/>run&#59<br/><br/>/*  only those NGS related records are counted */<br/>proc sql&#59&#59<br/>   create table FSC_NGS as <br/>   select distinct FSC, NGS_CATEGORY from DOC.ngs_fsc_sk&#59<br/>   quit&#59 /* 4077 */<br/><br/>proc sql&#59&#59<br/>   create table msb_3 as <br/>   select a.*, b.NGS_CATEGORY <br/>   from msb_2 a, FSC_NGS b <br/>   where a.fsc = b.fsc&#59<br/>quit&#59<br/><br/>proc sql&#59&#59<br/>   create table msb_4 as <br/>   select a.*, b.ENCOUNTER_TYPE, b.PX_CodeType<br/>   from msb_3 a, DOC.EncType b <br/>   where a.NGS_CATEGORY = b.NGS_CATEGORY&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>  create table msb_5 as<br/>  select key_hsn as PatID, dos_1 as ADate, KEY_DOC_NUM as Provider,DIAG, FSC, LOS, ' ' as Facility_Location length=3, . as DDate, <br/>         ' ' as Facility_Code length=3, 'U' as Discharge_Disposition, ' ' as Discharge_Status length=2, ' ' as DRG length=3, ' ' as DRG_Type length=4, ' ' as Admitting_Source length=2,<br/>         ENCOUNTER_TYPE as EncType, PX_CodeType, NGS_CATEGORY<br/>  from msb_4&#59<br/>quit&#59<br/><br/>data msb_6&#59<br/>   set msb_5&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vdos=vvalue(ADate)&#59<br/>   VADate=compress(Vdos,'/')&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'||Provider ||'_'|| EncType&#59<br/>   drop Vdos&#59<br/>run&#59 /* 98636 */<br/><br/>proc sort data= msb_6&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>/*data msb_7&#59*/<br/>/*  length ADate DDate 4.&#59*/<br/>/*  do _n_=0 by 1 until(last.EncounterID)&#59*/<br/>/*  set msb_6&#59*/<br/>/*  by EncounterID&#59*/<br/>/*  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59*/<br/>/*  output&#59*/<br/>/*  end&#59*/<br/>/*  run&#59*/<br/><br/>proc sql&#59<br/>   create table temp.Encounter_msb as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, Discharge_Status,<br/>                   DRG, DRG_Type, Admitting_Source<br/>   from msb_6&#59<br/>quit&#59 /* 159174738*/<br/><br/>/*  if _n_ >0 then EncounterID=cats(EncounterID,'_',_n_)&#59*/<br/>/* 000xxxxx_06082016_31925314671_10 */<br/><br/>proc sql&#59<br/>   create table test as<br/>   select distinct EncounterID from temp.Encounter_msb&#59quit&#59 /* 159174738*/<br/><br/><br/>/**********************************************************************<br/>From Hosp<br/>**********************************************************************/<br/><br/><br/>/*  Hospital */<br/>%let hosp_file          = clean17.CIHI_EOC_2_OND16_23MAY2017&#59<br/> %Extract_CIHI(ds_in            = &hosp_file,<br/>               ds_out           = cdm.hosp, <br/>               dchg_start_date  = &extract_start,&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<br/>               adms_end_date    = &extract_end,<br/>               ICD_field_list   = ,<br/>               ICD9_list        = ,<br/>               ICD9_excl_exact_list =,<br/> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   ICD10_list       = <br/>&nbsp&nbsp&nbsp&nbsp            )&#59<br/><br/>data check_1&#59<br/>   set cdm.hosp&#59<br/>   if DSCHG_DATE='01Jan9999'd&#59<br/>run&#59<br/><br/>/* DS_IP: DS IP OTH  HOSP_NUM : containing missing value */<br/><br/>data check_1&#59<br/>  set cdm.hosp&#59<br/>  if PROV_LOC_SK ^= 'Y'&#59<br/>run&#59<br/><br/>data check_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =. &#59<br/>run&#59<br/><br/>data hosp_2&#59<br/>  set cdm.hosp&#59<br/>  if hosp_num =.  then delete &#59<br/>  if PROV_LOC_SK ^= 'Y' then delete&#59<br/>  if DSCHG_DATE='01Jan9999'd then delete&#59<br/>run&#59<br/><br/>proc tabulate data=hosp_2&#59<br/>var adm_date dschg_date&#59<br/>table adm_date dschg_date, n nmiss (min max median)*f=mmddyy10.&#59<br/>run&#59<br/><br/>data hosp_21 hosp_22 hosp_23 hosp_24 hosp_25&#59<br/>   set hosp_2&#59<br/>    if coding_class_ind ='NA' then output hosp_21 &#59 /* ICD9 */<br/>&nbsp&nbsp&nbsp&nbspelse if coding_class_ind ='0' then output hosp_22 &#59 /* ICD10 */<br/>&nbsp&nbsp&nbsp&nbspelse if CODING_CLASS_IND in ('','9','C') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp     if proc_loc_sk='Y' then output hosp_23&#59 /* ICD9 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else if FY <'200708' then output hosp_24&#59 /* ICD9 and ICD10 conv_dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp else  output hosp_25&#59 /* ICD9 and ICD10 dx_code */<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp end&#59<br/>run&#59 <br/><br/>/* ICD9 */<br/>%macro convert_ICD9(in=, out=)&#59<br/>  data convert9&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS FY ENTRY_CODE NEWBORN dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert9(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '09' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CP'&#59<br/>run&#59<br/>%mend convert_ICD9&#59<br/><br/><br/>/* ICD10 */<br/>%macro convert_ICD10(in=, out=)&#59<br/>  data convert10&#59<br/>  set &in(keep= key_hsn adm_date dschg_date coding_class_ind INST_NUM HOSP_NUM DS_IP CMG DPG CACS ENTRY_CODE NEWBORN FY dschg_disp DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>   length DX $18  DxType $2 PX $11&#59<br/>   array c[25] $ DX_CODE_1 - DX_CODE_25&#59<br/>   array t[25] $ DX_TYPE_1 - DX_TYPE_25&#59<br/>   array p[20] $ INTVN_CODE_1 - INTVN_CODE_20&#59<br/>   do i=1 to dim(c)&#59<br/>      if c[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       DX=c[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   DxType=t[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/><br/>   do i=1 to dim(p)&#59<br/>      if p[i] not in (' ', 'NA') then do&#59<br/>&nbsp&nbsp&nbsp&nbsp       PX=p[i]&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp   output&#59<br/>&nbsp&nbsp&nbsp&nbsp  end&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/>run&#59<br/><br/>data &out&#59<br/>&nbsp&nbsp&nbsp&nbspset convert10(drop=i DX_CODE: DX_TYPE: INTVN_CODE:)&#59<br/>    DX_CodeType = '10' &#59<br/>&nbsp&nbsp&nbsp&nbspif PX ^= ' ' then PX_CodeType = 'CI'&#59<br/>run&#59<br/><br/>%mend convert_ICD10&#59<br/><br/>%convert_ICD9(in=hosp_21, out=hosp_21_conv_1)<br/>%convert_ICD10(in=hosp_22, out=hosp_22_conv_1)<br/><br/><br/>/* ICD9 and ICD10 conv_dx_code : 9 and C */<br/>data hosp_24_1&#59<br/>   set hosp_24(drop= dx_code_1-dx_code_25 INTVN_CODE_1-INTVN_CODE_20)&#59<br/>   rename conv_dx_code_1-conv_dx_code_25=dx_code_1-dx_code_25&#59<br/>   rename conv_proc_code_1-conv_proc_code_20=INTVN_CODE_1-INTVN_CODE_20&#59<br/>   run&#59<br/>proc freq data=hosp_24_1&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/>%convert_ICD9(in=hosp_24_1, out=hosp_24_conv_1)<br/><br/><br/>/* ICD9 and ICD10 dx_code */<br/>proc freq data=hosp_25&#59<br/>   tables CODING_CLASS_IND / missing&#59<br/>run&#59<br/><br/>data hosp_3&#59<br/>  set hosp_21_conv_1 hosp_22_conv_1 hosp_24_conv_1&#59<br/>  hosp_num_c=put(hosp_num,z3.)&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table hosp_4 as<br/>   select a.*, b.Facility_Location<br/>   from hosp_3 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.hosp_num_c=b.hosp_num&#59<br/>quit&#59<br/><br/>data hosp_5(drop=ds_ip)&#59<br/>   length EncType $2&#59<br/>   set hosp_4&#59<br/>   if DS_IP='DS' then  EncType='SD'&#59<br/>   else EncType='IP' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename adm_date=ADate&#59<br/>   rename dschg_date=DDate&#59<br/>   rename HOSP_NUM_C = Facility_Code&#59<br/><br/>run&#59<br/><br/>data hosp_6&#59<br/>   length DRG $3 DRG_Type $4&#59<br/>   set hosp_5&#59<br/>   if EncType='IP' then DRG=CMG&#59<br/>   else if EncType='SD' then DRG=''&#59 <br/>   DRG_Type=''&#59<br/>run&#59<br/><br/>proc freq data=hosp_6&#59<br/>tables DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_7&#59<br/>   set hosp_6&#59<br/>   if DSCHG_DISP in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if DSCHG_DISP in ('07', '08','09') then Discharge_Disposition ='E'&#59<br/>   else if DSCHG_DISP in ('01', '02', '03', '04', '05', '06','12', '13') then Discharge_Disposition ='A'&#59<br/>   else Discharge_Disposition =' '&#59<br/>run&#59<br/><br/>data hosp_8&#59<br/>   set hosp_7&#59<br/>   Discharge_Status=DSCHG_DISP&#59<br/>run&#59<br/><br/>data hosp_9&#59<br/>   length Admitting_Source $2&#59<br/>   set hosp_8&#59<br/>   if NEWBORN='NA' then Admitting_Source=ENTRY_CODE&#59<br/>   else Admitting_Source='N'&#59<br/>run&#59<br/><br/>data hosp_10&#59<br/>   set hosp_9&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'||Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=5506 */<br/><br/>proc sort data= hosp_10&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data hosp_11&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set hosp_10&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>data check_1&#59<br/>   set hosp_11&#59<br/>   if DX=''&#59<br/>   run&#59<br/><br/>data check_2&#59<br/>   set hosp_11&#59<br/>   if PX=''&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_hosp as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, Discharge_Status, DRG, DRG_Type, Admitting_Source<br/>   from hosp_11&#59<br/>quit&#59 /* n=2334 */<br/><br/><br/>/**********************************************************************<br/>From ED<br/>**********************************************************************/<br/><br/>proc sql&#59<br/>   create table ED_1 as <br/>   select distinct *<br/>   from hqc.ED_F_2012<br/>   where datepart(xtrc_date)=\"01AUG2013\"d or datepart(xtrc_date)=\"01AUG2014\"d or datepart(xtrc_date)=\"04AUG2015\"d <br/>         or datepart(xtrc_date)=\"08AUG2016\"d or datepart(xtrc_date)=\"12JUL2017\"d<br/>   order by KEY_HSN, REG_DATE&#59<br/>quit&#59<br/>%reformat_datevars (work, ED_1)&#59  /*1219515*/<br/><br/>proc freq data=ED_1&#59<br/>   tables PROV_LOC_SK / missing&#59<br/>   run&#59<br/><br/>proc sql&#59<br/>   create table ED_2 as<br/>   select distinct key_hsn, reg_date, disp_date, visit_disp, mp_prefix, provdr_type_1, mp_dx as Dx length=18, '10' as Dx_Codetype, substr(inst_num,3,3) as Facility_Code length=3<br/>          , adm_ambul<br/>   from ED_1&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>   create table ED_3 as<br/>   select a.*, b.Facility_Location<br/>   from ED_2 a<br/>   left join <br/>   doc.fac_loc b<br/>   on a.Facility_Code=b.hosp_num&#59<br/>quit&#59<br/><br/>proc freq data=ED_3&#59<br/>tables adm_ambul&#59<br/>run&#59<br/><br/>data ED_4(drop=visit_disp adm_ambul)&#59<br/>   length EncType $2  Admitting_source $2&#59<br/>   set ED_3&#59<br/>   EncType='ED'&#59<br/>   if visit_disp in ('','ZZ') then Discharge_Disposition ='U'&#59<br/>   else if visit_disp in ('10','11') then Discharge_Disposition ='E'&#59<br/>   else Discharge_Disposition ='A'&#59<br/>   if adm_ambul in ('A','C','G') then Admitting_source='A'&#59<br/>   else Admitting_source='D' &#59<br/>   rename key_hsn=PatID&#59<br/>   rename reg_date=ADate&#59<br/>   rename disp_date=DDate&#59<br/>run&#59<br/><br/>data ED_5&#59<br/>   set ED_4&#59<br/>   length VADate $8 EncounterID $35 &#59<br/>   format ADate DDate MMDDYY10. &#59<br/>   Vadm=vvalue(ADate)&#59<br/>   VADate=compress(Vadm,'/')&#59<br/>   Provider=Facility_Code&#59<br/>   EncounterID=PatID ||'_'|| VADate ||'_'|| Provider ||'_'|| EncType&#59<br/>   drop Vadm&#59<br/>run&#59 /* n=1,212,754*/<br/><br/>proc sort data= ED_5&#59<br/>by EncounterID&#59<br/>run&#59<br/><br/>data ED_6&#59<br/>  length ADate DDate 4.&#59<br/>  do _n_=0 by 1 until(last.EncounterID)&#59<br/>  set ED_5&#59<br/>  by EncounterID&#59<br/>  if _n_ >0 then EncounterID=cats(EncounterID,_n_)&#59<br/>  output&#59<br/>  end&#59<br/>run&#59<br/><br/>proc sql&#59<br/>   create table temp.Encounter_ED as<br/>   select distinct PatID, EncounterID, ADate, DDate, Provider, Facility_Location, EncType, Facility_Code, Discharge_Disposition, '' as Discharge_Status length=2, '' as DRG<br/>          length=3, '' as DRG_Type length=4, Admitting_source<br/>   from ED_6&#59<br/>quit&#59 /* 1212754 */<br/><br/>/* PDX='P', PAdmit ='M' for all ED visit */<br/>proc sql&#59<br/>   create table temp.Diagnosis_ED as<br/>   select PatID, EncounterID, ADate, Provider, EncType, DX, Dx_Codetype, '' as OrigDx length=18, 'M' as PAdmit length=2, 'P' as PDX<br/>   from ED_6<br/>   order by EncounterID&#59<br/>quit&#59 <br/>s///<br/>t///","custparents":[{"idx":"207b3cff-9b62-4fe1-a46e-2aa875a030fd"}]}]}}]},{"idx":"CodeTask-vMKtioTg1c4HUcTk","name":"enrollment","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*Creating the enrollment_1 using SK data</div><div class=\"ql-code-block\" data-language=\"plain\">the data set specification can be found at:</div><div class=\"ql-code-block\" data-language=\"plain\">https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</div><div class=\"ql-code-block\" data-language=\"plain\">downloaded and save in:</div><div class=\"ql-code-block\" data-language=\"plain\">P:\\2018 - CDM CNODES (Wenbin Nedeene Amanda)\\Documentation\\NewDocsSinceHandOver</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*what does it look like in sentinel demo file?*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*%print(data=locald.ENROLLMENT_1);*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*proc datasets lib=locald;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*&nbsp;&nbsp;&nbsp;&nbsp;contents data=ENROLLMENT_1 order=varnum;*/</div><div class=\"ql-code-block\" data-language=\"plain\">/*run;*/</div></div><p><br></p><p><br></p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">PatID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00</div><div class=\"ql-code-block\" data-language=\"plain\">Enr_Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.</div><div class=\"ql-code-block\" data-language=\"plain\">Enr_End&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.</div><div class=\"ql-code-block\" data-language=\"plain\">MedCov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">DrugCov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Chart&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div></div><p><br></p><p><br></p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*What does wenbin's datafile looks like?*/</div><div class=\"ql-code-block\" data-language=\"plain\">%print(data=rOldD.ENROLLMENT);</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets lib=rOldD;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=ENROLLMENT order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">/*</div><div class=\"ql-code-block\" data-language=\"plain\">Enr_Start&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Enr_End&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</div><div class=\"ql-code-block\" data-language=\"plain\">MedCov&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">DrugCov&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">Chart&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/* Decision:</div><div class=\"ql-code-block\" data-language=\"plain\">1. Var length and varnum order follow sentinel demo files</div><div class=\"ql-code-block\" data-language=\"plain\">2. MedCov='Y', DrugCov='Y', Chart='N'</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data enrol_tmp1;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;length</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID $16.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enr_Start 4.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enr_End 4.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MedCov $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DrugCov $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chart $1.</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;format Enr_Start YYMMDD10. Enr_End YYMMDD10.;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\">proc datasets ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;contents data=enrol_tmp1 order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*where is wenbin's code?</div><div class=\"ql-code-block\" data-language=\"plain\">P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas</div><div class=\"ql-code-block\" data-language=\"plain\">*/</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*Basically just to have coverage periods from the PHRS_PROG File*/</div><div class=\"ql-code-block\" data-language=\"plain\">data enrol_tmp2;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set &amp;PHRS_Covfile ;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;where xtrc_date = dhms(&amp;Xtrc_End_Cover, 0,0,0);</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn eff_date exp_date report_start report_end xtrc_date;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*make a key_hsn list (must have)*/</div><div class=\"ql-code-block\" data-language=\"plain\">%distinct(data=enrol_tmp2, target=enrol_tmp3,vars=key_hsn);</div><div class=\"ql-code-block\" data-language=\"plain\">%getCoverGAPs(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rawfile=enrol_tmp2,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ptFile=enrol_tmp3,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;theCovXtrc=%str(&amp;Xtrc_End_Cover),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;start=&amp;dataStartDate,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;end=&amp;dataEndDate ,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrol_tmp4,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;cohortgroup=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;debug=1</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\">%print(data=enrol_tmp4);</div></div><p><br></p><p><br></p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">data enrol_tmp5;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set enrol_tmp4;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;keep key_hsn coverStart coverEnd;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;where gaps=0;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rename key_hsn= PatID coverStart =Enr_Start coverEnd = Enr_End;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">data enrollment_9618;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set enrol_tmp1 enrol_tmp5;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;MedCov ='Y';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DrugCov='Y';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Chart ='N';</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%UnixZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;source=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;data=enrollment_9618,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrollment_9618.zip</div><div class=\"ql-code-block\" data-language=\"plain\">);</div></div><p><br></p><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"MY508b95ae-9444-4917-bc1b-20182a28a274"}],"_substeps":{"idx":"d1856b96-13a1-4e1c-8cae-9c66c9240673","name":"substeps","children":[{"idx":"7611c1ba-71a1-4f30-a22c-5e0214cf9514","name":"Definition of the table","NodeDescription":"<p>///t</p><p>///s</p><p><br></p><p>/*Creating&nbsp;the&nbsp;enrollment_1&nbsp;using&nbsp;SK&nbsp;data</p><p>the&nbsp;data&nbsp;set&nbsp;specification&nbsp;can&nbsp;be&nbsp;found&nbsp;at:</p><p>https://dev.sentinelsystem.org/projects/SYNPUF/repos/synpuf_overview/browse/files/translational_code/docs/Sentinel_Tech_Spec_SynPUF_to_SCDM_v1.0.pdf</p><p>downloaded&nbsp;and&nbsp;save&nbsp;in:</p><p>P:\\2018&nbsp;-&nbsp;CDM&nbsp;CNODES&nbsp;(Wenbin&nbsp;Nedeene&nbsp;Amanda)\\Documentation\\NewDocsSinceHandOver</p><p>*/</p><p><br></p><p>/*what&nbsp;does&nbsp;it&nbsp;look&nbsp;like&nbsp;in&nbsp;sentinel&nbsp;demo&nbsp;file?*/</p><p>/*%print(data=locald.ENROLLMENT_1);*/</p><p>/*proc&nbsp;datasets&nbsp;lib=locald;*/</p><p>/*&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=ENROLLMENT_1&nbsp;order=varnum;*/</p><p>/*run;*/</p><p><br></p><p>/*</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;$16.00</p><p>Enr_Start&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.</p><p>Enr_End&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;MMDDYY10.</p><p>MedCov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</p><p>DrugCov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Chart&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;</p><p>*/</p><p><br></p><p>/*What&nbsp;does&nbsp;wenbin's&nbsp;datafile&nbsp;looks&nbsp;like?*/</p><p>%print(data=rOldD.ENROLLMENT);</p><p>proc&nbsp;datasets&nbsp;lib=rOldD;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=ENROLLMENT&nbsp;order=varnum;</p><p>run;;</p><p>/*</p><p>Enr_Start&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Enr_End&nbsp;&nbsp;&nbsp;&nbsp;Num&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;&nbsp;YYMMDD10.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>PatID&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;$11.00&nbsp;&nbsp;&nbsp;&nbsp;KEY_HSN</p><p>MedCov&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>DrugCov&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>Chart&nbsp;&nbsp;&nbsp;&nbsp;Char&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>*/</p><p><br></p><p>/*&nbsp;Decision:</p><p>1.&nbsp;Var&nbsp;length&nbsp;and&nbsp;varnum&nbsp;order&nbsp;follow&nbsp;sentinel&nbsp;demo&nbsp;files</p><p>2.&nbsp;MedCov='Y',&nbsp;DrugCov='Y',&nbsp;Chart='N'</p><p>*/</p><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[{"idx":"MYa75d1273-cb09-4db4-80f0-44048d179507","name":"Make an empty table with defined vars","custparents":[{"idx":"7611c1ba-71a1-4f30-a22c-5e0214cf9514"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">data&nbsp;enrol_tmp1;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;length</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PatID&nbsp;$16.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enr_Start&nbsp;4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enr_End&nbsp;4.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MedCov&nbsp;$1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DrugCov&nbsp;$1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chart&nbsp;$1.</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;format&nbsp;Enr_Start&nbsp;YYMMDD10.&nbsp;Enr_End&nbsp;YYMMDD10.;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;delete;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\">/*</div><div class=\"ql-code-block\">proc&nbsp;datasets&nbsp;;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;contents&nbsp;data=enrol_tmp1&nbsp;order=varnum;</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div></div><p>*/t///</p>","children":[{"idx":"MY420ecaa8-5077-4bb3-b76f-d6e94f5e5a46","name":"Get coverage records from the master PHRS file","custparents":[{"idx":"MYa75d1273-cb09-4db4-80f0-44048d179507"}],"NodeDescription":"<p>///t</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*Basically&nbsp;just&nbsp;to&nbsp;have&nbsp;coverage&nbsp;periods&nbsp;from&nbsp;the&nbsp;PHRS_PROG&nbsp;File*/</div><div class=\"ql-code-block\" data-language=\"plain\">data&nbsp;enrol_tmp2;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;&amp;PHRS_Covfile&nbsp;;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;xtrc_date&nbsp;=&nbsp;dhms(&amp;Xtrc_End_Cover,&nbsp;0,0,0);</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;keep&nbsp;key_hsn&nbsp;eff_date&nbsp;exp_date&nbsp;report_start&nbsp;report_end&nbsp;xtrc_date;</div><div class=\"ql-code-block\" data-language=\"plain\">run;;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div></div><p><br></p><p>t///</p>","children":[{"idx":"MYec9bebc2-173b-4946-9d32-5568ab3f85f0","name":"Get PHRS encolment periods (covering and gap periods)","custparents":[{"idx":"MY420ecaa8-5077-4bb3-b76f-d6e94f5e5a46"}],"NodeDescription":"<p>///t</p><p><br></p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">/*make&nbsp;a&nbsp;key_hsn&nbsp;list&nbsp;(must&nbsp;have)*/</div><div class=\"ql-code-block\" data-language=\"plain\">%distinct(data=enrol_tmp2,&nbsp;target=enrol_tmp3,vars=key_hsn);</div><div class=\"ql-code-block\" data-language=\"plain\">/*Get coverage periods*/</div><div class=\"ql-code-block\" data-language=\"plain\">%getCoverGAPs(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;rawfile=enrol_tmp2,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;ptFile=enrol_tmp3,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;theCovXtrc=%str(&amp;Xtrc_End_Cover),</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;start=&amp;dataStartDate,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;end=&amp;dataEndDate&nbsp;,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrol_tmp4,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;cohortgroup=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;debug=1</div><div class=\"ql-code-block\" data-language=\"plain\">);</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div></div><p><br></p><p>t///</p>","children":[{"idx":"6f1b04b4-4f0f-4707-8483-cfb370c562c9","name":"Keep covering periods","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">/*The table _tmp4 contains both covering periods, and coverage gap peiods. The folliwng</div><div class=\"ql-code-block\">is to keep the covering periods*/</div><div class=\"ql-code-block\">data&nbsp;enrol_tmp5;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;enrol_tmp4;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;keep&nbsp;key_hsn&nbsp;coverStart&nbsp;coverEnd;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;gaps=0;</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;rename&nbsp;key_hsn=&nbsp;PatID&nbsp;coverStart&nbsp;=Enr_Start&nbsp;coverEnd&nbsp;=&nbsp;Enr_End;</div><div class=\"ql-code-block\">run;;</div><div class=\"ql-code-block\"><br></div></div><p><br></p><p><br></p><p><br></p><p>data&nbsp;enrollment_9618;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;enrol_tmp1&nbsp;enrol_tmp5;</p><p>&nbsp;&nbsp;&nbsp;&nbsp;MedCov&nbsp;='Y';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;DrugCov='Y';</p><p>&nbsp;&nbsp;&nbsp;&nbsp;Chart&nbsp;='N';</p><p>run;;</p><p><br></p><p><br></p><p><br></p><p><br></p><p>%UnixZip(</p><p>&nbsp;&nbsp;&nbsp;&nbsp;sPath=,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;source=,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;data=enrollment_9618,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;;remotedatapath,</p><p>&nbsp;&nbsp;&nbsp;&nbsp;target=enrollment_9618.zip</p><p>)</p><p>s///</p><p>t///</p>","children":[{"idx":"6710625a-6de1-427c-b0fd-8112e64ddb05","name":"Make and zip the enrollment file","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\" data-language=\"plain\">data enrollment_9618;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;set enrol_tmp1 enrol_tmp5;</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;MedCov ='Y';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;DrugCov='Y';</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;Chart ='N';</div><div class=\"ql-code-block\" data-language=\"plain\">run;</div><div class=\"ql-code-block\" data-language=\"plain\"><br></div><div class=\"ql-code-block\" data-language=\"plain\">%UnixZip(</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;sPath=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;source=,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;data=enrollment_9618,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;tPath=&amp;remotedatapath,</div><div class=\"ql-code-block\" data-language=\"plain\">&nbsp;&nbsp;&nbsp;&nbsp;target=enrollment_9618.zip</div></div><p><br></p><p><br></p><p><br></p><p>s///</p><p>t///</p>"}],"custparents":[{"idx":"MYec9bebc2-173b-4946-9d32-5568ab3f85f0"}]}]}]}]}]},{"idx":"CodeTask-1rmjHAhhEUwPQmgZ","name":"Ref. Wenbin's enrol code","NodeDescription":"///t<br/>///s<br/>/*Webin's code<br/>P:\\cdmpilot9_v1\\projectfolder\\sasprograms\\from pilot1 to compare\\datacreation\\CDM_part01.sas<br/>*/<br/><br/>/* SCDM: 1. Enrollment Table */<br/>proc sql&#59<br/>   create table PHRS_PERS_PROG_1 as<br/>   select *<br/>   from hqc.PHRS_PERS_PROG(where=(&_cls))<br/>/*   where key_hsn in (select key_hsn from sample_HSNs)*/<br/>   order by key_hsn,EFF_DATE&#59<br/>quit&#59<br/><br/>%reformat_datevars (work, PHRS_PERS_PROG_1)&#59  /*2,585,904*/<br/><br/>/* EXP_DATE =. occured in the last record */<br/>proc sql&#59<br/>  select count(distinct key_hsn) from PHRS_PERS_PROG_1&#59 quit&#59<br/><br/>data Check_1 Check_2&#59<br/>   set PHRS_PERS_PROG_1&#59<br/>   by key_hsn&#59<br/>   if not last.key_hsn then output Check_1&#59<br/>   else output Check_2&#59<br/>run&#59<br/><br/>data PHRS_PERS_PROG_2&#59<br/>   set PHRS_PERS_PROG_1&#59<br/>   if  EXP_DATE=. then EXP_DATE=REPORT_END&#59<br/>   if  EXP_DATE < &DRUG_INITIAL_DATE then delete&#59<br/>   if EFF_DATE > &extract_end then delete&#59<br/>   if EFF_DATE < &DRUG_INITIAL_DATE then EFF_DATE = &DRUG_INITIAL_DATE&#59<br/>   drop report_end report_frequency report_start report_type sgt_id xtrc_date&#59<br/>run&#59 <br/><br/>/* REPORT_END ('02JUL2017'd) might greater than '31MAR2017'd */<br/>data PHRS_PERS_PROG_3&#59<br/>   set PHRS_PERS_PROG_2&#59<br/>   if  EXP_DATE > &extract_end then EXP_DATE = &extract_end&#59<br/>run&#59 <br/><br/>/* Check MIN and MAX dates  */<br/>proc tabulate data=PHRS_PERS_PROG_3&#59<br/>&nbsp&nbsp&nbsp&nbspvar EFF_DATE EXP_DATE&#59<br/>&nbsp&nbsp&nbsp&nbsptable EFF_DATE EXP_DATE,(min max) *f=yymmdd10. &#59<br/>run&#59<br/><br/>proc sort data=PHRS_PERS_PROG_3 nodupkey&#59 by _all_&#59 run&#59 /* n=2018740 */<br/><br/>* Combine overlapping records&#59<br/>%macro enroll_combine(ID=, strt=, stop=, indata=, outdata=, gap=)&#59<br/><br/>proc sort data=&indata(keep=&ID &strt &stop) out=tmp nodupkey&#59<br/>by &ID &strt &stop&#59<br/>where &strt ne . or &stop ne . &#59<br/>run&#59<br/><br/>data &outdata(keep=&ID strt_f stop_f<br/>         rename=(strt_f=&strt stop_f=&stop))&#59<br/>   retain prev_stop strt_f stop_f&#59<br/> set tmp&#59<br/> by &ID&#59<br/> if first.&ID. then do&#59<br/>    strt_f=&strt&#59<br/>    stop_f=&stop&#59<br/>    prev_stop=&stop&#59<br/>    end&#59<br/> if (&strt>(prev_stop+&gap+1)) then do&#59<br/>    stop_f=prev_stop&#59<br/>    output&#59<br/>    strt_f=&strt&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/> if (&stop>prev_stop) then prev_stop=&stop&#59<br/> if last.&ID. then do&#59<br/>    stop_f=prev_stop&#59<br/>    output&#59<br/>&nbsp&nbsp&nbsp&nbspend&#59<br/> format strt_f stop_f yymmdd10. &#59<br/>run&#59<br/>%mend enroll_combine&#59<br/><br/>%enroll_combine(ID=key_hsn, strt=EFF_DATE, stop=EXP_DATE, indata=PHRS_PERS_PROG_3, outdata=PHRS_PERS_PROG_4, gap=0) &#59   /* n=1936946*/<br/><br/>proc sql&#59<br/>   create table PHRS_PERS_INFO_1 as<br/>   select distinct key_hsn, NATV_STAT_FLAG<br/>   from hqc.PHRS_PERS_INFO(where=(&_cls))&#59<br/>quit&#59<br/><br/>proc sql&#59<br/>   create table PHRS_PERS_PROG_5 as<br/>   select a.*, b.NATV_STAT_FLAG<br/>   from PHRS_PERS_PROG_4 a<br/>   left join<br/>   PHRS_PERS_INFO_1 b<br/>   on a.key_hsn=b.key_hsn&#59<br/>quit&#59<br/><br/>data PHRS_PERS_PROG_51&#59<br/>    set PHRS_PERS_PROG_5&#59<br/>&nbsp&nbsp&nbsp&nbsprename eff_date=Enr_Start&#59<br/>    rename EXP_DATE=Enr_End&#59<br/>    MedCov='Y'&#59<br/>    DrugCov='Y'&#59<br/>&nbsp&nbsp&nbsp&nbspif NATV_STAT_FLAG='1' then DrugCov='N'&#59<br/>&nbsp&nbsp&nbsp&nbspDrop natv_stat_flag&#59<br/>&nbsp&nbsp&nbsp&nbspChart='N'&#59<br/>run&#59<br/><br/>data PHRS_PERS_PROG_52&#59<br/>   retain pre_stop&#59<br/>   set PHRS_PERS_PROG_5&#59<br/>   by key_hsn&#59<br/>   if first.key_hsn then pre_stop=EXP_DATE&#59<br/>   if EFF_DATE-pre_stop > 1 then do&#59<br/>             Enr_Start=pre_stop+1&#59<br/>             Enr_End = EFF_DATE-1&#59<br/>             MedCov='N'&#59<br/><br/>             output&#59<br/>             pre_stop=EXP_DATE&#59<br/>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp end&#59<br/>   format Enr_Start Enr_End pre_stop yymmdd10. &#59<br/>   drop eff_date exp_date pre_stop&#59<br/>run&#59<br/><br/>data cdm.Enrollment&#59<br/>   length Enr_Start Enr_End 4.&#59<br/>   retain key_hsn&#59<br/>   set PHRS_PERS_PROG_51&#59<br/>       rename key_hsn=PatID&#59<br/>run&#59 <br/>proc sort data=cdm.Enrollment nodupkey&#59 by _all_&#59 run&#59 /* n=1936944*/<br/>s///<br/>t///","custparents":[{"idx":"d1856b96-13a1-4e1c-8cae-9c66c9240673"}]}]}}]}],"custparents":[{"idx":"CodeTask-1nO5AOhrm37TWv37"},{"idx":"CodeTask-NrDC6oJNN34iBg5x"}]},{"idx":"CodeTask-O5XVQeecDfZh8Tsa","name":"Remote Settings","NodeDescription":"<p>///t</p><p>///s</p><div class=\"ql-code-block-container\" spellcheck=\"false\"><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%include \"/sasdata/hisc/shared_data/HQC_share/DoNotDelete New Cohort Common Tools/tools_ncc.sas\" /LRECL=32767;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let remotedatapath =/sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/data_9618;</div><div class=\"ql-code-block\">libname remoted \"&amp;remotedatapath\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let remoteoldData = /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/data;</div><div class=\"ql-code-block\">libname rOldD \"&amp;remoteoldData\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let remoteoldDoc = /sasdata/hisc/shared_data/HQC_share/Project_CNODES_CDM/document;</div><div class=\"ql-code-block\">libname rOldDoc \"&amp;remoteoldDoc\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*define raw files</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;These can be found in NCC</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;prog 'remote settings' and prog 'b_remote...'</div><div class=\"ql-code-block\">*/</div><div class=\"ql-code-block\">%global</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ThisEGPPath </div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;exchangeDir Rexchange dp_benefitFile dp_nonbenefitFile dp_specFile ed_a2012File ed_b2012File</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;hospitalFile MSBFile MSB_DFile MSB_DocInfoFile PHRS_InfoFile PHRS_CovFile PHRS_RSDCFile PHRS_ArrvFile</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;PHRS_ResiFile PHRS_Resi_cleanFile PHRS_retrFile VerfMortFile MDS_LTC_File AnalyticalReport DataReport alldinfile</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;MortDateVar MortFile_vital MortFile_PHRS</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;ThisProjectType</div><div class=\"ql-code-block\">&nbsp;&nbsp;&nbsp;&nbsp;CleanHospFile CleanDINFile CleanMortVitalFile CleanMortPHRSFile</div><div class=\"ql-code-block\">;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let datastartdate='01Jan1996'd;</div><div class=\"ql-code-block\">%let dataenddate='31dec2018'd;</div><div class=\"ql-code-block\">%let clean19 =/sasdata/hisc/shared_data/HQC_share/Clean/2019 Data/Clean files ;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let Xtrc_Start_MSB ='31MAR1997'd;</div><div class=\"ql-code-block\">%let Xtrc_End_MSB = '08Oct2019'd;</div><div class=\"ql-code-block\">%let Xtrc_End_ED_A2012 = '30SEP2019'd;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;Xtrc_Start_DP_Ben*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;Xtrc_End_DP_Ben*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;Xtrc_Start_DP_NBen*/</div><div class=\"ql-code-block\">/*&nbsp;&nbsp;&nbsp;&nbsp;Xtrc_End_DP_NBen*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">libname clean19 \"&amp;clean19\";</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let Xtrc_End_Cover = '01Oct2019'd;</div><div class=\"ql-code-block\">%let PHRS_CovFile = hqc.phrs_pers_prog;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let PHRS_InfoFile = hqc.phrs_pers_info;</div><div class=\"ql-code-block\">%let PHRS_Resi_cleanFile=clean19.phrs_pers_resc_1_ond18_06feb2019;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let VerfMortFile = clean19.PHRS_DTHS_1_JFM19_16DEC2019;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let dp_benefitFile = hqc.dp_claim;</div><div class=\"ql-code-block\">%let dp_nonbenefitFile = hqc.DP_CLAIM_NON_BEN;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%let MSBFile = hqc.msb_billing;</div><div class=\"ql-code-block\">%let hospitalFile = clean19.cihi_eoc_1_jfm19_21nov2019;</div><div class=\"ql-code-block\">%let ed_a2012File = hqc.ED_F_2012;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*for remote*/</div><div class=\"ql-code-block\">%let theNGSfile = rOldDoc.NGS_FSC_SK;</div><div class=\"ql-code-block\">/*for remote*/</div><div class=\"ql-code-block\">%let theEncTypeFile = rOldDoc.Enctype;</div><div class=\"ql-code-block\">/*for remote*/</div><div class=\"ql-code-block\">%let theFacLocFile = rOldDoc.fac_loc;</div><div class=\"ql-code-block\">/*for remote*/</div><div class=\"ql-code-block\">%let theDiagMapFile=rOldDoc.SK_ZDIAG_TO_ICD9;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*include the raw file extracing macros*/</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_CIHI.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_MSB.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_Drug.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/demog_assign.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_Drug_non_ben_test.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/Addquotes.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/reformat_datevars.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%include '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_Drug_non_ben_test.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%include '/SAS_data/dw0/HQC_share/Xinya/Macros/GEO_INCQTL_assign.sas' /LRECL=32767;</div><div class=\"ql-code-block\"><br></div><div class=\"ql-code-block\">/*the following is for calculating the Charlson-elixer score*/</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_share/Clean/library_dw0.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/DataManip/Extract_MSB.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD9_E_CH_dxtype.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD9_E_EX_dxtype.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD10_CH_dxtype.sas' /LRECL=32767; </div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/StatAnal/ICD10_EX_dxtype.sas' /LRECL=32767;</div><div class=\"ql-code-block\">%INCLUDE '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/ExpandLst.sas' /LRECL=32767;</div><div class=\"ql-code-block\">/*%include '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/VarExist.sas' /LRECL=32767;*/</div><div class=\"ql-code-block\">%include '/SAS_data/dw0/HQC_Data_Lab/Macros/Util/IsEmptyDS.sas' /LRECL=32767;</div></div><p><br></p><p><br></p><p>s///</p><p>t///</p>","children":[],"custparents":[{"idx":"CodeTask-2EWZUgWyk7dvfLe9"},{"idx":"CodeTask-NrDC6oJNN34iBg5x"}]}],"custparents":[{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"},{"idx":"CodeTask-O5XVQeecDfZh8Tsa"},{"idx":"CodeTask-2EWZUgWyk7dvfLe9"},{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"},{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"}]},{"idx":"MY761326cc-0eec-4a1c-aeae-3ca72820511e","name":"Tools","custparents":[{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"},{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"},{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"},{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"},{"idx":"ProjectCollection-8BxdZeTrqJJdNGW8"}],"children":[],"_substeps":{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37","name":"substeps","custparents":[{"idx":"MY761326cc-0eec-4a1c-aeae-3ca72820511e"}],"children":[{"idx":"CodeTask-HaW91mdqQDKhx4Dg","name":"beep","type":"TASK","NodeDescription":"///t<br/>///s<br/>%beep&#59<br/>s///<br/>t///","children":[],"custparents":[{"idx":"CodeTask-qYA6cXbGlJZ99igP"},{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37"}]},{"idx":"CodeTask-n5AASdQWrOSKpmDd","name":"CDM_part01","type":"TASK","custparents":[{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37"}]},{"idx":"CodeTask-g9y4nybG5SYk1d3e","name":"local_test","type":"TASK","NodeDescription":"///t<br/>///s<br/><br/>s///<br/>t///","custparents":[{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37"}]},{"idx":"CodeTask-z4263UVKYtXBduWP","name":"TestRemote","type":"TASK","NodeDescription":"///t<br/>///s<br/>data _null_&#59run&#59<br/><br/>s///<br/>t///","custparents":[{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37"}]},{"idx":"CodeTask-Q8Ft3sPerp3NaQ17","name":"learning","type":"TASK","NodeDescription":"///t<br/>///s<br/>/*Learning*/<br/>%macro notrun&#59<br/><br/>/*wrong*/<br/>data diagnosis_tmp1f&#59<br/>&nbsp&nbsp&nbsp&nbspi=1&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp1e (obs=500)&#59<br/>&nbsp&nbsp&nbsp&nbspby ADate PatID Provider EncType&#59<br/>&nbsp&nbsp&nbsp&nbspif first.EncType then i+1&#59<br/>&nbsp&nbsp&nbsp&nbspOrigDX = diag&#59<br/>&nbsp&nbsp&nbsp&nbspif diag in: ('Z') then DX = diag_code&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX = OrigDX&#59<br/>&nbsp&nbsp&nbsp&nbspif DX='' then DX_codetype='OT'&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX_codetype='09'&#59<br/>&nbsp&nbsp&nbsp&nbspPX = NGS_Category&#59<br/>&nbsp&nbsp&nbsp&nbspOrigPX = FSC&#59<br/>&nbsp&nbsp&nbsp&nbspdrop diag OrigPX&#59<br/>run&#59<br/>/*correct*/<br/>data diagnosis_tmp1f&#59<br/>&nbsp&nbsp&nbsp&nbspretain i&#59<br/>&nbsp&nbsp&nbsp&nbspset diagnosis_tmp1e (obs=500)&#59<br/>&nbsp&nbsp&nbsp&nbspby ADate PatID Provider EncType&#59<br/>&nbsp&nbsp&nbsp&nbspif first.EncType then i+1&#59<br/>&nbsp&nbsp&nbsp&nbspOrigDX = diag&#59<br/>&nbsp&nbsp&nbsp&nbspif diag in: ('Z') then DX = diag_code&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX = OrigDX&#59<br/>&nbsp&nbsp&nbsp&nbspif DX='' then DX_codetype='OT'&#59<br/>&nbsp&nbsp&nbsp&nbspelse DX_codetype='09'&#59<br/>&nbsp&nbsp&nbsp&nbspPX = NGS_Category&#59<br/>&nbsp&nbsp&nbsp&nbspOrigPX = FSC&#59<br/>&nbsp&nbsp&nbsp&nbspdrop diag OrigPX&#59<br/>run&#59<br/><br/>%mend notrun&#59<br/>s///<br/>t///","custparents":[{"idx":"MYa37307ee-9fe5-4478-af33-a464f58dde37"}]}]}}],"NodeDescription":"<p>///t</p><p>This tree diagram is based on:</p><p>F:\\Personal\\Dropbox\\Project\\CNODEs_CDM\\PilotV910_20191218.egp</p><p>t///</p>"}]